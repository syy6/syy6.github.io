/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/comp/library","sap/suite/ui/microchart/library","sap/ui/core/Control","sap/ui/model/odata/CountMode","sap/ui/comp/smartmicrochart/SmartMicroChartCommons","sap/ui/core/format/DateFormat","sap/m/library","sap/base/Log","sap/suite/ui/microchart/ColumnMicroChart","sap/suite/ui/microchart/ColumnMicroChartData","sap/suite/ui/microchart/ColumnMicroChartLabel"],function(C,M,a,b,S,D,m,L,c,d,e){"use strict";var f=m.Size;var g=a.extend("sap.ui.comp.smartmicrochart.SmartColumnMicroChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartmicrochart/SmartColumnMicroChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:"Column"},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"}},defaultAggregation:"_chart",aggregations:{_chart:{type:"sap.suite.ui.microchart.ColumnMicroChart",multiple:false,visibility:"hidden"}},associations:{chartTitle:{type:"sap.m.Label",group:"Misc",multiple:false},chartDescription:{type:"sap.m.Label",group:"Misc",multiple:false},unitOfMeasure:{type:"sap.m.Label",group:"Misc",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{initialize:{}}},renderer:"sap.ui.comp.smartmicrochart.SmartMicroChartRenderer"});g._CHART_TYPE=["Column"];g.prototype.init=function(){this._bIsInitialized=false;this._bMetaModelLoadAttached=false;this.setAggregation("_chart",new c(),true);};g.prototype.onBeforeRendering=function(){var o=this.getAggregation("_chart");if(this.getIsResponsive()){o.setProperty("size",f.Responsive,true);o.setProperty("width",null,true);o.setProperty("height",null,true);}else{o.setProperty("size",f.Auto,true);o.setProperty("width",this.getWidth(),true);o.setProperty("height",this.getHeight(),true);}M._passParentContextToChild(this,o);};g.prototype.exit=function(){S._cleanup.call(this);};g.prototype.setEntitySet=function(E){if(this.getProperty("entitySet")!==E){this.setProperty("entitySet",E,true);S._initializeMetadata.call(this);}return this;};g.prototype.setShowLabel=function(s){var o;if(this.getShowLabel()!==s){o=this.getAggregation("_chart");this.setProperty("showLabel",s,true);o.setProperty("showTopLabels",s,true);o.setProperty("showBottomLabels",s,true);o.invalidate();}return this;};g.prototype.addAriaLabelledBy=function(A){this.addAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").addAriaLabelledBy(A);return this;};g.prototype.removeAriaLabelledBy=function(A){this.removeAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").removeAriaLabelledBy(A);return this;};g.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);this.getAggregation("_chart").removeAllAriaLabelledBy();return this;};g.prototype.setChartType=function(){return this;};g.prototype.propagateProperties=function(){if(a.prototype.propagateProperties){a.prototype.propagateProperties.apply(this,arguments);}S._initializeMetadata.call(this);};g.prototype._getBindingPath=function(){if(this.getChartBindingPath()){return this.getChartBindingPath();}else if(this.getEntitySet()){return"/"+this.getEntitySet();}else{return"";}};g.prototype._createAndBindInnerChart=function(){if(this._aDataPointAnnotations.length===0){L.error("DataPoint annotation missing! Cannot create the SmartColumnMicroChart");return;}if(!(this._aDataPointAnnotations[0].Value&&this._aDataPointAnnotations[0].Value.Path)){L.error("Value DataPoint annotation missing! Cannot create the SmartColumnMicroChart");return;}var o=this.getAggregation("_chart"),h=new d({value:{path:this._aDataPointAnnotations[0].Value.Path,type:"sap.ui.model.odata.type.Decimal"}});if(this._aDataPointAnnotations[0].Criticality&&this._aDataPointAnnotations[0].Criticality.Path){h.bindProperty("color",this._aDataPointAnnotations[0].Criticality.Path);}if(this._aDataPointAnnotations[0].Title&&this._aDataPointAnnotations[0].Title.Path){h.bindProperty("label",this._aDataPointAnnotations[0].Title.Path);}var A=S._getPropertyAnnotation.call(this,this._aDataPointAnnotations[0].Value.Path);var i=A["com.sap.vocabularies.Common.v1.Text"];if(i&&i.Path){o.setAllowColumnLabels(true);h.bindProperty("displayValue",i.Path);}o.bindAggregation("columns",{path:this._getBindingPath(),template:h,events:{change:this._onBindingDataChange.bind(this)}});this._createChartLabels();};g.prototype._createChartLabels=function(){var l,o=this._getLabelsMap();for(var k in o){l=new e();this.getAggregation("_chart").setAggregation(o[k],l,true);}};g.prototype._onBindingDataChange=function(){var p=this.getAggregation("_chart").getBinding("columns");this._updateAssociations(p);S.updateChartLabels.call(this,p);};g.prototype._updateAssociations=function(p){var o=p.getContexts(0,1)[0],h=o&&o.getObject();S._updateAssociations.call(this,h);};g.prototype._updateLabel=function(n,o){var l=this.getAggregation("_chart").getAggregation(n);l.setProperty("label",o.text,true);if(o.color){l.setProperty("color",o.color,true);}};g.prototype._getSupportedChartTypes=function(){return g._CHART_TYPE;};g.prototype._getLabelsMap=function(){return{"leftTop":"leftTopLabel","rightTop":"rightTopLabel","leftBottom":"leftBottomLabel","rightBottom":"rightBottomLabel"};};g.prototype.getAccessibilityInfo=function(){return S._getAccessibilityInfo.apply(this);};return g;});
