/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/comp/library","sap/ui/core/Control","sap/suite/ui/microchart/library","sap/m/library","sap/ui/comp/smartmicrochart/SmartMicroChartCommons"],function(l,C,M,a,S){"use strict";var b=a.Size;var V=a.ValueColor;var c=C.extend("sap.ui.comp.smartmicrochart.SmartBulletMicroChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartmicrochart/SmartBulletMicroChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},chartType:{type:"string",group:"Misc",defaultValue:"Bullet"},enableAutoBinding:{type:"boolean",group:"Misc",defaultValue:false},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:"164px"},height:{type:"sap.ui.core.CSSSize",group:"Misc"},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false}},defaultAggregation:"_chart",aggregations:{_criticalityThresholds:{type:"sap.ui.core.CustomData",multiple:true,visibility:"hidden"},_chart:{type:"sap.suite.ui.microchart.BulletMicroChart",multiple:false,visibility:"hidden"}},associations:{chartTitle:{type:"sap.m.Label",group:"Misc",multiple:false},chartDescription:{type:"sap.m.Label",group:"Misc",multiple:false},unitOfMeasure:{type:"sap.m.Label",group:"Misc",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{initialize:{}}},renderer:"sap.ui.comp.smartmicrochart.SmartMicroChartRenderer"});c._CRITICAL_COLOR=V.Critical;c._ERROR_COLOR=V.Error;c._CHART_TYPE=["Bullet"];c.prototype.init=function(){this._bIsInitialized=false;this._bMetaModelLoadAttached=false;this._bBarColorSet=false;this.setProperty("chartType","Bullet",true);this.setAggregation("_chart",new M.BulletMicroChart({"showValueMarker":true}),true);};c.prototype.setChartType=function(){return this;};c.prototype.setEntitySet=function(e){if(this.getProperty("entitySet")!==e){this.setProperty("entitySet",e,true);S._initializeMetadata.call(this);}return this;};c.prototype.setShowLabel=function(s){if(this.getShowLabel()!==s){this.setProperty("showLabel",s,true);var o=this.getAggregation("_chart");o.setProperty("showActualValue",s,true);o.setProperty("showTargetValue",s,true);o.setProperty("showDeltaValue",s,true);o.setProperty("showValueMarker",s,true);this.invalidate();}return this;};c.prototype.addAriaLabelledBy=function(A){this.addAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").addAriaLabelledBy(A);return this;};c.prototype.removeAriaLabelledBy=function(A){this.removeAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").removeAriaLabelledBy(A);return this;};c.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);this.getAggregation("_chart").removeAllAriaLabelledBy();return this;};c.prototype.propagateProperties=function(){if(C.prototype.propagateProperties){C.prototype.propagateProperties.apply(this,arguments);}S._initializeMetadata.call(this);};c.prototype.onBeforeRendering=function(){var o=this.getAggregation("_chart");if(this.getIsResponsive()){o.setProperty("size",b.Responsive,true);o.setProperty("width",null,true);o.setProperty("height",null,true);}else{o.setProperty("size",b.Auto,true);o.setProperty("width",this.getWidth(),true);o.setProperty("height",this.getHeight(),true);}o.setIsResponsive(this.getIsResponsive());M._passParentContextToChild(this,o);};c.prototype.destroy=function(){S._cleanup.call(this);C.prototype.destroy.apply(this,arguments);};c.prototype._createAndBindInnerChart=function(){this._bindValueProperties();this._bindActualValue();this._bindChartThresholds();S._updateAssociations.call(this);this._setMode();};c.prototype._setMode=function(){if(S._hasMember(this,"_oDataPointAnnotations.Visualization.EnumMember")){if(this._oDataPointAnnotations.Visualization.EnumMember===S._DELTABULLET){this.getAggregation("_chart").setMode(M.BulletMicroChartModeType.Delta);}}};c.prototype._bindValueProperties=function(){var m,f,i=this.getAggregation("_chart");if(S._hasMember(this,"_oDataPointAnnotations.TargetValue.Path")){i.bindProperty("targetValue",{path:this._oDataPointAnnotations.TargetValue.Path,type:"sap.ui.model.odata.type.Decimal"});var F=S._getLabelNumberFormatter.call(this,this._oDataPointAnnotations.TargetValue.Path);i.bindProperty("targetValueLabel",{path:this._oDataPointAnnotations.TargetValue.Path,formatter:F.format.bind(F)});}if(S._hasMember(this,"_oDataPointAnnotations.ForecastValue.Path")){i.bindProperty("forecastValue",{path:this._oDataPointAnnotations.ForecastValue.Path,type:"sap.ui.model.odata.type.Decimal"});}if(this._oDataPointAnnotations.MaximumValue){if(this._oDataPointAnnotations.MaximumValue.hasOwnProperty("Path")){i.bindProperty("maxValue",{path:this._oDataPointAnnotations.MaximumValue.Path,type:"sap.ui.model.odata.type.Decimal"});}else if(this._oDataPointAnnotations.MaximumValue.hasOwnProperty("Decimal")){m=parseFloat(this._oDataPointAnnotations.MaximumValue.Decimal);i.setMaxValue(m,true);}}if(this._oDataPointAnnotations.MinimumValue){if(this._oDataPointAnnotations.MinimumValue.hasOwnProperty("Path")){i.bindProperty("minValue",{path:this._oDataPointAnnotations.MinimumValue.Path,type:"sap.ui.model.odata.type.Decimal"});}else if(this._oDataPointAnnotations.MinimumValue.hasOwnProperty("Decimal")){f=parseFloat(this._oDataPointAnnotations.MinimumValue.Decimal);i.setMinValue(f,true);}}};c.prototype._bindActualValue=function(){var i=this.getAggregation("_chart"),f=S._getLabelNumberFormatter.call(this,this._oDataPointAnnotations.Value.Path);var o=new M.BulletMicroChartData({value:{path:this._oDataPointAnnotations.Value.Path,type:"sap.ui.model.odata.type.Decimal"},color:{parts:[this._oDataPointAnnotations.Value&&this._oDataPointAnnotations.Value.Path||"",this._oDataPointAnnotations.Criticality&&this._oDataPointAnnotations.Criticality.Path||""],formatter:S._getValueColor.bind(this)}});i.setAggregation("actual",o,true);i.bindProperty("actualValueLabel",{path:this._oDataPointAnnotations.Value.Path,formatter:f.format.bind(f)});};c.prototype._bindChartThresholds=function(){var d,o;if(S._hasMember(this._oDataPointAnnotations,"CriticalityCalculation.ImprovementDirection.EnumMember")){o=this._oDataPointAnnotations.CriticalityCalculation;d=o.ImprovementDirection.EnumMember;if(d!==S._MINIMIZE&&o.DeviationRangeLowValue&&o.DeviationRangeLowValue.Path){this._bindThresholdAggregation(o.DeviationRangeLowValue.Path,c._ERROR_COLOR);}if(d!==S._MINIMIZE&&o.ToleranceRangeLowValue&&o.ToleranceRangeLowValue.Path){this._bindThresholdAggregation(o.ToleranceRangeLowValue.Path,c._CRITICAL_COLOR);}if(d!==S._MAXIMIZE&&o.ToleranceRangeHighValue&&o.ToleranceRangeHighValue.Path){this._bindThresholdAggregation(o.ToleranceRangeHighValue.Path,c._CRITICAL_COLOR);}if(d!==S._MAXIMIZE&&o.DeviationRangeHighValue&&o.DeviationRangeHighValue.Path){this._bindThresholdAggregation(o.DeviationRangeHighValue.Path,c._ERROR_COLOR);}}};c.prototype._bindThresholdAggregation=function(p,s){var t=new M.BulletMicroChartData({value:{path:p,type:"sap.ui.model.odata.type.Decimal"},color:s});this.getAggregation("_chart").addAggregation("thresholds",t,true);};c.prototype.setAssociation=function(A,i,s){if(C.prototype.setAssociation){C.prototype.setAssociation.apply(this,arguments);}S._updateAssociation.call(this,A);return this;};c.prototype._getSupportedChartTypes=function(){return c._CHART_TYPE;};c.prototype.getAccessibilityInfo=function(){return S._getAccessibilityInfo.apply(this);};return c;});
