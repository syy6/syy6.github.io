/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/comp/library","sap/suite/ui/microchart/library","sap/ui/core/Control","sap/ui/model/odata/CountMode","sap/ui/comp/smartmicrochart/SmartMicroChartCommons","sap/ui/core/format/DateFormat","sap/m/library","sap/base/Log","sap/suite/ui/microchart/LineMicroChart","sap/suite/ui/microchart/LineMicroChartLine","sap/suite/ui/microchart/LineMicroChartPoint","sap/suite/ui/microchart/LineMicroChartEmphasizedPoint"],function(C,M,a,b,S,D,m,L,c,d,e,f){"use strict";var g=m.Size;var h=a.extend("sap.ui.comp.smartmicrochart.SmartLineMicroChart",{metadata:{library:"sap.ui.comp",designtime:"sap/ui/comp/designtime/smartmicrochart/SmartLineMicroChart.designtime",properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},chartType:{type:"string",group:"Misc",defaultValue:"Line"},chartBindingPath:{type:"string",group:"Misc",defaultValue:null},showLabel:{type:"boolean",group:"Appearance",defaultValue:true},isResponsive:{type:"boolean",group:"Appearance",defaultValue:false},width:{type:"sap.ui.core.CSSSize",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Misc"}},defaultAggregation:"_chart",aggregations:{_chart:{type:"sap.suite.ui.microchart.LineMicroChart",multiple:false,visibility:"hidden"},_chartTexts:{type:"sap.m.ListBase",multiple:false,visibility:"hidden"}},associations:{chartTitle:{type:"sap.m.Label",group:"Misc",multiple:false},chartDescription:{type:"sap.m.Label",group:"Misc",multiple:false},unitOfMeasure:{type:"sap.m.Label",group:"Misc",multiple:false},ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{initialize:{}}},renderer:"sap.ui.comp.smartmicrochart.SmartMicroChartRenderer"});h._CHART_TYPE=["Line"];h.prototype.init=function(){this._bIsInitialized=false;this._bMetaModelLoadAttached=false;this.setAggregation("_chart",new c({showThresholdLine:false}),true);};h.prototype.onBeforeRendering=function(){var o=this.getAggregation("_chart");if(this.getIsResponsive()){o.setProperty("size",g.Responsive,true);o.setProperty("width",null,true);o.setProperty("height",null,true);}else{o.setProperty("size",g.Auto,true);o.setProperty("width",this.getWidth(),true);o.setProperty("height",this.getHeight(),true);}M._passParentContextToChild(this,o);};h.prototype.exit=function(){S._cleanup.call(this);};h.prototype.setEntitySet=function(E){if(this.getProperty("entitySet")!==E){this.setProperty("entitySet",E,true);S._initializeMetadata.call(this);}return this;};h.prototype.setShowLabel=function(s){var o;if(this.getShowLabel()!==s){o=this.getAggregation("_chart");this.setProperty("showLabel",s,true);o.setProperty("showTopLabels",s,true);o.setProperty("showBottomLabels",s,true);o.invalidate();}return this;};h.prototype.addAriaLabelledBy=function(A){this.addAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").addAriaLabelledBy(A);return this;};h.prototype.removeAriaLabelledBy=function(A){this.removeAssociation("ariaLabelledBy",A,true);this.getAggregation("_chart").removeAriaLabelledBy(A);return this;};h.prototype.removeAllAriaLabelledBy=function(){this.removeAllAssociation("ariaLabelledBy",true);this.getAggregation("_chart").removeAllAriaLabelledBy();return this;};h.prototype.setChartType=function(){return this;};h.prototype.propagateProperties=function(){if(a.prototype.propagateProperties){a.prototype.propagateProperties.apply(this,arguments);}S._initializeMetadata.call(this);};h.prototype._getBindingPath=function(){if(this.getChartBindingPath()){return this.getChartBindingPath();}else if(this.getEntitySet()){return"/"+this.getEntitySet();}else{return"";}};h.prototype._createAndBindInnerChart=function(){if(this._aDataPointAnnotations.length===0){L.error("DataPoint annotation missing! Cannot create the SmartLineMicroChart");return;}for(var i=0;i<this._aDataPointAnnotations.length;i++){if(!(this._aDataPointAnnotations[i].Value&&this._aDataPointAnnotations[i].Value.Path)){L.error("Value DataPoint annotation missing! Cannot create the SmartLineMicroChart");return;}}var o=this.getAggregation("_chart"),l;this._aDataPointAnnotations.forEach(function(j,I){l=new d(this.getId()+"-line-"+I,{points:{path:this._getBindingPath(),factory:this._pointFactory.bind(this),events:{change:this._onBindingDataChange.bind(this)}}});o.addLine(l);},this);};h.prototype._pointFactory=function(i,o){var x,y,p,l=i.split("-").slice(-2,-1),j=this.getAggregation("_chart").getLines()[l],k=this._aDataPointAnnotations[l];x=o.getProperty(this._oChartViewMetadata.dimensionFields[l]);x=S._formatDimension.call(this,x);y=o.getProperty(k.Value.Path);y=Number(y);p=new e({x:x,y:y});if(j&&k.Criticality&&k.Criticality.Path){this.getAggregation("_chart").getLines()[l].setColor(o.getProperty(k.Criticality.Path));}return p;};h.prototype._onBindingDataChange=function(){var p=this.getAggregation("_chart").getLines()[0].getBinding("points");this._updateAssociations(p);S.updateChartLabels.call(this,p);};h.prototype._updateAssociations=function(p){var o=p.getContexts(0,1)[0],i=o&&o.getObject();S._updateAssociations.call(this,i);};h.prototype._updateLabel=function(n,o){this.getAggregation("_chart").setProperty(n,o.text,true);};h.prototype._getSupportedChartTypes=function(){return h._CHART_TYPE;};h.prototype._getLabelsMap=function(){return{"leftTop":"leftTopLabel","rightTop":"rightTopLabel","leftBottom":"leftBottomLabel","rightBottom":"rightBottomLabel"};};h.prototype.getAccessibilityInfo=function(){return S._getAccessibilityInfo.apply(this);};return h;});
