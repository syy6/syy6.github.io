/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../Scene","./NodeHierarchy"],function(q,S,N){"use strict";var a=S.extend("sap.ui.vk.threejs.Scene",{metadata:{},constructor:function(s){S.call(this);this._id=q.sap.uid();this._scene=s;this._state=null;this._defaultNodeHierarchy=null;this._currentViewStateManager=null;}});a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._state=null;this._scene=null;S.prototype.destroy.call(this);};a.prototype.setDoubleSided=function(v){this.setProperty("doubleSided",v,true);this._scene.traverse(function(n){if(n.material!==undefined){var u=n.userData;var o=THREE.FrontSide;var m;if(u.originalMaterial){if(u.originalMaterial.userData===undefined){u.originalMaterial.userData={};}m=u.originalMaterial.userData;if(m.originalMaterialSide===undefined){m.originalMaterialSide=u.originalMaterial.side;}o=m.originalMaterialSide;}else{if(n.material.userData===undefined){n.material.userData={};}m=n.material.userData;if(m.originalMaterialSide===undefined){m.originalMaterialSide=n.material.side;}o=m.originalMaterialSide;}n.material.side=v?THREE.DoubleSide:o;}});return this;};a.prototype.setViewStateManager=function(v){this._currentViewStateManager=v;return this;};a.prototype.getViewStateManager=function(){return this._currentViewStateManager;};a.prototype.getId=function(){return this._id;};a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var t=m[0]*g+m[4]*h+m[8]*i+m[12];var n=m[1]*g+m[5]*h+m[9]*i+m[13];var o=m[2]*g+m[6]*h+m[10]*i+m[14];var p=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var r=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var s=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(t-p,n-r,o-s);f.set(t+p,n+r,o+s);}THREE.Object3D.prototype._expandBoundingBox=function(c,v){var n=new THREE.Box3();function e(d){var g=d.geometry;if(g!==undefined){if(!g.boundingBox){g.computeBoundingBox();}if(!g.boundingBox.isEmpty()){n.copy(g.boundingBox);b(n,d.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}var s=d.userData.boundingBox;if(s!==undefined&&!s.isEmpty()&&!v){n.copy(s);b(n,d.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}this.updateMatrixWorld();if(v){this.traverseVisible(e);}else{this.traverse(e);}return c;};a.prototype._computeBoundingBox=function(v){var c=new THREE.Box3();if(this._scene){this._scene._expandBoundingBox(c,v);}return c;};a.prototype.getSceneRef=function(){return this._scene;};a.prototype._setState=function(s){this._state=s;};a.prototype.nodeRefToPersistentId=function(n){var s=this._state;if(Array.isArray(n)){if(!s){return[];}var i=[];n.forEach(function(c){i.push(s.object3DToSid(c));});return i;}else{if(!s){return null;}return s.object3DToSid(n);}};a.prototype.persistentIdToNodeRef=function(p){var s=this._state;if(Array.isArray(p)){if(!s){return[];}var n=[];p.forEach(function(c){n.push(s.sidToObject3D(c));});return n;}else{if(!s){return null;}return s.sidToObject3D(p);}};a.prototype.enumerateMaterials=function(){if(!this._defaultNodeHierarchy){return[];}var t=this._defaultNodeHierarchy.createNodeProxy(this._scene);if(t){return t.enumerateMaterials(true);}else{return[];}};return a;});
