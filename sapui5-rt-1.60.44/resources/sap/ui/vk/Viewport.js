/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./ViewportBase","./ContentConnector","./ViewStateManager"],function(q,V,C,a){"use strict";var b=V.extend("sap.ui.vk.Viewport",{metadata:{library:"sap.ui.vk"}});var c=b.getMetadata().getParent().getClass().prototype;b.prototype.init=function(){if(c.init){c.init.call(this);}this._implementation=null;this._deferred={};};b.prototype.exit=function(){this._deferred=null;this._destroyImplementation();if(c.exit){c.exit.call(this);}};b.prototype.getImplementation=function(){return this._implementation;};b.prototype._destroyImplementation=function(){if(this._implementation){this._implementation.destroy();this._implementation=null;}return this;};b.prototype.getShowDebugInfo=function(){if(this._implementation){return this._implementation.getShowDebugInfo();}return c.getShowDebugInfo.call(this);};b.prototype.setShowDebugInfo=function(v){c.setShowDebugInfo.call(this,v);if(this._implementation){this._implementation.setShowDebugInfo(v);}return this;};b.prototype.getBackgroundColorTop=function(){if(this._implementation){return this._implementation.getBackgroundColorTop();}return c.getBackgroundColorTop.call(this);};b.prototype.setBackgroundColorTop=function(v){c.setBackgroundColorTop.call(this,v);if(this._implementation){this._implementation.setBackgroundColorTop(v);}return this;};b.prototype.getBackgroundColorBottom=function(){if(this._implementation){return this._implementation.getBackgroundColorBottom();}return c.getBackgroundColorBottom.call(this);};b.prototype.setBackgroundColorBottom=function(v){c.setBackgroundColorBottom.call(this,v);if(this._implementation){this._implementation.setBackgroundColorBottom(v);}return this;};b.prototype.setWidth=function(v){c.setWidth.call(this,v);if(this._implementation){this._implementation.setWidth(v);}return this;};b.prototype.setHeight=function(v){c.setHeight.call(this,v);if(this._implementation){this._implementation.setHeight(v);}return this;};b.prototype.setSelectionMode=function(v){c.setSelectionMode.call(this,v);if(this._implementation){this._implementation.setSelectionMode(v);}return this;};b.prototype.getSelectionMode=function(){if(this._implementation){return this._implementation.getSelectionMode();}return c.getSelectionMode.call(this);};b.prototype.setCamera=function(v){c.setCamera.call(this,v);if(this._implementation){this._implementation.setCamera(v);return this;}return this;};b.prototype.getCamera=function(){if(this._implementation){return this._implementation.getCamera();}return c.getCamera.call(this);};b.prototype.setShouldRenderFrame=function(){if(this._implementation){this._implementation.setShouldRenderFrame();}return this;};b.prototype.shouldRenderFrame=function(){if(this._implementation){this._implementation.shouldRenderFrame();}};b.prototype.setFreezeCamera=function(v){c.setFreezeCamera.call(this,v);if(this._implementation){this._implementation.setFreezeCamera(v);}return this;};b.prototype._setContent=function(i){var j=null;var k=null;if(i){j=i;if(!(j instanceof sap.ui.vk.Scene)){j=null;}k=i.camera;if(!(k instanceof sap.ui.vk.Camera)){k=null;}}this._setScene(j);if(k){this.setCamera(k);}};b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};b.prototype._onBeforeClearContentConnector=function(){if(c._onBeforeClearContentConnector){c._onBeforeClearContentConnector.call(this);}this._setScene(null);};b.prototype._handleContentReplaced=function(i){var j=i.getParameter("newContent");this._setContent(j);};b.prototype._setScene=function(i){if(i instanceof sap.ui.vk.Scene){var j=i.getMetadata().getName(),k=this._implementation&&this._implementation.getMetadata().getName(),r=j==="sap.ui.vk.dvl.Scene"&&k==="sap.ui.vk.dvl.Viewport"||j==="sap.ui.vk.threejs.Scene"&&k==="sap.ui.vk.threejs.Viewport";if(!r){this._destroyImplementation();var n;var t=this;var l=this.getCamera();if(j==="sap.ui.vk.dvl.Scene"){n="sap.ui.vk.dvl.Viewport";}else if(j==="sap.ui.vk.threejs.Scene"){n="sap.ui.vk.threejs.Viewport";}if(n){q.sap.require(n);this._implementation=new(q.sap.getObject(n))({viewStateManager:this.getViewStateManager(),urlClicked:function(m){t.fireUrlClicked({nodeRef:m.getParameter("nodeRef"),url:m.getParameter("url")});},nodeClicked:function(m){t.fireNodeClicked({nodeRef:m.getParameter("nodeRef"),x:m.getParameter("x"),y:m.getParameter("y")});},resize:function(m){t.fireResize({size:m.getParameter("size")});},showDebugInfo:this.getShowDebugInfo(),width:this.getWidth(),height:this.getHeight(),backgroundColorTop:this.getBackgroundColorTop(),backgroundColorBottom:this.getBackgroundColorBottom(),selectionMode:this.getSelectionMode(),contentConnector:this.getContentConnector(),freezeCamera:this.getFreezeCamera()});if(l){this._camera=null;this._implementation.setCamera(l);}if("graphicsCore"in this._deferred&&this._implementation.setGraphicsCore){this._implementation.setGraphicsCore(this._deferred.graphicsCore);}delete this._deferred.graphicsCore;if("scene"in this._deferred&&this._implementation.setScene){this._implementation.setScene(this._deferred.scene);}delete this._deferred.scene;this._implementation.attachNodesPicked(function(m){this.fireNodesPicked({picked:m.getParameter("picked")});},this);this._implementation.attachNodeZoomed(function(m){this.fireNodeZoomed({zoomed:m.getParameter("zoomed"),isZoomIn:m.getParameter("isZoomIn")});},this);}this.invalidate();}}else{this._destroyImplementation();this.invalidate();}return this;};b.prototype._onAfterUpdateViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(this._viewStateManager);}};b.prototype._onBeforeClearViewStateManager=function(){if(this._implementation){this._implementation.setViewStateManager(null);}};b.prototype.activateView=function(v){if(this._implementation){this._implementation.activateView(v);return this;}else{q.sap.log.error("no implementation");return this;}};b.prototype.zoomTo=function(w,n,i,m){if(this._implementation){this._implementation.zoomTo(w,n,i,m);return this;}else{q.sap.log.error("no implementation");return this;}};var s=function(i){i.camera={};};var d=function(i){if(typeof i.camera==="object"&&i.camera!==null){i.camera.matrices=false;}};var e=function(i){if(typeof i.camera==="object"&&i.camera!==null){i.camera.useTransitionCamera=false;}};var f=function(i){i.animation=true;};var g=function(i){i.visibility=false;};var h=function(i){if(typeof i.visibility==="object"&&i.visibility!==null){i.visibility.mode=sap.ui.vk.VisibilityMode.Complete;}};b.prototype.getViewInfo=function(i){if(!this._implementation){q.sap.log.error("no implementation");return null;}var j={};if(typeof i!=="object"||i===null){s(j);d(j);e(j);f(j);g(j);h(j);}else{if(typeof i.camera==="object"&&i.camera!==null){j.camera={};if(typeof i.camera.matrices==="boolean"){j.camera.matrices=i.camera.matrices;}else if("matrices"in i.camera){j.camera.matrices=false;}else{d(j);}if(typeof i.camera.useTransitionCamera==="boolean"){j.camera.useTransitionCamera=i.camera.useTransitionCamera;}else if("useTransitionCamera"in i.camera){j.camera.useTransitionCamera=false;}else{e(j);}}else if(typeof i.camera==="boolean"){if(i.camera===true){j.camera={};d(j);e(j);}else{j.camera=false;}}else if("camera"in i){j.camera=false;}else{s(j);d(j);e(j);}if(typeof i.animation==="boolean"){j.animation=i.animation;}else if("animation"in i){j.animation=false;}else{f(j);}if(typeof i.visibility==="object"&&i.visibility!==null){j.visibility={};if(i.visibility.mode===sap.ui.vk.VisibilityMode.Complete||i.visibility.mode===sap.ui.vk.VisibilityMode.Differences){j.visibility.mode=i.visibility.mode;}else{h(j);}}else if(typeof i.visibility==="boolean"){if(i.visibility===true){j.visibility={};h(j);}else{j.visibility=false;}}else if("visibility"in i){j.visibility=false;}else{g(j);h(j);}}return this._implementation.getViewInfo(j);};b.prototype.setViewInfo=function(v,i){if(this._implementation){this._implementation.setViewInfo(v,i);}else{q.sap.log.error("no implementation");}return this;};b.prototype.getImage=function(w,i,t,j){if(this._implementation&&this._implementation.getImage){return this._implementation.getImage(w,i,t,j);}return null;};C.injectMethodsIntoClass(b);a.injectMethodsIntoClass(b);return b;});
