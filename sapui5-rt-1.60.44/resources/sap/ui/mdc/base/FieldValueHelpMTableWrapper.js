/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2018 SAP SE. All rights reserved
	
 */
sap.ui.define(['./FieldValueHelpContentWrapperBase','sap/ui/model/ChangeReason','sap/ui/base/ManagedObjectObserver','sap/base/strings/capitalize','sap/m/ListMode'],function(F,C,M,c,L){"use strict";var S;var a=F.extend("sap.ui.mdc.base.FieldValueHelpMTableWrapper",{metadata:{library:"sap.ui.mdc",aggregations:{table:{type:"sap.m.Table",multiple:false}},defaultAggregation:"table",events:{dataUpdate:{}}}});a.prototype.init=function(){F.prototype.init.apply(this,arguments);this._oObserver=new M(b.bind(this));this._oObserver.observe(this,{properties:["selectedItems"],aggregations:["table"]});};a.prototype.exit=function(){F.prototype.exit.apply(this,arguments);if(this._oScrollContainer){this._oScrollContainer.destroy();delete this._oScrollContainer;}this._oObserver.disconnect();this._oObserver=undefined;};a.prototype.invalidate=function(O){if(O){var t=this.getTable();if(t&&O===t){if(O.bOutput){var s=sap.ui.getCore().getStaticAreaRef();s=sap.ui.getCore().getUIArea(s);if(s.addInvalidatedControl){s.addInvalidatedControl(O);}}return;}}F.prototype.invalidate.apply(this,arguments);};a.prototype.initialize=function(s){if(s||this._oScrollContainer){return;}if(!S&&!this._bScrollContainerRequested){S=sap.ui.require("sap/m/ScrollContainer");if(!S){sap.ui.require(["sap/m/ScrollContainer"],_.bind(this));this._bScrollContainerRequested=true;}}if(S&&!this._bScrollContainerRequested){this._oScrollContainer=new S(this.getId()+"-SC",{height:"100%",width:"100%",vertical:true});this._oScrollContainer._oWrapper=this;this._oScrollContainer.getContent=function(){var i=[];var t=this._oWrapper&&this._oWrapper.getTable();if(t){i.push(t);}return i;};}return this;};function _(s){S=s;this._bScrollContainerRequested=false;if(!this._bIsBeingDestroyed){this.initialize();this.fireDataUpdate({contentChange:true});}}a.prototype.getDialogContent=function(){return this._oScrollContainer;};a.prototype.getSuggestionContent=function(){return this.getTable();};a.prototype.fieldHelpOpen=function(s){F.prototype.fieldHelpOpen.apply(this,arguments);var t=this.getTable();if(t){e.call(this,t,s);l.call(this);if(s){var i=t.getSelectedItem();if(i&&i.getDomRef()){i.getDomRef().scrollIntoView();}}}return this;};a.prototype.navigate=function(s){var t=this.getTable();if(!o(t)){this._bNavigate=true;this._iStep=s;return;}var i=t.getSelectedItem();var I=t.getItems();var j=I.length;var p=0;if(i){p=t.indexOfItem(i);p=p+s;}else if(s>=0){p=s-1;}else{p=j+s;}if(p<0){p=0;}else if(p>=j-1){p=j-1;}var q=I[p];if(q&&q!==i){q.setSelected(true);var v=m.call(this,q);if(q.getDomRef()){q.getDomRef().scrollIntoView();}this.setSelectedItems([{key:v.key,description:v.description}]);this.fireNavigate({key:v.key,description:v.description});}};a.prototype.getTextForKey=function(K){var t="";var T=this.getTable();if(o(T)){var I=T.getItems();for(var i=0;i<I.length;i++){var j=I[i];var v=m.call(this,j);if(v.key===K){t=v.description;break;}}}return t;};a.prototype.getKeyForText=function(t){var K;var T=this.getTable();if(o(T)){var I=T.getItems();for(var i=0;i<I.length;i++){var j=I[i];var v=m.call(this,j);if(v.description===t){K=v.key;break;}}}return K;};a.prototype.getListBinding=function(){var t=this.getTable();var i;if(t){i=t.getBinding("items");}return i;};function b(i){if(i.name==="table"){d.call(this,i.mutation,i.child);}if(i.name==="selectedItems"){l.call(this);}}function d(s,t){if(s==="remove"){t.detachEvent("itemPress",f,this);t.detachEvent("selectionChange",g,this);t.detachEvent("updateFinished",k,this);t=undefined;}else{t.setMode(L.SingleSelectMaster);t.setRememberSelections(false);t.attachEvent("itemPress",f,this);t.attachEvent("selectionChange",g,this);t.attachEvent("updateFinished",k,this);e.call(this,t,this._bSuggestion);l.call(this);if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);}}this.fireDataUpdate({contentChange:true});}function e(t,s){if(t&&this.getParent()){if(s){if(this._sTableWidth){t.setWidth(this._sTableWidth);}t.setMode(L.SingleSelectMaster);}else{this._sTableWidth=t.getWidth();t.setWidth("100%");if(this._getMaxConditions()===1){t.setMode(L.SingleSelectLeft);}else{t.setMode(L.MultiSelect);}}}}function f(E){var i=E.getParameter("listItem");if(!this._bSuggestion){i.setSelected(!i.getSelected());}h.call(this);}function g(E){if(!this._bSuggestion){h.call(this);}}function h(){var I=[];var t=this.getTable();if(t){var s=this.getSelectedItems();var T=t.getItems();var i=0;var p;var v;if(s.length>0){for(i=0;i<T.length;i++){p=T[i];v=m.call(this,p);if(!v){throw new Error("Key of item cannot be determined"+this);}for(var j=s.length-1;j>=0;j--){var q=s[j];if(q.key===v.key){s.splice(j,1);break;}}}}if(s.length>0){I=s;}s=t.getSelectedItems();for(i=0;i<s.length;i++){p=s[i];v=m.call(this,p);if(!v){throw new Error("Key of item cannot be determined"+this);}I.push({key:v.key,description:v.description});}}this.setSelectedItems(I);this.fireSelectionChange({selectedItems:I});}function k(E){l.call(this);if(this._bNavigate){this._bNavigate=false;this.navigate(this._iStep);}if(E.getParameter("reason")!==c(C.Filter)){this.fireDataUpdate({contentChange:false});}}function l(){var t=this.getTable();if(o(t)){var s=this.getSelectedItems();var I=t.getItems();for(var j=0;j<I.length;j++){var p=I[j];var v=m.call(this,p);var q=false;for(var i=0;i<s.length;i++){var r=s[i];if(v.key===r.key){q=true;break;}}p.setSelected(q);}}}function m(i){var v;var B=i.getBindingContext();if(B){v=n.call(this,B);}if(!v){var K=this._getKeyPath();var j;var D;if(!K&&i.getCells){var p=i.getCells();if(p.length>0&&p[0].getText){j=p[0].getText();}if(p.length>1&&p[1].getText){D=p[1].getText();}if(j!==undefined){v={key:j,description:D};}}}if(!v){throw new Error("Key could not be determined from item "+this);}return v;}function n(B){var K=this._getKeyPath();var D=this._getDescriptionPath();var i=B.getObject();var v;var s;if(i){if(K&&i.hasOwnProperty(K)){v=i[K];}if(D&&i.hasOwnProperty(D)){s=i[D];}}if(!v){return false;}return{key:v,description:s};}function o(t){if(!t){return false;}var B=t.getBinding("items");if(B&&B.getContexts().length===0){return false;}return true;}return a;},true);
