/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(['sap/m/Button','sap/m/ButtonType','sap/fe/MessagePopover','sap/ui/core/MessageType','sap/ui/model/Filter','sap/ui/model/FilterOperator'],function(B,a,M,b,F,c){'use strict';var d=B.extend('sap/fe/MessageButton',{metadata:{properties:{},events:{},aggregations:{customFilters:{type:'sap.fe.MessageFilter',multiple:true,singularName:'customFilter'}}},renderer:{}});function _(){var I,s=a.Default,m=this.oMessagePopover.getItems(),g=m.length,o={Error:0,Warning:0,Success:0,Information:0};if(g>0){for(var i=0;i<g;i++){++o[m[i].getType()];}if(o[b.Error]>0){I='sap-icon://message-error';s=a.Reject;}else if(o[b.Critical]>0||o[b.Warning]>0){I='sap-icon://message-warning';s=a.Reject;}else if(o[b.Success]>0){I='sap-icon://message-success';s=a.Accept;}else if(o[b.Information]>0){I='sap-icon://message-information';}else{I='sap-icon://message-popup';}this.setText(g);this.setIcon(I);this.setType(s);this.setVisible(true);this._applyGrouping();}else{this.setVisible(false);}}function e(){var C,v,V,o,g,p,s,u=[];function h(){var t=function(i){if(!i){return false;}var j=sap.ui.getCore().byId(i);while(j){if(j.getId()===s){return true;}j=j.getParent();}return false;};return new F({path:"controlId",test:t,caseSensitive:true});}if(!this.sViewId){this.sViewId=this._getViewId(this.getId());}s=this.sViewId;C=this.getAggregation('customFilters');if(C){C.forEach(function(i){u.push(new F({path:i.getProperty('path'),operator:i.getProperty('operator'),value1:i.getProperty('value1'),value2:i.getProperty('value2')}));});}g=this.getBindingContext();if(!g){return;}else{p=g.getPath();v=new F({filters:[new F({path:'validation',operator:c.EQ,value1:true}),h()],and:true});V=new F({filters:[v,new F({path:'target',operator:c.StartsWith,value1:p})],and:false});}o=new F({filters:[u,V],and:true});this.oItemBinding.filter(o);}function f(E){var i=E.getParameter('item'),m=i.getBindingContext('message').getObject(),C=sap.ui.getCore().byId(m.getControlId());if(C&&C.getDomRef()){C.focus();}}d.prototype.init=function(){this.attachPress(this.handleMessagePopoverPress,this);this.oMessagePopover=new M();this.oItemBinding=this.oMessagePopover.getBinding('items');this.oItemBinding.attachChange(_.bind(this));this.attachModelContextChange(e.bind(this));this.oMessagePopover.attachActiveTitlePress(f.bind(this));};d.prototype.handleMessagePopoverPress=function(E){this.oMessagePopover.toggle(E.getSource());};d.prototype._applyGrouping=function(){var m,g,s,h,S,l,E,n,A,i,j,k;this.sGeneralGroupText=this.sGeneralGroupText?this.sGeneralGroupText:sap.ui.getCore().getLibraryResourceBundle('sap.fe').getText('SAPFE_MESSAGE_GROUP_GENERAL');function o(C,p){return C===p.getId();}if(!this.oObjectPageLayout){E=this.getParent();while(E&&!(E instanceof sap.uxap.ObjectPageLayout)){E=E.getParent();}if(!E){return;}this.oObjectPageLayout=E;}m=this.oMessagePopover.getItems();s=this.oObjectPageLayout.getSections();if(s){for(i=m.length-1;i>=0;--i){g=m[i];if(g.getGroupName()){continue;}for(j=s.length-1;j>=0;--j){h=s[j];S=h.getSubSections();for(k=S.length-1;k>=0;--k){l=S[k];A=l.findElements(true);n=A.filter(o.bind(this,g.getControlId()));if(n.length>0){g.setGroupName(h.getTitle()+(l.getTitle()?', '+l.getTitle():''));j=k=-1;}else{g.setGroupName(this.sGeneralGroupText);}}}}}};d.prototype._getViewId=function(C){var v,o=sap.ui.getCore().byId(C);while(o){if(o instanceof sap.ui.core.mvc.View){v=o.getId();break;}o=o.getParent();}return v;};return d;},true);
