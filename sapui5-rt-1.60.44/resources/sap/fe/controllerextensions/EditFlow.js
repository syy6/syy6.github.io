/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2017 SAP SE. All rights reserved
    
 */
sap.ui.define(['sap/ui/core/mvc/ControllerExtension','sap/fe/actions/messageHandling','sap/ui/core/XMLTemplateProcessor','sap/ui/core/util/XMLPreprocessor','sap/ui/core/Fragment'],function(C,m,X,a,F){'use strict';var f='sap.fe.controls.field.DraftPopOverAdminData',p=X.loadTemplate(f,'fragment');var E=C.extend('sap.fe.controllerextensions.EditFlow',{createDocument:function(l){var t=this;this.base.getView().getModel().getBindingForReference(l).then(function(b){t.base.transaction.createDocument(b).then(function(n){if(n){t.handleNewContext(n,false);}});});},editDocument:function(c){var t=this;this.base.transaction.editDocument(c).then(function(n){if(n!==c){t.handleNewContext(n,true);}});},saveDocument:function(c){var t=this;this.base.transaction.saveDocument(c).then(function(A){if(A!==c){t.handleNewContext(A,true);}});},cancelDocument:function(c,P){var t=this;this.base.transaction.cancelDocument(c,P).then(function(A){if(!A){t.base.routing.setDirtyState(c,true);window.history.back();}else{t.handleNewContext(A,true);}});},deleteDocument:function(c,P){var t=this;this.base.transaction.deleteDocument(c,P).then(function(){t.base.routing.setDirtyState(c,true);window.history.back();});},handleNewContext:function(c,n){this.base.routing.setDirtyState(c,true);this.base.routing.navigateToContext(c,{noHistoryEntry:n});},formatDraftOwnerText:function(h,d,D,s,b,c){var e='',r=sap.ui.getCore().getLibraryResourceBundle('sap.fe');if(h){var u=D||d||b||s;if(c){e+=d?r.getText('DRAFTINFO_GENERIC_LOCKED_OBJECT_POPOVER_TEXT'):r.getText('DRAFTINFO_LAST_CHANGE_USER_TEXT')+' ';}e+=u?r.getText('DRAFTINFO_OWNER',[u]):r.getText('DRAFTINFO_ANOTHER_USER');}return e;},formatDraftOwnerTextInline:function(h,d,D,s,b){return this.formatDraftOwnerText(h,d,s,D,b,false);},formatDraftOwnerTextInPopover:function(h,d,D,s,b){return this.formatDraftOwnerText(h,d,s,D,b,true);},onDraftLinkPressed:function(e,s){var t=this,b=e.getSource(),B=b.getBindingContext(),v=this.base.getView(),M=v.getModel().getMetaModel(),c=v.getController();if(!this._oPopover||!this._oPopover.oPopup){Promise.resolve(t._oFragment||a.process(p,{},{bindingContexts:{entitySet:M.createBindingContext("/"+s)},models:{entitySet:M}})).then(function(o){t._oFragment=o;return F.load({definition:o,controller:c});}).then(function(P){t._oPopover=P;v.addDependent(t._oPopover);t._oPopover.setBindingContext(B);t._oPopover.openBy(b);});}this._oPopover.setBindingContext(B);this._oPopover.openBy(b);},closeDraftAdminPopover:function(){this._oPopover.close();},handleDraftPatchEvents:function(b){var u=this.base.getView().getModel('ui');var t=this;b.attachEvent('patchSent',function(){t.base.routing.setDirtyState(b,true);u.setProperty('/draftStatus','Saving');});b.attachEvent('patchCompleted',function(e){u.setProperty('/draftStatus',e.getParameter('success')?'Saved':'Clear');m.showUnboundMessages();});}});return E;});
