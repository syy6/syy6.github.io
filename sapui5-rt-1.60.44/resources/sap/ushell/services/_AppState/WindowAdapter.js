// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/_AppState/LimitedBuffer","sap/base/Log"],function(L,a){"use strict";var W=50;var C=18;function b(){this._init.apply(this,arguments);}b.prototype._init=function(s,B,c){var i=c&&c.config&&c.config.initialAppStates||{};var I=c&&c.config&&c.config.initialAppStatesPromise;this._oServiceInstance=s;this._oBackendAdapter=B;if(!b.prototype.data){b.prototype.data=new L(W);}if(I){I.then(function(i){if(typeof i==="object"){Object.keys(i).forEach(function(k){b.prototype.data.addAsHead(k,i[k]);});}});}Object.keys(i).forEach(function(k){b.prototype.data.addAsHead(k,i[k]);});};b.prototype.saveAppState=function(k,s,d,A,c,t){this.sComponent=c;var D=new jQuery.Deferred();b.prototype.data.addAsHead(k,d);if(this._oBackendAdapter&&!t){return this._oBackendAdapter.saveAppState(k,s,d,A,c);}D.resolve();return D.promise();};b.prototype.loadAppState=function(k){var d=new jQuery.Deferred(),c=b.prototype.data.getByKey(k);if(c){setTimeout(function(){d.resolve(k,c.value);},0);return d.promise();}try{if(window.opener&&window.opener.sap&&window.opener.sap.ushell){var A=window.opener.sap.ui.require("sap/ushell/services/AppState").WindowAdapter.prototype.data.getByKey(k);if(A){d.resolve(k,A.value);return d.promise();}}}catch(e){if(e.code===C){a.warning("AppState.js - loadAppState: Opener is not of the same origin and cannot be used for AppState resolving.");}else{a.warning("AppState.js - loadAppState: Opener is a FLP but AppState could not get resolved from there.");}}if(this._oBackendAdapter){this._oBackendAdapter.loadAppState(k).done(function(k,D){b.prototype.data.addAsHead(k,D);d.resolve(k,D);}).fail(d.reject.bind(d));return d.promise();}d.reject("AppState.js - loadAppState: Application State could not be loaded");return d.promise();};return b;});
