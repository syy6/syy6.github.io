// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/resources','sap/ushell/components/applicationIntegration/AppLifeCycle','sap/ushell/components/SharedComponentUtils','sap/ushell/Config','sap/ushell/EventHub'],function(r,A,s,C,E){"use strict";function _(){return sap.ushell.Container.getRenderer("fiori2");}function a(){return A.getElementsModel().getModel();}function G(v,h,i,j,t,o,k,l,m,n,M,p,q){this.view=null;this.getView=function(){if(!this.view||!sap.ui.getCore().byId(v)){if(i==="xml"){this.view=sap.ui.xmlview(v,h);}else{this.view=sap.ui.jsview(v,h);}}if(M){this.view.setModel(M);}return this.view;};return{entryHelpID:j,title:t,valueResult:null,onSave:o?o.bind(this):function(){if(this.getView().getController().onSave){return this.getView().getController().onSave();}}.bind(this),onCancel:k?k.bind(this):function(){if(this.getView().getController().onCancel){return this.getView().getController().onCancel();}}.bind(this),contentFunc:l?l.bind(this):function(){if(this.getView().getController().getContent){return this.getView().getController().getContent();}}.bind(this),valueArgument:m?m.bind(this):function(){var u=new jQuery.Deferred(),w=this;setTimeout(function(){if(w.getView().getController().getValue){w.getView().getController().getValue().done(function(x){u.resolve(x);});}},0);return u.promise();}.bind(this),editable:typeof n==="function"?n():n,contentResult:null,icon:p,defaultVisibility:q};}function c(m){return function(){return this.getView().getController()[m]();};}function b(p){var o={entryHelpID:p.entryHelpId,title:r.i18n.getText(p.i18nTitleKey),editable:true,valueResult:null,contentResult:null,icon:p.icon,getView:function(){var h=p.viewType==="xml"?sap.ui.xmlview:sap.ui.jsview;var v=sap.ui.getCore().byId(p.viewId);if(!v){v=h(p.viewId,p.componentNamespace);}return v;}};o.valueArgument=c("getValue").bind(o);o.onSave=c("onSave").bind(o);o.onCancel=c("onCancel").bind(o);o.contentFunc=c("getContent").bind(o);return o;}function L(){return b({entryHelpId:"language",i18nTitleKey:"languageRegionTit",icon:"sap-icon://globe",viewId:"languageRegionSelector",componentNamespace:"sap.ushell.components.shell.MeArea.LanguageRegionSelector"});}function U(){return b({entryHelpId:"UserActivitiesEntry",i18nTitleKey:"userActivities",icon:"sap-icon://laptop",viewId:"userActivitiesHandler",componentNamespace:"sap.ushell.components.shell.MeArea.userActivitiesHandler"});}function d(){var S=_().getShellConfig();var u=(S.enableOnlineStatus&&sap.ushell.ui5service.UserStatus.prototype.isEnabled)||S.enableUserImgConsent;var v=u?"userAccountSelector":"userAccountSetting";var h=u?"sap.ushell.components.shell.MeArea.userAccount.UserAccountSelector":"sap.ushell.components.shell.MeArea.userAccount.UserAccountSetting";return b({entryHelpId:"userAccountEntry",i18nTitleKey:"UserAccountFld",icon:"sap-icon://account",viewId:v,componentNamespace:h,viewType:"xml"});}function e(){var m=a(),u=sap.ushell.Container.getUser();var t=new G("userPrefThemeSelector","sap.ushell.components.shell.MeArea.ThemeSelector","xml","themes",r.i18n.getText("Appearance"),function(){var v=this.getView().getController().onSave();v.done(function(){if(m.getProperty("/enableTilesOpacity")===true){sap.ushell.utils.utils.handleTilesOpacity();}});return v;},undefined,undefined,undefined,function(){if(m.getProperty("/setTheme")!==undefined){return m.getProperty("/setTheme")&&u.isSetThemePermitted();}else{return u.isSetThemePermitted();}},m,"sap-icon://palette");var h=new G("userPrefUsageAnalyticsSelector","sap.ushell.components.shell.MeArea.UsageAnalyticsSelector","js","usageAnalytics",r.i18n.getText("usageAnalytics"),undefined,undefined,undefined,undefined,sap.ushell.Container.getService("UsageAnalytics").isSetUsageAnalyticsPermitted());var i=new G("defaultParametersSelector","sap.ushell.components.shell.MeArea.DefaultParameters","js",undefined,r.i18n.getText("defaultsValuesEntry"),undefined,undefined,undefined,undefined,true,undefined,undefined,false);var j=new G("userProfilingView","sap.ushell.components.shell.MeArea.UserProfiling","js","userProfiling",r.i18n.getText("userProfiling"),undefined,undefined,undefined,undefined,false,m,"sap-icon://user-settings",false);var k=[new d(),t,new L()],p=[];p.push(h);var l=C.last("/core/shell/enableRecentActivity");if(l){k.push(new U());}k.push(j);if(m.getProperty("/enableNotifications")===true){var n=sap.ushell.Container.getService("Notifications")._getNotificationSettingsAvalability(),o;o=new G("notificationSettings","sap.ushell.components.shell.Notifications.Settings","js",undefined,r.i18n.getText("notificationSettingsEntry_title"),undefined,undefined,undefined,undefined,true,undefined,"sap-icon://ui-notifications",false);k.push(o);n.done(function(S){if(S.settingsAvailable){o.visible=true;m.getProperty("/userPreferences/entries").every(function(v,w){if(v.title===r.i18n.getText("notificationSettingsEntry_title")){m.setProperty("/userPreferences/entries/"+w+"/visible",true);return false;}return true;});}});}if(m.getProperty("/userDefaultParameters")){k.push(i);}var q=C.last("/core/home/enableHomePageSettings");if(q!==false){k.push(g());}return{dialogTitle:r.i18n.getText("userSettings"),isDetailedEntryMode:false,activeEntryPath:null,entries:k,profiling:p};}function g(){var R=_(),o=r.i18n;var h;var i={title:o.getText('FlpSettings_entry_title'),entryHelpID:"flpSettingsEntry",valueArgument:function(){return jQuery.Deferred().resolve(" ");},contentFunc:function(){var D=new jQuery.Deferred();s.getEffectiveHomepageSetting("/core/home/homePageGroupDisplay","/core/home/enableHomePageSettings").then(function(j){h=sap.ui.xmlview({viewName:"sap.ushell.components.shell.MeArea.FlpSettings",viewData:{initialDisplayMode:j||"scroll"}});D.resolve(h);});return D;},onSave:function(){var D=h.getController().onSave();var j=s.getPersonalizer("homePageGroupDisplay",R).setPersData(D);j.fail(function(k){jQuery.sap.log.error("Failed to save the anchor bar mode in personalization",k,"sap.ushell.components.flp.settings.FlpSettings");});C.emit("/core/home/homePageGroupDisplay",D);return jQuery.Deferred().resolve();},onCancel:function(){return jQuery.Deferred().resolve();},icon:"sap-icon://home"};return i;}function f(){var u=a().getProperty("/userPreferences/entries");var D=e();D.entries=D.entries.concat(u);D.entries=_().reorderUserPrefEntries(D.entries);a().setProperty("/userPreferences",D);}return{setModel:f};});
