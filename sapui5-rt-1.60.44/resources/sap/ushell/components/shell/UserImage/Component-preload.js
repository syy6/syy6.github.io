sap.ui.require.preload({"sap/ushell/components/shell/UserImage/Component.js":function(){
/*!
 * ${copyright}
 */
sap.ui.define(['sap/ushell/resources','sap/ui/core/UIComponent','sap/ushell/components/homepage/ComponentKeysHandler','sap/ushell/utils','sap/m/Dialog','sap/m/Button','sap/m/Text','sap/m/Link','sap/ui/layout/VerticalLayout','sap/m/FlexBox','sap/ui/core/IconPool','sap/ui/Device','sap/base/Log'],function(r,U,C,u,D,B,T,L,V,F,I,a,l){"use strict";var s;return U.extend("sap.ushell.components.shell.UserImage.Component",{metadata:{version:"${version}",library:"sap.ushell.components.shell.UserImage",dependencies:{libs:["sap.m","sap.ui.layout"]}},createContent:function(){var S;s=sap.ushell.Container.getRenderer("fiori2")._oShellView;S=(s.getViewData()?s.getViewData().config:{})||{};this.loadUserImage();var o=sap.ushell.Container.getUser();if(S.enableUserImgConsent==true&&o.getImageConsent()==undefined){this._showUserConsentPopup();}sap.ui.getCore().getEventBus().publish("shell","userImageCompLoaded",{delay:0});},_showUserConsentPopup:function(){var t=this;var b=sap.ui.getCore().getConfiguration().getRTL()?'Right':'Left';var d,f,c,e;var y=new B('yesButton',{text:r.i18n.getText("DisplayImg"),type:"Emphasized",press:function(){t.updateUserImage(true);d.close();}});var n=new B('noButton',{text:r.i18n.getText("DontDisplayImg"),press:function(){t.updateUserImage(false);d.close();}});d=new D("userConsentDialog",{title:r.i18n.getText("userImageConsentDialogTitle"),modal:true,stretch:a.system.phone,buttons:[y,n],afterClose:function(){d.destroy();}}).addStyleClass('sapUshellUserConsentDialog');var g=new T({text:r.i18n.getText("userImageConsentDialogTermsOfUse")}).addStyleClass('sapUshellUserConsentDialogTerms');var h=new T({text:r.i18n.getText("userImageConsentText"),textAlign:b}).addStyleClass('sapUshellUserConsentDialogText');var i=new L({text:r.i18n.getText("userImageConsentDialogShowTermsOfUse"),textAlign:b,press:function(){var k=e.getVisible();if(k){e.setVisible(false);i.setText(r.i18n.getText("userImageConsentDialogShowTermsOfUse"));}else{i.setText(r.i18n.getText("userImageConsentDialogHideTermsOfUse"));e.setVisible(true);}}.bind(this)}).addAriaLabelledBy(h);f=new F({alignItems:'Center',direction:'Row',items:[h]}).addStyleClass('sapUshellUserConsentDialogBox');c=new F({alignItems:'Center',direction:'Row',items:[i]}).addStyleClass('sapUshellUserConsentDialogBox').addStyleClass('sapUshellUserConsentDialogLink');e=new F({alignItems:'Center',direction:'Row',items:[g]}).addStyleClass('ushellUserImgConsentTermsOfUseFlexBox');e.setVisible(false);var j=new V('userConsentDialogLayout',{content:[f,c,e]});d.addContent(j);d.open();},loadUserImage:function(){var o=sap.ushell.Container.getUser(),i=o.getImage();if(i){this._setUserImage(i);}o.attachOnSetImage(this._setUserImage.bind(this));},_setUserImage:function(p){var b=typeof p==='string'?p:p.mParameters,i=true;if(b&&typeof b==='string'){i=false;}else if(!jQuery.isEmptyObject(b)){i=false;}var c=I.getIconURI("person-placeholder"),d=I.getIconURI("account");var h={'Cache-Control':'no-cache, no-store, must-revalidate','Pragma':'no-cache','Expires':'0'};if(!i){jQuery.ajax({url:b,headers:h,success:function(){s.getModel().setProperty("/userImage/personPlaceHolder",b);s.getModel().setProperty("/userImage/account",b);},error:function(){l.error("Could not load user image from: "+b,"","sap.ushell.renderers.fiori2.Shell.view");var o=sap.ushell.Container.getUser();o.setImage("");}});}else{s.getModel().setProperty("/userImage/personPlaceHolder",c);s.getModel().setProperty("/userImage/account",d);}},updateUserImage:function(i){var o=sap.ushell.Container.getUser(),d=new jQuery.Deferred(),b;this.userInfoService=sap.ushell.Container.getService("UserInfo");if(i!=undefined){o.setImageConsent(i);b=this.userInfoService.updateUserPreferences(o);b.done(function(){o.resetChangedProperties();d.resolve();}.bind(this));}else{d.reject(i+"is undefined");}},exit:function(){}});});}},"Component-preload");
