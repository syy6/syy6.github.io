sap.ui.require.preload({"sap/ushell/components/shell/Notifications/Component.js":function(){
// ${copyright}
sap.ui.define(['sap/ushell/resources','sap/ui/core/UIComponent','sap/ushell/components/homepage/ComponentKeysHandler','sap/ushell/renderers/fiori2/AccessKeysHandler','sap/ushell/utils','sap/ushell/ui/shell/RightFloatingContainer','sap/ushell/EventHub','sap/ui/Device'],function(r,U,C,A,u,R,E,D){"use strict";return U.extend("sap.ushell.components.shell.Notifications.Component",{metadata:{version:"${version}",library:"sap.ushell.components.shell.Notifications",dependencies:{libs:["sap.m"]},config:{}},createContent:function(){this.oRenderer=sap.ushell.Container.getRenderer("fiori2");this.oDefConfig={};this.bIsViewCreated=false;this.isNotificationPreviewLoaded=false;this.oNotificationsPreviewModel=undefined;this.AccessKeysHandler=A;var t=this;var a=h.bind(this);var f=function(N){var B=this.mBindingInfos[N],d=this.getMetadata().getJSONKeys()[N],e;jQuery.each(this[d._sGetter](),jQuery.proxy(function(i,v){this[d._sRemoveMutator](v);},this));jQuery.each(B.binding.getContexts(),jQuery.proxy(function(i,v){e=B.factory(this.getId()+"-"+i,v)?B.factory(this.getId()+"-"+i,v).setBindingContext(v,B.model):"";this[d._sMutator](e);},this));};this.oPreviewNotificationsContainerPlaceholder=new R({id:'notifications-preview-container-placeholder',visible:{path:'/enableNotificationsPreview',formatter:function(v){return t._handleNotificationsPreviewVisibility.apply(t,[v]);}}}).addStyleClass('sapUshellPreviewNotificationsConainer');this.oPreviewNotificationsContainer=new R({id:'notifications-preview-container',top:4,right:'1rem',actAsPreviewContainer:true,floatingContainerItems:{path:"/previewNotificationItems",factory:function(d,e){return sap.ui.getCore().byId(e.getObject().previewItemId);}},insertItemsWithAnimation:{path:'/animationMode',formatter:function(s){return s!=='minimal';}},visible:{path:'/enableNotificationsPreview',formatter:this._handleNotificationsPreviewVisibility.bind(this)}}).addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oPreviewNotificationsContainer.updateAggregation=f;sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","enablePreviewNotificationChanged",this._updateNotificationConfiguration,this);sap.ui.getCore().getEventBus().publish("shell","notificationsPreviewContainerCreated",{previewNotificationsContainerPlaceholder:this.oPreviewNotificationsContainerPlaceholder,previewNotificationsContainer:this.oPreviewNotificationsContainer});this.oNotificationsPreviewModel=this.oPreviewNotificationsContainer.getModel();var o=(this.getComponentData()?this.getComponentData().config:{});this.oDefConfig={view:{position:"right"},enableHeaderButton:true,enablePreview:true};var n,b;this._updateNotificationConfiguration();if(sap.ushell.Container.getService("Notifications").isEnabled()===true){sap.ushell.Container.getRenderer("fiori2").shellCtrl.getModel().setProperty("/enableNotifications",true);sap.ushell.Container.getService("Notifications").init();if(this.oRenderer.getShellConfig().enableNotificationsUI===true){sap.ushell.Container.getRenderer("fiori2").shellCtrl.getModel().setProperty("/enableNotificationsUI",true);sap.ushell.Container.getService("Notifications").registerDependencyNotificationsUpdateCallback(this.notificationsCountUpdateCallback.bind(this),true);}}this.oDefConfig=jQuery.extend(this.oDefConfig,o);n=sap.ui.getCore().byId("NotificationsCountButton");n.applySettings({icon:sap.ui.core.IconPool.getIconURI("ui-notifications"),floatingNumber:{parts:["/notificationsCount"],formatter:function(d){var j=this.getDomRef(),e="";if(j){if(d>0){e=r.i18n.getText("NotificationToggleButtonCollapsed",d);}else{e=r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications");}j.setAttribute("aria-label",e);}return d;}},visible:"{/enableNotifications}",enabled:"{/enableNotifications}",selected:{path:"/currentViewPortState",formatter:function(v){if(v==='RightCenter'){return true;}return false;}},press:function(){a(this,!this.getSelected());},showSeparator:false,tooltip:r.i18n.getText("NotificationToggleButtonExpanded")},true,true).removeStyleClass("sapUshellPlaceHolders");b=n.onAfterRendering;n.onAfterRendering=function(){if(b){b.apply(this,arguments);}jQuery(this.getDomRef()).attr("aria-pressed",t.oRenderer.getNotificationsSelected());if(this.getDisplayFloatingNumber()>0){jQuery(this.getDomRef()).attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsed",this.getDisplayFloatingNumber()));}else{jQuery(this.getDomRef()).attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));}};n.addEventDelegate({onsapskipforward:function(e){t.AccessKeysHandler.bForwardNavigation=true;e.preventDefault();jQuery("#sapUshellHeaderAccessibilityHelper").focus();},onsaptabnext:function(e){t.AccessKeysHandler.bForwardNavigation=true;e.preventDefault();jQuery("#sapUshellHeaderAccessibilityHelper").focus();},onsapskipback:function(e){if(t.AccessKeysHandler.getAppKeysHandler()){e.preventDefault();t.AccessKeysHandler.bFocusOnShell=false;}}});this.oRenderer.addShellDanglingControl(n);if(sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty("/enableNotificationsUI")===true){sap.ushell.Container.getRenderer("fiori2").oShellModel.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);}if(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name==="Phone"){sap.ushell.Container.getRenderer("fiori2").getShellController().handleEndItemsOverflow({name:'Phone',showOverFlowBtn:true});}E.on('showNotifications').do(function(v){a(n,v);});sap.ui.getCore().getEventBus().publish("shell","notificationsCompLoaded",{delay:1000});},_notificationsUpdateCallback:function(){var t=this,a=5,T=0,b=this.oNotificationsPreviewModel.getProperty("/previewNotificationItems"),n=[],N=[],d,e,f,g,j,i,o,k=false,m=a-b.length-1;sap.ushell.Container.getService("Notifications").getNotifications().done(function(l){if(!l){return;}var p=sap.ui.getCore().byId("notifications-preview-container"),v;if(!this.isNotificationPreviewLoaded){p.setEnableBounceAnimations(true);}if(b&&b.length){for(j=0;j<b.length;j++){var O=b[j].originalItemId,q=false;for(i=0;i<l.length;i++){if(l[i].Id===O){q=true;break;}if(b[j].originalTimestamp>l[i].CreatedAt){break;}}if(!q){b.splice(j,1);k=true;j--;}}}if(b&&b.length>0){d=b[0].originalTimestamp;e=sap.ushell.Container.getService("Notifications")._formatAsDate(d);}for(j=0;(j<l.length)&&(T<a);j++){f=l[j].CreatedAt;g=sap.ushell.Container.getService("Notifications")._formatAsDate(f);if((e?g>e:true)){n[T]=l[j];T++;}}var s=n.length;if(b&&b.length>0&&b.length<a&&l.length>b.length){d=b[b.length-1].originalTimestamp;e=sap.ushell.Container.getService("Notifications")._formatAsDate(d);T=0;for(j=0;(j<l.length)&&(T<=m);j++){f=l[j].CreatedAt;g=sap.ushell.Container.getService("Notifications")._formatAsDate(f);if(g<e){n[s+T]=l[j];T++;}}}if(n.length===0&&!k){this._disableNotificationPreviewBouncingAnimation(p);return;}for(i=0;i<n.length;i++){o=new sap.m.NotificationListItem({hideShowMoreButton:true,title:n[i].SensitiveText?n[i].SensitiveText:n[i].Text,description:n[i].SubTitle,datetime:u.formatDate(n[i].CreatedAt),priority:sap.ui.core.Priority[n[i].Priority.charAt(0)+n[i].Priority.substr(1).toLowerCase()],press:function(w){var x=this.getBindingContext().getPath(),P=x.split("/"),y="/"+P[1]+"/"+P[2],z=this.getModel().getProperty(y),S=z.NavigationTargetObject,B=z.NavigationTargetAction,F=z.NavigationTargetParams,G=z.originalItemId,H=sap.ushell.Container.getService("Notifications");u.toExternalWithParameters(S,B,F);var I=H.markRead(G);I.fail(function(){sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedMarkRead'));});},close:function(w){var x=this.getBindingContext().getPath(),P=x.split("/"),y="/"+P[1]+"/"+P[2],z=this.getModel().getProperty(y),B=z.originalItemId,b=t.oNotificationsPreviewModel.getProperty("/previewNotificationItems"),F=sap.ushell.Container.getService("Notifications"),G=F.dismissNotification(B);G.done(function(){var i;for(i=0;i<b.length;i++){if(b[i].originalItemId===B){break;}}b.splice(i,1);t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);});G.fail(function(){sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedDismiss'));t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);});}}).addStyleClass("sapUshellNotificationsListItem");N.push({previewItemId:o.getId(),originalItemId:n[i].Id,originalTimestamp:n[i].CreatedAt,NavigationTargetObject:n[i].NavigationTargetObject,NavigationTargetAction:n[i].NavigationTargetAction,NavigationTargetParams:n[i].NavigationTargetParams});v=sap.ui.getCore().byId('viewPortContainer');if(v.getCurrentState()==="RightCenter"){o.addStyleClass("sapUshellRightFloatingContainerItemBounceOut");}}if(b.length===0){t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",N);this._disableNotificationPreviewBouncingAnimation(p);return;}for(j=N.length-1;j>-1;j--){if(b.length>=a){setTimeout(function(){b.pop();t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);},1000);}if(N[j].originalTimestamp>b[0].originalTimestamp){b.unshift(N[j]);}else{b.push(N[j]);}}t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);this._disableNotificationPreviewBouncingAnimation(p);}.bind(this)).fail(function(){});},_disableNotificationPreviewBouncingAnimation:function(n){if(!this.isNotificationPreviewLoaded){this.isNotificationPreviewLoaded=true;n.setEnableBounceAnimations(false);}},_handleNotificationsPreviewVisibility:function(e){var s=this.oRenderer.getCurrentViewportState(),i=s==='Center',n=sap.ushell.Container.getService('Notifications');e=e&&i;if(e){if(!this.bNotificationsRegistered){n.registerNotificationsUpdateCallback(this._notificationsUpdateCallback.bind(this));this.bNotificationsRegistered=true;}if(n.isFirstDataLoaded()){setTimeout(function(){if(this.oController&&this.oController._notificationsUpdateCallback){this.oController._notificationsUpdateCallback();}}.bind(this),300);}if(!this.bSubscribedToViewportStateSwitch){this.bHeadsupNotificationsInitialyVisible=this.oRenderer.getRightFloatingContainerVisibility();sap.ui.getCore().getEventBus().subscribe("launchpad","afterSwitchState",this._handleViewportStateSwitch,this);this.bSubscribedToViewportStateSwitch=true;}this._handleHeadsupNotificationsPresentation(s);}return e;},_handleViewportStateSwitch:function(s,e,d){var a=d.getParameter('to');if(a=='Center'){var n=sap.ui.getCore().byId("notifications-preview-container");if(n&&n.setFloatingContainerItemsVisiblity){n.setFloatingContainerItemsVisiblity(true);}}},_handleHeadsupNotificationsPresentation:function(s){var i=s==='Center',p=this.oPreviewNotificationsContainer.getDomRef(),H=p&&p.getBoundingClientRect(),P=H?H.bottom<0:false,S=i?P:this.bHeadsupNotificationsInitialyVisible;this.oRenderer.showRightFloatingContainer(S);},_handleAlerts:function(s,e,n){var N;if(this.oRenderer.getViewPortContainerCurrentState()!=='RightCenter'){for(N=0;N<n.length;N++){this.handleNotification(n[N]);}}},handleNotification:function(n){var a=this.oRenderer.addRightFloatingContainerItem({press:function(e){var v=sap.ui.getCore().byId('viewPortContainer');if(window.hasher.getHash()===n.NavigationTargetObject+"-"+n.NavigationTargetAction){v.switchState("Center");}else{u.toExternalWithParameters(n.NavigationTargetObject,n.NavigationTargetAction,n.NavigationTargetParams);}sap.ushell.Container.getService("Notifications").markRead(n.Id);},datetime:r.i18n.getText("notification_arrival_time_now"),title:n.SensitiveText?n.SensitiveText:n.Text,description:n.SubTitle,unread:n.IsRead,priority:"High",hideShowMoreButton:true},true,true);var t=this;setTimeout(function(){t.oRenderer.removeRightFloatingContainerItem(a.getId(),true);},3500);},notificationsCountUpdateCallback:function(d){var t=this,v=this.oRenderer.getViewPortContainerCurrentState(),i=v==="RightCenter"?true:false;if((d===undefined)||(!i)){this._updateBadge();}else{d.done(function(){t._updateBadge();});}},_updateBadge:function(){var n;sap.ushell.Container.getService("Notifications").getUnseenNotificationsCount().done(function(N){n=parseInt(N,10);sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty('/notificationsCount',n);}).fail(function(d){jQuery.sap.log.error("Shell.controller - call to notificationsService.getCount failed: ",d,"sap.ushell.renderers.lean.Shell");});},_switchToNotificationView:function(s){this.oRenderer.ViewPortContainerNavTo('rightViewPort',"notificationsView",'show');this.oRenderer.switchViewPortStateByControl(s,"RightCenter");sap.ui.getCore().getEventBus().publish("launchpad","notificationViewOpened");},_switchToNotificationViewWithPreview:function(n,a,s){if(a==='minimal'){this._switchToNotificationView(s);}else{var i=n.getFloatingContainerItems().length;setTimeout(function(){this._switchToNotificationView(s);}.bind(this),300+(i*100));}},_updateNotificationConfiguration:function(s,e,d){var o=this.oRenderer.getModelConfiguration(),n=sap.ushell.Container.getService("Notifications").isEnabled(),N=o.appState!=="embedded"&&o.appState!=="headerless"&&o.appState!=="merged"&&o.appState!=="standalone",b=true,p=true,a,f=D.system.desktop||D.system.tablet||D.system.combi,P={};if(n===true){a=sap.ushell.Container.getService("Notifications").getUserSettingsFlags();a.done(function(g){b=g.previewNotificationEnabled;P.bUserEnableNotificationsPreview=b;P.bConfigEnableNotificationsPreview=p;P.bMainFlagExists=false;if(p&&n&&f&&N){P.bMainFlagExists=true;P.bEnableNotificationsPreview=b;}sap.ui.getCore().getEventBus().publish("shell","changeNotificationPreview",P);});}},exit:function(){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","enablePreviewNotificationChanged",this._updateNotificationConfiguration,this);if(this.bSubscribedToViewportStateSwitch){sap.ui.getCore().getEventBus().unsubscribe("launchpad","afterSwitchState",this._handleViewportStateSwitch,this);this.bSubscribedToViewportStateSwitch=false;}if(sap.ushell.Container){if(sap.ushell.Container.getService("Notifications").isEnabled()===true){sap.ushell.Container.getService("Notifications").destroy();}}this.oPreviewNotificationsContainerPlaceholder.destroy();this.oPreviewNotificationsContainer.destroy();}});function c(o){if(o.oDefConfig.view&&o.bIsViewCreated==false){var n=sap.ui.view("notificationsView",{viewName:"sap.ushell.components.shell.Notifications.Notifications",type:'JS',viewData:{}});n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"role",value:"region",writeToDom:true}));n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-label",value:r.i18n.getText("NotificationToggleButtonExpanded"),writeToDom:true}));o.bIsViewCreated=true;if(o.oDefConfig.view.position==="right"){o.oRenderer.addRightViewPort(n);}else{o.oRenderer.addLeftViewPort(n);}}}function h(s,S){S=!!S;if(s.getSelected()===S){return;}var n=sap.ui.getCore().byId("notifications-preview-container"),a=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty('/animationMode')||'full';c(this);if(S){sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/notificationsCount",0);if(n){n.setFloatingContainerItemsVisiblity(false);this._switchToNotificationViewWithPreview(n,a,s);}else{this._switchToNotificationView(s);}}else{this.oRenderer.switchViewPortStateByControl(s,"Center");}sap.ushell.Container.getService("Notifications").notificationsSeen();sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/notificationsCount",0);s.$().attr("aria-pressed",S);s.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));}});},"sap/ushell/components/shell/Notifications/Notifications.controller.js":function(){sap.ui.define(['sap/ushell/utils'],function(u){"use strict";sap.ui.controller("sap.ushell.components.shell.Notifications.Notifications",{oPagingConfiguration:{MAX_NOTIFICATION_ITEMS_DESKTOP:400,MAX_NOTIFICATION_ITEMS_MOBILE:100,MIN_NOTIFICATION_ITEMS_PER_BUFFER:15,NOTIFICATION_ITEM_HEIGHT:(sap.ui.Device.system.phone||sap.ui.Device.system.tablet)?130:100,TAB_BAR_HEIGHT:100},onInit:function(){var i={};this.iMaxNotificationItemsForDevice=sap.ui.Device.system.desktop?this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_DESKTOP:this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_MOBILE;this.oNotificationsService=sap.ushell.Container.getService("Notifications");this.oSortingType=this.oNotificationsService.getOperationEnum();i[this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING]={};this.sCurrentSorting=this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;this.sCurrentExpandedType=undefined;var m=new sap.ui.model.json.JSONModel(i);m.setSizeLimit(1500);this.getView().setModel(m);this.getNextBuffer();this._oTopNotificationData=undefined;},shouldFetchMoreNotifications:function(){var h=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend"),l=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/listMaxReached");return h&&!l;},getNextBuffer:function(){var c=this.getItemsFromModel(this.sCurrentSorting),n,p,N;if(!this.shouldFetchMoreNotifications()){return;}N=this.getNumberOfItemsToFetchOnScroll();if(N===0){this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItems",false);return;}if(c!==undefined){n=c.length;}if(n===0){this.addBusyIndicatorToTabFilter(true);}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferBySortingType(this.sCurrentSorting,n,N);p.done(function(r){var d=this.oNotificationsService._getNotificationSettingsAvalability();if(d.state()=="pending"){this.oNotificationsService._userSettingInitialization();}this.addBufferToModel(r);}.bind(this));p.fail(function(r){if(n===0){this.handleError();}}.bind(this));},getNextBufferForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p,h=g.hasMoreItems;if(!h){return;}if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferInGroup(s,n,this.getBasicBufferSize());p.done(function(r){this.addTypeBufferToModel(s,r,false);}.bind(this));p.fail(function(r){this.getNextBufferFailHandler(S);}.bind(this));},addTypeHeadersToModel:function(r){var c=this.getItemsFromModel(this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),C=c.length,R;this._oTopNotificationData=undefined;if(!r){return;}R=JSON.parse(r).value;R.forEach(function(i,a){i.hasMoreItems=true;i.aNotifications=[{"Id":"temp"}];});this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/aGroupHeaders",R);this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate",false);if(C===0){this.removeBusyIndicatorToTabFilter(false);}},addBufferToModel:function(r){var c=this.getItemsFromModel(this.sCurrentSorting),C=c.length,m,h=r.length>=this.getNumberOfItemsToFetchOnScroll();this._oTopNotificationData=undefined;if(!r){this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",false);return;}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",h);m=c.concat(r);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/aNotifications",m);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",false);if(m.length>=this.iMaxNotificationItemsForDevice){this.handleMaxReached();}if(C===0){this.removeBusyIndicatorToTabFilter(true);}},addTypeBufferToModel:function(t,r,o){var g=this.getGroupFromModel(t),G=this.getGroupIndexFromModel(t),a=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),m;if(!r){return;}if(r.length<this.getBasicBufferSize()){g.hasMoreItems=false;}if(!g.aNotifications||o){g.aNotifications=[];}m=g.aNotifications.concat(r);a[G].aNotifications=m;a[G].Busy=false;this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,a);this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate",false);},keydownHandler:function(k){var j,n,c;if(k.keyCode===jQuery.sap.KeyCodes.DELETE){j=jQuery(document.activeElement);if(j.hasClass('sapUshellNotificationsListItem')){n=j.next();c=j.find(".sapMNLB-CloseButton")[0];sap.ui.getCore().byId(c.id).firePress();if(n){n.focus();}}}},notificationsUpdateCallback:function(d){var t=this,c,n,N;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){this.notificationsUpdateCallbackForType();d.resolve();return;}c=this.getItemsFromModel(this.sCurrentSorting);if(c!==undefined){n=c.length;}this.cleanModel();N=this.getNumberOfItemsToFetchOnUpdate(n);this.oNotificationsService.getNotificationsBufferBySortingType(this.sCurrentSorting,0,N).done(function(a){if(!a){return;}d.resolve();t.replaceItemsInModel(a,N);}).fail(function(a){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsBufferBySortingType failed: ",a,"sap.ushell.components.shell.Notifications.Notifications");});},getSelectedList:function(){var s;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){s=this.getView().oNotificationsListPriority;}else{s=this.getView().oNotificationsListDate;}return s;},isMoreCircleExist:function(){var s=this.getSelectedList(),i=s.getItems().length,l=s.getItems()[i-1];return!!i&&l.getMetadata().getName()==="sap.m.CustomListItem";},handleMaxReached:function(){var s=this.getSelectedList(),n=Math.floor(this.oNotificationsService.getNotificationsCount()),m=n-this.iMaxNotificationItemsForDevice,i=this.isMoreCircleExist();this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/moreNotificationCount",m);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/listMaxReached",m>=0);if(m>0&&!i){s.addItem(this.getView().getMoreCircle(this.sCurrentSorting));}else if(m<=0&&i){s.removeItem(this.getView().oMoreListItem);}},reAddFailedGroup:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending');G.splice(g.removedGroupIndex,0,g.oGroup);m.setProperty('/notificationsByTypeDescending',G);},removeGroupFromModel:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending'),r={oGroup:g,removedGroupIndex:undefined};G.some(function(o,i){if(o.Id===g.Id){r.removedGroupIndex=i;G.splice(i,1);m.setProperty('/notificationsByTypeDescending',G);return true;}return false;});this.sCurrentExpandedType=undefined;return r;},updateGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this,g=t.getView().getModel().getProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.updateGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");});p.done(function(n){var j=JSON.parse(n),a=j.value;a.forEach(function(i,b){var f=false;g.forEach(function(c,I){if(c.Id===i.Id){g[I].GroupHeaderText=i.GroupHeaderText;g[I].CreatedAt=i.CreatedAt;f=true;}});if(!f){g.unshift(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g);});},reloadGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this;p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");t.replaceBusyIndicatorWithNotificationsList();});p.done(function(n){var j=JSON.parse(n),a=j.value,r=[],l=-1;a.forEach(function(i,b){if(i.IsGroupHeader){i.Collapsed=true;r.push(i);l=l+1;}else if(r[l]){if(!r[l].notifications){r[l].notifications=[];}r[l].notifications.push(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,r);t.replaceBusyIndicatorWithNotificationsList();});},markRead:function(n){var p=this.oNotificationsService.markRead(n),t=this;p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedMarkRead'));t.setMarkReadOnModel(n,false);});this.setMarkReadOnModel(n,true);},onExit:function(){this.getView().oBusyIndicator.destroy();},onBeforeRendering:function(){this.oNotificationsService.registerDependencyNotificationsUpdateCallback(this.notificationsUpdateCallback.bind(this),false);},executeAction:function(n,a){return this.oNotificationsService.executeAction(n,a);},executeBulkAction:function(n,a,A,g,N,p){var t=g,P=this.oNotificationsService.executeBulkAction(g.Id,a),m,G=A,s=this.getView().getModel().getProperty(p+"/NotificationTypeDesc"),b=this;if(s===""){s=this.getView().getModel().getProperty(p+"/NotificationTypeKey");}P.fail(function(r){this.getView().getModel().setProperty(N+"/Busy",false);t.notifications.forEach(function(i,c){this.getView().getModel().setProperty(p+"/Busy",false);}.bind(this));if(r&&r.succededNotifications&&r.succededNotifications.length){r.succededNotifications.forEach(function(c,i){this.removeNotificationFromModel(c);}.bind(this));b.cleanModel();}if(r.succededNotifications.length===1){m=sap.ushell.resources.i18n.getText("notificationsPartialSuccessExecuteBulkAction",[G,r.succededNotifications.length,r.failedNotifications.length+r.succededNotifications.length,s,r.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else if(r.succededNotifications.length>1){m=sap.ushell.resources.i18n.getText("notificationsSingleSuccessExecuteBulkAction",[G,r.succededNotifications.length,r.failedNotifications.length+r.succededNotifications.length,s,r.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else{m=sap.ushell.resources.i18n.getText("notificationsFailedExecuteBulkAction");sap.ushell.Container.getService('Message').error(m);}}.bind(this));P.done(function(){m=sap.ushell.resources.i18n.getText("notificationsSuccessExecuteBulkAction",[G,s]);sap.m.MessageToast.show(m,{duration:4000});this.removeGroupFromModel(t);this.cleanModel();}.bind(this));},dismissNotification:function(n){var t=this,r=this.removeNotificationFromModel(n),p=this.oNotificationsService.dismissNotification(n);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedDismiss'));t.addNotificationToModel(r.obj,r.index);});},dismissBulkNotifications:function(n,g){var r=this.removeGroupFromModel(g),p=this.oNotificationsService.dismissBulkNotifications(g.Id);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteBulkAction'));this.reAddFailedGroup(r);}.bind(this));},onListItemPress:function(n,s,a,p){var v=sap.ui.getCore().byId('viewPortContainer');if(v){v.switchState("Center");}u.toExternalWithParameters(s,a,p);this.markRead(n);},scrollToItem:function(t){var j=this._getJqNotificationObjects(),a=j[0],b=j[1],c=j[2],d=j[3],i,n,e,f,g;if(a.length>0&&b.length>0&&c.length>0&&d.length>0){i=d.outerHeight(true)-window.parseInt(d.css("margin-top").replace("px",""));n=this.getIndexInModelByItemId(t.topItemId);n=n?n:0;e=n*i+window.parseInt(d.css("margin-top").replace("px",""));f=window.parseInt(b.css("padding-top").replace("px",""))+window.parseInt(c.css("padding-top").replace("px",""));g=a.offset().top;a.scrollTop(e+f+g-t.offSetTop);}this._oTopNotificationData=undefined;},_getJqNotificationObjects:function(){var j=jQuery("#notificationIconTabBar-containerContent"),a=j.children(),b=a.children(),c=j.find("li").first();return[j,a,b,c];},getTopOffSet:function(){var t=0,j=this._getJqNotificationObjects()[0];if(j.children().length>0&&j.children().children().length>0){t+=j.children().outerHeight()-j.children().height();t+=j.children().children().outerHeight()-j.children().children().height();}return t;},getTopItemOnTheScreen:function(){var j=this._getJqNotificationObjects()[0],t=0,i,a=0,b=this;t=this.getTopOffSet();j.find("li").each(function(){a=jQuery(this).offset().top;if(a>=t){i=b.getItemNotificationId(this);return false;}});return{topItemId:i,offSetTop:a};},handleError:function(){this.removeBusyIndicatorToTabFilter(true);try{sap.ushell.Container.getService("Message").error(sap.ushell.resources.i18n.getText("errorOccurredMsg"));}catch(e){jQuery.sap.log.error("Getting Message service failed.");}},addBusyIndicatorToTabFilter:function(i){var t=this.getSelectedTabFilter(),I=this.getView().oIconTabBar;if(i){I.addStyleClass('sapUshellNotificationIconTabByTypeWithBusyIndicator');t.removeAllContent();t.addContent(this.getView().oBusyIndicator);}},removeBusyIndicatorToTabFilter:function(i){var t=this.getSelectedTabFilter(),s;if(t&&i){if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){s=this.getView().oNotificationsListPriority;}else{s=this.getView().oNotificationsListDate;}t.removeContent(this.getView().oBusyIndicator);t.addContent(s);}},replaceBusyIndicatorWithNotificationsList:function(){var v=this.getView(),t=v.oIconTabBar.getItems()[1];if(t.getContent()[0]===v.oBusyIndicator){t.removeContent(v.oBusyIndicator);t.addContent(v.oNotificationsListType);}},addNotificationToModel:function(n,i){var m=this.getView().getModel(),a=m.getProperty("/"+this.sCurrentSorting+"/aNotifications");a.splice(i,0,n);m.setProperty("/"+this.sCurrentSorting+"/aNotifications",a);},removeNotificationFromModel:function(n){var m=this.getView().getModel(),i,g,a,N,r={};if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){N="/"+this.sCurrentSorting+"/aNotifications";a=m.getProperty(N);a.some(function(b,i,c){if(b.Id&&b.Id===n){r.obj=c.splice(i,1)[0];r.index=i;return true;}});m.setProperty(N,a);return r;}g=m.getProperty("/notificationsByTypeDescending");for(i=0;i<g.length;i++){a=g[i].aNotifications;if(a){if(a.length===1&&a[0].Id===n){g.splice(i,1);}else{a.some(function(b,i,c){if(b.Id&&b.Id===n){r.obj=c.splice(i,1)[0];r.index=i;return true;}});g[i].aNotifications=a;}}}this.updateGroupHeaders();m.setProperty("/notificationsByTypeDescending",g);return r;},getIndexInModelByItemId:function(n){var N,i;if(this.notificationsByTypeDescending===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){N=this.getView().getModel().getProperty("/"+this.sCurrentExpandedType+"/aNotifications");}else{N=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/aNotifications");}if(N===undefined||N.length===0){return 0;}for(i=0;i<N.length;i++){if(N[i].Id===n){return i;}}},cleanModel:function(){var t=this,s=this.getView().getModel().getProperty("/");if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING){this.getView().oIconTabBar.getItems()[1].removeAllContent();this.getView().oIconTabBar.getItems()[2].removeAllContent();}else if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){this.getView().oIconTabBar.getItems()[0].removeAllContent();this.getView().oIconTabBar.getItems()[1].removeAllContent();}else{this.getView().oIconTabBar.getItems()[2].removeAllContent();this.getView().oIconTabBar.getItems()[0].removeAllContent();}jQuery.each(s,function(i,a){if(i!==t.sCurrentSorting&&i!=="notificationsByTypeDescending"){s[i]=t.getInitialSortingModelStructure();}});this.getView().getModel().setProperty("/",s);},replaceItemsInModel:function(r,n){var c=this.getItemsFromModel(this.sCurrentSorting),C=c.length,h=r.length>=n;if(C){this._oTopNotificationData=this.getTopItemOnTheScreen();}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",h);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/aNotifications",r);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",false);this.handleMaxReached();},setMarkReadOnModel:function(n,I){var m=this.getView().getModel(),p="/"+this.sCurrentSorting,N,d,g,i;d=m.getProperty(p);if(this.sCurrentSorting==="notificationsByTypeDescending"){for(i=0;i<d.length;i++){if(d[i].Id===this.sCurrentExpandedType){p=p+"/"+i;g=true;break;}}if(!g){return;}}p=p+"/aNotifications";N=m.getProperty(p);N.some(function(a){if(a.Id===n){a.IsRead=I;return true;}});m.setProperty(p,N);},getNumberOfItemsInScreen:function(){var i,h=this.getWindowSize();i=(h-this.oPagingConfiguration.TAB_BAR_HEIGHT)/this.oPagingConfiguration.NOTIFICATION_ITEM_HEIGHT;return Math.ceil(i);},getBasicBufferSize:function(){return Math.max(this.getNumberOfItemsInScreen()*3,this.oPagingConfiguration.MIN_NOTIFICATION_ITEMS_PER_BUFFER);},getWindowSize:function(){return jQuery(window).height();},getNumberOfItemsToFetchOnScroll:function(){var c=this.getItemsFromModel(this.sCurrentSorting).length,b=this.getBasicBufferSize();if(c>=this.iMaxNotificationItemsForDevice){return 0;}if(c+b>this.iMaxNotificationItemsForDevice){return this.iMaxNotificationItemsForDevice-c;}return b;},getNumberOfItemsToFetchOnUpdate:function(n){var b=this.getBasicBufferSize(),N=Math.ceil(n/b),r;r=N>0?N*b:b;return r>this.iMaxNotificationItemsForDevice?this.iMaxNotificationItemsForDevice:r;},getItemsFromModel:function(s){if(s===undefined){s=this.sCurrentSorting;}return this.getView().getModel().getProperty("/"+s+"/aNotifications");},getItemsOfTypeFromModel:function(t){var g=this.getGroupFromModel(t);if(g){return g.aNotifications?g.aNotifications:[];}return[];},getGroupFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),G;g.some(function(a,i){if(a.Id===t){G=a;return true;}});return G;},getGroupIndexFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),i;g.forEach(function(a,b){if(a.Id===t){i=b;return true;}});return i;},getItemNotificationId:function(e){var i,I;i=sap.ui.getCore().byId(e.getAttribute("Id")).getBindingContext().sPath;I=this.getView().getModel().getProperty(i+"/Id");return I;},getInitialSortingModelStructure:function(){return{hasMoreItemsInBackend:true,listMaxReached:false,aNotifications:[],inUpdate:false,moreNotificationCount:""};},getSelectedTabFilter:function(){var t;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING){t=this.getView().oIconTabBar.getItems()[0];}else if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){t=this.getView().oIconTabBar.getItems()[2];}else{t=this.getView().oIconTabBar.getItems()[1];}return t;},triggerRetrieveMoreDataForGroupNotifications:function(){if(!this.getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate")){var n=this.getItemsOfTypeFromModel(this.sCurrentExpandedType),a=n?n.length:0,b=a?this.getBasicBufferSize():0,c=b*3/5,i=Math.floor(a-c),l=this.getView().oNotificationsListDate.getItems()[i],t=this.getTopOffSet();if(jQuery(l.getDomRef()).offset().top<=t){this.getNextBufferForType();}}},onExpandGroup:function(g){var l=this.getView().oNotificationsListType.getItems(),a=g.getId(),G=this.getView().getModel().getProperty(g.getBindingContextPath()),t=this;t.sCurrentExpandedType=G.Id;t.getView().getModel().setProperty(g.getBindingContextPath()+"/aNotifications",[]);t.getView().getModel().setProperty(g.getBindingContextPath()+"/hasMoreItems",true);l.forEach(function(i,b){if(i.getId()===a){t.getNextBufferForType();}else if(i.getId()!==a&&!i.getCollapsed()){i.setCollapsed(true);t.getView().getModel().setProperty(i.getBindingContextPath()+"/hasMoreItems",true);}});},notificationsUpdateCallbackForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p;if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);this.updateGroupHeaders();if(s){p=this.oNotificationsService.getNotificationsBufferInGroup(s,0,this.getNumberOfItemsToFetchOnUpdate(n));p.done(function(r){this.addTypeBufferToModel(s,r,true);}.bind(this));p.fail(function(r){this.getNextBufferFailHandler(r);}.bind(this));}},handleEmptyList:function(){var i=this.getItemsFromModel(this.sCurrentSorting);if(i){this.getSelectedList().toggleStyleClass("sapContrast",!i.length);this.getSelectedList().toggleStyleClass("sapContrastPlus",!i.length);}}});},false);},"sap/ushell/components/shell/Notifications/Notifications.view.js":function(){sap.ui.define(['sap/m/NotificationListItem','sap/m/BusyIndicator','sap/m/Button','sap/m/NotificationListGroup','sap/m/List','sap/m/IconTabFilter','sap/m/IconTabBar','sap/m/Text','sap/m/VBox','sap/m/CustomListItem'],function(N,B,a,b,L,I,c,T,V,C){"use strict";sap.ui.jsview("sap.ushell.components.shell.Notifications.Notifications",{createContent:function(o){var t=this;this.oBusyIndicator=new B('notificationsByTypeBusyIndicator',{size:"1rem"});this.oPreviousTabKey="sapUshellNotificationIconTabByDate";this.oPreviousByDateSorting=undefined;this.oActionListItemTemplate=new a({text:"{ActionText}",type:{parts:["Nature"],formatter:function(n){switch(n){case"POSITIVE":return"Accept";case"NEGATIVE":return"Reject";default:return"Default";}}},press:function(E){t.actionButtonPressHandler(E);}});this.removeTabIndexFromList=function(O){var l=O.$().children().get(1);if(l){l.removeAttribute("tabindex");}};this.actionButtonPressHandler=function(E){var n=E.getSource().getBindingContext().getPath(),g=this.getModel().getProperty(n),p=n.split("/"),h=t.oIconTabBar.getSelectedKey(),P=h==='sapUshellNotificationIconTabByType'?"/"+p[1]+"/"+p[2]+"/"+p[3]+"/"+p[4]:"/"+p[1]+"/"+p[2]+"/"+p[3],j=this.getModel().getProperty(P),s=j.Id;this.oPressActionEventPath=n;this.getModel().setProperty(P+"/Busy",true);o.executeAction(s,g.ActionId).done(function(r){if(r&&r.isSucessfull){sap.ui.require(['sap/m/MessageToast'],function(M){if(r.message&&r.message.length){M.show(r.message,{duration:4000});}else{var A=this.oPressActionEventPath,k=this.getModel().getProperty(A),l=k.ActionText;M.show(sap.ushell.resources.i18n.getText("ActionAppliedToNotification",l),{duration:4000});}}.bind(this));if(r.DeleteOnReturn!==false){o.removeNotificationFromModel(s);o.cleanModel();}}else{if(r){sap.ushell.Container.getService('Message').error(r.message);}else{sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteAction'));}}this.getModel().setProperty(P+"/Busy",false);}.bind(this)).fail(function(){this.getModel().setProperty(P+"/Busy",false);sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteAction'));}.bind(this));};this.oActionGroupItemTemplate=new a({text:"{GroupActionText}",type:{parts:["Nature"],formatter:function(n){switch(n){case"POSITIVE":return"Accept";case"NEGATIVE":return"Reject";default:return"Default";}}},press:function(E){var n=this.getBindingContext().getPath(),g=this.getModel().getProperty(n),p=n.split("/"),P="/"+p[1]+"/"+p[2],h=this.getModel().getProperty(P),j=[];if(h.aNotifications){h.aNotifications.forEach(function(k,l){j.push(k.Id);this.getModel().setProperty(P+"/Busy",true);}.bind(this));}this.getModel().setProperty(n+"/Busy",true);o.executeBulkAction(j,g.ActionId,this.getProperty("text"),h,n,P);}});this.addStyleClass('sapUshellNotificationsView');this.oNotificationListItemTemplate=new N({press:function(E){var g=this.getBindingContext(),m=g.sPath,M=this.getModel().getProperty(m),s=M.NavigationTargetObject,A=M.NavigationTargetAction,p=M.NavigationTargetParams,n=M.Id;o.onListItemPress.call(o,n,s,A,p);},datetime:{path:"CreatedAt",formatter:sap.ushell.utils.formatDate.bind(o)},description:"{SubTitle}",title:{parts:["SensitiveText","Text"],formatter:function(s,g){return s?s:g;}},buttons:{path:"Actions",templateShareable:true,sorter:new sap.ui.model.Sorter('Nature',true),template:this.oActionListItemTemplate},unread:{parts:["IsRead"],formatter:function(g){return!g;}},close:function(E){var n=this.getBindingContext().getPath(),g=this.getModel().getProperty(n),s=g.Id;o.dismissNotification(s);},busy:{parts:["Busy"],formatter:function(g){if(g){return g;}return false;}},priority:{parts:["Priority"],formatter:function(p){if(p){p=p.charAt(0)+p.substr(1).toLowerCase();return sap.ui.core.Priority[p];}}}}).addStyleClass("sapUshellNotificationsListItem").addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oNotificationGroupTemplate=new b({title:"{GroupHeaderText}",collapsed:"{Collapsed}",showEmptyGroup:true,enableCollapseButtonWhenEmpty:true,datetime:{path:"CreatedAt",formatter:sap.ushell.utils.formatDate.bind(o)},buttons:{path:"Actions",templateShareable:true,sorter:new sap.ui.model.Sorter('Nature',true),template:this.oActionGroupItemTemplate},items:{path:"aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},onCollapse:function(E){var g=E.getSource(),p=g.getBindingContext().getPath();if(!g.getCollapsed()){t.getModel().setProperty(p+"/Busy",true);t.expandedGroupIndex=p.substring(p.lastIndexOf("/")+1);o.onExpandGroup(g);}},close:function(E){var n=this.getBindingContext().getPath(),p=n.split("/"),P="/"+p[1]+"/"+p[2],g=this.getModel().getProperty(P),h=[];g.aNotifications.forEach(function(j,k){h.push(j.Id);});o.dismissBulkNotifications(h,g);},autoPriority:false,priority:{parts:["Priority"],formatter:function(p){if(p){p=p.charAt(0)+p.substr(1).toLowerCase();return sap.ui.core.Priority[p];}}},busy:{parts:["Busy"],formatter:function(g){if(g){return g;}return false;}}});this.oNotificationsListDate=new L({id:"sapUshellNotificationsListDate",mode:sap.m.ListMode.None,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByDateDescending/aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},growing:true,growingThreshold:400,growingScrollToLoad:true}).addStyleClass("sapUshellNotificationsList");this.oNotificationsListDate.onAfterRendering=function(){o.handleEmptyList();this.oNotificationsListDate.$().parent().parent().scroll(this._triggerRetrieveMoreData.bind(t));if(o._oTopNotificationData){o.scrollToItem(o._oTopNotificationData);}this.oNotificationsListDate.addStyleClass('sapContrast sapContrastPlus');this.removeTabIndexFromList(this.oNotificationsListDate);}.bind(this);this.oNotificationsListPriority=new L({id:"sapUshellNotificationsListPriority",mode:sap.m.ListMode.None,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByPriorityDescending/aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},growing:true,growingThreshold:400,growingScrollToLoad:true}).addStyleClass("sapUshellNotificationsList");this.oNotificationsListPriority.onAfterRendering=function(){o.handleEmptyList();this.oNotificationsListPriority.$().parent().parent().scroll(this._triggerRetrieveMoreData.bind(t));if(o._oTopNotificationData){o.scrollToItem(o._oTopNotificationData);}this.oNotificationsListPriority.addStyleClass('sapContrast sapContrastPlus');this.removeTabIndexFromList(this.oNotificationsListPriority);}.bind(this);this.triggerRetrieveMoreData=function(p){if(!this.getModel().getProperty("/"+p+"/inUpdate")){var n=this.getController().getItemsFromModel(p),g=n?n.length:0,h=g?this.getController().getBasicBufferSize():0,j=h*2/3,k=Math.floor(g-j),l=p==="notificationsByPriorityDescending"?this.oNotificationsListPriority.getItems()[k]:this.oNotificationsListDate.getItems()[k],m=this.getController().getTopOffSet();if(l&&l.getDomRef()&&jQuery(l.getDomRef()).offset().top<=m){this.getController().getNextBuffer(p);}}};this.triggerRetrieveMoreDataForExpandedGroup=function(){if(!this.getModel().getProperty("/notificationsByTypeDescending/inUpdate")){var g=this.getModel().getProperty("/notificationsByTypeDescending"),n=g.length,h=this.getModel().getProperty("/notificationsByTypeDescending")[this.expandedGroupIndex].aNotifications.length,j=h+n,k=j?this.getController().getBasicBufferSize():0,l=k*2/3,m=Math.floor(j-l),p=this.oNotificationsListType.getItems()[this.expandedGroupIndex].getItems()[m],q=this.getController().getTopOffSet();if(p&&p.getDomRef()&&jQuery(p.getDomRef()).offset().top<=q){o.getNextBufferForType();}}};this._triggerRetrieveMoreData=function(){this.triggerRetrieveMoreData(o.sCurrentSorting);};this.oNotificationsListType=new L({id:"sapUshellNotificationsListType",mode:sap.m.ListMode.SingleSelect,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByTypeDescending",template:t.oNotificationGroupTemplate,templateShareable:true}}).addStyleClass("sapUshellNotificationsList").addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oNotificationsListType.onAfterRendering=function(){this.oNotificationsListType.$().parent().parent().scroll(this.triggerRetrieveMoreDataForExpandedGroup.bind(t));this.removeTabIndexFromList(this.oNotificationsListType);}.bind(this);var i=new I({id:"sapUshellNotificationIconTabByDate",key:"sapUshellNotificationIconTabByDate",text:sap.ushell.resources.i18n.getText('notificationsSortByDate'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByDateDescendingTooltip')});var d=new I({id:"sapUshellNotificationIconTabByType",key:"sapUshellNotificationIconTabByType",text:sap.ushell.resources.i18n.getText('notificationsSortByType'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByTypeTooltip'),content:this.oNotificationsListType});var e=new I({id:"sapUshellNotificationIconTabByPrio",key:"sapUshellNotificationIconTabByPrio",text:sap.ushell.resources.i18n.getText('notificationsSortByPriority'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByPriorityTooltip')});this.oIconTabBar=new c('notificationIconTabBar',{backgroundDesign:sap.m.BackgroundDesign.Transparent,expandable:false,selectedKey:"sapUshellNotificationIconTabByDate",items:[i,d,e],select:function(g){var k=g.getParameter("key"),h=g.getParameter("item");if(k==="sapUshellNotificationIconTabByDate"){if(((t.oPreviousTabKey==="sapUshellNotificationIconTabByDate")&&((t.oPreviousByDateSorting===t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING)||t.oPreviousByDateSorting===undefined))||((t.oPreviousTabKey!=="sapUshellNotificationIconTabByDate")&&(t.oPreviousByDateSorting===t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING))){t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING;h.setTooltip(sap.ushell.resources.i18n.getText('notificationsSortByDateAscendingTooltip'));t.oNotificationsListDate.bindItems("/notificationsByDateAscending/aNotifications",t.oNotificationListItemTemplate);if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING);}t.oPreviousByDateSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING;}else{t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;h.setTooltip(sap.ushell.resources.i18n.getText('notificationsSortByDateDescendingTooltip'));t.oNotificationsListDate.bindItems("/notificationsByDateDescending/aNotifications",t.oNotificationListItemTemplate);if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING);}t.oPreviousByDateSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;}t.oPreviousTabKey="sapUshellNotificationIconTabByDate";}else if(k==="sapUshellNotificationIconTabByType"&&t.oPreviousTabKey!=="sapUshellNotificationIconTabByType"){t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING;t.getController().reloadGroupHeaders();h.removeAllContent();h.addContent(t.oBusyIndicator);t.oIconTabBar.addStyleClass('sapUshellNotificationIconTabByTypeWithBusyIndicator');t.oPreviousTabKey="sapUshellNotificationIconTabByType";}else{t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING;if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING);}t.oPreviousTabKey="sapUshellNotificationIconTabByPrio";}t.oPreviousTabKey=k;}}).addStyleClass('sapUshellNotificationTabBar');this.oIconTabBar.addEventDelegate({onsaptabprevious:function(E){var O=E.originalEvent,s=O.srcElement,g=s.classList,h;h=jQuery.inArray('sapMITBFilter',g)>-1;if(h===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}}});var f=this.oIconTabBar.onAfterRendering;this.oIconTabBar.onAfterRendering=function(){if(f){f.apply(this,arguments);}var g=sap.ui.getCore().byId('notificationIconTabBar--header');if(g){g.addStyleClass('sapContrastPlus');g.addStyleClass('sapUshellTabBarHeader');}};return[this.oIconTabBar];},getMoreCircle:function(t){var m=new T({text:sap.ushell.resources.i18n.getText('moreNotifications')}),n=new T({text:""}).addStyleClass("sapUshellNotificationsMoreCircleCount"),M=new V({items:[n,m],alignItems:sap.m.FlexAlignItems.Center}).addStyleClass("sapUshellNotificationsMoreCircle"),o=new T({text:sap.ushell.resources.i18n.getText('moreNotificationsAvailable_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),d=new T({text:sap.ushell.resources.i18n.getText('processNotifications_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),v=new V({items:[M,o,d]}).addStyleClass("sapUshellNotificationsMoreVBox"),l=new C({type:sap.m.ListType.Inactive,content:v}).addStyleClass("sapUshellNotificationsMoreListItem").addStyleClass('sapContrastPlus');n.setModel(this.getModel());n.bindText("/"+t+"/moreNotificationCount");this.oMoreListItem=l;return l;},getControllerName:function(){return"sap.ushell.components.shell.Notifications.Notifications";}});},false);},"sap/ushell/components/shell/Notifications/Settings.controller.js":function(){sap.ui.define(function(){"use strict";sap.ui.controller("sap.ushell.components.shell.Notifications.Settings",{onInit:function(){var t=this,s=sap.ushell.Container.getService("Notifications").readSettings(),m=new sap.ui.model.json.JSONModel(),v,n,r,d;m.setProperty("/aDitryRowsIndicator",[]);m.setProperty("/rows",[]);m.setProperty("/originalRows",[]);s.done(function(R){r=JSON.parse(R);m.setProperty("/rows",r.value);d=JSON.parse(JSON.stringify(r.value));m.setProperty("/originalRows",d);});s.fail(function(){n=t.getView().getNoDataUI();t.getView().removeAllContent();t.getView().addContent(n);});this._handleSwitchFlagsDataInitialization(m);v=this.getView();v.setModel(m);},onExit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){var o=this.getView().getModel().getProperty("/flags"),r=this.getView().getModel().getProperty("/rows"),d;if(r!==undefined){d=JSON.parse(JSON.stringify(r));this.getView().getModel().setProperty("/originalRows",d);}this.getView().getModel().setProperty("/originalFlags/previewNotificationEnabled",o.previewNotificationEnabled);this.getView().getModel().setProperty("/originalFlags/highPriorityBannerEnabled",o.highPriorityBannerEnabled);this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);},getContent:function(){var d=jQuery.Deferred();d.resolve(this.getView());return d.promise();},getValue:function(){var d=jQuery.Deferred();d.resolve(" ");return d.promise();},onCancel:function(){var o=this.getView().getModel().getProperty("/originalFlags"),O=this.getView().getModel().getProperty("/originalRows"),d=JSON.parse(JSON.stringify(O));this.getView().getModel().setProperty("/flags/previewNotificationEnabled",o.previewNotificationEnabled);this.getView().getModel().setProperty("/flags/highPriorityBannerEnabled",o.highPriorityBannerEnabled);this.getView().getModel().setProperty("/rows",d);this.getView().getModel().setProperty("/originalFlags",{});this.getView().getModel().setProperty("/originalRows",[]);this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);},onSave:function(){var d=jQuery.Deferred(),r=this.getView().getModel().getProperty("/rows"),o=this.getView().getModel().getProperty("/originalRows"),t,T,i,D=this.getView().getModel().getProperty("/aDitryRowsIndicator");d.resolve();this._handleSwitchFlagsSave();for(i=0;i<r.length;i++){if(D[i]&&D[i]===true){t=r[i];T=o[i];if(!this._identicalRows(t,T)){sap.ushell.Container.getService("Notifications").saveSettingsEntry(t);}}}this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);return d.promise();},setControlDirtyFlag:function(){var c=this.getBindingContext().sPath,i=c.substring(c.lastIndexOf("/")+1,c.length),o=this.getModel().getProperty("/aDitryRowsIndicator");if(o!==undefined){this.getModel().setProperty("/aDitryRowsIndicator/"+i,true);}},_handleSwitchFlagsDataInitialization:function(m){var s=sap.ushell.Container.getService("Notifications").getUserSettingsFlags(),M=sap.ushell.Container.getService("Notifications")._getNotificationSettingsMobileSupport();s.done(function(S){m.setProperty("/flags",{});m.setProperty("/flags/previewNotificationEnabled",S.previewNotificationEnabled);m.setProperty("/flags/highPriorityBannerEnabled",S.highPriorityBannerEnabled);m.setProperty("/flags/mobileNotificationsEnabled",M);m.setProperty("/originalFlags",{});m.setProperty("/originalFlags/previewNotificationEnabled",S.previewNotificationEnabled);m.setProperty("/originalFlags/highPriorityBannerEnabled",S.highPriorityBannerEnabled);});},_handleSwitchFlagsSave:function(){var p=this.getView().getModel().getProperty("/flags/previewNotificationEnabled"),h=this.getView().getModel().getProperty("/flags/highPriorityBannerEnabled"),o=this.getView().getModel().getProperty("/originalFlags/previewNotificationEnabled"),O=this.getView().getModel().getProperty("/originalFlags/highPriorityBannerEnabled");if((o!==p)||(O!==h)){sap.ushell.Container.getService("Notifications").setUserSettingsFlags({previewNotificationEnabled:p,highPriorityBannerEnabled:h});if(p!==o){sap.ui.getCore().getEventBus().publish("sap.ushell.services.Notifications","enablePreviewNotificationChanged",{bPreviewEnabled:p});}this.getView().getModel().setProperty("/originalFlags/previewNotificationEnabled",p);this.getView().getModel().setProperty("/originalFlags/highPriorityBannerEnabled",h);}},_identicalRows:function(r,a){if((r.NotificationTypeId===a.NotificationTypeId)&&(r.PriorityDefault===a.PriorityDefault)&&(r.DoNotDeliver===a.DoNotDeliver)&&(r.DoNotDeliverMob===a.DoNotDeliverMob)){return true;}return false;}});},false);},"sap/ushell/components/shell/Notifications/Settings.view.js":function(){sap.ui.define(function(){"use strict";sap.ui.jsview("sap.ushell.components.shell.Notifications.Settings",{createContent:function(c){var t=this,n,T,s,v,h,r=sap.ushell.resources.i18n;n=new sap.m.Table("notificationSettingsTable",{backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.All,columns:[new sap.m.Column({header:new sap.m.Text({text:r.getText("notificationType_column"),tooltip:r.getText("notificationType_columnTooltip")}),vAlign:"Middle",hAlign:"Left"}),new sap.m.Column({header:new sap.m.Text({text:r.getText("iOSNotification_column"),tooltip:r.getText("iOSNotification_columnTooltip")}),visible:"{/flags/mobileNotificationsEnabled}",minScreenWidth:"Tablet",demandPopin:true,vAlign:"Middle",hAlign:"Left"}),new sap.m.Column({header:new sap.m.Text({text:r.getText("highNotificationsBanner_column"),tooltip:r.getText("highNotificationsBanner_columnTooltip")}),minScreenWidth:"Tablet",demandPopin:true,hAlign:"Left"}),new sap.m.Column({header:new sap.m.Text({text:r.getText("Notifications_Settings_Show_Type_column"),tooltip:r.getText("notificationTypeEnable_columnTooltip")}),vAlign:"Middle",hAlign:"Left"})]});n.setFixedLayout(false);T=new sap.m.ColumnListItem({cells:[new sap.m.Label({text:"{NotificationTypeDesc}"}),new sap.m.CheckBox({selected:{parts:["DoNotDeliverMob"],formatter:function(d){return!d;}},select:function(e){t.getController().setControlDirtyFlag.apply(this);var p=e.getSource().getBindingContext().sPath;if(e.mParameters.selected===true){t.getModel().setProperty(p+"/DoNotDeliverMob",false);}else{t.getModel().setProperty(p+"/DoNotDeliverMob",true);}}}),new sap.m.CheckBox({select:function(e){t.getController().setControlDirtyFlag.apply(this);var p=e.getSource().getBindingContext().sPath;if(e.mParameters.selected===true){t.getModel().setProperty(p+"/PriorityDefault","40-HIGH");}else{t.getModel().setProperty(p+"/PriorityDefault","");}},selected:{parts:["PriorityDefault"],formatter:function(p){t.getController().setControlDirtyFlag.apply(this);if(p==="40-HIGH"){return true;}return false;}}}),new sap.m.Switch({state:{parts:["DoNotDeliver"],formatter:function(d){return!d;}},customTextOn:" ",customTextOff:" ",select:function(e){t.getController().setControlDirtyFlag.apply(this);},change:function(e){var N=e.getParameter("state"),p=e.getSource().getBindingContext().sPath;t.getModel().setProperty(p+"/DoNotDeliver",!N);t.getController().setControlDirtyFlag.apply(this);}})]});n.bindAggregation("items",{path:"/rows",template:T,sorter:new sap.ui.model.Sorter("NotificationTypeDesc")});v=new sap.m.VBox();s=this.createSwitchControlBar();h=new sap.m.VBox();h.addStyleClass("sapContrastPlus");h.addItem(s);v.addItem(h);v.addItem(n);return[v];},createSwitchControlBar:function(){var d,D,o,p,e,E,s,r=sap.ushell.resources.i18n,a=sap.ui.Device.system,b=a.desktop||a.tablet||a.combi;s=new sap.m.FlexBox('notificationSettingsSwitchBar');d=new sap.m.Switch("doNotDisturbSwitch",{tooltip:r.getText("showAlertsForHighNotifications_tooltip"),state:"{/flags/highPriorityBannerEnabled}",customTextOn:r.getText("Yes"),customTextOff:r.getText("No"),mode:sap.ui.model.BindingMode.TwoWay}).addAriaLabelledBy(D);D=new sap.m.Label("doNotDisturbLabel",{text:r.getText("Show_High_Priority_Alerts_title")});o=new sap.m.HBox("notificationDoNotDisturbHBox",{items:[d,D]});s.addItem(o);if(b===true){p=new sap.m.Switch("enablePreviewSwitch",{tooltip:r.getText("showNotificationsPreview_tooltip"),state:"{/flags/previewNotificationEnabled}",customTextOn:r.getText("Yes"),customTextOff:r.getText("No"),mode:sap.ui.model.BindingMode.TwoWay}).addAriaLabelledBy(e);e=new sap.m.Label("enablePreviewLabel",{text:r.getText("Show_Preview_in_Home_Page_title")});E=new sap.m.FlexBox({items:[p,e]});s.addItem(E);}return s;},getNoDataUI:function(){var n,N,o,a,r=sap.ushell.resources.i18n;if(n===undefined){N=new sap.ui.core.Icon("notificationSettingsNoDataIcon",{size:"5rem",src:"sap-icon://message-information"});o=new sap.m.Text("notificationSettingsNoDataTextHeader",{text:r.getText("noNotificationTypesEnabledHeader_message")}).setTextAlign(sap.ui.core.TextAlign.Center);a=new sap.m.Text("notificationSettingsNoDataText",{text:r.getText("noNotificationTypesEnabled_message")}).setTextAlign(sap.ui.core.TextAlign.Center);n=new sap.m.VBox("notificationSettingsNoDataInnerBox",{items:[N,o,a]});}return n;},getControllerName:function(){return"sap.ushell.components.shell.Notifications.Settings";}});},false);}},"Component-preload");
