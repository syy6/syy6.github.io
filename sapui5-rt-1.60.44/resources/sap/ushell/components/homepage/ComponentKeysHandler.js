// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ushell/ui/launchpad/AccessibilityCustomData','sap/ushell/EventHub'],function(A,E){"use strict";var C=function(){};C.prototype={keyCodes:jQuery.sap.KeyCodes,tileFocusCustomData:new A({key:"tabindex",value:"0",writeToDom:true}),goToTileContainer:function(){if(this.oModel.getProperty('/tileActionModeActive')){this.goToFirstVisibleTileContainer();}else{this.goToLastVisitedTile();}},goToFirstVisibleTileContainer:function(){var j=jQuery('#dashboardGroups').find('.sapUshellTileContainer:visible'),t=this.oModel.getProperty("/topGroupInViewPortIndex");if(j.length){var a=jQuery(j.get(t));if(a.length){this._setTileContainerSelectiveFocus(a);}}},goToLastVisitedTile:function(j,l){var a,b,d;if(l){var e=jQuery('#dashboardGroups').find('.sapUshellTileContainer:visible'),t=this.oModel.getProperty("/topGroupInViewPortIndex");var f=j||jQuery(e.get(t));a=f.find(".sapUshellTile:visible:first");b=f.find(".sapUshellTile:visible[tabindex=0]");d=f.find(".sapMGTLineMode:visible[tabindex=0]");if(a.length===0){a=jQuery(".sapUshellTile:visible:first");}}else{a=jQuery(".sapUshellTile:visible:first");b=jQuery(".sapUshellTile:visible[tabindex=0]");d=jQuery(".sapMGTLineMode:visible[tabindex=0]");}if(b.length){this._moveScrollDashboard(b);}else if(d.length){this._moveScrollDashboard(d);}else if(a.length){a.attr("tabindex","0");this._moveScrollDashboard(a);}},_goToFirstTileOfNextGroup:function(d,e){this._preventDefault(e);var i=this._getGroupAndTilesInfo();if(i){var n=this._getNextGroup(d,i.oGroup,false,true);if(n){this._goToTileOfGroup("first",n);}}},_goToTileOfGroup:function(p,g){if(g){var a=g.getTiles();if(this.oModel.getProperty('/tileActionModeActive')){a.push(g.oPlusTile);}a=a.concat(g.getLinks());p=p==="first"?0:p;p=p==="last"?a.length-1:p;var t=a[p];if(t&&t.getDomRef()){var j=jQuery(t.getDomRef());if(j.length===1){this._moveScrollDashboard(j);return true;}}}return false;},_moveTile:function(d){var i=this._getGroupAndTilesInfo(),D=this._getNextTile(d,true,i);if(D){var o=D.getParent(),s=D.getMode?D.getMode():'ContentMode',a=i.oCurTile.getMode?i.oCurTile.getMode():'ContentMode',b=s==='LineMode'?o.getLinks():o.getTiles(),n=0;if(i.oGroup===o){n=b.indexOf(D);if(a==="LineMode"&&s==="ContentMode"&&d==="left"){n=b.length;}}else if(d==="left"||d==="up"){n=b.length;}var e,f,t=this;if(a===s){var g=jQuery(".sapUshellDashboardView").control(0);e="movetile";f={sTileId:g.getController()._getTileUuid(i.oCurTile),toGroupId:o.getGroupId?o.getGroupId():o.groupId,toIndex:n,sToItems:a==='LineMode'?'links':'tiles',sFromItems:a==='LineMode'?'links':'tiles',sTileType:a==='LineMode'?'link':'tile'};if(s==="LineMode"){f.callBack=function(){setTimeout(function(){var b=s==='LineMode'?o.getLinks():o.getTiles();t._moveScrollDashboard(b[n].$());},10);};}else{setTimeout(function(){var b=s==='LineMode'?o.getLinks():o.getTiles();t._moveScrollDashboard(b[n].$());},10);}}else{e="convertTile";f={toGroupId:o.getGroupId?o.getGroupId():o.groupId,srcGroupId:i.oGroup.getGroupId?i.oGroup.getGroupId():i.oGroup.groupId,toIndex:n,callBack:function(){setTimeout(function(){var b=s==='LineMode'?o.getLinks():o.getTiles();t._moveScrollDashboard(b[n].$());},10);},tile:i.oCurTile,longDrop:false};}sap.ui.getCore().getEventBus().publish("launchpad",e,f);}},callbackSetFocus:function(t){var a=this;setTimeout(function(){if(t.oParent&&t.oParent instanceof sap.ushell.ui.launchpad.Tile){a._moveScrollDashboard(jQuery(t.oParent.getDomRef()));}else{a._moveScrollDashboard(t.$());}});},_getTileCenter:function(d,t,T){if(!(T instanceof HTMLElement)){var j=T.$().find(".sapMGTLineStyleHelper");if(T.isLink&&j&&j.length>1){if(d==="down"){return t.right;}return t.left;}}return t.right-((t.right-t.left)/2);},_getTileRect:function(d,t){if(t instanceof HTMLElement){return t.getBoundingClientRect();}var j=t.$().find(".sapMGTLineStyleHelper");if(t.isLink&&j&&j.length){if(d==="down"){return j.get(j.length-1).getBoundingClientRect();}else{return j.get(0).getBoundingClientRect();}}if(t.getDomRef()){return t.getDomRef().getBoundingClientRect();}},_findClosestTile:function(d,t,o){var a=this._getTileRect(d,o),n=this._getTileCenter(d,a,o);var b,e=Infinity,f=d==="down"?1:-1,g=t.indexOf(o)+f,h;for(;;g+=f){var T=t[g];if(!T){return b;}if(!b){if(d==="down"&&g===t.length-1){return T;}if(d==="up"&&g===0){return T;}}var i=this._getTileRect(d,T);if(!i){return b;}if(d==="down"&&a.bottom+5>=i.bottom){continue;}if(d==="up"&&a.top-5<=i.top){continue;}if(b&&h!=i.top){return b;}h=i.top;var j=Math.min(Math.abs(i.left-n),Math.abs(i.right-n));if(e>j){e=j;b=T;}else{return b;}}},_getNextTile:function(d,m,g){var i=g||this._getGroupAndTilesInfo(),l=true;if(!i||(m&&i.oGroup.getProperty('isGroupLocked'))){return null;}if(m){var t=i.oCurTile.getBindingContext().getObject().object;l=sap.ushell.Container.getService("LaunchPage").isLinkPersonalizationSupported(t);}if(d==="right"||d==="left"){var f=i.oCurTile.isLink?i.aLinks:i.aTiles,n=f.indexOf(i.oCurTile),a=d==="right"?n+1:n-1;if(f[a]&&f[a].getDomRef()){if(m&&f[a]===i.oGroup.oPlusTile){}else{return f[a];}}if(d==="right"&&!i.oCurTile.isLink&&i.aLinks.length&&l){return i.aLinks[0];}if(d==="left"&&i.oCurTile.isLink&&i.aTiles.length){return i.oGroup.getShowPlaceholder()?i.oGroup.oPlusTile:i.aTiles[i.aTiles.length-1];}}var N=this._getNextGroup(d,i.oGroup,m,l);if(N&&d==="right"){if(N.getTiles().length===0&&(N.getLinks().length===0)){return N.oPlusTile;}else if(N.getTiles().length===0){return N.getLinks()[0];}else{return N.getTiles()[0];}}if(N&&d==="left"){if(N.getTiles().length===0&&(N.getLinks().length===0)){return N.oPlusTile;}else if(N.getLinks().length===0){return N.getTiles()[N.getTiles().length-1];}else{return N.getLinks()[N.getLinks().length-1];}}if(d==="down"||d==="up"){var G=l?i.aTiles.concat(i.aLinks):i.aTiles,b=[];if(N){b=l?N.getTiles().concat(N.getLinks()):N.getTiles();if(b.length===0){b.push(N.oPlusTile);}}var j=(d==="down")?G.concat(b):b.concat(G);return this._findClosestTile(d,j,i.oCurTile);}},_getNextGroup:function(d,o,m,l){var n,a,g=o.getParent().getGroups(),b=g.indexOf(o),e=b;if(d==="down"||d==="right"){a=1;}else if(d==="up"||d==="left"){a=-1;}else{jQuery.sap.log.error("Direction is unkown",d,"sap.ushell.components.homepage.ComponentKeysHandler");return null;}e+=a;while(g[e]){n=g[e];var f=l?n.getTiles().concat(n.getLinks()):n.getTiles();var i=n.getVisible()&&!(n.getIsGroupLocked()&&m)&&!(f.length===0&&!(m||this.oModel.getProperty('/tileActionModeActive')));if(i){return n;}e+=a;}},_getGroupAndTilesInfo:function(){var j=this._getFocusOnTile(jQuery(document.activeElement));if(!j||!j.length){return null;}var o=j.control(0);o.isLink=j.hasClass('sapUshellLinkTile')||j.hasClass('sapMGTLineMode');var g=j.closest(".sapUshellTileContainer").control(0);if(!g){return null;}var t=g.getTiles();if(g.getShowPlaceholder()){t.push(g.oPlusTile);}return{oCurTile:o,oGroup:g,aTiles:t,aLinks:g.getLinks()};},_goToSiblingElementInTileContainer:function(d,j){var a=j.closest('.sapUshellTileContainer'),b,e,f;b=j.closest('.sapUshellTileContainerBeforeContent');if(b.length){if(d==='up'||d==="left"){this._goToNextTileContainer(b,d);}else{f=a.find('.sapUshellTileContainerHeader:first');this._setTabIndexOnTileContainerHeader(f);f.focus();}return;}b=j.closest('.sapUshellTileContainerHeader');if(b.length){if(d==='up'){this._setTabIndexOnTileContainerHeader(f);if(!this._goToTileContainerBeforeContent(a)){this._goToNextTileContainer(b,d);}}else if(d==="down"){e=a.find('.sapUshellTile:first');if(e.length){this._moveScrollDashboard(jQuery(e));}else{this._goToNextTileContainer(b,d);}}else if(d==="left"){if(j.hasClass("sapUshellTileContainerHeader")){if(!this._goToTileContainerBeforeContent(a)){this._goToNextTileContainer(b,"left");}}else{f=j.closest(".sapUshellTileContainerHeader");f.focus();}}else if(d==="right"){var g=j.hasClass("sapMInputBaseInner");if(!g){e=a.find('.sapUshellTile:first');if(e.length){this._moveScrollDashboard(e);}else{this._goToNextTileContainer(b,"down");}}}return;}b=this._getFocusOnTile(j);if(b){this._goFromFocusedTile(d,b,true);return;}b=j.closest('.sapUshellTileContainerAfterContent');if(b.length){if(d==='up'||d==="left"){this._goToTileOfGroup("first",b.control(0));}else{this._goToNextTileContainer(b,d);}}},_goToNextTileContainer:function(j,d){var a=j.closest('.sapUshellTileContainer');if(a.length===1){var b=jQuery('.sapUshellTileContainer:visible'),n=(d==='down')?1:-1,e=jQuery(b[b.index(a)+n]);if(e.length===1){var f=e.find('.sapUshellTileContainerHeader');if(d==='down'){if(!this._goToTileContainerBeforeContent(e)){this._setTabIndexOnTileContainerHeader(f);this._setTileContainerSelectiveFocus(e);}}else if(!this._goToTileContainerAfterContent(e)){if(d==="up"||d==="left"){var s=d==="up"?"first":"last";if(!this._goToTileOfGroup(s,e.control(0))){this._setTabIndexOnTileContainerHeader(f);f.focus();}}}}}},_goToTileContainerBeforeContent:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=a.find('.sapUshellTileContainerBeforeContent button:visible');if(b.length){b.focus();return true;}else{return false;}},_goToTileContainerAfterContent:function(j){var a=j.hasClass('sapUshellTileContainer')?j:j.closest('.sapUshellTileContainer'),b=a.find('.sapUshellTileContainerAfterContent button:visible');if(b.length){b.focus();return true;}else{return false;}},_goFromFocusedTile:function(d,j,i){var n=this._getNextTile(d);if(n){var a=n.$();if(i){var b=jQuery(j).closest('.sapUshellTileContainer'),e=n.oParent.$();if(b.get(0).id===e.get(0).id){this._moveScrollDashboard(a);}else if(d==='down'||d==='right'){if(!this._goToTileContainerAfterContent(b)){this._setTabIndexOnTileContainerHeader(e.find('.sapUshellTileContainerHeader'));this._setTileContainerSelectiveFocus(e);}}else if(d==='up'||d==='left'){var f=b.find('.sapUshellTileContainerHeader');this._setTabIndexOnTileContainerHeader(f);f.focus();}}else{this._moveScrollDashboard(a);}}},_setTabIndexOnTileContainerHeader:function(j){jQuery(".sapUshellTileContainerHeader").attr("tabindex",-1);jQuery(".sapUshellTileContainerHeader .sapUshellContainerTitle").attr("tabindex",-1);jQuery(".sapUshellTileContainerHeader .sapUshellContainerHeaderActions button").attr("tabindex",-1);if(j){var a=j.find('.sapUshellContainerTitle:first'),b=j.find('.sapUshellContainerHeaderActions:first');j.attr('tabindex',0);a.attr('tabindex',0);b.find('button').attr('tabindex',0);}},_setTileContainerSelectiveFocus:function(j){var a=jQuery('#dashboardGroups').find('.sapUshellTileContainer:visible'),b=j.find('.sapUshellTileContainerBeforeContent button'),d=j.find('.sapUshellTileContainerHeader:first'),B=b.length&&b.is(":visible");if(B){b.focus();}else if(j.get(0)===a.get(0)){this.goToLastVisitedTile();}else if(d.length){this._setTabIndexOnTileContainerHeader(d);d.focus();}},setTileFocus:function(j){if(!j.hasClass('sapUshellPlusTile')){if(j.parents('#catalogView').length>0){this.setFocusOnCatalogTile(j.find('[tabindex]').eq(0));}}jQuery(".sapUshellTile [tabindex = 0]").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});jQuery(".sapUshellTile:visible[tabindex=0]").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});jQuery(".sapMGTLineMode [tabindex = 0]").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});jQuery(".sapUshellLinkTile [tabindex = 0]").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});if(j.length>0){j.attr("tabindex",0);var a=jQuery("#Fiori2LoadingDialog")[0];if(!a||a.style.visibility==="hidden"){if(j.prop("tagName")==="DIV"&&jQuery(j).hasClass("sapUshellLinkTile")&&j.getMode==undefined){j=j.find("a").length?j.find("a")[0]:j;}j.focus();if(j[0]&&j[0].id){var t=sap.ui.getCore().byId(j[0].id);var b=this.tileFocusCustomData.getParent&&this.tileFocusCustomData.getParent();if(b){b.removeAggregation("customData",this.tileFocusCustomData,true);}if(t&&sap.ui.getCore().byId(t.getId())&&this.tileFocusCustomData&&sap.ui.getCore().byId(this.tileFocusCustomData.getId())){t.addAggregation("customData",this.tileFocusCustomData,true);}}}}else{var d=jQuery(j.prevObject.selector.substring(0,j.prevObject.selector.length-3));if(d.length>0){var o=d.control(0),i={oCurTile:o.oPlusTile,oGroup:o,aTiles:o.getTiles(),aLinks:o.getLinks()},n=this._getNextTile("left",false,i);if(!n){n=this._getNextTile("right",false,i);}jQuery(n.getDomRef()).attr("tabindex",0);}}},setFocusOnCatalogTile:function(j){var p=jQuery(".sapUshellTile[tabindex=0]"),a,v;if(p.length){jQuery(".sapUshellTileContainerContent [tabindex=0]").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});a=p.find('[tabindex], a').andSelf().filter('[tabindex], a');a.attr("tabindex",-1);}if(!j){v=jQuery(".sapUshellTile:visible,.sapUshellAppBox:visible");if(v.length){j=jQuery(v[0]);}else{return;}}j.attr("tabindex",0);j.find("button").attr("tabindex",0);j.focus();},_moveScrollDashboard:function(j){var y=-1*(document.getElementById('dashboardGroups').getBoundingClientRect().top)+j[0].getBoundingClientRect().top;jQuery('#sapUshellDashboardPage section').stop().animate({scrollTop:y},0,function(){this.setTileFocus(j);}.bind(this));},_moveGroupFromDashboard:function(d,j){var a,t=jQuery(".sapUshellDashboardGroupsContainerItem"),i,b;a=j.closest(".sapUshellDashboardGroupsContainerItem");i=t.index(a);b=d=="up"||d=="left"?i-1:i+1;this._moveGroup(i,b);},_moveGroup:function(f,t){if(t<0||t>=jQuery(".sapUshellDashboardGroupsContainerItem").length||t<jQuery(".sapUshellDisableDragAndDrop").length){return;}sap.ui.getCore().getEventBus().publish("launchpad","moveGroup",{fromIndex:f,toIndex:t});var a=this;setTimeout(function(){var b=jQuery(".sapUshellTileContainerHeader")[t];a._setTabIndexOnTileContainerHeader(jQuery(b));jQuery(b).focus();},100);},_getFocusOnTile:function(j){var a;['.sapUshellTile','.sapUshellLinkTile'].forEach(function(s){var b=j.closest(s);if(b.length){a=b;}});return a;},_renameGroup:function(j){if(j.closest('.sapUshellTileContainerHeader').length===1){j=j[0].tagName==='H2'?j:j.find("h2");j.click();}},_arrowsButtonsHandler:function(d,e,j){var i=this.oModel.getProperty('/tileActionModeActive');if((i&&j.hasClass('sapMInputBaseInner'))||j.hasClass("sapMITBFilter")){return;}else{this._preventDefault(e);}if(j.hasClass("sapUshellAnchorItem")){this._handleAnchorNavigationItemsArrowKeys(d,j);return;}var a=this._getFocusOnTile(j);if(e.ctrlKey===true&&this.oModel.getProperty("/personalization")){var b=j.closest('.sapUshellTileContainerHeader');if(a){this._moveTile(d,a);}else if(b.length){var f=b.closest('.sapUshellTileContainerContent');if(!f.hasClass('sapUshellTileContainerDefault')||!f.hasClass('sapUshellTileContainerLocked')){this._moveGroupFromDashboard(d,b);}}}else if(i){this._goToSiblingElementInTileContainer(d,j);}else if(a){this._goFromFocusedTile(d,a,i);}else if(!j.hasClass("sapUshellActionItem")){this.goToLastVisitedTile();}},_handleAnchorNavigationItemsArrowKeys:function(d,j){var a=jQuery(".sapUshellAnchorItem:visible"),n=a.index(j),N=j;if(d==="left"||d==="up"){if(n>0){N=a.get(n-1);}}else if(d==="right"||d==="down"){if(n<a.length-1){N=a.get(n+1);}}this._setAnchorItemFocus(jQuery(N));},_setAnchorItemFocus:function(j){jQuery(".sapUshellAnchorItem").get().forEach(function(h){jQuery(h).attr("tabindex",-1);});j.attr("tabindex",0);j.focus();},_appFinderHomeEndButtonsHandler:function(d,e,j){var v=jQuery(".sapUshellTile:visible,.sapUshellAppBox:visible"),a;if(v.length){if(d==="home"){a=jQuery(v.get(0));}if(d==="end"){a=jQuery(v.get(v.length-1));}}if(a){this._preventDefault(e);this._appFinderFocusAppBox(j,a);}},_homeEndButtonsHandler:function(s,e,j){if(j.hasClass("sapUshellAnchorItem")){this._preventDefault(e);this._setAnchorItemFocus(jQuery(".sapUshellAnchorItem:visible:"+s));}else if(e.ctrlKey===true){this._preventDefault(e);var a=jQuery(".sapUshellTile:visible")[s]();this._moveScrollDashboard(a);}else{var b=j.closest('.sapUshellTileContainer');if(b){var g=b.control(0);if(g){this._preventDefault(e);this._goToTileOfGroup(s,g);}}}},_deleteButtonHandler:function(j){if(this.oModel.getProperty("/personalization")&&this.oModel.getProperty("/tileActionModeActive")){var a=this._getFocusOnTile(j);if(a&&!a.hasClass('sapUshellLockedTile')&&!a.hasClass('sapUshellPlusTile')){var i=this._getGroupAndTilesInfo();if(i){var d=jQuery(".sapUshellDashboardView").control(0),t=d.getController()._getTileUuid(i.oCurTile),b=this;setTimeout(function(){if(i.oCurTile.getDomRef()){b._moveScrollDashboard(i.oCurTile.$());}else{b._moveScrollDashboard(i.oGroup.oPlusTile.$());}},100);sap.ui.getCore().getEventBus().publish("launchpad","deleteTile",{tileId:t},this);}}}},_ctrlPlusArrowKeyButtonsHandler:function(d){var j=jQuery(document.activeElement),a=j.closest('.sapUshellTileContainerHeader');if(this._getFocusOnTile(j)){this._moveTile(d);}else if(a.length){var b=a.closest('.sapUshellTileContainerContent');if(!b.hasClass('sapUshellTileContainerDefault')||!b.hasClass('sapUshellTileContainerLocked')){this._moveGroupFromDashboard(d,a);}}},_spaceButtonHandler:function(e,j){if(this._getFocusOnTile(j)){e.preventDefault();j.click(j);if(j.control(0).getUuid){sap.ui.getCore().getEventBus().publish("launchpad","dashboardTileClick",{uuid:j.control(0).getUuid()});}}else{j.click();}},_enterButtonHandler:function(j){if(j.hasClass('sapMInputBaseInner')){var a=j.closest('.sapUshellTileContainerHeader'),t=this;if(a.length===1){setTimeout(function(){a=jQuery("#"+a[0].id);t._setTabIndexOnTileContainerHeader(a);a.focus();},10);}}if(this._getFocusOnTile(j)){j.click(j);if(j.control(0).getUuid){sap.ui.getCore().getEventBus().publish("launchpad","dashboardTileClick",{uuid:j.control(0).getUuid()});}}},goToSelectedAnchorNavigationItem:function(){this._setAnchorItemFocus(jQuery(".sapUshellAnchorItemSelected"));return jQuery(document.activeElement).hasClass("sapUshellAnchorItemSelected");},handleFocusOnMe:function(e,f){var r=sap.ushell.Container.getRenderer("fiori2"),h=c;if(r){var s=r.getCurrentCoreView();if(s==="home"){if(f){if(e.shiftKey){var a=jQuery("#sapUshellDashboardFooterDoneBtn:visible");if(a.length){a.focus();}else{h.goToLastVisitedTile();}}else if(!h.goToSelectedAnchorNavigationItem()){h.goToLastVisitedTile();}}else{h._dashboardKeydownHandler(e);}}if(s==="appFinder"){if(f){if(e.shiftKey){h.setFocusOnCatalogTile();}else{var o=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(o&&o.getVisible()){o.focus();}else{h.appFinderFocusMenuButtons(e);}}}else{h._appFinderKeydownHandler(e);}}}},_groupHeaderNavigation:function(j){var a;if(j.hasClass("sapUshellTileContainerHeader")){a=j.find(".sapUshellContainerTitle");a.focus();}else if(j.closest(".sapUshellTileContainerHeader")){a=j.closest(".sapUshellTileContainerHeader");a.focus();}},_appFinderFocusAppBox:function(j,a){if(j&&a){j.attr("tabindex","-1").find(".sapUshellPinButton").attr("tabindex","-1");a.attr("tabindex","0").focus();a.find(".sapUshellPinButton").attr("tabindex","0");}},_preventDefault:function(e){e.preventDefault();e.stopPropagation();e.stopImmediatePropagation();},_getNextCatalog:function(d,j){var a;if(d==="down"||d==="right"){a=j.next();}else if(d==="up"||d==="left"){a=j.prev();}else{jQuery.sap.log.error("Direction is unkown",d,"sap.ushell.components.homepage.ComponentKeysHandler");return null;}if(a.length>0){var n=a.find("li.sapUshellAppBox, li.sapUshellTile").get().length;if(n>0){return a;}else{return this._getNextCatalog(d,a);}}},_getNextCatalogItem:function(d,j,p){var a=jQuery(j.parents()[2]),b=a.find("li.sapUshellAppBox, li.sapUshellTile").get();if(d==="right"||d==="left"){var n=b.indexOf(j.get(0)),e=d==="right"?n+1:n-1;if(b[e]){return b[e];}}var f=this._getNextCatalog(d,a),N=f?f.find("li.sapUshellAppBox, li.sapUshellTile").get():[];if(N.length>0&&d==="right"){return N[0];}if(N.length>0&&d==="left"){return N[N.length-1];}if(d==="down"||d==="up"){if(N.length>0&&p){return N[0];}else{var J=(d==="down")?b.concat(N):N.concat(b);return this._findClosestTile(d,J,j.get(0));}}},_appFinderKeysHandler:function(d,e,j,p){if(j.is(".sapUshellAppBox, .sapUshellTile")){this._preventDefault(e);var a=jQuery(this._getNextCatalogItem(d,j,p));if(a){this._appFinderFocusAppBox(j,a);}}},_handleAppFinderButton:function(){var o=window.document.getElementById("openCatalogBtn"),a=sap.ushell.Container.getRenderer("fiori2").getShellConfig(),O=window.document.getElementById("endItemsOverflowBtn");if(o){o.focus();return;}if(a.moveAppFinderActionToShellHeader){if(O){O.focus();}}else{E.emit('showMeArea',Date.now());window.setTimeout(function(){o=window.document.getElementById("openCatalogBtn");if(o){o.focus();}else{O=window.document.getElementById("overflowActions-overflowButton");if(O){O.focus();}}},300);}},handleShortcuts:function(e){var h=c,s=window.document.getElementById("shell-header");if(e.altKey&&s){switch(e.keyCode){case h.keyCodes.A:if(h.oModel.getProperty("/personalization")){s.setAttribute("accesskey","a");window.setTimeout(function(){h._handleAppFinderButton();s=window.document.getElementById("shell-header");if(s){s.removeAttribute("accesskey");}},0);e.preventDefault();}break;case h.keyCodes.H:h.oRouter.navTo("home");E.emit('showMeArea',false);E.emit('showNotifications',false);s.setAttribute("accesskey","h");window.setTimeout(function(){var f=jQuery(".sapUshellAnchorItem:visible:first");if(f.length){f.focus();}s=window.document.getElementById("shell-header");if(s){s.removeAttribute("accesskey");}},0);e.preventDefault();break;default:}}var i=h.oModel.getProperty('/tileActionModeActive');if(e.ctrlKey&&e.keyCode===h.keyCodes.ENTER&&i){var d=sap.ui.getCore().byId("sapUshellDashboardFooterDoneBtn");if(d){d.firePress();}}},appFinderFocusMenuButtons:function(e){var b=jQuery("#catalog-button, #userMenu-button, #sapMenu-button").filter("[tabindex=0]");if(b.length){b.eq(0).focus();this._preventDefault(e);return true;}else{return false;}},_appFinderKeydownHandler:function(e){var j=jQuery(document.activeElement);if(e.srcElement.id!="appFinderSearch-I"){var p=e.keyCode,i=sap.ui.getCore().getConfiguration().getRTL();if(i&&p===this.keyCodes.ARROW_RIGHT){p=this.keyCodes.ARROW_LEFT;}else if(i&&p===this.keyCodes.ARROW_LEFT){p=this.keyCodes.ARROW_RIGHT;}switch(p){case this.keyCodes.ARROW_UP:this._appFinderKeysHandler("up",e,j);break;case this.keyCodes.ARROW_DOWN:this._appFinderKeysHandler("down",e,j);break;case this.keyCodes.ARROW_RIGHT:this._appFinderKeysHandler("right",e,j);break;case this.keyCodes.ARROW_LEFT:this._appFinderKeysHandler("left",e,j);break;case this.keyCodes.PAGE_UP:this._appFinderKeysHandler("up",e,j,true);break;case this.keyCodes.PAGE_DOWN:this._appFinderKeysHandler("down",e,j,true);break;case this.keyCodes.HOME:this._appFinderHomeEndButtonsHandler("home",e);break;case this.keyCodes.END:this._appFinderHomeEndButtonsHandler("end",e);break;case this.keyCodes.SPACE:this._spaceButtonHandler(e,j);break;default:return;}}},_dashboardKeydownHandler:function(e){var t=document.activeElement&&document.activeElement.tagName;if(t==="INPUT"||t==="TEXTAREA"){return;}var p=e.keyCode,i=sap.ui.getCore().getConfiguration().getRTL(),j=jQuery(document.activeElement);if(i){if(p===this.keyCodes.ARROW_RIGHT){p=this.keyCodes.ARROW_LEFT;}else if(p===this.keyCodes.ARROW_LEFT){p=this.keyCodes.ARROW_RIGHT;}}switch(p){case this.keyCodes.F2:this._renameGroup(j);break;case this.keyCodes.F7:this._groupHeaderNavigation(j);break;case this.keyCodes.DELETE:this._deleteButtonHandler(j);break;case this.keyCodes.BACKSPACE:this._deleteButtonHandler(j);break;case this.keyCodes.ARROW_UP:this._arrowsButtonsHandler("up",e,j);break;case this.keyCodes.ARROW_DOWN:this._arrowsButtonsHandler("down",e,j);break;case this.keyCodes.ARROW_RIGHT:this._arrowsButtonsHandler("right",e,j);break;case this.keyCodes.ARROW_LEFT:this._arrowsButtonsHandler("left",e,j);break;case this.keyCodes.PAGE_UP:this._goToFirstTileOfNextGroup("up",e);break;case this.keyCodes.PAGE_DOWN:this._goToFirstTileOfNextGroup("down",e);break;case this.keyCodes.HOME:this._homeEndButtonsHandler("first",e,j);break;case this.keyCodes.END:this._homeEndButtonsHandler("last",e,j);break;case this.keyCodes.SPACE:this._spaceButtonHandler(e,j);break;case this.keyCodes.ENTER:this._enterButtonHandler(j);break;default:break;}return true;},init:function(m,r){this.oModel=m;this.oRouter=r;}};var c=new C();return c;},true);
