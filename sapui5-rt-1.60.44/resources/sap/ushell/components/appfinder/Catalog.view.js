// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['sap/ui/core/HTML','sap/ushell/ui/appfinder/AppBox','sap/ushell/ui/appfinder/PinButton','sap/ushell/ui/launchpad/CatalogEntryContainer','sap/ushell/ui/launchpad/CatalogsContainer','sap/ushell/ui/launchpad/Panel','sap/ushell/ui/launchpad/Tile'],function(H,A,P,C,a,b,T){"use strict";sap.ui.jsview("sap.ushell.components.appfinder.Catalog",{oController:null,createContent:function(c){var t=this;this.oViewData=this.getViewData();this.parentComponent=this.oViewData.parentComponent;var m=this.parentComponent.getModel();this.setModel(m);this.setModel(this.oViewData.subHeaderModel,"subHeaderModel");this.oController=c;function i(L){return((L!==null)&&(L==="1x2"||L==="2x2"))||false;}function d(v){return parseInt(v,10)||0;}function g(e,q,G,r,v,w){var x;if(r){var R=sap.ushell.resources.i18n,y=$.inArray(v,G);x=R.getText(y!==-1?"removeAssociatedTileFromContextGroup":"addAssociatedTileToContextGroup",w);}else{x=G&&G.length?q:e;}return x;}var o=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,q,G,r){if(G){var v=$.inArray(r,e);return v!==-1;}else{return!!q;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,q,G,r,v,w,x){return g(e,q,G,v,w,x);}},press:[c.onTilePinButtonClick,c]});var f=new P({icon:'sap-icon://pushpin-off',selected:{parts:["associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id"],formatter:function(e,q,G,r){if(G){var v=$.inArray(r,e);return v!==-1;}else{return!!q;}}},tooltip:{parts:["i18n>EasyAccessMenu_PinButton_UnToggled_Tooltip","i18n>EasyAccessMenu_PinButton_Toggled_Tooltip","associatedGroups","associatedGroups/length","/groupContext/path","/groupContext/id","/groupContext/title"],formatter:function(e,q,G,r,v,w,x){return g(e,q,G,v,w,x);}},press:[c.onTilePinButtonClick,c]});this.oAppBoxesTemplate=new A({title:'{title}',icon:'{icon}',subtitle:'{subtitle}',url:'{url}',navigationMode:'{navigationMode}',pinButton:f,press:[c.onAppBoxPressed,c]});f.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));f.addStyleClass("sapUshellPinButton");o.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"tabindex",value:"-1",writeToDom:true}));o.addStyleClass("sapUshellPinButton");this.oTileTemplate=new T({tileViews:{path:"content",factory:function(I,e){return e.getObject();}},"long":{path:"size",formatter:i},index:{path:"id",formatter:d},tileCatalogId:"{id}",pinButton:o,press:[c.catalogTilePress,c],afterRendering:c.onTileAfterRendering});this.oCatalogSelect=new sap.m.List("catalogSelect",{visible:"{/enableCatalogSelection}",name:"Browse",rememberSelections:true,mode:"SingleSelectMaster",items:{path:"/masterCatalogs",template:new sap.m.StandardListItem({type:"Active",title:"{title}",tooltip:"{title}"})},showNoData:false,itemPress:[c._handleCatalogListItemPress,c]});this.getCatalogSelect=function(){return this.oCatalogSelect;};var h=this.oCatalogSelect.onAfterRendering;this.oCatalogSelect.addEventDelegate({onsaptabnext:function(q){try{q.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.homepage.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipforward:function(q){try{q.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.components.homepage.ComponentKeysHandler.setFocusOnCatalogTile();}catch(e){}},onsapskipback:function(q){try{q.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);var r=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(r.getVisible()){r.focus();}else{sap.ushell.components.homepage.ComponentKeysHandler.appFinderFocusMenuButtons(q);}}catch(e){}}});if(m.getProperty("/enableHelp")){this.oCatalogSelect.addStyleClass('help-id-catalogCategorySelect');}this.setCategoryFilterSelection=function(S,e){var q=t.getCatalogSelect(),r=q.getItems(),v=S,w=0;if(!v||v==""){v=sap.ushell.resources.i18n.getText('all');}r.forEach(function(L,x){if(L.getTitle()===v){w=x;q.setSelectedItem(L);}});if(r.length!=0&&e){r[w].focus();}};this.oCatalogSelect.onAfterRendering=function(){var S=t.oController.categoryFilter||sap.ushell.resources.i18n.getText('all');t.setCategoryFilterSelection(S);if(h){h.apply(this,arguments);}if(!this.getSelectedItem()){this.setSelectedItem(this.getItems()[0]);}setTimeout(function(){var e=jQuery("#catalog-button, #userMenu-button, #sapMenu-button").filter("[tabindex=0]");if(e.length){e.eq(0).focus();}else{jQuery("#catalog-button").focus();}},0);};var j=this.oCatalogSelect._onAfterRenderingPopover;this.oCatalogSelect._onAfterRenderingPopover=function(){if(this._oPopover){this._oPopover.setFollowOf(false);}if(j){j.apply(this,arguments);}};var E=sap.ui.getCore().getEventBus(),D,u=function(){this.splitApp.toMaster('catalogSelect','show');if(!sap.ui.Device.system.phone){D=this._calculateDetailPageId();if(D!=this.splitApp.getCurrentDetailPage().getId()){this.splitApp.toDetail(D);}}};E.subscribe("launchpad","catalogContentLoaded",function(){setTimeout(u.bind(this),500);},this);E.subscribe("launchpad","afterCatalogSegment",u,this);var k=new H("sapUshellCatalogAccessibilityTileText",{content:"<div style='height: 0px; width: 0px; overflow: hidden; float: left;'>"+sap.ushell.resources.i18n.getText("tile")+"</div>"});var l=new C({header:'{title}',customTilesContainer:{path:"customTiles",template:this.oTileTemplate,templateShareable:true},appBoxesContainer:{path:"appBoxes",template:this.oAppBoxesTemplate,templateShareable:true}});this.oMessagePage=new sap.m.MessagePage({visible:true,showHeader:false,text:sap.ushell.resources.i18n.getText('EasyAccessMenu_NoAppsToDisplayMessagePage_Text'),description:''});this.oCatalogsContainer=new a("catalogTiles",{categoryFilter:"{/categoryFilter}",catalogs:{path:"/catalogs",templateShareable:true,template:l},busy:true});this.oCatalogsContainer.addStyleClass('sapUshellCatalogTileContainer');this.oCatalogsContainer.addEventDelegate({onsaptabprevious:function(e){var q=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader"),r=jQuery(e.srcControl.getDomRef());if(q.getVisible()&&!q.getPressed()&&!r.hasClass("sapUshellPinButton")){e.preventDefault();var v=sap.ui.getCore().byId("appFinderSearch");v.focus();}},onsapskipback:function(e){var q=sap.ui.getCore().byId("openCloseButtonAppFinderSubheader");if(q.getVisible()&&!q.getPressed()){e.preventDefault();q.focus();}}});this.oCatalogsContainer.onAfterRendering=function(){var e=sap.ui.getCore().byId('catalogTilesDetailedPage');if(!this.getBusy()){e.setBusy(false);jQuery.sap.measure.end("FLP:AppFinderLoadingStartToEnd");}else{e.setBusy(true);}jQuery("#catalogTilesDetailedPage-cont").scroll(function(){var q=sap.ui.getCore().byId('catalogTilesDetailedPage'),r=q.getScrollDelegate(),v=r.getScrollTop(),w=r.getMaxScrollTop();if(w-v<=30+3*t.oController.PagingManager.getTileHeight()&&t.oController.bIsInProcess===false){t.oController.bIsInProcess=true;t.oController.allocateNextPage();setTimeout(function(){t.oController.bIsInProcess=false;},0);}});};this.wrapCatalogsContainerInDetailPage=function(e,I){var q=new sap.m.Page(I,{showHeader:false,showFooter:false,showNavButton:false,content:[new b({translucent:true,content:e}).addStyleClass("sapUshellCatalogPage")]});return q;},this.getCatalogContainer=function(){return this.oCatalogsContainer;};new sap.m.Page({showHeader:false,showFooter:false,showNavButton:false,content:[new b({translucent:true,content:[k,this.getCatalogContainer()]}).addStyleClass("sapUshellCatalogPage")]});var n=this.wrapCatalogsContainerInDetailPage([k,this.getCatalogContainer()],'catalogTilesDetailedPage'),p=new sap.m.Page('catalogMessagePage',{showHeader:false,showFooter:false,showNavButton:false,content:[this.oMessagePage]});var s=new sap.m.BusyIndicator('catalogSelectBusyIndicator',{size:"1rem"});this.splitApp=new sap.m.SplitApp('catalogViewMasterDetail',{masterPages:[s,this.oCatalogSelect],detailPages:[n,p]});document.toSearch=function(){this.splitApp.toDetail('catalogTilesSearchPage');}.bind(this);document.toDetail=function(){this.splitApp.toDetail('catalogTilesDetailedPage');}.bind(this);document.toMessage=function(){this.splitApp.toDetail('catalogMessagePage');}.bind(this);return this.splitApp;},_calculateDetailPageId:function(){var s=this.getModel('subHeaderModel');var S=s.getProperty('/search/searchMode');var t=s.getProperty('/tag/tagMode');var n=this.getModel().getProperty("/catalogsNoDataText")?true:false;var i;if(S||t){i=this.getController().bSearchResults?'catalogTilesDetailedPage':'catalogMessagePage';}else if(n){i="catalogMessagePage";}else{i="catalogTilesDetailedPage";}return i;},getControllerName:function(){return"sap.ushell.components.appfinder.Catalog";}});},false);
