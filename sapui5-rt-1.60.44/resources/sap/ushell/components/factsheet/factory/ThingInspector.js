// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["jquery.sap.global","sap/suite/ui/commons/UnifiedThingInspector","sap/ushell/components/factsheet/annotation/Mapping","sap/ui/vbm/library","sap/ui/core/format/NumberFormat","sap/viz/ui5/data/FlattenedDataset"],function($,U,M,v,N,F){"use strict";var t,c={},A=[],L={},d,f,g,h,q,r,s,u,w,x,y,z,B={},C,D,E,G,H,I,J,K,O,P,Q,R,S,T,V,W,X,Y,Z,_,a1,b1,c1="displayFactSheet";V=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();if(sap.ui.getCore().getConfiguration().getLanguage()==="ZH"){V=new sap.ui.core.Locale("zh_CN");}function d1(a){return a<0?true:false;}function e1(a){var b=Number(a).toFixed(0);if(d1(a)){b=Number(b)*-1;}return b;}function f1(a,b){var e,o,i,n;if(!a){return"";}o=new RegExp(N.oDefaultFloatFormat.groupingSeparator,"g");if(b>=0){b=parseInt(b,10);n=N.getFloatInstance({minFractionDigits:b,maxFractionDigits:b},V);}else{n=N.getFloatInstance({minFractionDigits:0,maxFractionDigits:99},V);}e=n.format(a);i=e.replace(/[\D]/g,"");if(i&&i.length>6){a=a.replace(o,"");if(e1(a)<1000){return N.getIntegerInstance().format(a);}n=N.getFloatInstance({minFractionDigits:1,maxFractionDigits:1,style:"short"},V);return n.format(a);}else{return e;}}function g1(){var p,a,o="",b,m,e,k,i,j,n,l,h1;b=this.getElementBinding().sPath.split("/")[1];m=this.getModel();e=this.mBindingInfos.value.parameters;k=this.mBindingInfos.value.parts;for(i=0;i<e.length;i+=1){o=o+e[i].string;}for(j=0;j<k.length;j+=1){p=k[j].path;l="{"+p+"}";a=m.oData[b][p];o=o.replace(l,a);}n=C(o);if($.isNumeric(n)){h1=this.mBindingInfos.value.parts.filter(function(i1){return(i1.path===p);});n=f1(n,h1[0].type.oFormatOptions.maxFractionDigits);this.setDoubleFontSize(true);}this.setValue(n);this.getElementBinding().detachChange(g1);}_=function(){var a="";if(t.getName()&&t.getDescription()){a=t.getName()+", "+t.getDescription();}else if(t.getName()&&!t.getDescription()){a=t.getName();}else if(!t.getName()&&t.getDescription()){a=t.getDescription();}return a;};h=function(a){var b,e,i;b=a.slice(1).split("/");e="/";for(i=0;i<b.length;i+=1){if((b[i].indexOf("(")>0)&&(b[i].indexOf("sid(")<0)){break;}else{e+=b[i]+"/";}}return e;};q=function(a,m){var e,b,i,n;b=a.slice(m.sServiceUrl.length+1);if(b.indexOf("/")>=0){i=b.split("/");n=i[i.length];e=i[i.length-1];if(e.indexOf("(")>=0){e=e.slice(e.indexOf("("));}e=this.getNavEntitySet(e,n,m.getMetadata());}else{if(b.indexOf("(")>=0){e=b.slice(0,b.indexOf("("));}else{if(b.indexOf("?")>=0){e=b.slice(0,b.indexOf("?"));}else{e=b;}}}return e;};G=function(a,m){var e,k="",o,b;e=a.slice(m.sServiceUrl.length+1);if(e.indexOf("(")>=0){k=e.slice(e.indexOf("(")+1,e.indexOf(")"));if(k.indexOf("=")<=0){o=m.getServiceMetadata();b=s(q(a,m),o);k=H(b,o)+"="+k;}}return k;};H=function(e,m){var i,a,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.namespace===e.slice(0,e.lastIndexOf("."))){for(j=0;j<a.entityType.length;j+=1){if(a.entityType[j].name===e.slice(e.lastIndexOf(".")+1)){return a.entityType[j].key.propertyRef[0].name;}}}}};r=function(e,m){var i,a,b,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){b=a.entityContainer[0].entitySet;for(j=b.length-1;j>=0;j-=1){if(b[j].entityType===e){return b[j].name;}}}}};s=function(e,m,b){var i,a,k,j,l;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){k=a.entityContainer[0].entitySet;for(j=k.length-1;j>=0;j-=1){if(k[j].name===e){if(b){l=k[j].entityType.slice(a.namespace.length+1);}else{l=k[j].entityType;}return l;}}}}};u=function(e,n,m){var a,i,b,l,k,j,o;a=e.split(".");for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];l=a[0];if(a.length>2){for(k=1;k<a.length-1;k+=1){l+="."+a[k];}}if(b.namespace===l){for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===a[a.length-1]){if(b.entityType[j].navigationProperty){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){o=b.entityType[j].navigationProperty[k];return{name:o.relationship,toRole:o.toRole};}}}}}}}};w=function(e,n,m){var a,b,o,i,l,j,p,k;a=s(e,m);if(n.charAt(0)==="@"){if(c.termDefinitions&&c.termDefinitions[n]){b=c.termDefinitions[n];if(b.indexOf("Collection")>=0){b=b.slice(b.indexOf("(")+1,b.indexOf(")"));}return r(b,m);}}else{o=u(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){l=m.dataServices.schema[i];if(l.entityContainer&&l.entityContainer[0].associationSet){for(j=l.entityContainer[0].associationSet.length-1;j>=0;j-=1){p=l.entityContainer[0].associationSet[j];if(p.association===o.name){for(k=0;k<p.end.length;k+=1){if(p.end[k].role===o.toRole){return p.end[k].entitySet;}}}}}}}}};x=function(e,n,m){var a,o,i,b,j,l,k,p,h1;a=s(e,m);p=a.split(".")[a.split(".").length-1];o=u(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];for(j=0;j<b.entityType.length&&!h1;j+=1){if(b.entityType[j].name===p){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){h1=b.entityType[j].navigationProperty[k].toRole;break;}}}}for(j=b.association.length-1;j>=0;j-=1){l=b.association[j];if(b.namespace+"."+l.name===o.name){for(k=0;k<l.end.length;k+=1){if(l.end[k].role===h1){return l.end[k].multiplicity;}}}}}}else{jQuery.sap.log.error("\""+n+"\" wasn't found in the metadata document. Check whether the corresponding search connector is active.");return 0;}};y=function(e,m){var o,a,b,i;o={};if(c.expand){if(c.expand[s(e,m)]){a=c.expand[s(e,m)];b=[];for(i in a){if(a.hasOwnProperty(i)){b.push(a[i]);}}o.expand=b.join(", ");}}return o;};b1=function(a,e,o){var m,b,j,k,l,n;for(m=o.dataServices.schema.length-1;m>=0;m-=1){b=o.dataServices.schema[m];for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===e.split(".")[e.split(".").length-1]){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===a){for(l=0;l<b.association.length;l+=1){for(n=b.association[l].end.length-1;n>=0;n-=1){if(b.association[l].end[n].role===b.entityType[j].navigationProperty[k].toRole){return(b.association[l].end[n].type);}}}}}}}}};z=function(p,o){var b={},j;b.parts=[];b.parameters=[];for(j=p.length-1;j>=0;j-=1){if(p[j].Type==="Path"){if(p[j].EdmType){switch(p[j].EdmType){case"Edm.DateTimeOffset":case"Edm.DateTime":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.DateTime({"UTC":true})});break;case"Edm.Time":b.parts.push({path:p[j].Value+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"},UTC:true})});break;case"Edm.Date":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Date({"UTC":true})});break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Float()});break;case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Integer()});break;default:b.parts.push({path:p[j].Value});break;}}else{b.parts.push({path:p[j].Value});}}else if(p[j].Type==="String"){b.parameters.unshift({string:p[j].Value});}}b.formatter=function(){var a="",e,k,l,i,m="",n=false,h1=0,i1=0;if(arguments&&arguments.length>=1){e=arguments.length-1;l="";i=0;if(p&&p[0]&&(p[0].Type==="String")&&(p[0].Value.substr(0,1)==="#")){n=true;}for(k=0;k<p.length;k+=1){if(p[k].Type==="Path"){l=arguments[e];if(!l||(l.length===0)){if(a.length>i){if(a.indexOf("(")>i){a=a.substr(0,i);}else{a=a.substr(0,i);l=a;}}}else{if(n){l=encodeURIComponent(l);}a+=l;h1+=1;}e-=1;i=a.length;}else{i=a.length;m=p[k].Value;if(m.indexOf("(")!==-1){i1+=1;}if((l&&l.length>0)||(m.indexOf("(")!==-1)||(m&&(m.substr(0,1)==="#"))){a+=p[k].Value;}else{m="";}}}if(o){a=o(a);}a=a.trim();if((h1===1)&&(i1>0)&&(a.substr(0,1)==="(")&&(a.substr(-1)===")")){a=a.substr(1,a.length-2);}return a.trim();}};return b;};P=function(o,p){var k;for(k in o){if(o.hasOwnProperty(k)){if(k==="__metadata"){continue;}else if(k===p){return o[k];}else if(typeof o[k]==="object"){return P(o[k],p);}}}};C=function(a){var l,n,b,e={},i;l=a.lastIndexOf("/");n=a.slice(0,l);b=a.slice(l+1);if(!B[a]){e=new sap.ui.model.json.JSONModel();e.loadData(n,null,false);B[a]=e.getData();}else{e=B[a];}if(B[a]&&B[a].d){if(!B[a].d[b]){i=P(B[a].d,b);}else{i=B[a].d[b];}}return i;};D=function(o,e,m,a){var b,i,n,j,k,l,p,h1;b=new sap.ui.core.Control();i=Q(o.Value,o.EdmType,e);if(o.Value&&o.Value["com.sap.vocabularies.UI.v1.IsImageURL"]){b=new sap.m.Image({height:"50px"});if(i.BindingInfo){b.bindProperty("src",i.BindingInfo);}else{b.setProperty("src",i.String);}}else{if(o.UrlRef||o.Url||(o.Target&&o.Target.Path)){b=new sap.m.Link({wrapping:true});}else{b=new sap.m.Text();if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){b.setTextAlign(sap.ui.core.TextAlign.End);}}b.addStyleClass("sapFactsheetUtiDataField");if(i.BindingInfo){b.bindProperty("text",i.BindingInfo);}else{b.setProperty("text",i.String);}}if((o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithNavigation")&&m){n=o.Target.Path;if(c[e][n.slice(1)]){if(n.charAt(0)==="@"){if(n.indexOf("/")<0){j=c[e][n.slice(1)].UrlRef;}else{j=c[e][n.slice(1,n.indexOf("/"))].UrlRef;}b.bindProperty("href",I(j));}}b.attachPress(function(i1){return false;});}if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url.String){b.setHref(o.Url.String);}else{b.bindProperty("href",I(o.Url));k=new sap.m.Text({wrapping:true});if(i.BindingInfo){k.bindProperty("text",jQuery.extend({},i.BindingInfo));}else{k.setProperty("text",i.String);}b.setVisible(false);l=new sap.ui.layout.VerticalLayout();l.addContent(b);l.addContent(k);if(!A[A.indexOf(a)].Links){A[A.indexOf(a)].Links=[];}if(o.Url.Apply){p=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("-"));h1=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("?"));}A[A.indexOf(a)].Links.push({sSemanticObject:p,sIntend:h1,oVL:l});}}if(l){return l;}else{return b;}};E=function(o,l,p,b){var a,e="",i="",m,j,k,n;a=new sap.m.Label(l);a.addStyleClass("sapFactsheetUtiLabel");if(b){e=":";}if(o.Label){if(o.Label.String){a.setText(o.Label.String.trim()+e);a.setTooltip(o.Label.String.trim());}else{if(o.Label.Path){a.bindProperty("text",o.Label.Path);a.bindProperty("tooltip",o.Label.Path);}}}else{if(o.Value){if(o.Value.Path&&p){m=p[o.Value.Path];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}}else if(o.Value.Apply&&(o.Value.Apply.Name==="odata.concat")){for(k in o.Value.Apply.Parameters){if(o.Value.Apply.Parameters.hasOwnProperty(k)){n=o.Value.Apply.Parameters[k];if(n.Type==="Path"){m=p[n.Value];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}break;}}}}a.setText(i+e);a.setTooltip(i);}}return a;};Q=function(o,e,a){var b={},p,k,l=[],j,m,n,h1=[],i1,j1,i,k1,l1,m1,n1,o1=[],p1;p1=function(a,q1,r1){var p,s1={};p=c.propertyAnnotations[a];if(p&&p[q1]&&p[q1][r1]){if(p[q1][r1].Path){s1.Type="Path";s1.Value=p[q1][r1].Path;}else{s1.Type="String";s1.Value=p[q1][r1].String;}}return s1;};if(!o){return false;}if(o.Apply){if(o.Apply.Name==="odata.concat"){if(a&&c.propertyAnnotations&&c.propertyAnnotations[a]){k=o.Apply.Parameters;for(j=0;j<k.length;j+=1){l.push(k[j]);if(k[j].Type==="Path"){p=p1(a,k[j].Value,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}p=p1(a,k[j].Value,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}}}b.BindingInfo=z(l);}else{b.BindingInfo=z(o.Apply.Parameters);}}}else{if(o.Path){if(o.Path.charAt(0)==="@"){m=c[a][o.Path.slice(1,o.Path.indexOf("/"))].UrlRef;n=o.Path.slice(o.Path.indexOf("/")+1);if(m&&m.Apply){i1=m.Apply.Parameters;switch(m.Apply.Name){case"odata.concat":h1=i1;h1.push({Type:"String",Value:"/"+n});break;case"odata.fillUriTemplate":j1=i1[0].Value.split("{");for(i in j1){if(j1.hasOwnProperty(i)){if(j1[i].indexOf("}")<0){h1.push({Type:"String",Value:j1[i]});}else{k1=j1[i].split("}");for(j=1;j<i1.length;j+=1){if(i1[j].Name===k1[0]){l1=i1[j].Value;if(l1.Path){h1.push({Type:"Path",Value:l1.Path});}else{if(l1.Apply&&l1.Apply.Name&&(l1.Apply.Name.toLowerCase()==="odata.uriencode")){m1=l1.Apply.Parameters[0];h1.push({Type:m1.Type,Value:encodeURIComponent(m1.Value)});h1.push({Type:"String",Value:"{"+encodeURIComponent(m1.Value)+"}"});}}}}h1.push({Type:"String",Value:k1[1]});}}}h1.push({Type:"String",Value:"/"+n});b.fnChange=g1;break;default:break;}b.BindingInfo=z(h1,C);}else{if(m&&m.Path){h1.push({Type:"Path",Value:m.Path},{Type:"String",Value:"/"+n});b.BindingInfo=z(h1,C);}else{if(m&&m.String){b.String=C(m.String+"/"+n);}}}}else{b.BindingInfo={};switch(e){case"Edm.DateTimeOffset":case"Edm.DateTime":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.DateTime({"UTC":true})};break;case"Edm.Time":b.BindingInfo={path:o.Path+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"},UTC:true})};break;case"Edm.Date":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.Date({"UTC":true})};break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":if((e==="Edm.Decimal")||(e==="Edm.Double")||(e==="Edm.Single")){n1=new sap.ui.model.type.Float();}else if((e==="Edm.Int16")||(e==="Edm.Int32")||(e==="Edm.Int64")){n1=new sap.ui.model.type.Integer();}if(c.propertyAnnotations){o1.push({Type:"Path",Value:o.Path,EdmType:e},{Type:"String",Value:" "});p=p1(a,o.Path,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){o1.push({Type:p.Type,Value:p.Value});}p=p1(a,o.Path,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){o1.push({Type:p.Type,Value:p.Value});}b.BindingInfo=z(o1);}else{b.BindingInfo={path:o.Path,type:n1};}break;default:b.BindingInfo={path:o.Path};break;}}}else{if(o.String){b.String=o.String;}}}return b;};I=function(o){var a=[],p,b,j,e,i={},k,l,m;if(o&&o.Apply){p=o.Apply.Parameters;switch(o.Apply.Name){case"odata.fillUriTemplate":p[0].Value=p[0].Value.trim();b=p[0].Value.split("{");for(j=0;j<b.length;j+=1){if(b[j].indexOf("}")<0){a.push({"Value":b[j],"Type":"String"});}else{e=b[j].split("}");i={};i.Value=e[0];i.Type="Path";for(j=1;j<p.length;j+=1){if(p[j].Name===i.Value){k=p[j].Value;if(k.Path){i.Value=k.Path;}else{if(k.Apply&&k.Apply.Name&&k.Apply.Name.toLowerCase()==="odata.uriencode"){i.Value=k.Apply.Parameters[0].Value;}}break;}}a.push(i);a.push({"Value":e[1],"Type":"String"});}}l=sap.ushell.Container.getService("NavTargetResolution").getCurrentResolution();if(l&&l.url){m=jQuery.sap.getUriParameters(l.url).get("sap-system");if(m){a.push({Type:"String",Value:"&sap-system="+m});}}break;default:break;}}return z(a);};J=function(o){var a=sap.ui.core.TextAlign.Begin;if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a=sap.ui.core.TextAlign.End;}return a;};R=function(m,e,a,o,b,k){var l,p,j=0,n=0,h1=0,i1=0,j1,i,k1,l1,m1;if(!b){b=m.getServiceMetadata();}if(!a){a=[];}l=s(e,b);m1=new sap.ui.layout.form.SimpleForm({labelMinWidth:150,maxContainerCols:2});p=(c.propertyExtensions)?c.propertyExtensions[l]:[];if(o&&o.High){n=o.High;}if(o&&o.Medium){h1=o.Medium;}if(o&&o.Low){i1=o.Low;}for(i=0;i<a.length;i+=1){j1=a1(a[i]);if(o&&(j1==="High")){if(n){n-=1;}else{continue;}}else if(o&&(j1==="Medium")){if(h1){h1-=1;}else{continue;}}else if(o&&(j1==="Low")){if(i1){i1-=1;}else{continue;}}if(o&&o.Total&&(j>=o.Total)){break;}j+=1;k1=new sap.ui.core.Control().setModel(m);l1=E(a[i],{textAlign:sap.ui.core.TextAlign.End},p,false);l1.addStyleClass("sapFactsheetUtiFormPadding");k1=D(a[i],l,b,k);k1.addStyleClass("sapFactsheetUtiFormPadding");if(k1.setTextAlign){k1.setTextAlign(sap.ui.core.TextAlign.Begin);}m1.addContent(l1);m1.addContent(k1);}m1.addStyleClass("sapFactsheetUtiFormLayout");return m1;};S=function(m,e,o,b,a){var j,k="",l,n,p,h1,i1,j1,k1,l1,m1,n1,o1=[],i,p1,q1,r1;j=m.getServiceMetadata();switch(o.RecordType){case"com.sap.vocabularies.UI.v1.ReferenceFacet":l=new sap.suite.ui.commons.UnifiedThingGroup();if(o.Label&&o.Label.String){l.setTitle(o.Label.String);}n=o.Target.AnnotationPath;p=n.substring(n.lastIndexOf("@")+1);n=n.substring(0,n.lastIndexOf("@")-1);if(n){k=x(e,n,j);}h1=p.split("#");switch(h1[0]){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.Badge":case"com.sap.vocabularies.UI.v1.Identification":if(n){i1=w(e,n,j);p1=s(i1,j);}else{p1=s(e,j);}if(h1[0]==="com.sap.vocabularies.UI.v1.Chart"){p="com.sap.vocabularies.UI.v1.LineItem";}q1=c[p1][p];if(c.propertyExtensions){r1=c.propertyExtensions[p1];}if(k==="*"&&h1[0]!=="com.sap.vocabularies.UI.v1.Identification"){j1=T(m,q1,p1,j,b+"/"+n,o,r1,a);l.setContent(j1);}if(h1[0]==="com.sap.vocabularies.UI.v1.Identification"){k1=c[p1]["com.sap.vocabularies.UI.v1.Identification"];l1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);if(n){l1.addContent(R(m,i1,k1,null,null,a)).addStyleClass("sapFactsheetUtiPanel");l1.bindElement(b+"/"+n);}else{l1.addContent(R(m,e,k1,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}l.setContent(l1);}break;case"com.sap.vocabularies.UI.v1.StatusInfo":if(n){i1=w(e,n,j);m1=c[s(i1,j)]["com.sap.vocabularies.UI.v1.StatusInfo"];l.setContent(R(m,i1,m1,null,null,a).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{m1=c[s(e,j)]["com.sap.vocabularies.UI.v1.StatusInfo"];l.setContent(R(m,e,m1,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}break;case"com.sap.vocabularies.UI.v1.FieldGroup":n1=c[s(e,j)][p];if(n1){if(!l.getTitle()||(l.getTitle()==="")){if(n1.Label){if(n1.Label.String){l.setTitle(n1.Label.String);}else{if(n1.Label.Path){l.bindProperty("title",n1.Label.Path);}}}}if(n){i1=w(e,n,j);l.setContent(R(m,i1,n1.Data,null,null,a).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{l.setContent(R(m,e,n1.Data,null,null,a).addStyleClass("sapFactsheetUtiPanel"));}}break;default:break;}return l;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":l=new sap.ui.ux3.ThingGroup({title:o.Label.String});l.setContent(K(o));return l;case"com.sap.vocabularies.UI.v1.CollectionFacet":for(i=0;i<o.Facets.length;i+=1){o1.push(S(m,e,o.Facets[i],b,a));}return o1;default:break;}};K=function(o){var i,a,b;switch(o.UrlContentType.String){case"image/png":case"image/jpeg":case"image/gif":i=new sap.m.Image({width:"100%"});if(o.Url.String){i.setSrc(o.Url.String);}return i;default:a=new sap.ui.core.HTML();if(o.Url.String){a.setContent("<iframe src = '"+o.Url.String+"' width='100%' height='250px' frameborder='0'></iframe>");}else{if(o.Url.Path){a.bindProperty("content",{path:o.Url.Path,formatter:function(e){b="<iframe src = '"+o.Url.Path+"' width='100%' height='250px' frameborder='0'></iframe>";return b;}});}}return a;}};T=function(m,a,e,o,b,l,n,h1){var i1,j1,k1,l1,m1,i,k,n1=[],o1=[],p1=[],q1=[],r1,s1,t1,u1,v1,w1,x1,y1=[],z1,A1,B1,C1=[],D1,E1,F1,G1,H1,I1,J1,K1,L1=false,M1,N1;K1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");if(!o){o=m.getServiceMetadata();}i1=(c.propertyExtensions)?c.propertyExtensions[e]:[];j1=6;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){j1=5;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){j1=4;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){j1=3;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){j1=2;}k1=0;l1=0;for(i=0;i<a.length;i+=1){m1=a1(a[i]);if(m1==="High"){k1+=1;}}if(j1>k1){l1=j1-k1;}else if(j1<k1){k1=j1;}o1.push(new sap.m.Column({visible:false}));n1.push(new sap.m.Text().bindText("__metadata/uri"));for(i=0;i<a.length;i+=1){N1="";t1=new sap.ui.core.Control();m1=a1(a[i]);t1=D(a[i],e,o,h1);r1=E(a[i],null,i1);if(a[i].Value.Path){B1=a[i].Value.Path;if(n&&n[B1]&&n[B1]["http://www.sap.com/Protocols/SAPData"]&&n[B1]["http://www.sap.com/Protocols/SAPData"].sortable){r1.data("IsSortable",n[B1]["http://www.sap.com/Protocols/SAPData"].sortable);if(n[B1]["http://www.sap.com/Protocols/SAPData"].sortable==="true"){L1=true;}}else{r1.data("IsSortable","true");L1=true;}if(n&&n[B1]&&n[B1]["http://www.sap.com/Protocols/SAPData"]&&n[B1]["http://www.sap.com/Protocols/SAPData"].filterable){r1.data("IsFilterable",n[B1]["http://www.sap.com/Protocols/SAPData"].filterable);if(n[B1]["http://www.sap.com/Protocols/SAPData"].filterable==="true"){L1=true;}}else{r1.data("IsFilterable","true");L1=true;}}else{M1=true;for(k=0;k<a[i].Value.Apply.Parameters.length;k+=1){if(a[i].Value.Apply.Parameters[k].Type==="Path"){B1=a[i].Value.Apply.Parameters[k].Value;if(n[B1]&&n[B1]["http://www.sap.com/Protocols/SAPData"]&&n[B1]["http://www.sap.com/Protocols/SAPData"].sortable){if(n[B1]["http://www.sap.com/Protocols/SAPData"].sortable==="false"){M1=false;N1="";break;}}if(N1){N1+=";";}N1+=B1;}}B1=N1;if(M1===false){r1.data("IsSortable","false");}else{r1.data("IsSortable","true");L1=true;}r1.data("IsFilterable","false");}if(a[i].EdmType){r1.data("EdmType",a[i].EdmType);}r1.data("ColumnName",B1);p1.push(r1);q1.push(t1);if(m1==="High"){if(k1>0){s1=true;k1-=1;}else{s1=false;}}else if(m1==="Medium"){if(l1>0){s1=true;l1-=1;}else{s1=false;}}else{s1=false;}o1.push(new sap.m.Column({header:r1,hAlign:J(a[i]),visible:s1}));n1.push(t1);}u1=new sap.m.ColumnListItem({type:sap.m.ListType.Navigation,unread:false,cells:n1});if(l){v1=l.Label.String;}u1.attachPress({aColumns:a,aLabels:p1,aControls:q1,sTitle:v1},function(j,p){var O1,P1,r1,i,Q1,R1,S1;O1=j.getSource().getCells()[0].getText().substr(j.getSource().getCells()[0].getText().lastIndexOf("/"));P1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column()]});P1.addStyleClass("sapFactsheetUtiPanel");P1.addStyleClass("sapFactsheetUtiTilePadding");P1.addStyleClass("sapFactsheetUtiTableNoTopBorder");P1.bindElement(O1);for(i=0;i<a.length;i+=1){r1=p1[i].clone();r1.setText(r1.getText()+":");S1=q1[i].clone();r1.setLabelFor(S1);P1.addItem(new sap.m.ColumnListItem({cells:[r1,S1]}));}Q1=new sap.suite.ui.commons.UnifiedThingGroup({content:P1,title:v1,description:_()});R1=new sap.m.Page({title:t.getTitle(),showNavButton:true,content:[Q1]});t.navigateToPage(R1,true);t.attachAfterNavigate(P1,function(j){if(j.getParameters().getParameters().toId.indexOf("__page")>=0){var T1;T1=P1.getItems();if(T1.length>0&&A.indexOf(h1)>=0){A[A.indexOf(h1)].bLoaded=true;A[A.indexOf(h1)].bProcessed=false;A[A.indexOf(h1)].bIsTable=true;A[A.indexOf(h1)].oTableItems=T1;d(A.indexOf(h1));}}});});w1=new sap.m.Table({growing:true,columns:o1});w1.setModel(m);w1.bindItems({path:b,template:u1});E1=new sap.m.VBox({items:[new sap.m.Input({placeholder:K1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,O1,P1,Q1,i;p=j.getSource().getParent().getParent().getId();O1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));P1=O1.getFilterItems();for(i=0;i<P1.length;i+=1){if(P1[i]instanceof sap.m.ViewSettingsCustomItem&&P1[i].getKey()===this.oParent.data("ColumnName")){Q1=P1[i];break;}}if(Q1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){Q1.setSelected(false);Q1.setFilterCount(0);}else{Q1.setSelected(true);Q1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});F1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_GREATER_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_EQUALS")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_LESS_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.Input({placeholder:K1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,O1,P1,Q1,i;p=j.getSource().getParent().getParent().getId();O1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));P1=O1.getFilterItems();for(i=0;i<P1.length;i+=1){if((P1[i]instanceof sap.m.ViewSettingsCustomItem)&&(P1[i].getKey()===this.oParent.data("ColumnName"))){Q1=P1[i];break;}}if(Q1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){Q1.setSelected(false);Q1.setFilterCount(0);}else{Q1.setSelected(true);Q1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_AFTER")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_AT")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:K1.getText("USHELL_FACTSHEET_BEFORE")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.DateTimeInput({type:sap.m.DateTimeInputType.Date,valueFormat:new sap.ui.model.type.DateTime({pattern:"yyyy/MM/dd HH:mm:ss UTC+00:00"}).getOutputPattern(),placeholder:K1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,O1,P1,Q1,i;p=j.getSource().getParent().getParent().getId();O1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));P1=O1.getFilterItems();for(i=0;i<P1.length;i+=1){if((P1[i]instanceof sap.m.ViewSettingsCustomItem)&&(P1[i].getKey()===this.oParent.data("ColumnName"))){Q1=P1[i];break;}}if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){Q1.setSelected(false);Q1.setFilterCount(0);}else{Q1.setSelected(true);Q1.setFilterCount(1);}}}).addStyleClass("sapFactsheetUtiFilterInput")]});G1=function(t1){var j=[],i,p,O1=t1.getItems(),P1;if(O1[0].getParent().data("EdmType")==="Edm.String"&&O1[0].getValue()){j.push(new sap.ui.model.Filter(O1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.Contains,O1[0].getValue()));}else if(O1[0].getParent().data("EdmType")==="Edm.Decimal"&&O1[1].getValue()){for(i=0;i<O1[0].getItems().length;i+=1){if(O1[0].getItems()[i].getSelected()===true){p=O1[0].getItems()[i].data("FilterOperator");break;}}P1=O1[1].getValue();for(i=P1.length-1;i>0;i-=1){if(P1[i]===","){P1=P1.replace(P1[i],".");break;}}j.push(new sap.ui.model.Filter(O1[1].getParent().data("ColumnName"),p,P1));}else if(O1[0].getParent().data("EdmType")==="Edm.Date"&&O1[1].getValue()){for(i=0;i<O1[0].getItems().length;i+=1){if(O1[0].getItems()[i].getSelected()===true){p=O1[0].getItems()[i].data("FilterOperator");break;}}j.push(new sap.ui.model.Filter(O1[1].getParent().data("ColumnName"),p,O1[1].getValue()));}else{j.push(new sap.ui.model.Filter(O1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.EQ,O1[0].getValue()));}return j;};H1=function(p){var O1=p.getSource(),P1=O1.getFilterItems(),Q1,i,j;for(i=0;i<P1.length;i+=1){if(P1[i]&&P1[i]instanceof sap.m.ViewSettingsCustomItem){P1[i].setSelected(false);P1[i].setFilterCount(0);Q1=P1[i].getCustomControl().getItems();for(j=0;j<Q1.length;j+=1){if((Q1[j]instanceof sap.m.Input)||(Q1[j]instanceof sap.m.DateTimeInput)){Q1[j].setValue("");}if((Q1[j]instanceof sap.m.List)&&(Q1[j].getSelectedItem()!==null)){Q1[j].removeSelections();}}}}};I1=H1;for(i=0;i<o1.length;i+=1){if(o1[i+1]){r1=p1[i].clone();if(r1.getText()&&(r1.data("IsSortable")==="true")&&o1[i+1].getVisible()){z1=new sap.m.ViewSettingsItem({text:r1.getText(),key:r1.data("ColumnName")});if(i===0){z1.setSelected(true);}z1.Sort=r1.Sort;y1.push(z1);}if(r1.getText()&&(r1.data("IsFilterable")==="true")){if(r1.data("EdmType")==="Edm.String"){J1=E1.clone().data("ColumnName",r1.data("ColumnName")).data("EdmType",r1.data("EdmType"));}else if(r1.data("EdmType")==="Edm.Decimal"){J1=F1.clone().data("ColumnName",r1.data("ColumnName")).data("EdmType",r1.data("EdmType"));}if((r1.data("EdmType")==="Edm.String")||(r1.data("EdmType")==="Edm.Decimal")){D1=new sap.m.ViewSettingsCustomItem({key:r1.data("ColumnName"),text:r1.getText(),customControl:J1,customData:new sap.ui.core.CustomData({key:"callback",value:G1})});C1.push(D1);}}}}A1=new sap.m.ViewSettingsDialog({sortItems:y1,filterItems:C1,cancel:I1,resetFilters:H1,confirm:function(j){var O1,P1,Q1=[],R1,S1=[],T1,U1=[],V1=[],p,i,W1;O1=j.getParameters();P1=w1.getBinding("items");if(O1.sortItem){R1=O1.sortItem.getKey();T1=O1.sortDescending;if(R1.indexOf(";")>0){S1=R1.split(";");for(i=0;i<S1.length;i+=1){Q1.push(new sap.ui.model.Sorter(S1[i],T1));}}else if(R1){Q1.push(new sap.ui.model.Sorter(R1,T1));}P1.sort(Q1);}p=O1;for(i=0;i<p.filterItems.length;i+=1){if(p.filterItems[i]instanceof sap.m.ViewSettingsCustomItem){W1=p.filterItems[i].getCustomData()[0].getValue();U1=W1.apply(this,[p.filterItems[i].getCustomControl()]);if(U1){if(!Array.isArray(U1)){U1=[U1];}V1=V1.concat(U1);}}else if(p.filterItems[i]instanceof sap.m.ViewSettingsItem){U1=p.filterItems[i].getCustomData()[0].getValue();if(U1){if(!Array.isArray(U1)){U1=[U1];}V1=V1.concat(U1);}}}P1.filter(V1);}});if(L1===true&&(y1.length>0||C1.length>0)){w1.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(j){A1.open();},tooltip:sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("P13NDIALOG_VIEW_SETTINGS")})]}));}w1.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));x1=(function(h1){return function(j){var p=this.getItems();if(p.length===0){this.setNoDataText(K1.getText("FACETOVERVIEW_NO_CONTENT_TEXT"));}else{this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));}if(p.length>0&&A.indexOf(h1)>=0){A[A.indexOf(h1)].bLoaded=true;A[A.indexOf(h1)].bProcessed=false;A[A.indexOf(h1)].bIsTable=true;A[A.indexOf(h1)].oTableItems=p;}d(A.indexOf(h1));};}(h1));w1.attachUpdateFinished(x1);return w1;};W=function(a,o,b,e){var i;switch(a){case"com.sap.vocabularies.UI.v1.ChartType/Area":i=new sap.viz.ui5.Area({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bar":i=new sap.viz.ui5.Bar({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bubble":i=new sap.viz.ui5.Bubble({});break;case"com.sap.vocabularies.UI.v1.ChartType/Column":i=new sap.viz.ui5.Column({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":i=new sap.viz.ui5.StackedColumn({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":i=new sap.viz.ui5.StackedColumn100({});break;case"com.sap.vocabularies.UI.v1.ChartType/Donut":i=new sap.viz.ui5.Donut({});break;case"com.sap.vocabularies.UI.v1.ChartType/HeatMap":i=new sap.viz.ui5.Heatmap({});break;case"com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":i=new sap.viz.ui5.HorizontalArea({});break;case"com.sap.vocabularies.UI.v1.ChartType/Line":i=new sap.viz.ui5.Line({});break;case"com.sap.vocabularies.UI.v1.ChartType/Pie":i=new sap.viz.ui5.Pie({});break;case"com.sap.vocabularies.UI.v1.ChartType/Scatter":i=new sap.viz.ui5.Scatter({});break;case"com.sap.vocabularies.UI.v1.ChartType/TreeMap":i=new sap.viz.ui5.Treemap({});break;case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked100":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/Radar":case"com.sap.vocabularies.UI.v1.ChartType/Waterfall":break;}if(i){if(o&&o.String){i.setTitle(new sap.viz.ui5.types.Title({visible:true,text:o.String}));}if(b&&b.String){i.setTooltip(b.String);}i.setWidth("100%");i.setHeight("17rem");i.setDataset(e);}else{i=new sap.m.Text({});}return i;};X=function(i){var a;i=i||1;if(jQuery.device.is.phone){a=(7*i)+"rem";}else{a=(11*i-1)+"rem";}return a;};Y=function(a){var i,b=0,e=0,j=0,o;for(i=0;i<a.length;i+=1){o=a1(a[i]);if(o){switch(o){case"High":b+=1;break;case"Medium":e+=1;break;case"Low":j+=1;break;}}}return{High:b,Medium:e,Low:j};};a1=function(o){var e="";if(o.Importance){e=o.Importance.EnumMember;}else if(o["com.sap.vocabularies.UI.v1.Importance"]){e=o["com.sap.vocabularies.UI.v1.Importance"].EnumMember;}return e.substr(e.indexOf("/")+1);};Z=function(m,a,e,b){var i=false,o,j,k,l;o=new sap.suite.ui.commons.KpiTile({doubleFontSize:false});if(a.ValueFormat){j=a.ValueFormat.NumberOfFractionalDigits.Int;}if(a.Title&&a.Title.String){o.setDescription(a.Title.String);}else{if(a.Title&&a.Title.Path){o.bindProperty("description",{path:a.Title.Path});}}if(a.Value&&a.Value.String){o.setValue(a.Value.String);}else{if(a.Value&&a.Value.Path){k=Q(a.Value,a.Value.EdmType,e);if(k.fnChange){o.setModel(m);o.bindElement(b);o.getElementBinding().attachChange(k.fnChange,o);}if(k.String){if($.isNumeric(k.String)){i=true;o.setValue(f1(k.String,j));}else{o.setValue(k.String);}}else if(k.BindingInfo){l=k.BindingInfo;if(l.parts&&l.parts.length===2){o.bindProperty("valueUnit",l.parts[0]);l.parts[1].type=undefined;l.parts[1].formatter=(function(){return function(n){return f1(n,j);};}(j));o.bindProperty("value",l.parts[1]);}else if(l.parts&&l.parts.length===1){l.parts[0].type=undefined;l.parts[0].formatter=(function(){return function(n){return f1(n,j);};}(j));o.bindProperty("value",l);}else{o.bindProperty("value",l);}}}}if(a.Value.EdmType==="Edm.Decimal"||a.Value.EdmType==="Edm.Double"||a.Value.EdmType==="Edm.Single"||a.Value.EdmType==="Edm.Int16"||a.Value.EdmType==="Edm.Int32"||a.Value.EdmType==="Edm.Int64"||i===true){o.setDoubleFontSize(true);}return o;};g=function(m){var a=[],b=[],e,j,k,i,l;j=function(o){if(k(o)===false){if(Array.isArray(o)){for(i=0;i<o.length;i+=1){k(o[i]);}}else if(typeof o==="object"){for(l in o){if(o.hasOwnProperty(l)){if(o[l].constructor!==String){j(o[l]);}}}}}};k=function(o){if(o.RecordType&&o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url&&o.Url.Apply){e=o.Url.Apply.Parameters[0].Value.slice(o.Url.Apply.Parameters[0].Value.indexOf("#")+1,o.Url.Apply.Parameters[0].Value.indexOf("-"));if(a.indexOf(e)<0){a.push(e);}return true;}}else{return false;}};for(l in c){if(c.hasOwnProperty(l)){if(l.indexOf(m.dataServices.schema[0].namespace)>=0){j(c[l]);}}}for(i=0;i<a.length;i+=1){if(!L.hasOwnProperty(a[i])){b.push(a[i]);}}return b;};f=function(a){var i,o,l,b;if(a.length>0){o=new sap.ui.model.json.JSONModel();l="/sap/opu/odata/UI2/INTEROP/SemanticObjects?$expand=Links&$format=json";b="&$filter=id%20eq%20%27";for(i=0;i<a.length;i+=1){if(b.length>22){b+="%20or%20id%20eq%20%27"+a[i]+"%27";}else{b+=a[i]+"%27";}}l+=l+b;o.loadData(l);o.attachRequestCompleted(function(){var i,j,e,k=[];if(this.getData().d&&this.getData().d.results){e=this.getData().d.results;for(i=0;i<e.length;i+=1){L[e[i].id]="";k=e[i].Links.results;for(j=0;j<k.length;j+=1){L[k[j].id.slice(0,k[j].id.indexOf("~"))]="";}}}L.InteropCompleted=true;d();});}else{L.InteropCompleted=true;}};d=function(a){var i,j,k,n,b,e,l;if(L.InteropCompleted===true){for(i=0;i<A.length;i+=1){if(A[i].bLoaded&&!A[i].bProcessed&&A[i].Links){l=A[i].Links;for(j=0;j<l.length;j+=1){if(L.hasOwnProperty(l[j].sIntend)===true){if(A[i].bIsTable===true){if(A[i].oTableItems){b=A[i].oTableItems;for(k=0;k<b.length;k+=1){e=b[k].getCells();for(n=0;n<e.length;n+=1){if(e[n]instanceof sap.ui.layout.VerticalLayout&&e[n].getContent()[0].getBindingInfo("href").parts===l[j].oVL.getContent()[0].getBindingInfo("href").parts&&e[n].getContent()[1].getBindingInfo("text").parts===l[j].oVL.getContent()[1].getBindingInfo("text").parts){e[n].getContent()[0].setVisible(true);e[n].getContent()[1].setVisible(false);}}}}}else{l[j].oVL.getContent()[0].setVisible(true);l[j].oVL.getContent()[1].setVisible(false);}}else if(A[i].bIsTable===false){l[j].oVL.getContent()[1].setText(l[j].oVL.getContent()[0].getText());}A[i].bProcessed=true;}}}}if(a>=0){if(A[a].bLoaded&&!A[a].bProcessed&&A[a].Links){l=A[a].Links;for(j=0;j<l.length;j+=1){if(A[a].bIsTable===false){l[j].oVL.getContent()[1].setText(l[j].oVL.getContent()[0].getText());}}}}};O=function(e,l,t){var m,n,p,h1,i1,j1,k1,l1,i,m1={},n1,o1,p1,q1,j,r1,s1,t1,u1,v1,w1,x1,y1,z1,A1=0,B1=0,C1,D1,E1,F1,G1,H1,I1,J1=[],K1,L1,M1,N1,O1,P1,Q1,R1,S1,T1,U1,V1,W1,X1,Y1,Z1,$1,_1=0,a2,b2,c2,d2,e2,f2,g2;m=h(e);w1=l.substring(0,l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));x1=l.substring(l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));if(window.location.search.indexOf("cbn_keep_anno_case%3Dtrue")===-1){x1=x1.toLowerCase();}n=new sap.ui.model.odata.ODataModel(m,{annotationURI:w1+x1,loadAnnotationsJoined:true,loadMetadataAsync:false,json:true});n.setCountSupported(false);t.setModel(n);p=q(e,n);h1="/"+e.slice(m.length);i1=n.getServiceMetadata();c=n.getServiceAnnotations();j1=s(p,i1);k1=c[j1]["com.sap.vocabularies.UI.v1.HeaderInfo"];l1=c[j1]["com.sap.vocabularies.UI.v1.Facets"];t.bindElement(h1,y(p,i1));y1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");L.InteropCompleted=false;f(g(i1));t.addStyleClass("sapFactsheetUtiThingType"+p.replace(/\s/g,""));if(k1.TypeName.String){t.setTitle(k1.TypeName.String);}else{if(k1.TypeName.Path){t.bindProperty("title",{path:k1.TypeName.Path});}}if(k1.ImageUrl&&k1.ImageUrl.String){t.setIcon(k1.ImageUrl.String);}else if(k1.ImageUrl&&k1.ImageUrl.Path){t.bindProperty("icon",{path:k1.ImageUrl.Path});}else if(k1.TypeImageUrl&&k1.TypeImageUrl.String){t.setIcon(k1.TypeImageUrl.String);}else if(k1.TypeImageUrl&&k1.TypeImageUrl.Path){t.bindProperty("icon",{path:k1.TypeImageUrl.Path});}if(k1.Title.Value.String){t.setName(k1.Title.Value.String);}else{t.bindProperty("name",Q(k1.Title.Value,k1.Title.EdmType,j1).BindingInfo);}if(k1.Description&&k1.Description.Value){if(k1.Description.Value.String){t.setDescription(k1.Description.Value.String);}else{t.bindProperty("description",Q(k1.Description.Value,k1.Description.EdmType,j1).BindingInfo);}}for(a2 in c[j1]){if(c[j1].hasOwnProperty(a2)){if(a2.search("com.sap.vocabularies.UI.v1.DataPoint")!==-1){b2=c[j1][a2];if(b2){t.addKpi(Z(n,b2,j1,h1));_1+=1;}}if(_1>=3){break;}}}for(i=0;i<l1.length;i+=1){if(l1[i]["com.sap.vocabularies.UI.v1.IsSummary"]){s1=l1[i];break;}}if(s1){z1=15;for(j=0;j<s1.Facets.length;j+=1){C1=s1.Facets[j].Target.AnnotationPath.substring(s1.Facets[j].Target.AnnotationPath.lastIndexOf("@")+1);n1=s1.Facets[j].Target.AnnotationPath;n1=n1.substring(0,n1.lastIndexOf("@")-1);s1.Facets[j].NavPath=n1;D1=w(p,n1,i1);s1.Facets[j].NavEntitySet=D1;if(D1){E1=D1;}else{E1=p;}s1.Facets[j].EntitySet=E1;F1=s(D1,i1);if(F1){G1=F1;}else{G1=j1;}s1.Facets[j].EntityType=G1;H1=[];if(c[G1][C1].length){H1=c[G1][C1];}else if(c[G1][C1].Data.length){H1=c[G1][C1].Data;}s1.Facets[j].Content=H1;for(i=0;i<H1.length;i+=1){I1=a1(H1[i]);if(I1==="High"){A1+=1;}else if(I1==="Medium"){B1+=1;}}}if(A1>=z1){A1=z1;B1=0;}else if((A1+B1)>z1){B1=z1-A1;if(B1<0){B1=0;}}if(jQuery.device.is.phone){B1=0;}M1=z1-A1-B1;U1=new sap.suite.ui.commons.FacetOverview({title:y1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT")});A=[];A.push(U1);A[0].bLoaded=false;A[0].bProcessed=false;A[0].bIsTable=false;N1=[];P1=B1+A1;for(j=0;j<s1.Facets.length;j+=1){Q1=R(n,s1.Facets[j].EntitySet,s1.Facets[j].Content,{High:A1,Medium:B1,Low:0},null,U1).addStyleClass("sapFactsheetUtiTilePadding");if(j>0){Q1.addStyleClass("sapFactsheetUtiPaddingTop");}if(s1.Facets[j].NavPath){Q1.bindElement(h1+"/"+s1.Facets[j].NavPath);}O1=Y(s1.Facets[j].Content);A1-=O1.High;B1-=O1.Medium;if(((O1.High>0)&&((A1+O1.High)>0))||((O1.Medium>0)&&((B1+O1.Medium)>0))){N1.push(Q1);if(j>0){if(M1>0){M1-=1;}else if(B1>0){B1-=1;}else if(A1>0){A1-=1;}}}if((A1<1)&&(B1<1)){break;}}if(A1<0){A1=0;}if(B1<0){B1=0;}m1=new sap.ui.layout.VerticalLayout({content:N1,width:"100%"});R1=X();T1=1;if((P1>3)&&(P1<=9)){R1=X(2);T1=2;}else if(P1>9){R1=X(3);T1=3;}U1.setContent(m1);U1.setRowSpan(T1);if(jQuery.device.is.phone){U1.setHeightType(sap.suite.ui.commons.FacetOverviewHeight.Auto);}else{U1.setHeight(R1);}U1.addStyleClass("sapFactsheetUtiGeneralInformationOverviewFacet");U1.attachPress({facets:s1},function(o,a){var b,k,h2,i2,m1;t.removeAllFacetContent();h2=new sap.suite.ui.commons.UnifiedThingGroup();h2.setDescription(_());h2.setTitle(y1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));h2.addStyleClass("sapFactsheetUtiGeneralInformationUtg");if(a.facets.Facets.length>1){b="L6 M12 S12";}else{b="L12 M12 S12";}A[0].Links=[];i2=new sap.ui.layout.VerticalLayout({width:"100%"});for(i=0;i<a.facets.Facets.length;i+=1){if(i%2===0){k=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,defaultSpan:b});}m1=S(n,p,a.facets.Facets[i],h1,this);m1.addStyleClass("sapFactsheetUtiGeneralInformationUtgContent");if((i===0)&&(a.facets.Facets.length>1)&&(m1.getTitle().trim()==="")){m1.setTitle(y1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));}k.addContent(m1);if(i%2!==0){i2.addContent(k);}}A[0].bLoaded=true;A[0].bProcessed=false;A[0].bIsTable=false;d(0);if(i%2!==0){i2.addContent(k);}h2.setContent(i2);t.addFacetContent(h2);t.navigateToDetail();});t.addFacet(U1);}p1=function(q1){return function(a){var o,b,k,h2,i2,j2,k2,l2,m2,n2,h1,o2,p2,q2,r2,s2,t2,u2,v2,i;if((q1.cardinality==="*"&&a.results&&a.results.length&&a.results.length!==0)||(q1.cardinality==="1"&&a)){n2=new sap.ui.model.json.JSONModel();if(q1.cardinality==="*"){if(a.results&&a.results.length){n2.setData(a);}}else{n2.setData({result:a});h1="/result";}o=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/VBI_APPL_DEF_SRV",false);b=c[q1.navigationType]["com.sap.vocabularies.UI.v1.GeoLocation"];p2=c[q1.navigationType]["com.sap.vocabularies.UI.v1.HeaderInfo"];q2=c[q1.navigationType]["com.sap.vocabularies.UI.v1.Identification"];if(b.Longitude&&b.Latitude){h2={"Data":{"Set":{"N":[{"name":"Spots","E":[]}]}}};if(q1.cardinality==="1"){if(b.Longitude.Path&&b.Latitude.Path){k=a[b.Longitude.Path]+";"+a[b.Latitude.Path]+";0";}h2.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}else{for(i=0;i<a.results.length;i+=1){if(b.Longitude.Path&&b.Latitude.Path){k=a.results[i][b.Longitude.Path]+";"+a.results[i][b.Latitude.Path]+";0";}h2.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}if(a.results.length!==0){k=a.results[0][b.Longitude.Path]+";"+a.results[0][b.Latitude.Path]+";0";}}}v2=parseInt(a.__count,10);if(Number(v2)){q1.facet.setQuantity(v2);}k2=function(w2){var x2,y2,z2,A2,B2;x2=$.parseJSON(w2.getParameters().data);if(x2.Action.name==="DETAIL_REQUEST"&&x2.Action.instance){y2=x2.Action.instance;if(n2.oData.results){h1="/results/"+y2.split(".")[1];}u2=p2.TypeName.String.substring(0,17);A2=parseFloat(X(0.7))*16;B2=parseFloat(X(1.5))*16;z2={"SAPVB":{"version":"2.0","xmlns:VB":"VB","Windows":{"Remove":{"name":"Detail1"},"Set":{"name":"Detail1","Window":{"id":"Detail1","type":"callout","refParent":"Main","refScene":"","offsetX":"16","offsetY":"-27","modal":"false","width":B2,"height":A2,"caption":u2,"pos.bind":y2+".GeoPosition"}}},"Scenes":{"Set":{"name":"Details","Scene":{"id":"Details","navControlVisible":"false"}}}}};this.load(z2);}};l2=function(w2){var a2,x2,D1,y2;if(!r2){r2=D(p2.Title,q1.navigationType,i1,q1.facet);r2.setModel(n2);r2.bindElement(h1);s2=D(p2.Description,q1.navigationType,i1,q1.facet);s2.setModel(n2);s2.bindElement(h1);for(a2 in b.Address){if(a2==="label"){o2=D({Value:b.Address[a2]},q1.navigationType,i1,q1.facet);o2.setModel(n2);o2.bindElement(h1);break;}}y2=7;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){y2=4;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){y2=5;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){y2=2;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){y2=3;}t2=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(n);if(q1.navigationPath){D1=w(q1.entitySet,q1.navigationPath,i1);t2.addContent(R(n,D1,q2,{High:y2},null,q1.facet));t2.setModel(n2).bindElement(h1);}else{t2.addContent(R(n,q1.entitySet,q2,{High:y2},null,q1.facet)).setModel(n2).bindElement(h1);}}else{r2.bindElement(h1);if(s2){s2.bindElement(h1);}if(o2){o2.bindElement(h1);}if(t2){t2.bindElement(h1);}}x2=parseFloat(X(1.5))*16*0.95+"px";if(r2){r2.placeAt(w2.getParameter("contentarea").id);r2.addStyleClass("sapFactsheetUtiGeoPopupHead");if(jQuery.device.is.phone){r2.addStyleClass("sapFactsheetUtiGeoPopupHeadFontPhone");}r2.setWidth(x2);}if(s2){s2.placeAt(w2.getParameter("contentarea").id);s2.addStyleClass("sapFactsheetUtiGeoPopupDescr");if(jQuery.device.is.phone){s2.addStyleClass("sapFactsheetUtiGeoPopupDescrFontPhone");}s2.setWidth(x2);}if(o2){o2.placeAt(w2.getParameter("contentarea").id);o2.addStyleClass("sapFactsheetUtiGeoPopupText");o2.setWidth(x2);}if(t2&&t2.getContent()[0]&&t2.getContent()[0].getContent&&t2.getContent()[0].getContent().length>0){t2.placeAt(w2.getParameter("contentarea").id);t2.addStyleClass("sapFactsheetUtiGeoPopupText");t2.setWidth(x2);}if(A.indexOf(q1.facet)>=0){A[A.indexOf(q1.facet)].bLoaded=true;A[A.indexOf(q1.facet)].bProcessed=false;A[A.indexOf(q1.facet)].bIsTable=false;}d(A.indexOf(q1.facet));};m2=function(w2){if(r2){r2.destroy();r2=undefined;}if(s2){s2.destroy();s2=undefined;}if(o2){o2.destroy();o2=undefined;}if(t2){t2.destroy();t2=undefined;}$(w2.getParameter("contentarea").id).empty();};i2=function(q1){return function(a){var w2,x2,y2,z2,i;z2=a.ProjectJSON;z2=z2.indexOf("{")?z2.substr(z2.indexOf("{")):z2;w2=$.parseJSON(z2);w2.SAPVB.Scenes.Set.SceneGeo.initialStartPosition=k;w2.SAPVB.Scenes.Set.SceneGeo.initialZoom=12;w2.SAPVB.Actions.Set.Action.push({id:"200",name:"TAP_ON_MAP",refEvent:"Click",refScene:"MainScene",refVO:"Map"});if(h2){w2.SAPVB.Data=h2.Data;}for(i=0;i<w2.SAPVB.Scenes.Set.SceneGeo.VO.length;i+=1){if(w2.SAPVB.Scenes.Set.SceneGeo.VO[i].datasource==="Spots"){if(w2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale&&w2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale.split(";").length!==3){w2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale="1.0;1.0;1.0";break;}}}q1.facet.getContent().attachSubmit(function(A2){if(jQuery.device.is.tablet||jQuery.device.is.phone){q1.facet.firePress();}});q1.facet.getContent().load(w2);q1.facet.attachPress("",function(A2,B2){var C2=[],D2=[],i,E2;if(!x2){x2=new sap.ui.vbm.VBI({width:"100%",height:"100%",plugin:false,config:null});x2.addStyleClass("sapFactsheetUtiGeoPopup");}w2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.move="false";w2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.zoom="false";w2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.pitch="false";w2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.yaw="false";w2.SAPVB.Scenes.Set.SceneGeo.SuppressedNavControlVisibility="false";x2.load(w2);if(q1.cardinality==="*"){for(i=0;i<n2.oData.results.length;i+=1){C2.push(n2.oData.results[i][b.Longitude.Path]);D2.push(n2.oData.results[i][b.Latitude.Path]);}}x2.attachSubmit(k2);x2.attachOpenWindow(l2);x2.attachCloseWindow(m2);y2=new sap.suite.ui.commons.UnifiedThingGroup({content:x2,title:q1.facetContent.Label.String,description:_()});t.removeAllFacetContent();t.addFacetContent(y2);t.navigateToDetail();t.attachAfterNavigate(C2,function(A2){if(A2.getParameters().getParameters().toId.indexOf("-detail-page")!==-1){if(jQuery.device.is.phone){E2="300px";}else{E2=Math.floor($("#"+A2.getParameters().getParameters().toId+"-cont").height()-128)+"px";}x2.setHeight(E2);if(C2.length>1){x2.zoomToGeoPosition(C2,D2);}}});});};};j2=function(w2){return function(x2){t.removeFacet(w2);};};o.read("VBIApplicationSet('ZFACTSHEETS')","","",false,i2(q1),j2(q1.facet));}else{q1.facet.setQuantity(undefined);q1.facet.addStyleClass("sapFactsheetUtiEmptyTile");q1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);q1.facet.setContent(undefined);q1.facet.setTitle(undefined);}};};o1=function(q1){return function(a){var o,b,k,h2,i2,j2,i,j,m1,k2,l2,m2,n2,o2,p2,q2,r2,s2,t2,u2,v2,w2,x2,y2,z2,A2="",B2,C2,D2,E2,F2,G2;o=new sap.ui.model.json.JSONModel();if(q1.facetContent.Target&&q1.facetContent.Target.AnnotationPath&&q1.facetContent.Target.AnnotationPath.split("#")[1]&&c[q1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+q1.facetContent.Target.AnnotationPath.split("#")[1]]){b=c[q1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+q1.facetContent.Target.AnnotationPath.split("#")[1]];}else{b=c[q1.navigationType]["com.sap.vocabularies.UI.v1.Badge"];}if(q1.cardinality==="*"){if(a.results&&a.results.length){B2=q1.facetContent.Target.AnnotationPath;c2=B2.substring(B2.lastIndexOf("@")+1);if(c2==="com.sap.vocabularies.UI.v1.Chart"){C2=c[q1.navigationType]["com.sap.vocabularies.UI.v1.Chart"];D2=c.propertyExtensions[q1.navigationType];E2=[];for(i=0;i<C2.Dimensions.length;i+=1){E2.push({axis:1,name:D2[C2.Dimensions[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+C2.Dimensions[i].PropertyPath+"}"});}F2=[];for(i=0;i<C2.Measures.length;i+=1){F2.push({name:D2[C2.Measures[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+C2.Measures[i].PropertyPath+"}"});}G2=new F({dimensions:E2,measures:F2,data:{path:"/results"}});m1=W(C2.ChartType.EnumMember,C2.Title,C2.Description,G2);m1.setModel(o);q1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.XL);}else{m1=new sap.ui.layout.VerticalLayout({width:"100%"}).addStyleClass("sapFactsheetUtiVLayoutPadding");for(i=0;i<a.results.length;i+=1){i2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutPadding");k=D(b.Title,q1.navigationType,i1,q1.facet);if(k.setWrapping){k.setWrapping(false);}sap.ui.getCore().byId(t.getId()+"-master-page").addDelegate({onAfterShow:(function(i2){return function(){var H2,I2;H2=i2.getParent().getDomRef().clientWidth;I2=H2;if(i2.getContent()[0]){I2-=i2.getContent()[0].getDomRef().clientWidth;if(H2<i2.getContent()[0].getDomRef().clientWidth){i2.getContent()[0].getDomRef().setAttribute("style","width:"+H2+"px");return;}}if(i2.getContent()[1]){I2-=i2.getContent()[1].getDomRef().clientWidth;}if(I2<10){I2=0;}if(i2.getContent()[2]){i2.getContent()[2].getDomRef().setAttribute("style","width:"+I2+"px");}};}(i2))});o=new sap.ui.model.json.JSONModel();o.setData({result:a.results[i]});k.setModel(o);k.bindElement("/result");j2=false;if(a.results[i][b.Title.Value.Path]){j2=true;}if(b.Title.Value.Apply){for(j=0;j<b.Title.Value.Apply.Parameters.length;j+=1){if(b.Title.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.Title.Value.Apply.Parameters[j].Value]){j2=true;break;}}}}A2="";if(j2){i2.addContent(k);if(b.MainInfo&&((b.MainInfo.EdmType&&b.MainInfo.EdmType==="Edm.Decimal")||(b.MainInfo.Value&&b.MainInfo.Value.Apply&&b.MainInfo.Value.Apply.Parameters[0]&&b.MainInfo.Value.Apply.Parameters[0].EdmType&&b.MainInfo.Value.Apply.Parameters[0].EdmType==="Edm.Decimal"))){A2="comma";}else if(b.MainInfo&&b.MainInfo.Value.Path&&a.results[i][b.MainInfo.Value.Path]){A2="dash";}else if(b.MainInfo&&b.MainInfo.Value.Apply){for(j=0;j<b.MainInfo.Value.Apply.Parameters.length;j+=1){if(b.MainInfo.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.MainInfo.Value.Apply.Parameters[j].Value]){A2="dash";break;}}}}if(A2==="dash"){i2.addContent(new sap.ui.core.HTML({content:"<span class=\"sapFactsheetUtiSeparatorPadding sapMText\"> &ndash; </span>"}));}if(A2==="comma"){i2.addContent(new sap.m.Text({text:", "}).addStyleClass("sapFactsheetUtiSeparatorPaddingForDecimal"));}}if(b.MainInfo){h2=D(b.MainInfo,q1.navigationType,i1,q1.facet);if(h2.setWrapping){h2.setWrapping(false);}h2.setModel(o);h2.bindElement("/result");i2.addContent(h2);}m1.addContent(i2);}}k2=parseInt(a.__count,10);if(Number(k2)){q1.facet.setQuantity(k2);}q1.facet.setContent(m1);q1.facet.attachPress({facet:q1.facetContent},function(H2,I2){var m1;t.removeAllFacetContent();A[A.indexOf(q1.facet)].Links=[];m1=S(n,q1.entitySet,I2.facet,q1.bindingPath,this);m1.setDescription(_());t.addFacetContent(m1);if(A.indexOf(q1.facet)>=0){A[A.indexOf(q1.facet)].bLoaded=false;A[A.indexOf(q1.facet)].bProcessed=false;A[A.indexOf(q1.facet)].bIsTable=true;}d(A.indexOf(q1.facet));t.navigateToDetail();});}else{q1.facet.setQuantity(0);q1.facet.addStyleClass("sapFactsheetUtiEmptyTile");q1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}if(A.indexOf(q1.facet)>=0){A[A.indexOf(q1.facet)].bLoaded=true;A[A.indexOf(q1.facet)].bProcessed=false;A[A.indexOf(q1.facet)].bIsTable=false;}d(A.indexOf(q1.facet));}else{o.setData({result:a});for(y2 in a){if(a.hasOwnProperty(y2)){if(y2!=="__metadata"){if(typeof a[y2]==="string"&&a[y2]){if(parseInt(a[y2],10)!==0){z2=true;break;}}else if(typeof a[y2]==="number"&&parseInt(a[y2],10)!==0){z2=true;break;}}}}if(z2){l2=new sap.ui.layout.VerticalLayout();m2=(c.propertyExtensions)?c.propertyExtensions[q1.navigationType]:[];n2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");o2=E(b.Title,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");k=D(b.Title,q1.navigationType,i1,q1.facet);k.setModel(o);k.bindElement("/result");n2.addContent(o2);n2.addContent(k);l2.addContent(n2);if(b.MainInfo){p2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");q2=E(b.MainInfo,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");h2=D(b.MainInfo,q1.navigationType,i1,q1.facet);h2.setModel(o);h2.bindElement("/result");p2.addContent(q2);p2.addContent(h2);l2.addContent(p2);}if(b.SecondaryInfo){r2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");s2=E(b.SecondaryInfo,{},m2,true).addStyleClass("sapFactsheetUtiLabelMargin");t2=D(b.SecondaryInfo,q1.navigationType,i1,q1.facet);t2.setModel(o);t2.bindElement("/result");r2.addContent(s2);r2.addContent(t2);l2.addContent(r2);}if(b.TypeImageUrl||b.ImageUrl){if(b.ImageUrl){u2=b.ImageUrl;}else{u2=b.TypeImageUrl;}v2=new sap.ui.layout.HorizontalLayout();w2="64px";if(jQuery.device.is.phone){w2="48px";}if(u2.String&&(u2.String.substr(0,11)==="sap-icon://")){x2=new sap.ui.core.Icon({size:w2,width:w2});}else{x2=new sap.m.Image({width:w2});}x2.addStyleClass("sapFactsheetUtiRelIcon");if(u2&&u2.String){x2.setSrc(u2.String);}else{if(u2&&u2.Path){x2.bindProperty("src",u2.Path);}}v2.addContent(x2);v2.addContent(l2);q1.facet.setContent(v2);}else{q1.facet.setContent(l2);}q1.facet.attachPress({facet:q1.facetContent},function(H2,I2){var m1;t.removeAllFacetContent();A[A.indexOf(q1.facet)].Links=[];m1=S(n,q1.entitySet,I2.facet,q1.bindingPath,this);m1.setDescription(_());t.addFacetContent(m1);if(A.indexOf(q1.facet)>=0){A[A.indexOf(q1.facet)].bLoaded=true;A[A.indexOf(q1.facet)].bProcessed=false;A[A.indexOf(q1.facet)].bIsTable=false;}d(A.indexOf(q1.facet));t.navigateToDetail();});}else{q1.facet.addStyleClass("sapFactsheetUtiEmptyTile");q1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}if(A.indexOf(q1.facet)>=0){A[A.indexOf(q1.facet)].bLoaded=true;A[A.indexOf(q1.facet)].bProcessed=false;A[A.indexOf(q1.facet)].bIsTable=false;}d(A.indexOf(q1.facet));}};};f2=function(q1){return function(a){t.removeFacet(q1.facet);};};d2=function(q1){return function(a){var o,b,i,k,h2;b=c[q1.navigationType]["com.sap.vocabularies.UI.v1.MediaResource"];if(q1.cardinality==="*"){if(a.results&&a.results.length){o=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiPictureViewerOverview");for(i=0;i<a.results.length;i+=1){o.addContent(new sap.m.Image({src:a.results[i][b.Thumbnail.Url.Path],height:"85px"}));if(i===3){break;}}k=parseInt(a.__count,10);if(Number(k)){q1.facet.setQuantity(k);}q1.facet.setContent(o);q1.facet.attachPress({facet:q1.facetContent,data:a},function(i2,j2){var k2,e2,l2;t.removeAllFacetContent();h2=new sap.suite.ui.commons.UnifiedThingGroup();if(j2.facet.Label&&j2.facet.Label.String){h2.setTitle(j2.facet.Label.String);}h2.setDescription(_());if(jQuery.device.is.phone){e2="350px";}else{e2="550px";}k2=new sap.m.Carousel({height:e2});for(i=0;i<j2.data.results.length;i+=1){l2=new sap.m.Image({src:j2.data.results[i][b.Url.Path]});if(jQuery.device.is.phone){l2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeightPhone");}else{l2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeight");}k2.addPage(l2);}h2.setContent(k2);t.addFacetContent(h2);t.navigateToDetail();});}else{q1.facet.setQuantity(0);q1.facet.addStyleClass("sapFactsheetUtiEmptyTile");q1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}}};};g2=function(o,h2){var k,i,j,i2=[],j2={},k2,l2,m2,n2,o2,p2,q2,r2;l2=function(i1,a){var i,b="";if(i1){if(i1.Path){return a[i1.Path];}else if(i1.String){return i1.String;}else if(i1.Apply.Name==="odata.concat"){for(i=0;i<i1.Apply.Parameters.length;i+=1){if(i1.Apply.Parameters[i].Type==="Path"){b=b+a[i1.Apply.Parameters[i].Value];}else if(i1.Apply.Parameters[i].Type==="String"){b=b+i1.Apply.Parameters[i].Value;}}return b;}}};j2.iCount=0;j2.aContacts=[];for(i=0;i<o.__batchResponses.length;i+=1){if(!o.__batchResponses[i].data){continue;}i2=o.__batchResponses[i].data.results;if(!i2){i2=[];i2.push(o.__batchResponses[i].data);}if(i2.length>0){k2=c[i2[0].__metadata.type]["com.sap.vocabularies.Communication.v1.Contact"];if(k2){for(j=0;j<i2.length;j+=1){m2=n2=o2="";if(k2.tel){for(k=0;k<k2.tel.length;k+=1){if(k2.tel[k].type&&k2.tel[k].type.EnumMember){p2=l2(k2.tel[k].uri,i2[j]);switch(k2.tel[k].type.EnumMember){case"com.sap.vocabularies.Communication.v1.PhoneType/voice":m2=p2?p2.replace("tel:",""):"";m2=m2?m2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/cell":n2=p2?p2.replace("tel:",""):"";n2=n2?n2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/fax":o2=p2?p2.replace("tel:",""):"";o2=o2?o2.replace(";ext=",""):"";break;}}}}r2=k2.email&&k2.email.address?k2.email.address:"";q2=l2(k2.photo,i2[j]);j2.iCount+=1;j2.aContacts.push({fn:l2(k2.fn,i2[j]),title:l2(k2.title,i2[j]),org:l2(k2.org,i2[j]),phone:m2,mobile:n2,fax:o2,photo:q2,email:l2(r2,i2[j]),sEntity:i2[0].__metadata.type,bExistsPhoto:q2?true:false,bUseIcon:q2?false:true,sOrder:j2.iCount});}}}}if(h2){j2.aContacts.sort(function(a,b){return a[h2]>b[h2]?1:-1;});}return j2;};L1=function(q1){return function(o){var i,a,b,k,h2,i2,j2,k2;a=g2(o,"sOrder");b=new sap.ui.layout.Grid({defaultSpan:"L6 M6 S12",hSpacing:0,vSpacing:0}).addStyleClass("sapFactsheetUtiContactsGrid");for(i=0;i<a.aContacts.length&&i<4;i+=1){i2=new sap.ui.layout.VerticalLayout();if(a.aContacts[i].photo){j2=new sap.m.Image({height:"55px",src:a.aContacts[i].photo});}else{j2=new sap.ui.core.Icon({size:"50px",src:sap.ui.core.IconPool.getIconURI("person-placeholder")}).addStyleClass("sapFactsheetUtiRelIcon");}i2.addContent(j2);i2.addStyleClass("sapFactsheetUtiContactsImage");h2=new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:a.aContacts[i].fn}).addStyleClass("sapFactsheetUtiTextName"),new sap.m.Text({text:a.aContacts[i].title}).addStyleClass("sapFactsheetUtiTextValue")]});k=new sap.ui.layout.HorizontalLayout({content:[i2,h2]}).addStyleClass("sapFactsheetUtiContactsBox");b.addContent(k);}U1=sap.ui.getCore().byId(t.data("contactFacetId"));U1.setQuantity(a.iCount);if(i>0){U1.setContent(b);if(i<=2){k2=sap.suite.ui.commons.FacetOverviewHeight.M;}else{k2=sap.suite.ui.commons.FacetOverviewHeight.L;}U1.attachPress(function(){var i,J1=[],K1;n.clearBatch();for(i=0;i<c[j1]["com.sap.vocabularies.UI.v1.Contacts"].length;i+=1){n1=c[j1]["com.sap.vocabularies.UI.v1.Contacts"][i].AnnotationPath;n1=n1.substring(0,n1.lastIndexOf("@")-1);if(n1!==""){K1=h1+"/"+n1;}else{K1=h1;}J1.push(n.createBatchOperation(K1,"GET"));}n.addBatchReadOperations(J1);n.submitBatch(function(o){var a,l2,m2,n2,o2,p2,q2;q2=jQuery.sap.resources({url:jQuery.sap.getModulePath("sap.ushell.components.container.")+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});a=g2(o,"sEntity");l2=new sap.ui.model.json.JSONModel();l2.setData(a);m2=new sap.m.ColumnListItem({type:sap.m.Inactive,unread:false,cells:[new sap.ui.layout.VerticalLayout({content:[new sap.m.Image({src:"{photo}",width:"74px",visible:"{bExistsPhoto}"}),new sap.ui.core.Icon({size:"76px",src:sap.ui.core.IconPool.getIconURI("person-placeholder"),visible:"{bUseIcon}"}).addStyleClass("sapFactsheetUtiRelIcon")]}),new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:"{fn}"}).addStyleClass("sapFactsheetUtiContactsName"),new sap.m.Label({text:"{title}"}),new sap.m.Label({text:"{org}"})]}),new sap.m.Link({text:"{phone}",href:"tel:{phone}"}),new sap.m.Link({text:"{mobile}",href:"tel:{mobile}"}),new sap.m.Link({text:"{fax}",href:"tel:{fax}"}),new sap.m.Link({text:"{email}",href:"mailto:{email}"})]});n2=new sap.m.Table({threshold:2,inset:false,showUnread:true,scrollToLoad:true,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.Center,width:"12%",header:new sap.m.Text({text:""})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,header:new sap.m.Text({text:q2.getText("USHELL_FACTSHEET_NAME")})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:q2.getText("USHELL_FACTSHEET_PHONE")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("mobile")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("fax")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"26%",header:new sap.m.Text({text:q2.getText("USHELL_FACTSHEET_EMAIL")}),minScreenWidth:"Tablet",demandPopin:true})],items:{path:"/aContacts",template:m2}});o2=new sap.m.ViewSettingsDialog({sortItems:[new sap.m.ViewSettingsItem({key:"fn",text:q2.getText("USHELL_FACTSHEET_NAME")}),new sap.m.ViewSettingsItem({key:"phone",text:q2.getText("USHELL_FACTSHEET_PHONE")}),new sap.m.ViewSettingsItem({key:"mobile",text:sap.ushell.resources.i18n.getText("mobile")}),new sap.m.ViewSettingsItem({key:"fax",text:sap.ushell.resources.i18n.getText("fax")}),new sap.m.ViewSettingsItem({key:"email",text:q2.getText("USHELL_FACTSHEET_EMAIL")})],confirm:function(r2){var s2,t2,u2=[];s2=r2.getParameters();t2=n2.getBinding("items");if(s2.sortItem){u2.push(new sap.ui.model.Sorter(s2.sortItem.getKey(),s2.sortDescending));t2.sort(u2);}}});n2.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(r2){o2.open();}})]}));n2.setModel(l2);p2=new sap.suite.ui.commons.UnifiedThingGroup({title:U1.getTitle(),description:_(),content:n2});t.removeAllFacetContent();t.addFacetContent(p2);t.navigateToDetail();});});}else{k2=sap.suite.ui.commons.FacetOverviewHeight.S;U1.addStyleClass("sapFactsheetUtiEmptyTile");U1.setQuantity(0);}U1.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:k2);};};for(i=0;i<l1.length;i+=1){if(l1[i]["com.sap.vocabularies.UI.v1.Map"]){n1=l1[i].Target.AnnotationPath;n1=n1.substring(0,n1.lastIndexOf("@")-1);X1="1";W1=j1;if(n1){W1=b1(n1,j1,i1);X1=x(p,n1,i1);}e2="100%";if(jQuery.device.is.phone){e2="150px";}V1=new sap.ui.vbm.VBI({width:"100%",height:e2,plugin:false,config:null});U1=new sap.suite.ui.commons.FacetOverview({title:l1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.L,content:V1});A.push(U1);A[A.length-1].bLoaded=false;A[A.length-1].bProcessed=false;A[A.length-1].bIsTable=false;q1={cardinality:X1,navigationPath:n1,facet:U1,facetContent:l1[i],navigationType:W1,metadata:i1,bindingPath:h1,entitySet:p};if(X1==="*"){Y1=["$inlinecount=allpages","$top=1000"];}else{Y1=[];}n.read(h1+"/"+n1,"",Y1,true,p1(q1));t.addFacet(U1);}else{if(l1[i].Target){n1=l1[i].Target.AnnotationPath;n1=n1.substring(0,n1.lastIndexOf("@")-1);c2=l1[i].Target.AnnotationPath.substring(l1[i].Target.AnnotationPath.lastIndexOf("@")+1);if(n1){W1=b1(n1,j1,i1);U1=new sap.suite.ui.commons.FacetOverview({title:l1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});X1=x(p,n1,i1);if(X1!==0){q1={cardinality:X1,navigationPath:n1,facet:U1,facetContent:l1[i],navigationType:W1,metadata:i1,bindingPath:h1,entitySet:p};if(l1[i]["com.sap.vocabularies.UI.v1.Gallery"]){if(X1==="*"){Y1=["$inlinecount=allpages"];}else{Y1=[];}n.read(h1+"/"+n1,"",Y1,true,d2(q1));}else{A.push(U1);A[A.length-1].bLoaded=false;A[A.length-1].bProcessed=false;A[A.length-1].bIsTable=false;if(X1==="*"){Y1=["$inlinecount=allpages","$top=3"];}else{Y1=[];}n.read(h1+"/"+n1,"",Y1,true,o1(q1),f2(q1));}t.addFacet(U1);}}else{if(c2==="com.sap.vocabularies.UI.v1.Contacts"){U1=new sap.suite.ui.commons.FacetOverview({title:l1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});t.data("contactFacetId",U1.sId);q1={facet:U1};n.clearBatch();for(j=0;j<c[j1][c2].length;j+=1){n1=c[j1][c2][j].AnnotationPath;n1=n1.substring(0,n1.lastIndexOf("@")-1);if(n1!==""){X1=x(p,n1,i1);if(X1==="*"){K1=h1+"/"+n1+"?$top=4"+"&$inlinecount=allpages";}else{K1=h1+"/"+n1;}}else{K1=h1;}J1.push(n.createBatchOperation(K1,"GET"));}n.addBatchReadOperations(J1);n.submitBatch(L1(q1));t.addFacet(U1);}}}}}S1=new sap.ushell.ui.footerbar.AddBookmarkButton();$1=function(){var b,i,c2,a,k,h2={},a2,i2,j2,k2,o,l2,m2,n2,o2;S1.setAppData({title:t.getTitle(),subtitle:t.getName()+" - "+t.getDescription()});S1.setEnabled(true);m2=sap.ushell.Container.getService("URLParsing");n2=m2.getShellHash(window.location.href);o2=m2.parseShellHash(n2);j2=o2.semanticObject;u1=new sap.suite.ui.commons.LinkActionSheet({showCancelButton:true,placement:sap.m.PlacementType.Top});r1=G(e,n);b=r1.split(",");for(i=0;i<b.length;i+=1){b[i]=b[i].replace("='","=","g");if(b[i].lastIndexOf("'")===b[i].length-1){b[i]=b[i].slice(0,-1);}}for(c2 in c[j1]){if(c[j1].hasOwnProperty(c2)){if(c2.indexOf("com.sap.vocabularies.Common.v1.SecondaryKey")===0){a=c[j1][c2];for(i=0;i<a.length;i+=1){k=this.getBoundContext().getProperty(a[i].PropertyPath);if(k){b.push(a[i].PropertyPath+"="+k);}}}}}for(i=0;i<b.length;i+=1){a2=b[i].substr(0,b[i].indexOf("="));i2=b[i].substr(b[i].indexOf("=")+1,b[i].length);h2[decodeURIComponent(a2)]=decodeURIComponent(i2);}t1=sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(j2,h2);t1.done(jQuery.proxy(function(p2){var i,q2,r2;for(i=0;i<p2.length;i+=1){r2=p2[i].intent;if(r2.indexOf(c1)<0&&r2.indexOf("-analyzeKPIDetails~")<0&&r2.indexOf("-analyzeSBKPIDetails~")<0&&r2.indexOf("-NavigateToMaintainCusProj~")<0&&r2.indexOf("CostCenter-manageCostCenter~")<0&&r2.indexOf("AccountingDocument-analyzeDocumentJournal~")<0&&r2.indexOf("AccountingDocument-analyzeGLLineItem~")<0&&r2.indexOf("ControllingDocument-analyzeCostCenters~")<0&&r2.indexOf("ControllingDocument-analyzeInternalOrders~")<0&&r2.indexOf("ControllingDocument-analyzeMarketSegment~")<0&&r2.indexOf("ControllingDocument-analyzeProfitCentersActuals~")<0&&r2.indexOf("ControllingDocument-analyzeProfitLoss~")<0&&r2.indexOf("ControllingDocument-analyzeProjectsActuals~")<0&&r2.indexOf("PurchaseOrder-create~")<0){q2=sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{shellHash:r2}});u1.addItem(new sap.m.Link({text:p2[i].text,href:q2}));t.setTransactionsVisible(true);}}}));t.attachTransactionsButtonPress(function(p2){u1.openBy(p2.getParameter("caller"));});this.detachChange($1);sap.ushell.services.AppConfiguration.setWindowTitle(t.getTitle().trim()+": "+t.getName().trim()+" ("+t.getDescription().trim()+")");t.setActionsVisible(true);Z1=new sap.m.Button({text:y1.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_EMAIL_LINK"),icon:"sap-icon://email",press:function(oE){sap.m.URLHelper.triggerEmail("",t.getName(),window.location.href);}});v1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});k2=e.substr(0,e.lastIndexOf("/")+1);for(o in n.oData){if(n.oData.hasOwnProperty(o)){k2=k2+o;l2=o.substring(o.indexOf("(")+1,o.indexOf(")"));break;}}v1.addButton(new sap.ushell.ui.footerbar.JamDiscussButton({jamData:{businessObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:l2,name:t.getTitle(),ui_url:window.location.href}}}));v1.addButton(new sap.ushell.ui.footerbar.JamShareButton({jamData:{object:{id:window.location.href,display:new sap.m.Text({text:t.getTitle()}),share:""},externalObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:l2,name:t.getTitle()}}}));v1.addButton(S1);v1.addButton(Z1);t.attachActionsButtonPress(function(p2){v1.openBy(p2.getParameter("caller"));});A[0].bLoaded=true;A[0].bProcessed=false;d(0);};t.getElementBinding().attachChange($1);t.attachBackAction(function(o){history.back();});t.addDelegate({onAfterRendering:function(){t._adjustFacetLayout();}});return t;};return function(a,b){try{t=O(a,b,new U({configurationVisible:false}));}catch(e){throw e;}return t;};},true);
