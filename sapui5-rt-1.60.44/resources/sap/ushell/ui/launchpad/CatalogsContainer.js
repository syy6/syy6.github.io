sap.ui.define(['sap/ui/core/Control','sap/ushell/ui/launchpad/TileContainerUtils'],function(C,T){"use strict";var a=C.extend("sap.ushell.ui.launchpad.CatalogsContainer",{metadata:{properties:{categoryFilter:{type:"string",defaultValue:"ALL"},categoryAllocateTiles:{type:"int",defaultValue:"0"}},aggregations:{catalogs:{type:"sap.ushell.ui.launchpad.CatalogEntryContainer",multiple:true}}},renderer:{render:function(r,c){var b=c.getCatalogs();if(b.length){c.setBusy(false);}r.write("<div");r.addClass("sapUshellCatalogsContainer");r.writeClasses();r.writeControlData(c);r.write(">");jQuery.each(b,function(i,d){r.renderControl(this);});r.write("</div>");}}});a.prototype.setPagingManager=function(p){jQuery.sap.measure.start("FLP:DashboardManager.CatalogsRendering","CatalogsRendering","FLP");jQuery.sap.measure.pause("FLP:DashboardManager.CatalogsRendering");this.oPagingManager=p;};a.prototype.updateAllocatedUnits=function(n){this.nAllocatedUnits=n;};a.prototype.applyPagingCategoryFilters=function(n,c){var i=this.getCatalogs();this.nAllocatedUnits=n;if(c&&c!="All"&&c!=""){this.sCatalogTerm=c;}else{this.sCatalogTerm="";}if(!this.filters){this.filters={};}if(!this.filters.catalogEntry){this.filters.catalogEntry=function(e){var p=e.getPath(),I=e.getProperty("title")===this.sCatalogTerm,b;if(!this.sCatalogTerm){return;}b=this.indexingMaps.onScreenPathIndexMap[p];if(b){b.isVisible=I;}}.bind(this);}if(!this.filters.pagination){this.filters.pagination=function(e){var p=e.getPath(),b;b=this.indexingMaps.onScreenPathIndexMap[p];if(!this.nAllocatedUnits){b.isVisible=false;}}.bind(this);}if(!this.indexingMaps){return;}this.indexingMaps=T.indexOnScreenElements(i);T.applyFilterOnAllItems(this.mBindingInfos["catalogs"],this.filters,this.processFiltering.bind(this));if(this.indexingMaps){T.showHideTilesAndHeaders(this.indexingMaps,this.getCatalogs());}};a.prototype.processFiltering=function(e){var c=this.getCatalogs(),p=e.getPath(),i=this.indexingMaps.onScreenPathIndexMap[p],o=c[i.aItemsRefrenceIndex],b;if(i.isVisible&&(!this.catalogPagination[p]||this.catalogPagination[p]=="start")){if(this.catalogPagination[p]==undefined){this.catalogPagination[p]="start";o.catalogState={};}else if(this.catalogPagination[p]=="start"){var n=o.nNumberOfVisibileElements;this.nAllocatedUnits+=(n.appBoxesContainer+n.customTilesContainer);}b=this.nAllocatedUnits;o.handleElements("appBoxesContainer");o.handleElements("customTilesContainer");if(o.catalogState["appBoxesContainer"]=="full"&&o.catalogState["customTilesContainer"]=="full"){this.catalogPagination[p]="full";}if(b-this.nAllocatedUnits>0){this.bSearchResults=true;}else{i.isVisible=false;}}else if(i.isVisible&&this.catalogPagination[p]=="full"){var d=o.nNumberOfVisibileElements;var f=d.appBoxesContainer+d.customTilesContainer;if(f==0){i.isVisible=false;}}};a.prototype.resetCatalogPagination=function(){this.catalogPagination={};};a.prototype.updateAggregation=function(r){jQuery.sap.log.debug("Updating TileContainer. Reason: ",r);try{jQuery.sap.measure.resume("FLP:DashboardManager.CatalogsRendering");this.filterElements();jQuery.sap.measure.pause("FLP:DashboardManager.CatalogsRendering");}catch(e){sap.ui.base.ManagedObject.prototype.updateAggregation.apply(this,arguments);}};a.prototype.addNewItem=function(e,n){var N,b,i,p=e.getPath();N=T.createNewItem.bind(this)(e,n);if(!N.filters){N.filters={};N.filters.appBoxesContainer={};N.filters.customTilesContainer={};N.filters.appBoxesContainer.pagination=function(c){var p=c.getPath(),d;d=this.indexingMaps.appBoxesContainer.onScreenPathIndexMap[p];if(this.getAllocatedUnits){d.isVisible=!!this.getAllocatedUnits();}}.bind(N);N.filters.customTilesContainer.pagination=function(c){var p=c.getPath(),d;d=this.indexingMaps.customTilesContainer.onScreenPathIndexMap[p];if(this.getAllocatedUnits){d.isVisible=!!this.getAllocatedUnits();}}.bind(N);}N.nAllocatedUnits=this.nAllocatedUnits;N.getAllocatedUnits=function(){return this.nAllocatedUnits;}.bind(this);N.elementFiltered=function(c){b=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits+=c*b;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.elementsVisible=function(c){b=this.oPagingManager.getSizeofSupportedElementInUnits("tile");this.nAllocatedUnits-=c*b;if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.newElementCreated=function(E,c){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);N.currElementVisible=function(){this.nAllocatedUnits-=this.oPagingManager.getSizeofSupportedElementInUnits("tile");if(this.nAllocatedUnits<=0){this.nAllocatedUnits=0;}}.bind(this);T.addNewItem.bind(this)(N,n);i=this.getCatalogs();this.indexingMaps.onScreenPathIndexMap[p]={aItemsRefrenceIndex:i.length-1,isVisible:true};return true;};a.prototype.handleFilters=function(){if(!this.catalogPagination){this.catalogPagination={};}if(!this.catalogsElementsMap){this.catalogsElementsMap={};}if(!this.filters){this.filters={};}};a.prototype.setHandleSearchCallback=function(h){this.handleSearchCallback=h;};a.prototype.filterElements=function(){var n="catalogs",b=this.mBindingInfos[n].binding,B=b.getContexts(),i=this.getCatalogs(),c;if(!this.indexingMaps){this.indexingMaps=T.indexOnScreenElements(i);}this.handleFilters();c=T.markVisibleOnScreenElements(B,this.indexingMaps,false);if(!T.validateOrder(B,i,c)){throw true;}T.createMissingElementsInOnScreenElements(this.indexingMaps,B,c,this.addNewItem.bind(this),i,this.filters,n);i=this.getCatalogs();T.showHideTilesAndHeaders(this.indexingMaps,i);if(this.handleSearchCallback){this.handleSearchCallback();}};return a;});
