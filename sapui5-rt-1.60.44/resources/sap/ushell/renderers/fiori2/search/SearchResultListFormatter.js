sap.ui.define(['sap/ushell/renderers/fiori2/search/SearchConfiguration','sap/ushell/renderers/fiori2/search/SearchHelper','sap/ushell/renderers/fiori2/search/SearchNavigationObject','sap/ushell/renderers/fiori2/search/SearchNavigationObjectForSinaNavTarget','sap/ushell/renderers/fiori2/search/sinaNext/sina/sinaFactory','sap/ushell/renderers/fiori2/search/sinaNext/sina/AttributeDescriptionTextArrangement','sap/ushell/renderers/fiori2/search/sinaNext/sina/AttributeType'],function(S,a,b,c,s,A,d){"use strict";var m=sap.ushell.renderers.fiori2.search.SearchResultListFormatter=function(){this.init.apply(this,arguments);};m.prototype={init:function(){},format:function(e,t,o){o=o||{};o.suppressHighlightedValues=o.suppressHighlightedValues||false;var l={};var f=[];var r=e.items;var i,z;for(i=0;i<r.length;i++){var g=r[i];var h={};var I=[];for(z=0;z<g.detailAttributes.length;z++){var k=g.detailAttributes[z];switch(k.metadata.type){case d.ImageUrl:h.imageUrl=k.value;h.imageFormat=k.metadata.format?k.metadata.format.toLowerCase():undefined;if(k.defaultNavigationTarget){h.imageNavigation=new c(k.defaultNavigationTarget);}break;case d.GeoJson:h.geoJson={value:k.value,label:g.title};break;case d.Group:var n=this._formatAttributeGroup(k,o,z);I.push(n);break;case d.Double:case d.Integer:case d.String:case d.Longtext:case d.Date:case d.Time:case d.Timestamp:var p=this._formatSingleAttribute(k,o,z);I.push(p);break;}}h.key=g.key;h.keystatus=g.keystatus;h.dataSource=g.dataSource;h.dataSourceName=g.dataSource.label;if(g.titleAttributes){var q,u,v;var w=[];for(z=0;z<g.titleAttributes.length;z++){q=g.titleAttributes[z];if(q.metadata.type==d.Group){u=this._formatAttributeGroup(q,o,z);}else{u=this._formatSingleAttribute(q,o,z,false);}v=u.value;w.push(v);}h.title=w.join(' ');}else{h.title=o.suppressHighlightedValues?g.title:g.titleHighlighted;}h.titleDescription=g.titleDescription?g.titleDescription:"";h.itemattributes=I;if(g.defaultNavigationTarget){h.titleNavigation=new c(g.defaultNavigationTarget);if(!h.title||h.title.length==0){h.title=g.defaultNavigationTarget.label;}}if(g.navigationTargets&&g.navigationTargets.length>0){h.navigationObjects=[];for(var j=0;j<g.navigationTargets.length;j++){var x=new c(g.navigationTargets[j]);x.setLoggingType('RESULT_LIST_ITEM_NAVIGATE_CONTEXT');h.navigationObjects.push(x);}}var y=l[g.dataSource.id]||{};l[g.dataSource.id]=y;h.layoutCache=y;h.selected=h.selected||false;h.expanded=h.expanded||false;var B={};this._formatResultForDocuments(g,B);this._formatResultForNotes(g,B);h.additionalParameters=B;h.positionInList=i;h.resultSetId=e.id;f.push(h);}return f;},_formatAttributeGroup:function(e,o,i){var f={};var g={};f.name=e.label;var h=false;var j=false;for(var k in e.attributes){var _=e.attributes[k];var l=this._formatSingleAttribute(_,o,i);g[_.nameInGroup]=l;h=h||l.whyfound;j=j||l.longtext!==undefined;}f.value=this._formatBasedOnGroupTemplate(e.template,g,"value");f.valueRaw=this._formatBasedOnGroupTemplate(e.template,g,"valueRaw");f.valueWithoutWhyfound=this._formatBasedOnGroupTemplate(e.template,g,"valueWithoutWhyfound");f.key=e.id;f.isTitle=false;f.isSortable=e.metadata.isSortable;f.attributeIndex=i;f.displayOrder=e.metadata.usage.Detail&&e.metadata.usage.Detail.displayOrder;f.whyfound=h;if(j){f.longtext=f.value;}return f;},_formatSingleAttribute:function(e,o,i,u){var I={};I.name=e.label;I.valueRaw=e.value;I.value=o.suppressHighlightedValues?e.valueFormatted:e.valueHighlighted;I.valueWithoutWhyfound=e.valueFormatted;if(e.unitOfMeasure){if(o.suppressHighlightedValues||!e.unitOfMeasure.valueHighlighted){I.value+=" "+e.unitOfMeasure.valueFormatted;}else{I.value+=" "+e.unitOfMeasure.valueHighlighted;}I.valueWithoutWhyfound+=" "+e.unitOfMeasure.valueFormatted;}if(e.description){if(u===undefined){u=!(e.metadata.isFirstName||e.metadata.isLastName||e.description.metadata.isFirstName||e.description.metadata.isLastName);}var f=(o.suppressHighlightedValues||!e.description.valueHighlighted)?e.description.valueFormatted:e.description.valueHighlighted;var t=e.metadata.descriptionTextArrangement;if(t==A.TextOnly&&f==e.description.valueFormatted&&I.value!=e.valueFormatted){t=A.TextFirst;}I.value=this._concatenateAttrValueAndDescriptionAccordingToArrangement(I.value,f,t,u);I.valueWithoutWhyfound=this._concatenateAttrValueAndDescriptionAccordingToArrangement(I.valueWithoutWhyfound,e.description.valueFormatted,t,u);}I.key=e.id;I.isTitle=false;I.isSortable=e.metadata.isSortable;I.attributeIndex=i;I.displayOrder=e.metadata.usage.Detail&&e.metadata.usage.Detail.displayOrder;I.whyfound=e.isHighlighted;if(e.defaultNavigationTarget){I.defaultNavigationTarget=new c(e.defaultNavigationTarget);}if(e.metadata.type===d.Longtext){I.longtext=e.value;}if(e.metadata.format&&e.metadata.format===d.Multilinetext){I.longtext=e.value;}return I;},_formatBasedOnGroupTemplate:function(t,e,v){if(!(t&&e&&v)){return"";}var f="",p=0;var g,r=/{\w+}/gi;while((g=r.exec(t))!==null){f+=t.substring(p,g.index);var h=g[0].slice(1,-1);f+=e[h]&&e[h][v]||"";p=r.lastIndex;}f+=t.substring(p);return f;},_concatenateAttrValueAndDescriptionAccordingToArrangement:function(e,f,g,u){if(e.trim().length==0&&f.trim().length==0){return"";}u=u!=undefined?u:true;switch(g){case A.TextOnly:return f;case A.TextSeparate:return e+" "+f;case A.TextFirst:if(e.trim().length==0){return f;}if(u){e="("+e+")";}return f+" "+e;case A.TextLast:default:if(f.trim().length==0){return e;}if(u){f="("+f+")";}return e+" "+f;}},_formatResultForDocuments:function(r,e){var k='';e.isDocumentConnector=false;var j,f;for(j=0;j<r.detailAttributes.length;j++){f=r.detailAttributes[j];if(f.metadata.id==='FILE_PROPERTY'){e.isDocumentConnector=true;}if(f.metadata.isKey===true){if(k.length>0){k+=';';}k=k+f.metadata.id+'='+f.value;}}if(e.isDocumentConnector===true){var g=';o=sid('+r.dataSource.system+'.'+r.dataSource.client+')';var h=r.dataSource.id;e.imageUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+g+"/FileLoaderFiles(ConnectorId='"+h+"',FileType='ThumbNail',SelectionParameters='"+k+"')/$value";e.titleUrl="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+g+"/FileLoaderFiles(ConnectorId='"+h+"',FileType='BinaryContent',SelectionParameters='"+k+"')/$value";var i="/sap/opu/odata/SAP/ESH_SEARCH_SRV"+g+"/FileLoaderFiles(ConnectorId='"+h+"',FileType='SUVFile',SelectionParameters='"+k+"')/$value";e.suvlink='/sap/bc/ui5_ui5/ui2/ushell/resources/sap/fileviewer/viewer/web/viewer.html?file='+encodeURIComponent(i);if(!r.navigationObjects){r.navigationObjects=[];}var n=new b({text:"Show Document",href:e.suvlink,target:"_blank"});r.navigationObjects.push(n);for(j=0;j<r.detailAttributes.length;j++){f=r.detailAttributes[j];if(f.id=='PHIO_ID_THUMBNAIL'&&f.value){e.containsThumbnail=true;}if(f.id=='PHIO_ID_SUV'&&f.value){e.containsSuvFile=true;}}}},_formatResultForNotes:function(r,e){}};return m;});
