sinaDefine(['../../../sina/SinaObject'],function(S){"use strict";return S.derive({_init:function(){},parseCDSAnnotationsForDataSource:function(d,c){var p={dataSourceIsCdsBased:false,detailAttributesAreSorted:false,titleAttributesAreSorted:false};var i,a,b,e,u,f,g,h;var j={};var k={};var l={};var m=[];var n=[];var o=[];var q;var r;var s={};var t=[];for(i=0;i<d.attributesMetadata.length;i++){e=d.attributesMetadata[i];l[e.id]=e;var v=c.attributeAnnotations[e.id]||{};if(Object.keys(v).length>0){p.dataSourceIsCdsBased=true;if((b=v["UI.IDENTIFICATION.URL"])!==undefined){if(v["SEMANTICS.IMAGEURL"]!==undefined){var w=c.attributeAnnotations[b];var x=w["SEMANTICS.URL.MIMETYPE"];if(w&&x){g=d.attributeMetadataMap[b];var y=d.attributeMetadataMap[x];e.suvUrlAttribute=g;e.suvMimeTypeAttribute=y;e.format=this.sina.AttributeFormatType.DocumentThumbnail;}}}if((b=v["UI.CONNECTEDFIELDS.QUALIFIER"])!==undefined){r=s[b];if(!r){r=this.sina._createAttributeGroupMetadata({id:b,label:v["UI.CONNECTEDFIELDS.GROUPLABEL"],template:v["UI.CONNECTEDFIELDS.TEMPLATE"],attributes:{},usage:{}});s[b]=r;t.push(r);}else{if(v["UI.CONNECTEDFIELDS.GROUPLABEL"]&&!r.label){r.label=v["UI.CONNECTEDFIELDS.GROUPLABEL"];}if(v["UI.CONNECTEDFIELDS.TEMPLATE"]&&!r.template){r.template=v["UI.CONNECTEDFIELDS.TEMPLATE"];}}r.attributes[v["UI.CONNECTEDFIELDS.NAME"]]=e;e.group=r;e.nameInGroup=v["UI.CONNECTEDFIELDS.NAME"];}if((b=v["UI.IDENTIFICATION.POSITION"])!==undefined||(b=v["UI.IDENTIFICATION.IMPORTANCE"]&&Number.MAX_VALUE)){switch(v["UI.IDENTIFICATION.IMPORTANCE"]){case"HIGH":case"MEDIUM":case undefined:h=this._parsePosition(b);var _=e;if(e.group){if(e.group.usage&&e.group.usage._Detail){break;}_=e.group;}_.usage=e.usage||{};_.usage._Detail=e.usage._Detail||{};_.usage._Detail.displayOrder=h;if(v["UI.IDENTIFICATION.IMPORTANCE"]=="HIGH"){m.push(_);}else if(v["UI.IDENTIFICATION.IMPORTANCE"]=="MEDIUM"){n.push(_);}else{o.push(_);}break;}}if(v["SEMANTICS.CONTACT.PHOTO"]!==undefined){e.format=this.sina.AttributeFormatType.Round;e.type=this.sina.AttributeType.ImageUrl;}if(v["SEMANTICS.IMAGEURL"]!==undefined){e.type=this.sina.AttributeType.ImageUrl;}if(v["SEMANTICS.NAME.GIVENNAME"]!==undefined){e.isFirstName=true;}if(v["SEMANTICS.NAME.FAMILYNAME"]!==undefined){e.isLastName=true;}if(v["SEMANTICS.EMAIL.ADDRESS"]!==undefined){e.isEmailAddress=true;}if(v["SEMANTICS.TELEPHONE.TYPE"]!==undefined){e.isPhoneNr=true;}if(v["SEMANTICS.URL"]!==undefined){e.isHTTPURL=true;}if(v["SEMANTICS.CURRENCYCODE"]!==undefined){e.isCurrency=true;}if(v["SEMANTICS.UNITOFMEASURE"]!==undefined){e.isUnitOfMeasure=true;}if((b=v["SEMANTICS.QUANTITY.UNITOFMEASURE"])!==undefined){e.isQuantity=true;u=l[b];if(u){if(u.isUnitOfMeasure){e.unitOfMeasureAttribute=u;}}else{j[b]=j[b]||[];j[b].push({attribute:e,annotationName:"SEMANTICS.QUANTITY.UNITOFMEASURE"});}}if((b=v["SEMANTICS.AMOUNT.CURRENCYCODE"])!==undefined){u=l[b];if(u){if(u.isCurrency){e.unitOfMeasureAttribute=u;}}else{j[b]=j[b]||[];j[b].push({attribute:e,annotationName:"SEMANTICS.AMOUNT.CURRENCYCODE"});}}if((b=v["OBJECTMODEL.TEXT.ELEMENT"])!==undefined){f=l[b];if(f){f.isDescription=true;e.descriptionAttribute=f;}else{k[b]=k[b]||[];k[b].push(e);}var z=v["UI.TEXTARRANGEMENT"];if(z){switch(z.toUpperCase()){case"TEXT_FIRST":e.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextFirst;break;case"TEXT_LAST":e.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextLast;break;case"TEXT_ONLY":e.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextOnly;break;case"TEXT_SEPARATE":e.descriptionTextArrangement=this.sina.AttributeDescriptionTextArrangement.TextSeparate;break;}}else{e.descriptionTextArrangement=q;}}if(v["UI.MULTILINETEXT"]!==undefined){e.format=this.sina.AttributeFormatType.MultilineText;}}}d.attributesMetadata=d.attributesMetadata.concat(t);var A=this._createSortFunction("_Detail");if(m.length>0||n.length>0){if(m.length>0){p.dataSourceIsCdsBased=true;}m.sort(A);n.sort(A);var B=m.concat(n);for(i=0;i<B.length;++i){B[i].usage.Detail=B[i].usage._Detail;B[i].usage.Detail.displayOrder=i;}p.detailAttributesAreSorted=true;}else if(o.length>0){p.dataSourceIsCdsBased=true;o.sort(A);for(i=0;i<o.length;++i){o[i].usage.Detail=o[i].usage._Detail;o[i].usage.Detail.displayOrder=i;}p.detailAttributesAreSorted=true;}for(var C in j){u=d.attributeMetadataMap[C];if(u){var D=j[C];for(i=0;i<D.length;i++){e=D[i].attribute;a=D[i].annotationName;if((a.toUpperCase()=="SEMANTICS.QUANTITY.UNITOFMEASURE"&&u.isUnitOfMeasure)||(a.toUpperCase()=="SEMANTICS.AMOUNT.CURRENCYCODE"&&u.isCurrency)){e.unitOfMeasureAttribute=u;}}}}for(var E in k){f=d.attributeMetadataMap[E];if(f){f.isDescription=true;var F=k[E];for(i=0;i<F.length;i++){e=F[i];e.descriptionAttribute=f;}}}if(Object.keys(c.dataSourceAnnotations).length>0){if((b=c.dataSourceAnnotations["UI.HEADERINFO.TITLE.VALUE"])!==undefined){var G=d.attributeMetadataMap[b];if(G){if(c.dataSourceAnnotations["UI.HEADERINFO.TITLE.TYPE"]&&c.dataSourceAnnotations["UI.HEADERINFO.TITLE.TYPE"].toUpperCase()=="AS_CONNECTED_FIELDS"){var H=c.dataSourceAnnotations["UI.HEADERINFO.TITLE.VALUEQUALIFIER"];if(H&&H.trim().length>0){r=s[H];if(r&&r==G.group){G=r;}}}G.usage.Title={displayOrder:1};}}if((b=c.dataSourceAnnotations["UI.HEADERINFO.TITLE.URL"])!==undefined){g=d.attributeMetadataMap[b];if(g){g.usage.Navigation={mainNavigation:true};}}if((b=c.dataSourceAnnotations["UI.HEADERINFO.DESCRIPTION.VALUE"])!==undefined){var I=d.attributeMetadataMap[b];if(I){I.usage.TitleDescription={};}}if((b=c.dataSourceAnnotations["UI.TEXTARRANGEMENT"])!==undefined){switch(b.toUpperCase()){case"TEXT_FIRST":q=this.sina.AttributeDescriptionTextArrangement.TextFirst;break;case"TEXT_LAST":q=this.sina.AttributeDescriptionTextArrangement.TextLast;break;case"TEXT_ONLY":q=this.sina.AttributeDescriptionTextArrangement.TextOnly;break;case"TEXT_SEPARATE":q=this.sina.AttributeDescriptionTextArrangement.TextSeparate;break;}}}return p;},_createSortFunction:function(u){return function(a,b){if(a.usage[u].displayOrder<b.usage[u].displayOrder){return-1;}else if(a.usage[u].displayOrder>b.usage[u].displayOrder){return 1;}else{return 0;}};},_parsePosition:function(p){if(typeof p==='string'){try{p=parseInt(p,10);}catch(e){p=Number.MAX_VALUE;}}else if(typeof p!=='number'){p=Number.MAX_VALUE;}return p;}});});
