// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/ui5service/ShellUIService","sap/ui/Device","sap/ushell/CanvasShapesManager","./AccessKeysHandler","./History","sap/ushell/components/applicationIntegration/AppLifeCycle","sap/ushell/services/AppConfiguration","sap/ushell/services/AppType","sap/ushell/services/Message","sap/ushell/ui/launchpad/Fiori2LoadingDialog","sap/ushell/utils","sap/ushell/resources","sap/ushell/UserActivityLog","sap/ushell/EventHub","sap/ushell/Config","sap/ui/core/Component","jquery.sap.storage","sap/ushell/utils/WindowUtils"],function(S,D,C,A,H,a,b,c,M,F,u,r,U,E,d,f,g,W){"use strict";var h=true,p=false,B=false,s,j=a.getElementsModel(),m,o={embedded:0,newWindowThenEmbedded:1,newWindow:1,replace:0},n={embedded:"embedded",newWindowThenEmbedded:"newWindowThenEmbedded",newWindow:"newWindow",replace:"replace"},k={};sap.ui.controller("sap.ushell.renderers.fiori2.Shell",{_aDoableObjects:[],onComponentTargetDisplay:function(e){var P=e.getParameters(),i=P.control,l=P.object;i.navTo("centerViewPort",l.getId(),"show");},onInit:function(){var e=this.getView().updateShellAggregation;sap.ui.getCore().byId("shell-header").updateAggregation=e;sap.ui.getCore().byId("shell").updateAggregation=e;sap.ui.getCore().byId("right-floating-container").updateAggregation=e;sap.ui.getCore().byId("shell-split").updateAggregation=e;var R=f.getOwnerComponentFor(this.getView()).getRouter();R.getTarget("home").attachDisplay(this.onComponentTargetDisplay);R.getTarget("appfinder").attachDisplay(this.onComponentTargetDisplay);R.initialize(true);this.bEnableHashChange=true;B=false;h=true;var v=this.getView();var i=window.matchMedia("(min-width: 600px)"),l;var k=(v.getViewData()?v.getViewData().config:{})||{};a.parseStatefulContainerConfiguration(k.statefulApplicationContainer);this.oEndUserFeedbackConfiguration={showAnonymous:true,anonymousByDefault:true,showLegalAgreement:true,showCustomUIContent:true,feedbackDialogTitle:true,textAreaPlaceholder:true,customUIContent:undefined};k["enableBackGroundShapes"]=k.enableBackGroundShapes===undefined?true:k.enableBackGroundShapes;this.initShellModel(k);l=function(w){d.emit("/core/shell/model/isPhoneWidth",!w.matches);};if(i.addListener){i.addListener(l);l(i);}v.setModel(r.i18nModel,"i18n");v.oShellHeader.setModel(m);v.oShellHeader.setModel(r.i18nModel,"i18n");sap.ui.getCore().getEventBus().subscribe("externalSearch",this.externalSearchTriggered,this);this._setConfigurationToModel();this._aDoableObjects=this._registerAndCreateEventHubDoables(k);sap.ushell.Container.getService("AppLifeCycle");s.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);this.history=new H();this.oViewPortContainer=sap.ui.getCore().byId("viewPortContainer");a.init(k.appState,this.oViewPortContainer,k.rootIntent,k.disableHomeAppCache,{ownerComponent:this.getOwnerComponent()},k.storageSize?k.storageSize:10);this.oNotificationsCountButton=sap.ui.getCore().byId("NotificationsCountButton");this.oFiori2LoadingDialog=sap.ui.getCore().byId("Fiori2LoadingDialog");var q=function(w){this.oShellNavigation=w;this.oShellNavigation.registerExtraRouter(R);this.oShellNavigation.registerNavigationFilter(this._handleEmptyHash.bind(this));this.oShellNavigation.init(this.doHashChange.bind(this));this.oShellNavigation.registerNavigationFilter(this._disableSourceAppRouter.bind(this));this.oShellNavigation.registerNavigationFilter(this.handleDataLoss.bind(this));this.oShellNavigation.registerNavigationFilter(this._savePreviousHash.bind(this));this._previousHash=null;E.emit("ShellNavigationInitialized");}.bind(this);Promise.all([sap.ushell.Container.getServiceAsync("URLParsing"),sap.ushell.Container.getServiceAsync("URLShortening")]).then(function(){return sap.ushell.Container.getServiceAsync("ShellNavigation");}).then(q);sap.ushell.Container.setLogonFrameProvider(this._getLogonFrameProvider());A.init(m);window.onbeforeunload=function(){if(sap.ushell.Container&&sap.ushell.Container.getDirtyFlag()){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}return r.browserI18n.getText("dataLossExternalMessage");}};if(d.last("/core/shell/model/contentDensity")){a.getAppMeta()._applyContentDensityClass();}D.media.attachHandler(this.onScreenSizeChange,this,D.media.RANGESETS.SAP_STANDARD);this.onScreenSizeChange(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));D.orientation.attachHandler(function(){var w=sap.ui.getCore().byId('viewPortContainer');if(w&&w.getCurrentState()!=="Center"){w.switchState("Center");}});this.initShellUIService();sap.ui.getCore().attachThemeChanged(this.redrawBackGroundShapes);if(k.sessionTimeoutIntervalInMinutes){var L=20000,t=this;setTimeout(function(){t._createSessionHandler(k);},L);}this.oViewPortContainer.onfocusin=function(){A.bFocusOnShell=false;A.bFocusPassedToExternalHandlerFirstTime=false;};this.oViewPortContainer.onfocusout=function(){A.bFocusOnShell=true;A.bFocusPassedToExternalHandlerFirstTime=true;};},shellUpdateAggItem:function(i,e){return sap.ui.getCore().byId(e.getObject());},_registerAndCreateEventHubDoables:function(k){var e=[E.once("CenterViewPointContentRendered").do(this._loadCoreExt.bind(this)),E.on("AppRendered").do(this.setBackGroundShapes.bind(this)),E.on("AppRendered").do(this.delayedCloseLoadingScreen.bind(this)),E.once("AppRendered").do(this._loadCoreExtNonUI5.bind(this)),E.on("toggleContentDensity").do(this.toggleContentDensity.bind(this)),E.on("ShellFloatingContainerDockedIsResized").do(this._onResizeWithDocking.bind(this)),E.on("LaunchpadCustomRouterRouteMatched").do(this._centerViewPort.bind(this)),E.once("CoreResourcesComplementLoaded").do(this._onCoreResourcesComplementLoaded.bind(this)),E.once("RendererExtensionPluginsLoaded").do(this._onRendererExtensionPluginsLoaded.bind(this)),E.join(E.once("RendererExtensionPluginsLoaded"),E.once("firstSegmentCompleteLoaded"),E.once("ShellComplete")).do(this._loadWarmupPlugins.bind(this))];if(k&&k.moveEditHomePageActionToShellHeader){e.push(E.on("showCatalog").do(this._hideEditButton.bind(this)));}return e;},initShellModel:function(k){s=j;s.init(k,a.shellElements().model());m=this.getView().getViewData().shellModel;d.emit("/core/shell/model/personalization",d.last("/core/shell/enablePersonalization"));},redrawBackGroundShapes:function(){if(k.enableBackGroundShapes){C.drawShapes();}},setBackGroundShapes:function(){var e=d.last("/core/shell/model/animationMode")!=='minimal';if(!B&&k.enableBackGroundShapes){B=true;C.drawShapes();C.enableAnimationDrawing(e);}},initShellUIService:function(){a.initShellUIService({fnOnBackNavigationChange:this.onBackNavigationChange.bind(this)});if(k.enableOnlineStatus){sap.ui.require(["sap/ushell/ui5service/UserStatus"],function(e){this.oUserStatus=new e({scopeObject:this.getOwnerComponent(),scopeType:"component"});this.oUserStatus.attachEnabledStatusChanged(function(i){d.emit("/core/shell/model/userStatusEnabled",i.mParameters.data);}.bind(this));this.oUserStatus.attachStatusChanged(function(i){var l=i.mParameters.data;d.emit("/core/shell/model/userStatus",l);if(l===null){d.emit("/core/shell/model/userStatusUserEnabled",false);}else{d.emit("/core/shell/model/userStatusUserEnabled",true);}}.bind(this));}.bind(this));}},onBackNavigationChange:function(e){this.isBackNavigationChanged=true;var i=e.getParameters().data,l=d.last("/core/shell/model/currentState");if(i){a.service().setNavigateBack(i);if(l.stateName==='minimal'||l.stateName==='standalone'||l.stateName==='embedded'){sap.ushell.Container.getRenderer('fiori2').showHeaderItem('backBtn',true);}}else{a.service().resetNavigateBack();}},toggleContentDensity:function(e){var i=e.contentDensity==="compact";a.getAppMeta()._applyContentDensityByPriority(i);},_handleEmptyHash:function(e){e=(typeof e==="string")?e:"";e=e.split("?")[0];if(e.length===0){var v=this.getView()?this.getView().getViewData():{};k=v.config||{};if(k.migrationConfig){return this.oShellNavigation.NavigationFilterStatus.Continue;}if(k.rootIntent){setTimeout(function(){window.hasher.setHash(k.rootIntent);},0);return this.oShellNavigation.NavigationFilterStatus.Abandon;}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_setConfigurationToModel:function(){var v=this.getView().getViewData();if(v){k=v.config||{};}if(k){if(k.states){j.extendStates(k.states);}if(k.changeEndUserFeedbackTitle!==undefined){this.oEndUserFeedbackConfiguration.feedbackDialogTitle=k.changeEndUserFeedbackTitle;}if(k.changeEndUserFeedbackPlaceholder!==undefined){this.oEndUserFeedbackConfiguration.textAreaPlaceholder=k.changeEndUserFeedbackPlaceholder;}if(k.showEndUserFeedbackAnonymousCheckbox!==undefined){this.oEndUserFeedbackConfiguration.showAnonymous=k.showEndUserFeedbackAnonymousCheckbox;}if(k.makeEndUserFeedbackAnonymousByDefault!==undefined){this.oEndUserFeedbackConfiguration.anonymousByDefault=k.makeEndUserFeedbackAnonymousByDefault;}if(k.showEndUserFeedbackLegalAgreement!==undefined){this.oEndUserFeedbackConfiguration.showLegalAgreement=k.showEndUserFeedbackLegalAgreement;}if(k.enableSetTheme!==undefined){m.setProperty("/setTheme",k.enableSetTheme);}m.setProperty("/contentDensity",k.enableContentDensity===undefined?true:k.enableContentDensity);if(k.title){m.setProperty("/title",k.title);}if(k.migrationConfig!==undefined){m.setProperty("/migrationConfig",k.migrationConfig);}if(k.enableUserDefaultParameters!==undefined){m.setProperty("/userDefaultParameters",k.enableUserDefaultParameters);}if(k.disableHomeAppCache!==undefined){m.setProperty("/disableHomeAppCache",k.disableHomeAppCache);}m.setProperty("/enableHelp",d.last("/core/extension/enableHelp"));m.setProperty("/searchAvailable",(k.enableSearch!==false));m.bindProperty('/animationMode').attachChange(this.handleAnimationModeChange.bind(this));m.setProperty("/animationMode",k.animationMode);this._getPersData({container:"flp.launchpad.animation.mode",item:"animationMode"}).then(function(e){m.setProperty("/animationMode",e?e:k.animationMode);k.animationMode=e?e:k.animationMode;});this._getPersData({container:"flp.settings.FlpSettings",item:"userActivitesTracking"}).then(function(e){if(e===undefined){e=true;}m.setProperty("/enableTrackingActivity",e);}).catch(function(e){jQuery.sap.log.error("Failed to ltracking activities state state from the personalization",e,"sap.ushell.components.flp.settings.FlpSettings");});}},_hideEditButton:function(){var e=sap.ui.getCore().byId("ActionModeBtn");if(e){e.setVisible(false);}},_getPreviousPageDirty:function(){return p;},_setPreviousPageDirty:function(e){p=e;},getModelConfiguration:function(){var v=this.getView().getViewData(),e,i;if(v){e=v.config||{};i=jQuery.extend({},e);}delete i.applications;return i;},_getLogonFrameProvider:function(){var v=this.getView();return{create:function(){return v.createIFrameDialog();},show:function(){v.showIFrameDialog();},destroy:function(){v.destroyIFrameDialog();}};},onExit:function(){this._aDoableObjects.forEach(function(l){l.off();});sap.ui.getCore().getEventBus().unsubscribe("externalSearch",this.externalSearchTriggered,this);D.media.detachHandler(this.onScreenSizeChange,this,D.media.RANGESETS.SAP_STANDARD);if(this.oShellNavigation){this.oShellNavigation.hashChanger.destroy();}var e=this.getView().aDanglingControls;if(e){e.forEach(function(l){if(l.destroyContent){l.destroyContent();}l.destroy();});}var i=this.getView().oShellHeader;if(i&&i.destroy){i.destroy();}U.deactivate();s.destroy();a.shellElements().clean();a.destroy();s=undefined;this.bEnableHashChange=true;},handleAnimationModeChange:function(){var e=d.last("/core/shell/model/animationMode"),i=e!=='minimal';C.enableAnimationDrawing(i);sap.ui.getCore().getEventBus().publish("launchpad","animationModeChange",{sActionMode:e});},getAnimationType:function(){return"show";},_getCurrentAppRouter:function(){var e=sap.ushell.Container.getService("AppLifeCycle"),i=e&&e.getCurrentApplication&&e.getCurrentApplication(),l=i&&i.componentInstance;if(l){return l.getRouter();}return null;},_disableSourceAppRouter:function(e,i){if(!this.bEnableHashChange){return this.oShellNavigation.NavigationFilterStatus.Continue;}var l=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,i);if(!l){var q=this._getCurrentAppRouter();if(q){q.stop();}}return this.oShellNavigation.NavigationFilterStatus.Continue;},_resumeAppRouterIgnoringCurrentHash:function(){var e=this._getCurrentAppRouter();if(e){e.initialize(true);}},handleDataLoss:function(e,i){if(!this.bEnableHashChange){this.bEnableHashChange=true;this.closeLoadingScreen();return this.oShellNavigation.NavigationFilterStatus.Custom;}if(sap.ushell.Container.getDirtyFlag()){if(!r.browserI18n){r.browserI18n=r.getTranslationModel(window.navigator.language).getResourceBundle();}if(confirm(r.browserI18n.getText("dataLossInternalMessage"))){sap.ushell.Container.setDirtyFlag(false);p=true;return this.oShellNavigation.NavigationFilterStatus.Continue;}this._resumeAppRouterIgnoringCurrentHash();if(this._previousHash===e){this.bEnableHashChange=false;window.hasher.setHash(i);return this.oShellNavigation.NavigationFilterStatus.Custom;}var l=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,i);var w=this.oShellNavigation.wasHistoryEntryReplaced();if(l&&w){return{status:this.oShellNavigation.NavigationFilterStatus.Custom,hash:i};}this.bEnableHashChange=false;window.history.back(1);return this.oShellNavigation.NavigationFilterStatus.Custom;}return this.oShellNavigation.NavigationFilterStatus.Continue;},_savePreviousHash:function(e,i){var l=this.oShellNavigation.hashChanger.isInnerAppNavigation(e,i);var w=this.oShellNavigation.wasHistoryEntryReplaced();if(l&&w){return this.oShellNavigation.NavigationFilterStatus.Continue;}this._previousHash=i;return this.oShellNavigation.NavigationFilterStatus.Continue;},_isColdStart:function(){var R=sap.ushell.Container.getRenderer('fiori2');var N=!R||!R.getCurrentCoreView();if(this.history.getHistoryLength()<=1&&N){return true;}this._isColdStart=function(){return false;};return false;},_setEnableHashChange:function(v){this.bEnableHashChange=v;},_logRecentActivity:function(R){return b.addActivity(R);},_logApplicationUsage:function(e){if(sap.ushell.Container){sap.ushell.Container.getServiceAsync("UserRecents").then(function(i){i.addAppUsage(e);});}},doHashChange:function(e,i,O,l,P){jQuery.sap.measure.start("FLP:ShellController.doHashChange","doHashChange","FLP");u.addTime("ShellControllerHashChange");return this._doHashChange(this,e,i,O,l,P).then(function(){jQuery.sap.measure.end("FLP:ShellController.doHashChange");},function(v){jQuery.sap.measure.end("FLP:ShellController.doHashChange");});},_doHashChange:function(e,i,l,O,q,P){var I,t,v;if(!this.bEnableHashChange){this.bEnableHashChange=true;e.closeLoadingScreen();return jQuery.when();}if(P){e.hashChangeFailure(e.history.getHistoryLength(),P.message,null,"sap.ushell.renderers.fiori2.Shell.controller",false);return jQuery.when();}if(sap.m.InstanceManager&&h){sap.m.InstanceManager.closeAllDialogs();sap.m.InstanceManager.closeAllPopovers();}h=true;e.openLoadingScreen();if(u.getParameterValueBoolean("sap-ushell-no-ls")){e.closeLoadingScreen();}t=e.history.getHistoryLength();v=e.fixShellHash(i);e.history.hashChange(v,O);e.currentAppBeforeNav=b.getCurrentApplication();jQuery.sap.flpmeasure.end(0,"Creating Shell");jQuery.sap.flpmeasure.start(0,"targetResolution",1);return e._resolveHashFragment(v).then(function(R,w){jQuery.sap.flpmeasure.end(0,"targetResolution");jQuery.sap.flpmeasure.start(0,"CreateComponent",3);var x=w?w.semanticObject+"-"+w.action:"",k=e._getConfig(),y=!!(R&&R.componentHandle),T=R&&R.ui5ComponentName;R=e._calculateNavigationMode(w,R);if(R&&(R.navigationMode===n.newWindow||u.isNativeWebGuiNavigation(R))){e.logOpenAppAction(v,R,l);e._openAppInNewWindowAndRestore(R);return;}if(d.last("/core/shell/model/migrationConfig")){k.migrationConfig=false;e.getModel().setProperty("/migrationConfig",false);if(R&&v==='#'){k.rootIntent="";}else if(v==='#'){setTimeout(function(){window.hasher.setHash(k.rootIntent);},0);return;}}if(k&&k.applications&&k.applications[x]){R.applicationConfiguration=k.applications[x];}I=a.getInMemoryInstance(x,v);if(I.isInstanceSupported){e._initiateApplication(R,v,w,t,l);return;}else{if(y||!T){e._initiateApplication(R,v,w,t,l);return;}a.destroy(I.appId,I.container);}a.removeApplication(x);b.setApplicationInInitMode();sap.ui.getCore().getEventBus().publish("ApplicationContainer","_prior.newUI5ComponentInstantion",{name:T});jQuery.sap.measure.start("FLP:ShellController.UI5createComponent","UI5 createComponent","FLP");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){a.createComponent(R,w).done(function(z){jQuery.sap.measure.end("FLP:ShellController.UI5createComponent");jQuery.sap.flpmeasure.end(0,"CreateComponent");e._initiateApplication(R,v,w,t,l);}).fail(function(z){var G=r.i18n.getText("cannot_load_ui5_component_details",[v]),J="Failed to load UI5 component for navigation intent "+v;b.setCurrentApplication(e.currentAppBeforeNav);e.hashChangeFailure(t,{title:r.i18n.getText("error"),message:r.i18n.getText("failed_to_open_ui5_component"),technicalMessage:J},{info:G,technicalMessage:z.message+"\n"+z.stack},"sap.ushell.renderers.fiori2.Shell.controller",false);});});},function(w){var x=r.i18n.getText("cannot_resolve_navigation_target_details",[v]),y="Failed to resolve navigation target: "+v+". This is most likely caused by an incorrect SAP Fiori launchpad content configuration or by missing role assignment.";e.hashChangeFailure(t,{title:r.i18n.getText("error"),message:r.i18n.getText("failed_to_open_app_missing_configuration_or_role_assignment"),technicalMessage:y},{info:x,fixedShellHash:v,technicalMessage:w},"sap.ushell.renderers.fiori2.Shell.controller",false);});},_initiateApplication:function(R,e,P,O,i){jQuery.sap.measure.start("FLP:ShellController._initiateApplication","_initiateApplication","FLP");var l=b.getMetadata(R),q=d.last("/core/extension/SupportTicket");if(l.title){window.document.title=l.title;}else{jQuery.sap.log.debug("Shell controller._initiateApplication: the title of the window is not changed because most probably the application was resolved with undefined");}if(q){setTimeout(function(){sap.ushell.UserActivityLog.activate();},0);}var N=false;try{this.navigate(P,e,l,R);N=true;}catch(t){if(t.stack){jQuery.sap.log.error("Application initialization (Intent: \n"+e+"\n failed due to an Exception:\n"+t.stack);}this.hashChangeFailure(O,t.name,t.message,l?l.title:"",false);}if(N){this.logOpenAppAction(e,R,i);}jQuery.sap.measure.end("FLP:ShellController._initiateApplication");},_resolveHashFragment:function(e){jQuery.sap.measure.start("FLP:ShellController._resolveHashFragment","_resolveHashFragment","FLP");var R,P,i=sap.ushell.Container.getService("URLParsing").parseShellHash(e),l=new jQuery.Deferred(),k=this._getConfig();P=i&&i.params||{};if(i&&i.contextRaw&&i.contextRaw==="navResCtx"&&P&&P.additionalInformation&&(P.additionalInformation[0]||P.additionalInformation[0]==="")&&P.applicationType&&P.applicationType[0]&&P.url&&P.url[0]&&P.navigationMode&&(P.navigationMode[0]||P.additionalInformation[0]==="")){P=i.params||{};R={additionalInformation:P.additionalInformation[0],applicationType:P.applicationType[0],url:P.url[0],navigationMode:P.navigationMode[0]};if(P.title){R.text=P.title[0];}l.resolve(R,i);}else{if(window["sap-ushell-async-libs-promise-directstart"]){window["sap-ushell-async-libs-promise-directstart"].then(function(q){l.resolve(q.resolvedHashFragment,i);delete window["sap-ushell-async-libs-promise-directstart"];},function(q){l.reject(q);delete window["sap-ushell-async-libs-promise-directstart"];});return l.promise();}sap.ushell.Container.getService("NavTargetResolution").resolveHashFragment(e).done(function(R){if(i&&(i.semanticObject+"-"+i.action)===k.rootIntent){R.navigationMode="embedded";}jQuery.sap.measure.end("FLP:ShellController._resolveHashFragment");l.resolve(R,i);}).fail(function(q){l.reject(q);});}return l.promise();},_calculateNavigationMode:function(P,R){if(!R){return undefined;}var N=R.navigationMode;if(N===n.newWindowThenEmbedded){if(this._isColdStart()||(P.contextRaw&&P.contextRaw==="navResCtx")||this.history.backwards){R.navigationMode=n.embedded;}else{R.navigationMode=n.newWindow;if(!u.isNativeWebGuiNavigation(R)){R.url=this._getCurrentLocationHash();}}return R;}if(N===n.newWindow&&this._isColdStart()){R.navigationMode=n.replace;return R;}return R;},_usesNavigationRedirect:function(e){if(!e){return new jQuery.Deferred().reject().promise();}var t=this,i=e.getInstance({});if(i&&typeof i.navigationRedirect==="function"){var l=new jQuery.Deferred();var N=i.navigationRedirect();if(N&&typeof N.then==="function"){N.then(function(q){jQuery.sap.log.warning("Performing navigation redirect to hash "+q);i.destroy();t.history.pop();sap.ushell.Container.getService("ShellNavigation").toExternal({target:{shellHash:q}},undefined,false);l.resolve(true);},function(){l.reject();});return l.promise();}}return new jQuery.Deferred().reject().promise();},navigate:function(P,e,i,R){jQuery.sap.measure.start("FLP:ShellController.navigate","navigate","FLP");var N=(jQuery.isPlainObject(R)?R.navigationMode:null),t=this;if(N===null){if(this._isColdStart()){window.hasher.setHash("");return;}this.bEnableHashChange=false;this.history.pop();this._windowHistoryBack(1);return;}R=this._calculateNavigationMode(P,R);N=(jQuery.isPlainObject(R)?R.navigationMode:null);if(N===n.embedded){var l=this._usesNavigationRedirect(R.componentHandle);l.then(null,function(){t._handleEmbeddedNavMode(e,P,i,R);if(P&&P.contextRaw==="navResCtx"){jQuery.sap.log.error(" This path will no longer be supported in 1.40");t.bEnableHashChange=false;if(P&&P.params&&P.params.original_intent&&P.params.original_intent[0]){window.hasher.replaceHash(P.params.original_intent[0]);t.history._history[0]=P.params.original_intent[0];}}});jQuery.sap.measure.end("FLP:ShellController.navigate");return;}if(N===n.replace){this.bEnableHashChange=false;this._changeWindowLocation(R.url);return;}if(N===n.newWindow){this._openAppInNewWindowAndRestore(R);return;}this.hashChangeFailure(this.history.getHistoryLength(),"Navigation mode is not recognized",null,"sap.ushell.renderers.fiori2.Shell.controller",false);},_openAppInNewWindowAndRestore:function(R){this.bEnableHashChange=false;if(u.isNativeWebGuiNavigation(R)){try{var i=u.appendUserIdToUrl("sap-user",R.url);var l=u.getPrivateEpcm();var q=o[R.navigationMode];if(u.hasNavigationModeCapability()){l.doNavigate(i,q||o[n.embedded]);}else{l.doNavigate(i);}}catch(e){if(e.stack){jQuery.sap.log.error("Application initialization failed due to an Exception:\n"+e.stack);}this.hashChangeFailure(this.history.getHistoryLength(),e.name,e.message,R.text,false);}}else{this._openAppNewWindow(R.url);}this.history.pop();var v=R.componentHandle&&R.componentHandle.getInstance&&R.componentHandle.getInstance({});if(v){v.destroy();}this._resumeAppRouterIgnoringCurrentHash();this._windowHistoryBack(1);b.setCurrentApplication(this.currentAppBeforeNav);return;},_handleEmbeddedNavMode:function(e,P,i,R){jQuery.sap.measure.start("FLP:ShellController._handleEmbeddedNavMode","_handleEmbeddedNavMode","FLP");var l,I,q;this.resetShellUIServiceHandlers();a.getAppMeta().setAppIcons(i);l='-'+P.semanticObject+'-'+P.action;I=e==="#"||(k.rootIntent&&k.rootIntent===P.semanticObject+"-"+P.action);q=P?P.semanticObject+"-"+P.action:"";a.switchViewState(a.shellElements().calculateElementsState(I?"home":"app",R.applicationType,k.appState,R.explicitNavMode),undefined,l);if(I){a.getShellUIService().setBackNavigation();}this._handleHomeAndBackButtonsVisibility();a.handleControl(q,l,P,R,this.getWrappedApplicationWithMoreStrictnessInIntention.bind(this),this.closeLoadingScreen.bind(this),e);this.closeLoadingScreen();if(this.currentAppBeforeNav){var t=a.getStatefulContainer(this.currentAppBeforeNav.applicationType);if(t){t.onApplicationOpened(R.applicationType);}}jQuery.sap.measure.end("FLP:ShellController._handleEmbeddedNavMode");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){E.emit("loadCoreResourcesComplement");});},_centerViewPort:function(){this.oViewPortContainer.switchState("Center");},_isShellHomeIntent:function(i){return i==="#"||i===k.rootIntent;},getWrappedApplicationWithMoreStrictnessInIntention:function(i,e,l,R,q,t,v){var w,x=this;setTimeout(function(){setTimeout(function(){var y;if(d.last("/core/shell/model/currentState/stateName")==="app"){y="shellAppTitle";}A.sendFocusBackToShell(y);setTimeout(function(){x.readNavigationEnd();},500);},100);sap.ui.getCore().getEventBus().publish("launchpad","appOpening",R);jQuery.sap.log.info('app is being opened');},0);if(k.applications){R.applicationConfiguration=k.applications[i];}w=a.getAppContainer(q,R,this._isColdStart(),l,v);R.sShellHash=i;a.publishNavigationStateEvents(w,R,this.onAppAfterRendering.bind(this,R));w.addStyleClass('sapUshellApplicationPage');if(!t){w.addStyleClass("sapUShellApplicationContainerLimitedWidth");}if(this._isDock()&&window.matchMedia('(min-width: 106.4rem)').matches){w.addStyleClass("sapUShellDockingContainer");w.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}else if(this._isDock()){w.removeStyleClass("sapUShellApplicationContainerLimitedWidth");}w.toggleStyleClass('sapUshellDefaultBackground',!e.hideLightBackground);a.getAppMeta()._applyContentDensityByPriority();a.addControl(w);setTimeout(function(){x.closeLoadingScreen();},0);jQuery.sap.measure.end("FLP:ShellController.getWrappedApplication");return w;},resetShellUIServiceHandlers:function(){a.getAppMeta().resetShellUIServiceHandlers();this.isBackNavigationChanged=false;},onAppAfterRendering:function(e){var i=a.getShellUIService();setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell","appOpened",e);jQuery.sap.log.info('app was opened');},0);var l=a._publicEventDataFromResolutionResult(e);E.emit("AppRendered",l);sap.ushell.renderers.fiori2.utils.publishExternalEvent("appOpened",l);if(i){if(!a.getAppMeta().getIsHierarchyChanged()){i.setHierarchy();}if(!a.getAppMeta().getIsTitleChanged()){i.setTitle();}if(!a.getAppMeta().getIsRelatedAppsChanged()){i.setRelatedApps();}if(!this.isBackNavigationChanged){i.setBackNavigation();}}s.updateStateProperty("application/icon",a.getAppMeta().getAppIcon(),true);s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},_saveHomePageComponent:function(){if(this.oHomeApp){return;}var t=this,e="sap.ushell",l=function(i,q,v){t.oHomeApp=v.component;sap.ui.getCore().getEventBus().unsubscribe(e,"appComponentLoaded",l);};sap.ui.getCore().getEventBus().subscribe(e,"appComponentLoaded",l);},hashChangeFailure:function(i,v,e,l,q){if(u.isPlainObject(v)){this.reportError(v.technicalMessage,e.technicalMessage,l);this.closeLoadingScreen();sap.ushell.Container.getService("Message").show(sap.ushell.services.Message.Type.ERROR,v.message,{title:v.title,details:e});}else{this.reportError(v,e,l);this.closeLoadingScreen();this.delayedMessageError(r.i18n.getText("fail_to_start_app_try_later"));}h=false;this._resumeAppRouterIgnoringCurrentHash();if(i===0){window.hasher.setHash("");}else if(jQuery.sap.getUriParameters().get("bFallbackToShellHome")){window.hasher.setHash("");}else{this.bEnableHashChange=q;sap.ushell.Container.setDirtyFlag(p);this._windowHistoryBack(1);}},reportError:function(e,i,l){jQuery.sap.log.error(e,i,l);},delayedMessageError:function(e){setTimeout(function(){if(sap.ushell.Container!==undefined){sap.ushell.Container.getService("Message").error(e);}},0);},fixShellHash:function(e){if(!e){e='#';}else if(e.charAt(0)!=='#'){e='#'+e;}return e;},_openAppNewWindow:function(e){if(e.trim().indexOf("sap-nwbc://")===0&&(D.browser.edge||D.browser.msie)){window.location.href=e;}else{var i=W.openURL(e);if(!i&&!(D.browser.msie||D.browser.edge)){var l=r.i18n.getText("fail_to_start_app_popup_blocker",[window.location.hostname]);this.delayedMessageError(l);}}},_windowHistoryBack:function(i){window.history.back(i);},_changeWindowLocation:function(e){window.location.href=e;},handleEndItemsOverflow:function(P){var e=d.last("/core/shell/model/currentState/headEndItems");if(e.length===1||(e.length===2&&e.indexOf("NotificationsCountButton")!=-1)){return;}function i(){s.removeHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);var l=sap.ui.getCore().byId('headEndItemsOverflow');if(l){l.destroy();}}if(P.name==='Phone'||P.name==='Tablet'){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}else{i();s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else if(P.name==="Desktop"){if(P.showOverFlowBtn){if(e.indexOf("endItemsOverflowBtn")===-1){s.addHeaderEndItem(["endItemsOverflowBtn"],false,["home","app"]);}}else{i();}}},isHeadEndItemOverflow:function(){var e=0,l,q=d.last("/core/shell/model/currentState/headEndItems");if(q.indexOf("endItemsOverflowBtn")===-1){return false;}else{var t=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var v=3;if(t==="Phone"){v=1;}for(var i=0;i<q.length;i++){l=sap.ui.getCore().byId(q[i]);if(l&&l.getVisible()){e++;}}if(sap.ui.getCore().byId("endItemsOverflowBtn").getVisible()){return e>v+1;}else{return e>v;}}},isHeadEndItemInOverflow:function(e){return e!=="ENDITEMSOVERFLOWBTN"&&!this.isHeadEndItemNotInOverflow(e);},isHeadEndItemNotInOverflow:function(e){if(this.isHeadEndItemOverflow()){if(e==="NOTIFICATIONSCOUNTBUTTON"||e==="ENDITEMSOVERFLOWBTN"){return true;}else{var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;if(i==="Tablet"){return e==="SF"||e==="FLOATINGCONTAINERBUTTON";}else if(i==="Desktop"){return e==="SF"||e==="FLOATINGCONTAINERBUTTON"||e==="COPILOTBTN";}else{return i!=="Phone";}}}else if(e==="ENDITEMSOVERFLOWBTN"){return false;}else{return true;}},pressEndItemsOverflow:function(e){var P=sap.ui.getCore().byId('headEndItemsOverflow');function i(){if(P.isOpen()){P.close();}}if(!P){var l=new sap.ui.model.Filter('','EQ','a');l.fnTest=this.isHeadEndItemInOverflow.bind(this);P=new sap.m.Popover("headEndItemsOverflow",{placement:sap.m.PlacementType.Bottom,showHeader:false,showArrow:false,content:{path:"/currentState/headEndItems",filters:[l],factory:function(I,q){var t=sap.ui.getCore().byId(q.getObject()).clone();t.detachPress(i);t.attachPress(i);return t;}}});P.addStyleClass("sapUshellPopupContainer sapMPopoverheadEndItemsOverflow");P.updateAggregation=this.getView().updateShellAggregation;P.setModel(m);this.getView().aDanglingControls.push(P);}if(P.isOpen()){P.close();}else{P.updateAggregation("content");P.openBy(e.getSource());}},externalSearchTriggered:function(e,i,l){d.emit("/core/shell/model/searchTerm",l.searchTerm);l.query=l.searchTerm;},onAfterNavigate:function(e){var t=e.mParameters?e.mParameters.toId:undefined;this.closeLoadingScreen();u.addTime("ShellController.onAfterNavigate");if(t==="application-"+k.rootIntent){var i=sap.ui.getCore().byId("configBtn");if(i){i.focus();}}a.onAfterNavigate(e.getParameter("fromId"),e.getParameter("from"),t);},logOpenAppAction:function(e,R,i){var l=d.last("/core/shell/enableRecentActivity")&&d.last("/core/shell/enableRecentActivityLogging");if(!l){return;}var q={};var t=b.getMetadata(R);var v=e;if(i){v+=i;}q.title=t.title;q.appType=c.APP;q.url=v;sap.ushell.Container.getServiceAsync("URLParsing").then(function(w){var P=w.parseShellHash(e);if(P){q.appId="#"+w.constructShellHash({semanticObject:P.semanticObject,action:P.action});}else{q.appId=e;}if(e.indexOf("#Action-search")>=0){q.appType=c.SEARCH;}if(d.last("/core/shell/model/enableTrackingActivity")){setTimeout(function(){this._logRecentActivity(q);}.bind(this),1500);}if(k.enableTilesOpacity&&d.last("/core/shell/enableRecentActivity")){setTimeout(function(){this._logApplicationUsage(e);}.bind(this),1500);}}.bind(this));},openLoadingScreen:function(){jQuery.sap.measure.start("FLP:ShellController.openLoadingScreen","openLoadingScreen","FLP");if(this.oFiori2LoadingDialog){var e=d.last("/core/shell/model/animationMode")||"full";this.oFiori2LoadingDialog.openLoadingScreen(e);}jQuery.sap.measure.end("FLP:ShellController.openLoadingScreen");},closeLoadingScreen:function(){if(this.oFiori2LoadingDialog){this.oFiori2LoadingDialog.closeLoadingScreen();}},readNavigationEnd:function(){var e=document.getElementById("sapUshellLoadingAccessibilityHelper-loadingComplete");if(e){e.setAttribute("aria-live","polite");e.innerHTML=r.i18n.getText("loadingComplete");setTimeout(function(){e.setAttribute("aria-live","off");e.innerHTML="";},0);}},delayedCloseLoadingScreen:function(){setTimeout(function(){this.closeLoadingScreen();}.bind(this),600);},togglePane:function(e){var i=e.getSource(),l=i.getSelected();sap.ui.getCore().getEventBus().publish("launchpad","togglePane",{currentContent:d.last("/core/shell/model/currentState/paneContent")});if(e.getParameter("id")==="categoriesBtn"){i.getModel().setProperty("/currentState/showCurtainPane",!l);}else{i.getModel().setProperty("/currentState/showPane",!l);}},_switchViewPortStateByControl:function(O,e){var i=false,v=this.oViewPortContainer;if(O&&O.setEnabled&&typeof O.setEnabled==="function"){i=true;}if(i){O.addStyleClass("sapUshellShellHeadItemOverrideDisableStyle");O.setEnabled(false);}function l(){O.setEnabled(true);O.removeStyleClass("sapUshellShellHeadItemOverrideDisableStyle");v.detachAfterSwitchStateAnimationFinished(l);}if(i){v.attachAfterSwitchStateAnimationFinished(l);}v.switchState(e);},onScreenSizeChange:function(P){this.validateShowLogo(P);this.handleNavMenuTitleVisibility(P);this._handleHomeAndBackButtonsVisibility();this.handleEndItemsOverflow(P);},_handleHomeAndBackButtonsVisibility:function(){var i=jQuery("#mainShell").width()<1024&&jQuery(".sapUshellContainerDocked").length>0,I=d.last("/core/shell/model/currentViewPortState")==="Center",e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name,l=sap.ui.getCore().byId("homeBtn"),q=sap.ui.getCore().byId("backBtn"),t=e==="Desktop",v=e!=="Phone"||I;if(i){if(l){t=false;}}if(l){l.setVisible(t);}if(q){q.setVisible(v);}},validateShowLogo:function(P){var e;var i=d.last("/core/shell/model/currentState/stateName");var I=i==='merged'||i==='headerless';if(P){e=P.name;}else{e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;}var l=true;if(e==="Phone"&&!this.getMeAreaSelected()||I){l=false;}s.updateStateProperty("showLogo",l,false,["home","app","blank","blank-home","minimal","lean"],true);},handleNavMenuTitleVisibility:function(P){this.bNavMenuTitleVisible=false;if(P.name!=="Desktop"){this.bNavMenuTitleVisible=true;}s.updateStateProperty("application/showNavMenuTitle",this.bNavMenuTitleVisible,true);},navigateFromShellApplicationNavigationMenu:function(i){if(window.hasher.getHash()!==i.substr(1)){this.oViewPortContainer.switchState("Center");window.hasher.setHash(i);}var e=sap.ui.getCore().byId("shellAppTitle");if(e){e.close();}},_loadCoreExtNonUI5:function(e,i,l){if(l&&(l.applicationType=="NWBC"||l.applicationType=="TR")){setTimeout(this._loadCoreExt.bind(this),2000);}},_onRendererExtensionPluginsLoaded:function(){sap.ushell.Container.getServiceAsync("UsageAnalytics").then(function(e){e.init(r.i18n.getText("usageAnalytics"),r.i18n.getText("i_agree"),r.i18n.getText("i_disagree"),r.i18n.getText("remind_me_later"));});},_onCoreResourcesComplementLoaded:function(){var v=this.getView();if(v){v.createPostCoreExtControls();}function e(P){var V=this.getView()?this.getView().getViewData():{},k=V.config||{},i=jQuery.sap.getUriParameters().get("sap-ushell-xx-pluginmode")==="delayed",t=this;function l(){t._publishCoreExtLoadedEvent();E.emit("RendererExtensionPluginsLoaded");}function L(){P.loadPlugins("RendererExtensions").always(l);}if(!P.getRegisteredPlugins().RendererExtensions.init){P.registerPlugins({init:{component:"sap.ushell.components.shell.defaults",url:jQuery.sap.getResourcePath("sap/ushell/components/shell/defaults")}});}jQuery.sap.log.info("Triggering load of 'RendererExtension' plug-ins after loading core-ext module",null,"sap.ushell.renderers.fiori2.Shell");if(!k.inHeaderLessOpt){if(i){setTimeout(L,5000);}else{L();}}else{l();}}sap.ushell.Container.getServiceAsync("PluginManager").then(e.bind(this));},_loadWarmupPlugins:function(){sap.ushell.Container.getService("PluginManager").loadPlugins("AppWarmup").always(function(){jQuery.sap.log.debug("WARMUP plugins loaded",null,"sap.ushell.renderers.fiori2.Shell");});},_loadCoreExt:function(){jQuery.sap.measure.end("FLP:Container.InitLoading");sap.ushell.Container.getServiceAsync("Ui5ComponentLoader").then(function(){E.emit("loadCoreResourcesComplement");});},_publishCoreExtLoadedEvent:function(){setTimeout(function(){sap.ui.getCore().getEventBus().publish("shell","FLP-FMP");},3000);},getCurrentViewportState:function(){return d.last("/core/shell/model/currentViewPortState");},makeEndUserFeedbackAnonymousByDefault:function(e){this.oEndUserFeedbackConfiguration.anonymousByDefault=e;},showEndUserFeedbackLegalAgreement:function(e){this.oEndUserFeedbackConfiguration.showLegalAgreement=e;},_activateFloatingUIActions:function(w){if(w<417){this.oFloatingUIActions.disable();}else{this.oFloatingUIActions.enable();}},setFloatingContainerDragSelector:function(e){jQuery(e).addClass("sapUshellShellFloatingContainerSelector");sap.ui.require(["sap/ushell/UIActions"],function(i){if(!this.oFloatingUIActions){this.oFloatingUIActions=new sap.ushell.UIActions({containerSelector:".sapUiBody",wrapperSelector:'.sapUshellShellFloatingContainerWrapper',draggableSelector:'.sapUshellShellFloatingContainerWrapper',rootSelector:".sapUiBody",cloneClass:"sapUshellFloatingContainer-clone",dragCallback:this._handleFloatingContainerUIStart.bind(this),endCallback:this._handleFloatingContainerDrop.bind(this),moveTolerance:3,onDragStartUIHandler:this._onDragStartUI.bind(this),onDragEndUIHandler:this._setFloatingContainerHeight.bind(this),dragAndScrollCallback:this._doDock.bind(this),switchModeDelay:1000,isLayoutEngine:false,isTouch:false,elementToCapture:e,defaultMouseMoveHandler:function(){},debug:jQuery.sap.debug()});}else{this.oFloatingUIActions.elementsToCapture=jQuery(e);}this._activateFloatingUIActions(jQuery(window).width());var t;jQuery(window).bind("resize",function(){clearTimeout(t);t=setTimeout(this._activateFloatingUIActions(jQuery(window).width()),300);}.bind(this));}.bind(this));},_doDock:function(e){jQuery.sap.measure.start("FLP:Shell.controller._doDock","dragging co-pilot element","FLP");var i=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(i.name==="Desktop"){var w=jQuery(window).width();if(e){e.docked={};var l=e.docked;if(e.moveX>=w-64){l.dockPos="right";l.setIsDockingAreaOpen=true;this._openDockingArea(e);}else if(e.moveX<64){l.dockPos="left";l.setIsDockingAreaOpen=true;this._openDockingArea(e);}else{if(this._isDockingAreaOpen()){this._closeDockingArea(e);}if(jQuery("#canvas").hasClass('sapUshellContainerDocked')){this._handleCloseCanvas(e);}}}}jQuery.sap.measure.end("FLP:Shell.controller._doDock");},_finishDoDock:function(e){this._openDockingArea(false);var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","docked:"+e.dockPos);this._handleOpenCanvas(e);var w=jQuery('#sapUshellFloatingContainerWrapper');w.css("height","100%");jQuery("#shell-floatingContainer").addClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsDocked",e.dockPos);if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}},_onResizeWithDocking:function(){this.onScreenSizeChange(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD));setTimeout(function(){sap.ui.getCore().getEventBus().publish("launchpad","appFinderWithDocking");},300);},_onDragStartUI:function(e){jQuery.sap.measure.start("FLP:Shell.controller._onDragStartUI","start drag","FLP");if(this._isDock()){var i=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");i.put("lastState","floating");jQuery("#sapUshellFloatingContainerWrapper").removeClass('sapUshellContainerDocked');jQuery(".sapUshellShellFloatingContainerFullHeight").removeClass("sapUshellShellFloatingContainerFullHeight");sap.ui.getCore().getEventBus().publish("launchpad","shellFloatingContainerIsUnDocked");jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");jQuery("#sapUshellFloatingContainerWrapper").addClass('sapUshellContainerDockedMinimizeCoPilot');jQuery(jQuery(".sapUshellContainerDockedMinimizeCoPilot")).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(false));this._handleCloseCanvas(e);}jQuery.sap.measure.end("FLP:Shell.controller._onDragStartUI");},_handleAnimations:function(i,e){var l="sapUshellContainerDockedLaunchpad";var q=jQuery('#canvas');var w=jQuery('#sapUshellFloatingContainerWrapper');function t(x,T){jQuery(l).toggleClass(x,T);}if(i){jQuery('#canvas,#shell-header').addClass(l);if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){t("closeRight",true);}else{t("closeLeft",true);}w.addClass("sapUshellContainerDockedExtendCoPilot");setTimeout(function(){if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){t("closeRight",false);t("openRight",true);}else if(q.hasClass('sapUshellContainer-Narrow-Left')||e=="left"){t("closeLeft",false);t("openLeft",true);}},300);this._onResizeWithDocking();}else{jQuery("#sapUshellFloatingContainerWrapper").addClass("sapUshellContainerDockedExtendCoPilot");if(q.hasClass('sapUshellContainer-Narrow-Right')||e=="right"){t("openRight",false);}else{t("openLeft",false);}setTimeout(function(){jQuery(l).removeClass(l+" closeLeft openLeft closeRight openRight");},550);}var v=sap.ui.getCore().byId('shell-header');v._handleResizeChange();},_openDockingArea:function(e){var i=e?e.docked:false;var I=i?i.setIsDockingAreaOpen:false;if(I&&jQuery("#DockinaAreaDiv").length==0){var l=sap.ui.getCore().getConfiguration().getRTL();if((i.dockPos==="right"&&e.clone&&!l)||(i.dockPos==="left"&&e.clone&&l)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaRight">').appendTo(e.clone.parentElement);}else if((i.dockPos==="left"&&e.clone&&!l)||(i.dockPos==="right"&&e.clone&&l)){jQuery('<div id="DockinaAreaDiv"  class="sapUshellShellDisplayDockingAreaLeft">').appendTo(e.clone.parentElement);}e.clone.oDockedProp={};e.clone.oDockedProp.dockPos=i.dockPos;}else if(!I){this._closeDockingArea();}},_closeDockingArea:function(e){setTimeout(function(){jQuery('.sapUshellShellDisplayDockingAreaRight').remove();jQuery('.sapUshellShellDisplayDockingAreaLeft').remove();},150);var i=sap.ui.getCore().byId('shell-header');if(i){i._handleResizeChange();}},_isDock:function(){return jQuery('.sapUshellContainerDocked').size()!==0;},_isDockingAreaOpen:function(){return jQuery('.sapUshellShellDisplayDockingAreaRight').size()!==0||jQuery('.sapUshellShellDisplayDockingAreaLeft').size()!==0;},_handleOpenCanvas:function(e){var i=jQuery('#canvas');var l=jQuery('.sapUshellShellHead');var I=sap.ui.getCore().getConfiguration().getRTL();if((e.dockPos==="right"&&!I)||(e.dockPos==="left"&&I)){i.addClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked ');l.addClass('sapUshellContainerDocked');}if((e.dockPos==="left"&&!I)||(e.dockPos==="right"&&I)){i.addClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked ');l.addClass('sapUshellContainerDocked');}var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_handleCloseCanvas:function(e){var i=jQuery('#canvas');var l=jQuery('.sapUshellShellHead');if(e){e.docked.setIsDockingAreaOpen=false;}if(i.hasClass('sapUshellContainer-Narrow-Right')){i.removeClass('sapUshellContainer-Narrow-Right sapUshellContainerDocked sapUshellMoveCanvasRight');l.removeClass('sapUshellContainerDocked');this._openDockingArea(e);this._setFloatingContainerHeight();}if(i.hasClass('sapUshellContainer-Narrow-Left')){i.removeClass('sapUshellContainer-Narrow-Left sapUshellContainerDocked sapUshellMoveCanvasLeft');l.removeClass('sapUshellContainerDocked');this._openDockingArea(e);this._setFloatingContainerHeight();}if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}this._onResizeWithDocking();var v=sap.ui.getCore().byId("viewPortContainer");if(v){v._handleSizeChange();}},_setFloatingContainerHeight:function(e){var w=jQuery(window).width();var i=jQuery('#sapUshellFloatingContainerWrapper');if(this._isDock()){if(e&&(e.clientX>=w-64||e.clientX<64)){i.addClass(' sapUshellContainerDocked');i.addClass("sapUshellContainerDockedMinimizeCoPilot");jQuery(i).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',this._handleAnimations(true));}}else if(!this._isDock()){jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");}},_handleFloatingContainerDrop:function(e,i,l){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerDrop","drop floating container","FLP");var q=i.firstChild?sap.ui.getCore().byId(i.firstChild.id):undefined,t=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.FloatingContainer"),w=jQuery(window).width(),v=jQuery(window).height(),P=l.deltaX/w,x=l.deltaY/v,O=i.style.visibility,y=i.style.display,z=parseFloat(i.style.left.replace("%","")),G=parseFloat(i.style.top.replace("%",""));i.style.visibility='hidden';i.style.display='block';if(typeof(z)==='number'){P=z+100*l.deltaX/w;}if(typeof(G)==='number'){x=G+100*l.deltaY/v;}if(this._isDockingAreaOpen()){x=0;}i.setAttribute("style","left:"+P+"%;top:"+x+"%;position:absolute;");i.visibility=O;i.display=y;t.put("floatingContainerStyle",i.getAttribute("style"));if(q){q.handleDrop();if(!!l.clone.oDockedProp&&this._isDockingAreaOpen()){this._finishDoDock(l.clone.oDockedProp);}}jQuery.sap.measure.end("FLP:Shell.controller.handleFloatingContainerDrop");},_handleFloatingContainerUIStart:function(i,l){jQuery.sap.measure.start("FLP:Shell.controller._handleFloatingContainerUIStart","starts dragging floating container","FLP");var q=l;q.style.display="none";if(window.getSelection){var t=window.getSelection();try{t.removeAllRanges();}catch(e){}}jQuery.sap.measure.end("FLP:Shell.controller._handleFloatingContainerUIStart");},getFloatingContainerState:function(){var e=jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState");var l="floating";if(e!=null){l=e.get("lastState");if(l==null){l="floating";}}return l;},setFloatingContainerVisibility:function(v){var l=this.getFloatingContainerState();if(l){if(l=="floating"){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}else if(l.indexOf("docked")!=-1){var V=sap.ui.getCore().byId("viewPortContainer");if(v==true){var e=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD);if(e.name=="Desktop"){var w=jQuery('#sapUshellFloatingContainerWrapper');w.addClass("sapUshellContainerDocked");jQuery("#canvas, .sapUshellShellHead").addClass("sapUshellContainerDocked");w.css("height","100%");sap.ui.getCore().byId("shell-floatingContainer").addStyleClass("sapUshellShellFloatingContainerFullHeight");if(V){V._handleSizeChange();}if(sap.ui.getCore().getConfiguration().getRTL()){if(l.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}}else if(l.indexOf("right")!=-1){jQuery("#canvas").addClass('sapUshellContainer-Narrow-Right');this._handleAnimations(true,"right");}else{jQuery("#canvas").addClass('sapUshellContainer-Narrow-Left');this._handleAnimations(true,"left");}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);}else{jQuery.sap.storage(jQuery.sap.storage.Type.local,"com.sap.ushell.adapters.local.CopilotLastState").put("lastState","floating");this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}if(jQuery(".sapUShellApplicationContainerLimitedWidth").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellApplicationContainerLimitedWidth");jQuery('#application-Action-toappnavsample').addClass("sapUShellDockingContainer");}}else{if(sap.ui.getCore().getConfiguration().getRTL()){if(l.indexOf("right")!=-1){this._handleAnimations(false,"left");}else{this._handleAnimations(false,"right");}}else if(l.indexOf("right")!=-1){this._handleAnimations(false,"right");}else{this._handleAnimations(false,"left");}if(V){V._handleSizeChange();}setTimeout(function(){this.getView().getOUnifiedShell().setFloatingContainerVisible(v);}.bind(this),400);if(jQuery(".sapUShellDockingContainer").length>0){jQuery('#application-Action-toappnavsample').removeClass("sapUShellDockingContainer");jQuery('#application-Action-toappnavsample').addClass("sapUShellApplicationContainerLimitedWidth");}}jQuery("#sapUshellFloatingContainerWrapper").removeClass("sapUshellContainerDockedMinimizeCoPilot sapUshellContainerDockedExtendCoPilot");this._onResizeWithDocking();if(V){V._handleSizeChange();}}}},getFloatingContainerVisibility:function(){return this.getView().getOUnifiedShell().getFloatingContainerVisible();},setFloatingContainerContent:function(P,i,e,l){s.setFloatingContainerContent(P,i,e,l);},getRightFloatingContainerVisibility:function(){var R=this.getView().getOUnifiedShell().getRightFloatingContainer(),e=R&&R.getVisible();return e;},setHeaderTitle:function(t,i){if(typeof t!=="string"){throw new Error("sTitle type is invalid");}this.getView().getOUnifiedShell().getHeader().setTitleControl(t,i);},addEndUserFeedbackCustomUI:function(e,i){if(e){this.oEndUserFeedbackConfiguration.customUIContent=e;}if(i===false){this.oEndUserFeedbackConfiguration.showCustomUIContent=i;}},setFooter:function(e){var i=this.getView().getOUnifiedShell();if(typeof e!=="object"||!e.getId){throw new Error("oFooter value is invalid");}if(i.getFooter()!==null){jQuery.sap.log.warning("You can only set one footer. Replacing existing footer: "+i.getFooter().getId()+", with the new footer: "+e.getId()+".");}i.setFooter(e);},removeFooter:function(){this.getView().getOUnifiedShell().setFooter(null);},addUserPreferencesEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateUserPrefModel(e);},addUserProfilingEntry:function(e){this._validateUserPrefEntryConfiguration(e);this._updateProfilingModel(e);},_validateUserPrefEntryConfiguration:function(e){if((!e)||(typeof e!=="object")){throw new Error("object oConfig was not provided");}if(!e.title){throw new Error("title was not provided");}if(!e.value){throw new Error("value was not provided");}if(typeof e.entryHelpID!=="undefined"){if(typeof e.entryHelpID!=="string"){throw new Error("entryHelpID type is invalid");}else if(e.entryHelpID===""){throw new Error("entryHelpID type is invalid");}var i=sap.ui.getCore().byId('shell-header');i._handleResizeChange();}if(e.title&&typeof e.title!=="string"){throw new Error("title type is invalid");}if(typeof e.value!=="function"&&typeof e.value!=="string"&&typeof e.value!=="number"){throw new Error("value type is invalid");}if(e.onSave&&typeof e.onSave!=="function"){throw new Error("onSave type is invalid");}if(e.content&&typeof e.content!=="function"){throw new Error("content type is invalid");}if(e.onCancel&&typeof e.onCancel!=="function"){throw new Error("onCancel type is invalid");}},_createSessionHandler:function(k){var t=this;sap.ui.require(["sap/ushell/SessionHandler"],function(e){t.oSessionHandler=new e();t.oSessionHandler.init({oModel:t.getModel(),keepSessionAlivePopupText:k.keepSessionAlivePopupText,pageReloadPopupText:k.pageReloadPopupText,preloadLibrariesForRootIntent:k.preloadLibrariesForRootIntent,sessionTimeoutReminderInMinutes:k.sessionTimeoutReminderInMinutes,sessionTimeoutIntervalInMinutes:k.sessionTimeoutIntervalInMinutes,enableAutomaticSignout:k.enableAutomaticSignout});});},_getSessionHandler:function(){return this.oSessionHandler;},_navBack:function(){this.setMeAreaSelected(false);a.service().navigateBack();},_updateUserPrefModel:function(e){var i=this._getModelEntryFromEntryObject(e),l=d.last("/core/shell/model/userPreferences/entries");l.push(i);l=this._reorderUserPrefEntries(l);m.setProperty("/userPreferences/entries",l);},_updateProfilingModel:function(e){var i=this._getModelEntryFromEntryObject(e),l=d.last("/core/shell/model/userPreferences/profiling")||[];l.push(i);m.setProperty("/userPreferences/profiling",l);},_getModelEntryFromEntryObject:function(e){return{"entryHelpID":e.entryHelpID,"title":e.title,"editable":e.content?true:false,"valueArgument":e.value,"valueResult":null,"onSave":e.onSave,"onCancel":e.onCancel,"contentFunc":e.content,"contentResult":null,"icon":e.icon};},_reorderUserPrefEntries:function(e){var l,t;for(var i=0;i<e.length;i++){if(e[i].entryHelpID==="flpSettingsEntry"){l=i;}else if(e[i].entryHelpID==="themes"){t=i;}if(l!=undefined&&t!=undefined){var q=e.splice(l,1);e.splice(t+1,0,q[0]);break;}}return e;},onAfterViewPortSwitchState:function(e){var t=e.getParameter("to");var i=sap.ui.getCore().byId("shellAppTitle");m.setProperty("/currentViewPortState",t);if(this.applicationKeyHandler){A.registerAppKeysHandler(this.applicationKeyHandler);this.applicationKeyHandler=undefined;}sap.ui.getCore().getEventBus().publish("launchpad","afterSwitchState",e);if(t==="Center"){i.setVisible(true);}else{i.setVisible(false);if(t=="RightCenter"){this.applicationKeyHandler=A.getAppKeysHandler();A.bFocusOnShell=false;if(sap.ui.getCore().byId("notificationsView")){A.registerAppKeysHandler(sap.ui.getCore().byId("notificationsView").getController().keydownHandler.bind(sap.ui.getCore().byId("notificationsView")));}}}this.validateShowLogo();this._handleHomeAndBackButtonsVisibility();},getModel:function(){return m;},_getConfig:function(){return k?k:{};},_getPersData:function(P){var e=sap.ui.core.Component.getOwnerComponentFor(this.getView());return new Promise(function(i,l){sap.ushell.Container.getServiceAsync("Personalization").then(function(q){var t={keyCategory:q.constants.keyCategory.FIXED_KEY,writeFrequency:q.constants.writeFrequency.LOW,clientStorageAllowed:true};var v=q.getPersonalizer(P,t,e);v.getPersData().then(i).fail(l);});});},_getCurrentLocationHash:function(){return window.location.hash;},setMeAreaSelected:function(e){E.emit('showMeArea',e);},getMeAreaSelected:function(){return d.last("/core/shell/model/currentViewPortState")==="LeftCenter";},setNotificationsSelected:function(e){E.emit('showNotifications',e);},getNotificationsSelected:function(){return d.last("/core/shell/model/currentViewPortState")==='RightCenter';},isAnimationModeNotMinimal:function(e){return e!=='minimal';}});},false);
