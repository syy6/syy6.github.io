// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/thirdparty/URI","sap/ushell/utils","sap/ushell/_ApplicationType/utils","sap/ushell/_ApplicationType/systemAlias","sap/ushell/_ApplicationType/wdaResolution","sap/ushell/_ApplicationType/guiResolution","sap/ushell/services/_ClientSideTargetResolution/ParameterMapping","sap/ushell/Config"],function(U,u,a,s,w,g,p,C){"use strict";function b(M,B,E){var i=M.inbound;var r=i&&i.resolutionResult;if(!(!i||!r||!(r["sap.wda"]))){return w.constructFullWDAResolutionResult(M,B,E);}if(!(!i||!r)){return w.constructWDAResolutionResult(M,B,E);}}function c(M,B,E){var o=new U(B),i=M.inbound,I=i&&i.resolutionResult,j=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults),S,k;if(j["sap-system"]){S=j["sap-system"][0];delete j["sap-system"];}if(j["sap-system-src"]){k=j["sap-system-src"][0];delete j["sap-system-src"];}return new Promise(function(r,R){s.spliceSapSystemIntoURI(o,I.systemAlias,S,k,"WCF",I.systemAliasSemantics||s.SYSTEM_ALIAS_SEMANTICS.apply,E).done(function(l){var P=a.getURLParsing().paramsToString(j),F=a.appendParametersToUrl(P,l.toString());var n={url:F,text:"",additionalInformation:"",applicationType:"WCF",fullWidth:true};r(n);}).fail(function(l){R(l);});});}function d(M,B,E){var i=M.inbound,j,S,k,o,r={};["applicationType","additionalInformation","applicationDependencies"].forEach(function(P){if(i.resolutionResult.hasOwnProperty(P)){r[P]=i.resolutionResult[P];}});r.url=B;if(r.applicationDependencies&&typeof r.url==="undefined"){r.url="";}if(typeof r.url==="undefined"){return Promise.reject("Cannot resolve intent: url was not specified in matched inbound");}o=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults);r.reservedParameters={};var R={"sap-ui-fl-max-layer":true,"sap-ui-fl-control-variant-id":true};Object.keys(R).forEach(function(n){var v=o[n];if(v){delete o[n];r.reservedParameters[n]=v;}});M.mappedDefaultedParamNames=M.mappedDefaultedParamNames.filter(function(D){return!R[D];});if(M.mappedDefaultedParamNames.length>0){o["sap-ushell-defaultedParameterNames"]=[JSON.stringify(M.mappedDefaultedParamNames)];}S=o["sap-system"]&&o["sap-system"][0];k=o["sap-system-src"]&&o["sap-system-src"][0];r["sap-system"]=S;if(typeof k==="string"){r["sap-system-src"]=k;}M.effectiveParameters=o;j=a.getURLParsing().paramsToString(o);if(j){r.url=r.url+((r.url.indexOf("?")<0)?"?":"&")+j;}if(typeof i.resolutionResult.ui5ComponentName!=="undefined"){r.ui5ComponentName=i.resolutionResult.ui5ComponentName;}r.text=i.title;return Promise.resolve(r);}function e(M,B,E){var i=M.inbound,I=i&&i.resolutionResult,r={};var o=new U(B);var j=jQuery.extend(true,{},M.mappedIntentParamsPlusSimpleDefaults);if(M.inbound&&M.inbound.action==="launchURL"&&M.inbound.semanticObject==="Shell"){delete j["sap-external-url"];}var S=j["sap-system"]&&j["sap-system"][0];var k=j["sap-system-src"]&&j["sap-system-src"][0];r["sap-system"]=S;delete j["sap-system"];if(typeof k==="string"){r["sap-system-src"]=k;delete j["sap-system-src"];}return(new Promise(function(R,l){if(a.absoluteUrlDefinedByUser(o,I.systemAlias,I.systemAliasSemantics)){R(B);}else{s.spliceSapSystemIntoURI(o,I.systemAlias,S,k,"URL",I.systemAliasSemantics||s.SYSTEM_ALIAS_SEMANTICS.applied,E).fail(l).done(function(n){var q=n.toString();R(q);});}})).then(function(l){var P=a.getURLParsing().paramsToString(j);var F=C.last("/core/navigation/flpURLDetectionPattern");var n=new RegExp(F);return n.test(l)?a.appendParametersToIntentURL(j,l):a.appendParametersToUrl(P,l);},Promise.reject.bind(Promise)).then(function(l){["additionalInformation","applicationDependencies"].forEach(function(P){if(i.resolutionResult.hasOwnProperty(P)){r[P]=i.resolutionResult[P];}});r.url=l;r.text=i.title;r.applicationType="URL";return Promise.resolve(r);},Promise.reject.bind(Promise));}var A={URL:{type:"URL",generateResolutionResult:e,easyAccessMenu:{intent:"Shell-startURL",resolver:null,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:false,systemSelectionPriority:1}},WDA:{type:"WDA",generateResolutionResult:b,easyAccessMenu:{intent:"Shell-startWDA",resolver:w.resolveEasyAccessMenuIntentWDA,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:true,systemSelectionPriority:2}},TR:{type:"TR",generateResolutionResult:g.generateTRResolutionResult,easyAccessMenu:{intent:"Shell-startGUI",resolver:g.resolveEasyAccessMenuIntentWebgui,showSystemSelectionInUserMenu:true,showSystemSelectionInSapMenu:true,systemSelectionPriority:3}},NWBC:{type:"NWBC"},WCF:{type:"WCF",generateResolutionResult:c},SAPUI5:{type:"SAPUI5",generateResolutionResult:d}};function f(){return Object.keys(A).map(function(i){return A[i];}).filter(function(o){return typeof o.easyAccessMenu==="object";});}function h(){var E={};f().forEach(function(o){E[o.easyAccessMenu.intent]=o.easyAccessMenu.resolver;});return function(M){return E[M];};}var m={getEasyAccessMenuResolver:h(),getEasyAccessMenuDefinitions:f};Object.keys(m).forEach(function(M){Object.defineProperty(A,M,{value:m[M]});});return A;},false);
