// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui2/srvc/ODataWrapper","sap/ui2/srvc/ODataService","sap/ushell/utils","sap/ushell/resources"],function(O,a,u,r){"use strict";return function(s){function c(j){var C;if(j&&!jQuery.isEmptyObject(j)){C=JSON.stringify(j);return C.replace(/\{|\}|\\n|,/g,"\n");}return"";}this.createTicket=function(S){var d,b="/sap/opu/odata/UI2/INTEROP/",R="Messages",U,h,C,D,o=sap.ushell.Container;if(!S.text){throw new sap.ushell.utils.Error("Support Ticket data does not contain text member");}U=jQuery.sap.getObject("clientContext.navigationData.applicationInformation.url",0,S);h=jQuery.sap.getObject("clientContext.navigationData.navigationHash",0,S);C=jQuery.sap.getObject("clientContext.navigationData.tileDebugInfo",0,S);U=typeof U==="string"?U:"";h=typeof h==="string"?h:"";C=typeof C==="string"?JSON.parse(C).catalogId||'':"";S.url=U;S.catalogId=C;S.subject=r.i18n.getText("contactSupport.Subject",[o.getLogonSystem().getName()+"-"+o.getLogonSystem().getClient(),o.getUser().getId()]).substring(0,40);S.hash=h;S.clientContext=c(S.clientContext);d=new jQuery.Deferred();var e={baseUrl:b,'sap-language':o.getUser().getLanguage(),'sap-client':o.getLogonSystem().getClient()};D=new sap.ui2.srvc.createODataWrapper(e);sap.ui2.srvc.ODataService.call(this,D,function(){return false;});D.create(R,S,function(f){d.resolve(f.messageNumber);},function(E){d.reject(E);});return d.promise();};};},true);
