/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2018 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/Utils","sap/base/util/uid",'sap/ui/base/ManagedObjectObserver','sap/ui/base/ManagedObject'],function(F,u,M,a){"use strict";var C={};C.applyChange=function(c,o,p){if(p.modifier.targets!=="jsControlTree"){throw new Error("Combine buttons change can't be applied on XML tree");}var b=c.getDefinition(),m=p.modifier,v=F.getViewForControl(o),s=m.bySelector(b.content.combineButtonSelectors[0],p.appComponent),A=p.appComponent,P=m.getParent(s),i,d,B,I=sap.ui.getCore().getConfiguration().getRTL(),e,f,g=[],r={menuButtonId:"",parentAggregation:"",insertIndex:0};B=b.content.combineButtonSelectors.map(function(h){return m.bySelector(h,A);});d=B[0].sParentAggregationName;r.parentAggregation=d;i=m.findIndexInParentAggregation(s);r.insertIndex=i;e=m.createControl("sap.m.Menu",p.appComponent,v,b.content.menuIdSelector);B.forEach(function(h,j){var k,l,n=h.getBindingInfo("enabled"),q=h.getAggregation("customData"),S=b.content.buttonsIdForSave[j],t=m.getProperty(h,"text");l=m.createControl("sap.m.MenuItem",p.appComponent,v,S);m.setProperty(l,"text",h.mProperties.text);m.setProperty(l,"icon",h.mProperties.icon);m.setProperty(l,"enabled",h.mProperties.enabled);l.attachPress(function(E){return h.firePress(E);});h.getAggregation=function(w,D){if(w==="customData"){var x=a.prototype.getAggregation.call(h,"customData"),y=l?a.prototype.getAggregation.call(l,"customData"):[];y=(y)?y:[];return(x&&x.length)?x:y;}else{return a.prototype.getAggregation.apply(this,arguments);}};new M(function(w){m.setProperty(l,"enabled",w.current);if(n){l.bindProperty("enabled",n);}}).observe(h,{properties:["enabled"]});if(n){l.bindProperty("enabled",n);}if(t){I?g.unshift(t):g.push(t);}S.id=S.id+"-originalButtonId";k=m.createControl("sap.ui.core.CustomData",p.appComponent,v,S);m.setProperty(k,"key","originalButtonId");m.setProperty(k,"value",m.getId(h));if(q&&q.length>0){q.forEach(function(w,j){m.insertAggregation(l,"customData",w,j);});}m.removeAggregation(P,d,h);m.insertAggregation(l,"dependents",h);m.insertAggregation(l,"customData",k,0);m.insertAggregation(e,"items",l,j);});f=m.createControl("sap.m.MenuButton",p.appComponent,v,b.content.menuButtonIdSelector);r.menuButtonId=m.getId(f);m.setProperty(f,"text",g.join("/"));m.insertAggregation(f,"menu",e,0);m.insertAggregation(P,d,f,i);c.setRevertData(r);return true;};C.revertChange=function(c,o,p){var m=p.modifier,r=c.getRevertData(),b=c.getDefinition(),P=r.parentAggregation,A=r.insertIndex,d=m.bySelector(r.menuButtonId,p.appComponent),e=m.getParent(d),B=b.content.combineButtonSelectors;for(var i=0;i<B.length;i++){var f=m.bySelector(B[i],p.appComponent);m.insertAggregation(e,P,f,A+i);}m.removeAggregation(e,P,d);d.destroy();c.resetRevertData();return true;};C.completeChangeContent=function(c,s,p){var m=p.modifier,A=p.appComponent,o=c.getDefinition(),b=s.combineFieldIds;if(b&&b.length>=2){c.addDependentControl(b,"combinedButtons",p);o.content.combineButtonSelectors=b.map(function(d){return m.getSelector(d,A);});o.content.menuButtonIdSelector=m.getSelector(A.createId(u()),A);o.content.menuIdSelector=m.getSelector(A.createId(u()),A);o.content.buttonsIdForSave=b.map(function(){return m.getSelector(A.createId(u()),A);});}else{throw new Error("Combine buttons action cannot be completed: oSpecificChangeInfo.combineFieldIds attribute required");}};return C;},true);
