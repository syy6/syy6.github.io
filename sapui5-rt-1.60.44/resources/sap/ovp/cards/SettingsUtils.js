sap.ui.define(["jquery.sap.global","sap/m/Dialog","sap/m/Button","sap/ovp/cards/PayLoadUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/rta/SettingsDialogConstants","sap/ui/Device","sap/m/MessagePopover","sap/m/MessagePopoverItem","sap/m/Link","sap/m/MessageBox","sap/ovp/cards/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ovp/app/resources"],function(Q,D,B,P,O,S,a,M,b,L,c,A,V,J,R,d){"use strict";var r=d;function e(i,q,e1){var f1=i.getComponentInstance(),g1=f1.getComponentData(),h1=g1.appComponent,i1=g1.mainComponent,j1=(e1)?"":g1.cardId,k1=j1+"Dialog",l1=(e1)?"":g1.modelName,m1=(!l1)?undefined:h1.getModel(l1),n1=q.getModel().getData(),o1={cards:{}};o1.cards[k1]={template:n1.template,settings:n1};if(d1.bNewKPICardFlag){var p1=n1.selectedKPI;m1=new sap.ui.model.odata.v2.ODataModel(p1.ODataURI,{'annotationURI':p1.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None});l1="customer.kpi_card_model_"+h(p1.ODataURI);}if(m1&&!!l1){o1.cards[k1].model=l1;q.setModel(m1,l1);}o1.cards[k1]=i1._getTemplateForChart(o1.cards[k1]);q.getController()._oManifest=o1;if(d1.bNewKPICardFlag){m1.getMetaModel().loaded().then(function(){var q1=O.createCardComponent(q,o1,"dialogCard");q1.then(function(){q.setBusy(false);}).catch(function(){k(o1.cards[k1].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");j(q,o1,k1);});},function(q1){Q.sap.log.error(q1);});m1.attachMetadataFailed(function(){k(o1.cards[k1].settings,"OVP_KEYUSER_METADATA_FAILURE");j(q,o1,k1);});}else{O.createCardComponent(q,o1,"dialogCard");}}function s(i,q){if(!this.oNewDataSources[i]){this.oNewDataSources[i]={uri:q};}}function f(i){if(this.oNewDataSources[i]){delete this.oNewDataSources[i];}}function g(i){var q=this.oAppComponent.getMetadata(),e1=q.getManifestEntry("sap.app").dataSources;if(this.oNewDataSources[i]){return this.oNewDataSources;}return e1;}function h(i){var q=i.split("/");return q[q.length-1]?q[q.length-1]:q[q.length-2];}function j(i,q,e1){q.cards[e1].template="sap.ovp.cards.error";q.cards[e1].model=undefined;var f1=O.createCardComponent(i,q,"dialogCard");var g1=i.getController();f1.then(function(){i.setBusy(false);g1.setBusy(false);}).catch(function(){i.setBusy(false);g1.setBusy(false);});}function k(i,q){var e1=_();if(i){i.errorStatusText=e1&&e1.getText(q);}}function l(i){if(i.indexOf('#')!==-1){return i.split('#')[1];}else{return"Default";}}function m(i,q){if(i){var e1,f1,g1;if(i.indexOf("{")===0&&i.indexOf("}")===i.length-1){i=i.slice(1,-1);if(i.indexOf(">")!=-1){e1=i.split(">");g1=e1[0];f1=e1[1];}else if(i.indexOf("&gt;")!=-1){e1=i.split("&gt;");g1=e1[0];f1=e1[1];}if(!!f1&&g1==="@i18n"&&d1.oi18nModel){return d1.oi18nModel.getProperty(f1);}else{return i;}}else{return i;}}else{return q;}}function n(i,q,e1,f1){if(q[i]&&q[i][e1]){return m(q[i][e1].String,f1);}else{return f1;}}function o(i,q){var e1=l(q),f1=_(),g1=f1&&f1.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[e1]);g1=(g1)?g1:e1;if(q.indexOf(",")!==-1){q=q.split(",")[0];}if(q.indexOf(".Identification")!==-1){if(i[q]){var h1=A.sortCollectionByImportance(i[q]);for(var i1=0;i1<h1.length;i1++){var j1=h1[i1];if(j1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){if(j1&&j1["Label"]){return m(j1["Label"].String,g1);}else{return j1["SemanticObject"].String+"-"+j1["Action"].String;}}if(j1.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(j1&&j1["Label"]){return m(j1["Label"].String,g1);}else{return j1["Url"].String;}}}}return f1&&f1.getText("OVP_KEYUSER_LABEL_NO_NAVIGATION");}else if(q.indexOf(".HeaderInfo")!==-1){if(i[q]&&i[q]["Description"]&&i[q]["Description"].Label){return m(i[q]["Description"].Label.String,g1);}else{return g1;}}else if(q.indexOf(".PresentationVariant")!==-1||q.indexOf(".SelectionVariant")!==-1||q.indexOf(".SelectionPresentationVariant")!==-1){return n(q,i,"Text",g1);}else if(q.indexOf(".DataPoint")!==-1){return n(q,i,"Title",g1);}else if(q.indexOf(".Chart")!==-1){return n(q,i,"Description",g1);}else if(q.indexOf(".FieldGroup")!==-1){return n(q,i,"Label",g1);}else{var k1="";if(e1!=="Default"){k1="#"+e1;}var l1="com.sap.vocabularies.Common.v1.Label"+k1;if(i[q]&&i[q][l1]){return m(i[q][l1].String,g1);}else{return g1;}}}function p(i,q){switch(q){case"cardPreview":return(O.getSupportedCardTypes().indexOf(i)!==-1);case"noOfRows":case"noOfColumns":case"stopResizing":var e1=["sap.ovp.cards.stack"];return(e1.indexOf(i)===-1);case"listType":case"listFlavor":var f1=["sap.ovp.cards.list"];return(f1.indexOf(i)!==-1);case"listFlavorForLinkList":var g1=["sap.ovp.cards.linklist"];return(g1.indexOf(i)!==-1);case"isViewSwitchSupportedCard":case"kpiHeader":var h1=["sap.ovp.cards.list","sap.ovp.cards.table","sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(h1.indexOf(i)!==-1);case"chartSPVorKPI":case"chart":var i1=["sap.ovp.cards.charts.analytical","sap.ovp.cards.charts.smart.chart","sap.ovp.cards.charts.bubble","sap.ovp.cards.charts.donut","sap.ovp.cards.charts.line"];return(i1.indexOf(i)!==-1);case"sortOrder":case"sortBy":case"lineItem":var j1=["sap.ovp.cards.list","sap.ovp.cards.table"];return(j1.indexOf(i)!==-1);case"identification":var k1=["sap.ovp.cards.stack"];return(k1.indexOf(i)!==-1);default:break;}}function t(i){return!!i.kpiAnnotationPath;}function u(i){return!!i.selectionPresentationAnnotationPath;}function v(i){return u(i)||t(i);}function w(i){return i.substring(i.lastIndexOf("_")+1,i.length).indexOf("C")!==-1;}function x(i){if(i.NewKPICard){return i.NewKPICard;}else if(i.selectedKPICardID){return i.selectedKPICardID.indexOf("newKPICard")!==-1;}else{return false;}}function y(i,q,e1,f1){var g1=true;var h1=true;if(e1){if(i.mainViewSelected){h1=false;}else{g1=false;}}switch(q){case"cardPreview":return p(i.template,"cardPreview");case"noOfRows":case"noOfColumns":case"stopResizing":return g1&&p(i.template,q);case"title":return g1;case"dynamicSwitchSubTitle":return g1&&!!i.dynamicSubTitle;case"dynamicSwitchStateSubTitle":return!!i.dynamicSubtitleAnnotationPath;case"subTitle":if(!i.subTitle){i.subTitle=" ";return true;}else{return g1&&!i.dynamicSubtitleAnnotationPath;}break;case"dynamicSubTitle":return h1&&!!i.dynamicSubtitleAnnotationPath;case"valueSelectionInfo":if(!i.valueSelectionInfo){i.valueSelectionInfo=" ";}return g1&&(p(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath)&&!x(i);case"dataPoint":return h1&&!t(i)&&(p(i.template,"kpiHeader")&&!!i.dataPointAnnotationPath);case"listType":case"listFlavor":case"listFlavorForLinkList":return g1&&p(i.template,q);case"identification":return h1&&(!i.staticContent)&&!p(i.template,q);case"selectionPresentationVariant":return h1&&u(i)&&!t(i)&&p(i.template,"kpiHeader");case"KPI":return h1&&t(i)&&!u(i)&&p(i.template,"chart")&&!x(i);case"presentationVariant":case"selectionVariant":return h1&&!v(i)&&(!i.staticContent)&&p(i.template,"kpiHeader");case"kpiHeader":return g1&&!t(i)&&p(i.template,q);case"lineItem":case"chart":return h1&&!v(i)&&p(i.template,q);case"chartSPVorKPI":return h1&&v(i)&&!x(i)&&p(i.template,q);case"presentationVariantSPVorKPI":case"selectionVariantSPVorKPI":return h1&&v(i)&&!x(i)&&(!i.staticContent)&&p(i.template,"kpiHeader");case"showViewName":return e1&&h1;case"showDefaultView":if(e1&&h1){if(i.defaultViewSelected!=i.selectedKey){return true;}}return false;case"showEntitySet":if(e1&&h1){if(i.selectedKey>0&&i.tabs[i.selectedKey-1].entitySet){return true;}}return false;case"showMore":case"removeVisual":case"lineItemSubTitle":case"lineItemTitle":case"staticLink":case"links":var i1=(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent);if(q==="staticLink"){return(i1&&!!i.staticContent[f1].targetUri);}else if(q==="links"){return(i1&&!!i.staticContent[f1].semanticObject);}else if(q==="removeVisual"){return(i1&&(!!i.staticContent[f1].targetUri||!!i.staticContent[f1].semanticObject));}else{return i1;}break;default:break;}}function z(i){var q=false;this.oVisibility.viewSwitchEnabled=false;this.oVisibility.showViewSwitch=false;if(p(i.template,"isViewSwitchSupportedCard")&&!x(i)){if(i.tabs&&i.tabs.length){q=true;this.oVisibility.showViewSwitch=true;}this.oVisibility.viewSwitchEnabled=true;}this.oVisibility.cardPreview=y(i,"cardPreview");this.oVisibility.stopResizing=y(i,"stopResizing",q);this.oVisibility.noOfRows=y(i,"noOfRows",q);this.oVisibility.noOfColumns=y(i,"noOfColumns",q);this.oVisibility.title=y(i,"title",q);this.oVisibility.subTitle=y(i,"subTitle",q);this.oVisibility.valueSelectionInfo=y(i,"valueSelectionInfo",q);this.oVisibility.listType=y(i,"listType",q);this.oVisibility.listFlavor=y(i,"listFlavor",q);this.oVisibility.listFlavorForLinkList=y(i,"listFlavorForLinkList",q);if(i.template==="sap.ovp.cards.linklist"&&!!i.staticContent){var e1=i.staticContent,f1={},g1={},h1={},i1={};for(var j1=0;j1<e1.length;j1++){var k1=e1[j1].index;f1[k1]=y(i,"staticLink",null,j1);g1[k1]=y(i,"links",null,j1);h1[k1]=y(i,"removeVisual",null,j1);i1[k1]=y(i,"showMore",null,j1);}this.oVisibility.staticLink=f1;this.oVisibility.links=g1;this.oVisibility.removeVisual=h1;this.oVisibility.showMore=i1;}this.oVisibility.lineItemTitle=y(i,"lineItemTitle");this.oVisibility.lineItemSubTitle=y(i,"lineItemSubTitle");this.oVisibility.showViewName=y(i,"showViewName",q);this.oVisibility.showDefaultView=y(i,"showDefaultView",q);this.oVisibility.showEntitySet=y(i,"showEntitySet",q);this.aVariantNames.forEach(function(l1){this.oVisibility[l1.sPath]=y(i,l1.sPath,q)&&!!i[l1.sPath]&&!!i[l1.sPath].length;}.bind(this));this.oVisibility.kpiHeader=y(i,"kpiHeader",q)&&!!i["dataPoint"]&&!!i["dataPoint"].length;this.oVisibility.dynamicSwitchSubTitle=y(i,"dynamicSwitchSubTitle",q);this.oVisibility.dynamicSwitchStateSubTitle=y(i,"dynamicSwitchStateSubTitle",q);this.oVisibility.moveToTheTop=false;this.oVisibility.moveUp=false;this.oVisibility.moveDown=false;this.oVisibility.moveToTheBottom=false;this.oVisibility.delete=false;}function _(){if(r){return r;}r=sap.ui.getCore().getLibraryResourceBundle("sap.ovp");return r;}function C(i){var q=i.getProperty("/staticContent");for(var e1=0;e1<q.length;e1++){q[e1].index="Index--"+(e1+1);}i.setProperty("/staticContent",q);}function E(q){var e1=0;for(var i=q.length-1;i>=0;i--){if(/^\d+$/.test(q[i])){e1=parseInt(q[i],10);break;}}return e1;}function F(i){if(i.lineItem){i.lineItem.forEach(function(e1){if(e1.value===i.annotationPath){i.lineItemQualifier=e1.name;}});}if(i.tabs&&i.tabs.length&&i.selectedKey){i.viewName=i.tabs[i.selectedKey-1].value;i.isDefaultView=false;if(i.selectedKey===i.defaultViewSelected){i.isDefaultView=true;}}var q=i.sortOrder;i.sortOrder="descending";if(q&&q.toLowerCase()!=="descending"){i.sortOrder="ascending";}i.isExtendedList=false;if(i.listType==="extended"){i.isExtendedList=true;}i.isBarList=false;if(i.listFlavor==="bar"){i.isBarList=true;}i.hasKPIHeader=false;if(i.dataPointAnnotationPath){i.hasKPIHeader=true;}return i;}function G(i){var q=i.kpiAnnotationPath;var e1=i.template;var f1=i.entityType;var g1="";if(q&&f1&&e1==="sap.ovp.cards.charts.analytical"){var h1=f1[q];var i1=h1&&h1.Detail;if(i1&&i1.RecordType==="com.sap.vocabularies.UI.v1.KPIDetailType"&&i1.SemanticObject&&i1.Action){g1="#"+i1.SemanticObject.String+"-"+i1.Action.String;}}i["KPINav"]=g1;}function H(i){var q=[],e1=_(),f1=i.metaModel,g1=(!!f1)?f1.getODataEntityContainer().entitySet:[];g1.forEach(function(h1){var i1=e1&&e1.getText("OVP_KEYUSER_LABEL_DEFAULT_LABEL_WITH_QUALIFIER",[h1.name]),j1=f1.getODataEntityType(h1.entityType)["sap:label"];q.push({name:m(j1,i1),value:h1.name});});if(q.length>0){i["allEntitySet"]=q;}}function I(i){var q=i.entityType;if(!i["allEntitySet"]){H(i);}G(i);this.aVariantNames.forEach(function(h1){var i1=[],j1=1;for(var k1 in q){if(q.hasOwnProperty(k1)&&k1.indexOf(h1.sVariant)!==-1){if(h1.sVariant===".LineItem"){var l1={name:r.getText("OVP_KEYUSER_LABEL_LINEITEM_OPTIONS",[j1]),value:k1,fields:A.sortCollectionByImportance(q[k1])};i1.push(l1);j1++;}else{i1.push({name:o(q,k1),value:k1});}}}if(i1.length!==0){i[h1.sPath]=i1;}});if(i.entityType&&i.entityType.property){i["modelProperties"]=i.entityType.property.map(function(h1){return{name:h1.name,value:h1.name};});}if(!!i.tabs&&i.tabs.length){var e1=false,f1=i.tabs[i.tabs.length-1].value,g1=f1.split(' ');i.newViewCounter=E(g1);i.defaultViewSelected=i.selectedKey;i.isViewResetEnabled=false;i.aViews=[{text:r&&r.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false}];e1=i.tabs.some(function(h1){return h1.dataPointAnnotationPath;});i.tabs.forEach(function(h1,i1){var j1=h1.value;if(e1&&!h1.dataPointAnnotationPath&&h1.dataPoint&&h1.dataPoint.length){h1.dataPointAnnotationPath=h1.dataPoint[0].value;}if(i1+1===i.selectedKey){j1=h1.value;if(r){j1+=" ("+r.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}else{j1+=" (Default view)";}}i.aViews.push({text:j1,key:i1+1,initialSelectedKey:i1+1,isLaterAddedView:false,isViewResetEnabled:false});});}else if(p(i.template,"isViewSwitchSupportedCard")){i.newViewCounter=0;i.aViews=[{text:r.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}];}return i;}function K(q){var e1=q.getData();if(sap.ushell&&sap.ushell.Container){sap.ushell.Container.getService("CrossApplicationNavigation").getLinks().done(function(f1){var g1=[],h1={};for(var i=0;i<f1.length;i++){g1.push(f1[i].intent);h1[f1[i].intent]=f1[i].text;}sap.ushell.Container.getService("CrossApplicationNavigation").isIntentSupported(g1).done(function(i1){var f1=[];for(var j1 in i1){if(i1.hasOwnProperty(j1)&&i1[j1].supported===true&&h1&&h1[j1]){f1.push({name:h1[j1],value:j1});}}var k1=e1;if(f1.length!==0||f1.length!==0){k1["links"]=f1;}q.refresh();}).fail(function(i1){Q.sap.log.error(i1);});}).fail(function(i){Q.sap.log.error(i);});}}function N(i){this.oResetButton.setEnabled(i);}function T(i){this.oSaveButton.setEnabled(i);var q=this.oMessagePopOver.getModel(),e1=q.getProperty("/Counter/Error");this.bError=(e1>0);}function U(i){var q=new RegExp("((http|https)(:\/\/))?([a-zA-Z0-9]+[.]{1}){2}[a-zA-z0-9]+(\/{1}[a-zA-Z0-9]+)*\/?","i");return q.test(i);}function W(i,q){if(q==="targetUri"){return!U(i)&&(!!i||i==="");}else{return!(i.trim().length);}}function X(q){var e1=q.getParameter("path"),f1="",g1,i,h1,i1,j1,k1;var l1=_();if(e1==="/title"||e1==="title"||e1==="/viewName"||e1==="targetUri"||e1==="value"){var m1=q.getParameter("value"),n1=W(m1,e1),o1,p1=q.getParameter("context");if(e1==="/viewName"){o1=q.getSource().getProperty("/selectedKey");f1=l1&&l1.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");e1="/tabs/"+(o1-1)+"/value";}if(e1==="value"){f1=l1&&l1.getText("OVP_KEYUSER_INPUT_ERROR_VIEW_NAME");e1=p1.getPath()+"/"+e1;}if(e1.indexOf("/title")!==-1){f1=l1&&l1.getText("OVP_KEYUSER_INPUT_ERROR");}if(p1&&p1.getPath().indexOf("staticContent")!==-1){g1=p1.getPath().split("/");if(e1==="title"){f1=l1.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_TITLE")+(parseInt(g1[g1.length-1],10)+1);}else if(e1==="targetUri"){f1=l1.getText("OVP_KEYUSER_INPUT_ERROR_RECORD_URL")+" "+(parseInt(g1[g1.length-1],10)+1);}e1=p1.getPath()+"/"+e1;}h1=this.oMessagePopOver.getModel();i1=h1.getProperty("/Messages");j1=h1.getProperty("/Counter/All");k1=h1.getProperty("/Counter/Error");if(n1){T.bind(this)(true);for(i=0;i<i1.length;i++){if(i1[i].fieldName===e1){i1.splice(i,1);j1--;k1--;i--;}}i1.push({"type":"Error","title":f1,"fieldName":e1,"counter":k1+1});j1++;k1++;}else{T.bind(this)(true);for(i=0;i<i1.length;i++){if(i1[i].fieldName===e1){i1.splice(i,1);j1--;k1--;i--;}}}h1.setProperty("/Messages",i1);h1.setProperty("/Counter/All",j1);h1.setProperty("/Counter/Error",k1);h1.refresh(true);}else if(e1==="/staticContent,title"||e1==="/staticContent,targetUri"||e1==="/tabs,value"){g1=e1.split(",");h1=this.oMessagePopOver.getModel();i1=h1.getProperty("/Messages");j1=h1.getProperty("/Counter/All");k1=h1.getProperty("/Counter/Error");T.bind(this)(true);for(i=0;i<i1.length;i++){if(i1[i].fieldName.indexOf(g1[0])!==-1&&i1[i].fieldName.indexOf(g1[1])!==-1){i1.splice(i,1);j1--;k1--;i--;}}h1.setProperty("/Messages",i1);h1.setProperty("/Counter/All",j1);h1.setProperty("/Counter/Error",k1);h1.refresh(true);}}function Y(){var i=this.oMessagePopOver.getModel();i.setProperty("/Messages",[]);i.setProperty("/Counter/All",0);i.setProperty("/Counter/Error",0);i.setProperty("/Counter/Success",0);i.setProperty("/Counter/Warning",0);i.setProperty("/Counter/Information",0);i.refresh(true);}function Z(){var i=new L({text:"Show more information",href:"",target:"_blank"});var q=new b({type:"{type}",title:"{title}",description:"{description}",subtitle:"{subtitle}",counter:"{counter}",fieldName:"{fieldName}",link:i});this.oMessagePopOver=new M({items:{path:"/Messages",template:q}});var e1={"Counter":{"All":0,"Error":0,"Success":0,"Warning":0,"Information":0},"Messages":[]};var f1=new J(e1);this.oMessagePopOver.setModel(f1);this.oMessagePopOverButton.setModel(f1);}function $(i,q){var e1=i.byId("sapOvpSettingsForm");if(e1){var f1=e1.getDomRef();if(f1){f1.style.width=q;}}}function a1(i){var q=this.dialogBox.getContent()[0],e1=q.getModel(),f1=q.getModel("deviceMediaProperties");switch(i.name){case"S":case"M":f1.setProperty("/deviceMedia","Column");$(q,"100%");break;case"L":case"XL":default:f1.setProperty("/deviceMedia","Row");$(q,"calc(100% - "+(e1.getProperty("/dialogBoxWidth")+1)+"rem)");break;}f1.refresh(true);}function b1(){a.media.detachHandler(a1.bind(this),null,"SettingsViewRangeSet");a.media.removeRangeSet("SettingsViewRangeSet");}function c1(){a.media.initRangeSet("SettingsViewRangeSet",[520,760,960],"px",["S","M","L","XL"]);a.media.attachHandler(a1.bind(this),null,"SettingsViewRangeSet");a1.bind(this)(a.media.getCurrentRange("SettingsViewRangeSet"));}var d1={oOvpResourceBundle:_(),dialogBox:undefined,oSaveButton:undefined,oResetButton:undefined,oMessagePopOverButton:undefined,oMessagePopOver:undefined,oAppDescriptor:undefined,oOriginalAppDescriptor:undefined,oMainComponent:undefined,oAppComponent:undefined,oNewDataSources:{},sApplicationId:"",oi18nModel:undefined,iContentHeightForDialog:38,iContentHeightForDialogWithViewSwitch:33,aVariantNames:S.aVariantNames,getDataSources:g,removeDataSources:f,setDataSources:s,attachWindowResizeHandler:c1,detachWindowResizeHandler:b1,settingFormWidth:$,addKPINavApplicationName:G,addManifestSettings:F,setVisibilityForFormElements:z,getVisibilityOfElement:y,enableResetButton:N,enableSaveButton:T,checkClonedCard:w,resetErrorHandling:Y,createErrorCard:j,setErrorMessage:k,getQualifier:l,getTrimmedDataURIName:h,addSupportingObjects:I,oVisibility:S.oVisibility,bError:false,bNewStaticLinkListCardFlag:false,bNewKPICardFlag:false,getDialogBox:function(i){return new Promise(function(e1,f1){if(!this.dialogBox){this.oSaveButton=new B("settingsSaveBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("save"),type:"Emphasized"});var g1=new B("settingsCancelBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("cancelBtn")});this.oResetButton=new B("settingsResetBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("resetCardBtn")});this.oMessagePopOverButton=new B("settingsMessagePopOverBtn",{text:"{/Counter/All}",type:"Emphasized",icon:"sap-icon://message-popup",visible:"{= ${/Counter/All} === 0 ? false : true}"}).addStyleClass("sapOvpSettingsMessagePopOverBtn");this.dialogBox=new D("settingsDialog",{title:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("settingsDialogTitle"),buttons:[this.oMessagePopOverButton,this.oSaveButton,g1,this.oResetButton],afterClose:function(M1){var K1=this.dialogBox.getContent()[0],N1=K1.byId("sapOvpSettingsLineItemTitle"),O1=K1.byId("sapOvpSettingsLineItemSubTitle");if(N1){N1.destroy();}if(O1){O1.destroy();}this.bNewStaticLinkListCardFlag=false;this.bNewKPICardFlag=false;this.dialogBox.destroyContent();this.detachWindowResizeHandler();}.bind(this)});this.dialogBox.setBusyIndicatorDelay(0);g1.attachPress(function(M1){this.dialogBox.close();}.bind(this));}this.oResetButton.setVisible(!this.bNewKPICardFlag);Z.bind(this)();var h1=this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag;var i1=i.getComponentInstance(),j1=i1.getRootControl().getModel("ovpCardProperties"),k1;this.oi18nModel=i1.getComponentData().i18n;if(this.bNewStaticLinkListCardFlag){k1={"title":"New Title","subTitle":"New Subtitle","staticContent":[],"listFlavor":"standard","template":"sap.ovp.cards.linklist","layoutDetail":j1.getProperty("/layoutDetail")};}else if(this.bNewKPICardFlag){var l1=i1.getComponentData().mainComponent.getView().getModel("JSONModelForSSB").getProperty("/d/results"),m1=l1[0];k1={"entitySet":m1.ODataEntityset,"kpiAnnotationPath":"com.sap.vocabularies.UI.v1.KPI#"+m1.KPIQualifier,"title":m1.GroupTitle,"subTitle":m1.KPITitle,"template":"sap.ovp.cards.charts.analytical","layoutDetail":j1.getProperty("/layoutDetail"),"selectedKPI":m1,"errorStatusText":undefined,"KPIData":l1};}else{k1=j1.getData();}var n1=Q.extend(true,{},k1);n1=I.call(this,n1);n1=this.addManifestSettings(n1);var o1=new J(n1),p1=i.getDomRef().offsetHeight,q1=new J(a.system),r1=new J({"deviceMedia":"Row"}),s1=i1.getComponentData(),t1=s1.mainComponent,u1=s1.appComponent,v1=(h1)?"":s1.cardId;this.oAppComponent=u1;this.oAppDescriptor=t1._getCardFromManifest(v1);this.sApplicationId=t1._getApplicationId();this.oMainComponent=t1;this.oOriginalAppDescriptor=u1._getOvpCardOriginalConfig(v1);q1.setDefaultBindingMode("OneWay");n1.dialogBoxHeight=p1;n1.dialogBoxWidth=20;if(n1.template==="sap.ovp.cards.linklist"){o1.setProperty("/listFlavorName",this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_CAROUSEL"));}else{o1.setProperty("/listFlavorName",this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_BARLIST"));}if(n1.layoutDetail==="resizable"){if(!n1.defaultSpan){n1.defaultSpan={};o1.setProperty("/defaultSpan/cols",o1.getProperty("/cardLayout/colSpan"));o1.setProperty("/defaultSpan/rows",n1.template==="sap.ovp.cards.list"||n1.template==="sap.ovp.cards.table"?o1.getProperty("/cardLayout/noOfItems"):o1.getProperty("/cardLayout/rowSpan"));}else{if(!n1.defaultSpan.rows){o1.setProperty("/defaultSpan/rows",n1.template==="sap.ovp.cards.list"||n1.template==="sap.ovp.cards.table"?o1.getProperty("/cardLayout/noOfItems"):o1.getProperty("/cardLayout/rowSpan"));}if(!n1.defaultSpan.cols){o1.setProperty("/defaultSpan/cols",o1.getProperty("/cardLayout/colSpan"));}}n1.NoOfColumns=[];var w1=1,x1=6;for(var q=w1;q<=x1;q++){n1.NoOfColumns.push({value:q});}if(p(n1.template,'chart')||n1.template==='sap.ovp.cards.linklist'){var y1=i.getComponentInstance().getComponentData().mainComponent,z1=y1.getLayout(),A1=z1.getDashboardLayoutUtil(),B1=t1._getCardId(i.getId()),C1=A1.calculateCardProperties(B1),D1=A1._getCardController(B1).getView().byId('bubbleText')?43:0,E1=C1.headerHeight+C1.dropDownHeight+D1+50,F1=Math.ceil(C1.minCardHeight/A1.getRowHeightPx())+1;n1.NoOfRows=[];n1.NoOfRows.push({name:"None",value:0});n1.NoOfRows.push({name:"Small",value:F1});n1.NoOfRows.push({name:"Standard",value:Math.ceil((E1+480)/A1.getRowHeightPx())+1});if(this.bNewStaticLinkListCardFlag||this.bNewKPICardFlag){o1.setProperty("/defaultSpan/cols",1);o1.setProperty("/defaultSpan/rows",F1);}}}var G1={};var H1=new J(G1);K(H1);if(n1.template==="sap.ovp.cards.linklist"&&n1.staticContent){C(o1);o1.setProperty("/lineItemId","linkListItem--1");o1.setProperty("/lineItemIdCounter",n1.staticContent.length);}if(n1.template==="sap.ovp.cards.charts.analytical"){var I1=t1._getCardId(i.getId());o1.setProperty("/NewKPICard",this.bNewKPICardFlag);o1.setProperty("/selectedKPICardID",I1);}this.setVisibilityForFormElements(n1);var J1=new J(this.oVisibility);o1.attachPropertyChange(X.bind(this));var K1=new sap.ui.view("settingsView",{viewName:"sap.ovp.cards.rta.SettingsDialog",type:V.XML,preprocessors:{xml:{bindingContexts:{ovpCardProperties:o1.createBindingContext("/")},models:{ovpCardProperties:o1,deviceSystemProperties:q1}}}});K1.setModel(H1,"staticCardProperties");var L1=this.oOvpResourceBundle?this.oOvpResourceBundle.oResourceModel:null;K1.setModel(o1);K1.setModel(L1,"ovpResourceModel");K1.setModel(r1,"deviceMediaProperties");K1.setModel(J1,"visibility");if(this.oi18nModel){K1.setModel(this.oi18nModel,"@i18n");}this.dialogBox.addContent(K1);this.attachWindowResizeHandler();K1.loaded().then(function(M1){var N1=M1.byId("dialogCard");if(!N1.getVisible()){N1=M1.byId("dialogCardNoPreview");var O1=K1.getModel().getProperty("/template").split("."),P1=O1[O1.length-1],Q1=this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_NO_CARD_PREVIEW_MSG",[P1]);N1.setText(Q1);}else{N1.setWidth(n1.dialogBoxWidth+"rem");}e(i,M1,h1);this.dialogBox.open();M1.getController().settingsResolve=e1;}.bind(this));}.bind(this));}};d1.fnEditCardHandler=function(i,q){var e1=i.getComponentInstance().getComponentData().mainComponent,f1=e1.getLayout(),g1=e1.getUIModel();return d1.getDialogBox(i).then(function(h1){var i1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_changeCard",content:h1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"editCardSettings",content:h1.flexibilityChange}}];if(h1.viewSwitchChange){i1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"viewSwitch",content:h1.viewSwitchChange}});}if(g1.getProperty('/containerLayout')==='resizable'){var j1=f1.getDashboardLayoutModel(),k1=f1.getDashboardLayoutUtil(),l1=e1._getCardId(i.getId()),m1=j1.getCardById(l1),n1=k1.calculateCardProperties(l1),o1=j1.getColCount(),p1='C'+o1,q1=h1.flexibilityChange.newAppDescriptor.settings.defaultSpan,r1,s1=[];if(q1&&q1.cols){i1.forEach(function(t1){if(t1.changeSpecificData.changeType==='editCardSettings'){var u1=t1.changeSpecificData.content.oldAppDescriptor;u1.settings.defaultSpan={rowSpan:m1.dashboardLayout.rowSpan,colSpan:m1.dashboardLayout.colSpan,showOnlyHeader:m1.dashboardLayout.showOnlyHeader};}});if(q1.rows===0){m1.dashboardLayout.autoSpan=false;r1=Math.ceil((n1.headerHeight+2*k1.CARD_BORDER_PX)/k1.getRowHeightPx());}else{m1.dashboardLayout.autoSpan=true;if(m1.template==='sap.ovp.cards.list'||m1.template==='sap.ovp.cards.table'){m1.dashboardLayout.noOfItems=q1.rows;}else{r1=q1.rows;}}j1._arrangeCards(m1,{row:r1,column:q1.cols},'resize',s1);j1._removeSpaceBeforeCard(s1);s1.forEach(function(t1){var u1={};u1.dashboardLayout={};u1.cardId=t1.content.cardId;u1.dashboardLayout[p1]=t1.content.dashboardLayout;i1.push({selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{changeType:"dragOrResize",content:u1}});});}}return i1;});};d1.fnCloneCardHandler=function(i,q){return P.getPayLoadForCloneCard(i).then(function(e1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:e1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:e1.flexibilityChange}}];});};d1.fnAddStaticLinkListCardHandler=function(i,q){d1.bNewStaticLinkListCardFlag=true;return d1.getDialogBox(i).then(function(e1){return[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:e1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:e1.flexibilityChange}}];});};d1.fnAddKPICardHandler=function(i,q){d1.bNewKPICardFlag=true;return d1.getDialogBox(i).then(function(e1){var f1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_addNewCard",content:e1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"newCardSettings",content:e1.flexibilityChange}}];if(e1.addODataAnnotation){f1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_addAnnotationsToOData",content:e1.addODataAnnotation}});}return f1;});};d1.fnRemoveCardHandler=function(i,q){return new Promise(function(e1,f1){c.confirm(d1.oOvpResourceBundle&&d1.oOvpResourceBundle.getText("OVP_KEYUSER_MESSAGE_BOX_WARNING_MESSAGE_DELETE"),{actions:[c.Action.DELETE,c.Action.CANCEL],icon:c.Icon.WARNING,title:d1.oOvpResourceBundle&&d1.oOvpResourceBundle.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_DELETE"),initialFocus:c.Action.CANCEL,onClose:function(g1){if(g1==="DELETE"){e1(P.getPayLoadForRemoveCard(i));}else{f1(null);}}});}).then(function(e1){var f1=[{appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_ovp_removeCard",content:e1.appDescriptorChange}},{selectorControl:i.getComponentInstance().getComponentData().appComponent.getRootControl().getController().getLayout(),changeSpecificData:{runtimeOnly:true,changeType:"removeCardContainer",content:e1.flexibilityChange}}];if(e1.removeDataSourceChange){e1.removeDataSourceChange.forEach(function(g1){f1.push({appComponent:i.getComponentInstance().getComponentData().appComponent,changeSpecificData:{appDescriptorChangeType:"appdescr_app_removeDataSource",content:g1}});});}return f1;},function(e1){return[];});};return d1;},true);
