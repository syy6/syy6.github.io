sap.ui.define(["jquery.sap.global","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/charts/VizAnnotationManager","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/app/resources"],function(q,U,C,V,a,N,D,b,c,O){"use strict";var d={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line"};var e={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};function f(){var i={locale:function(){},format:function(v,j){var k="";if(j){k=j.split('/');}if(k.length>0){var x,J;if(k.length==3){x=Number(k[1]);J=Number(k[2]);if(isNaN(x)){x=-1;}if(isNaN(J)){J=0;}}else{x=2;J=0;}if(k[0]=="axisFormatter"||(k[0]=="ShortFloat")){var K;K=N.getFloatInstance({style:'short',minFractionDigits:x,maxFractionDigits:x});if(k[0]=="ShortFloat"){K=N.getFloatInstance({style:'short',minFractionDigits:x,maxFractionDigits:x});}if(x===-1){K=N.getFloatInstance({style:'short'});}return K.format(Number(v));}else if(k[0]==="tooltipNoScaleFormatter"){var L=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:J,showScale:false,minFractionDigits:x,maxFractionDigits:x});if(x===-1){L=N.getCurrencyInstance({style:'short',currencyCode:false});}return L.format(Number(v));}else if(k[0]=="CURR"){var M=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:x,maxFractionDigits:x});if(x===-1){M=N.getCurrencyInstance({style:'short',currencyCode:false});}return M.format(Number(v));}else if(k[0].search("%")!==-1){var P=N.getPercentInstance({style:'short',minFractionDigits:x,maxFractionDigits:x});if(x===-1){P=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=P.format(Number(v));return v;}}if(v.constructor===Date){var Q=D.getDateTimeInstance({pattern:j});if(j==="YearMonthDay"){Q=D.getDateInstance({style:"medium"});}v=Q.format(new Date(v));}return v;}};b.numericFormatter(i);}function g(i,j,k,M,v,x){M=typeof M==="undefined"?false:M;var J=false;var K;if(!i&&M){q.sap.log.error(v+e.CARD_ERROR+k+e.IS_MANDATORY);return J;}if(!i){q.sap.log.warning(v+e.CARD_WARNING+k+e.IS_MISSING);J=true;return J;}K=j[i];if(!K||typeof K!=="object"){var L=M?q.sap.log.error:q.sap.log.warning;L(v+e.CARD_ERROR+"in "+k+". ("+i+" "+e.NOT_WELL_FORMED);return J;}if(x&&x=="sap.ovp.cards.charts.analytical.analyticalChart"&&k=="Chart Annotation"&&(!K.ChartType||!K.ChartType.EnumMember)){q.sap.log.error(v+e.CARD_ERROR+e.MISSING_CHARTTYPE+e.CHART_ANNO);return J;}J=true;return J;}function h(i){var j=false;if(!i){return j;}var k;var v;var x;var J;var K;var P;var L;var M="";var Q;var R=i.getView();if(R){M="["+R.getId()+"] ";}if(!(Q=i.getCardPropertiesModel())){q.sap.log.error(M+e.CARD_ERROR+"in "+e.CARD_CONFIG+e.NO_CARD_MODEL);return j;}L=Q.getProperty("/entityType");if(!L||q.isEmptyObject(L)){q.sap.log.error(M+e.CARD_ERROR+"in "+e.CARD_ANNO);return j;}k=Q.getProperty("/selectionAnnotationPath");v=Q.getProperty("/chartAnnotationPath");J=Q.getProperty("/presentationAnnotationPath");K=Q.getProperty("/identificationAnnotationPath");P=Q.getProperty("/dataPointAnnotationPath");x=Q.getProperty("/contentFragment");j=g(k,L,"Selection Variant",false,M);j=g(v,L,"Chart Annotation",true,M,x)&&j;j=g(J,L,"Presentation Variant",false,M)&&j;j=g(K,L,"Identification Annotation",true,M)&&j;j=g(P,L,"Data Point",false,M)&&j;return j;}function l(i){return U.getConfig(i);}function m(j,k,v,x){var J=false;var M;var K;var L;var P;var Q;var R;if(!k.time||q.isEmptyObject(k.time)){return J;}if(!j){return J;}if(!j[0].Dimension||!(K=j[0].Dimension.PropertyPath)){return J;}M=s(v,x);for(var i=0;i<j.length;i++){if(j[i]&&j[i].Dimension&&j[i].Dimension.PropertyPath){K=j[i].Dimension.PropertyPath;}if(M&&M[K]){L=M[K][d.TYPE_KEY];P=M[K][d.DISPLAY_FORMAT_KEY];Q=M[K][d.SEMANTICS_KEY];R=M[K]["com.sap.vocabularies.Common.v1.IsCalendarYear"];}if(L&&P&&L.lastIndexOf("Edm.Date",0)===0&&P.toLowerCase()=="date"){J=true;return J;}if(L=="Edm.String"&&(R||Q&&Q.lastIndexOf("year",0)===0)){J=true;return J;}}return J;}function n(i,j,k){var v="";var x=l(j);var J,K;if(!x){return v;}v=x.default.type;J=i.getSetting("dataModel");K=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(m(k,x,J,K)){v=x.time.type;}return v;}n.requiresIContext=true;function o(v){var i;if(v){if(v.String){i=v.String;}else if(v.Boolean||v.Bool){i=p(v);}else{i=r(v);}}return i;}function p(v,i){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return i;}function r(v){var i;if(v){if(v.String){i=Number(v.String);}else if(v.Int){i=Number(v.Int);}else if(v.Decimal){i=Number(v.Decimal);}else if(v.Double){i=Number(v.Double);}else if(v.Single){i=Number(v.Single);}}return i;}function s(i,j){var k=U.cacheODataMetadata(i);if(!k){return undefined;}return k[j];}function t(v,J){v.attachSelectData(function(K){var L=v.getModel('ovpCardProperties');var M=v.getModel();var P=L.getProperty("/entitySet");var Q=s(M,P);var R=[],S=[];var T={},W={};var X=v.getDataset().getDimensions();var Y;for(var i=0;i<X.length;i++){R.push(X[i].getIdentity());}var Z=q.map(v.getDataset()._getDataContexts(),function(x){return x.getObject();});if(K.getParameter("data")&&K.getParameter("data")[0]&&K.getParameter("data")[0].data){Y=K.getParameter("data")[0].data._context_row_number;if(Z[Y].$isOthers&&Z[Y].$isOthers==true){var $={$isOthers:true};var _={getObject:function(){return $;}};J.doNavigation(_);}else{S=Object.keys(K.getParameter("data")[0].data);for(var j=0;j<R.length;j++){for(var k=0;k<S.length;k++){if(R[j]==S[k]){T[R[j]]=Z[Y][R[j]];}for(var a1 in Z[Y]){if(Q.hasOwnProperty(a1)){W[a1]=Z[Y][a1];}}}}var _={getObject:function(){return T;},getAllData:function(){return W;}};J.doNavigation(_);}}});}function u(i){if(i.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function w(i){var j=false;if(!i||i.constructor!=Array||i.length<1||i[0].constructor!=Object||!i[0].Dimension||!i[0].Dimension.PropertyPath){q.sap.log.error(e.CHART_ANNO_ERROR+"in "+e.CHART_ANNO+" "+e.DIMENSIONS_MANDATORY);return j;}j=true;return j;}function y(i){var j=false;if(!i||i.constructor!=Array||i.length<1||i[0].constructor!=Object||!i[0].Measure||!i[0].Measure.PropertyPath){q.sap.log.error(e.CHART_ANNO_ERROR+"in "+e.CHART_ANNO+" "+e.MEASURES_MANDATORY);return j;}j=true;return j;}function z(i){return i.name;}function A(i){if(i&&i.indexOf("#")!=-1){var j=i.split("#");if(j.length>1){return j[1];}}return"";}function B(k,v,x){function J(O1,P1,Q1){var R1=P1.split('.');var d1=R1.pop();var S1=R1.reduce(function(T1,U1){if(T1[U1]===undefined){T1[U1]={};}return T1[U1];},O1);if(Q1){S1[d1]=Q1;}return S1[d1];}var K,L,M,P;var Q,R,S,T,W,X,Y;var Z;var $;var _;var a1=[],b1=[];var c1=k.getChart();Q=c1.getChartType();R=l();for(var d1 in R){if(($=R[d1].reference)&&R[$]){var e1=q.extend(true,{},R[$]);R[d1]=e1;}if(R[d1].default.type==Q||(R[d1].time&&R[d1].time.type==Q)){S=R[d1];break;}}if(!S){q.sap.log.error(e.CARD_ERROR+"in "+e.CARD_CONFIG+e.CARD_CONFIG_ERROR+Q+" "+e.CARD_CONFIG_JSON);return;}if(!(K=k.getModel('ovpCardProperties'))){q.sap.log.error(e.CARD_ERROR+"in "+e.CARD_CONFIG+e.NO_CARD_MODEL);return;}var f1=k.getModel();var g1=K.getProperty("/entitySet");if(!f1||!g1){return;}L=K.getProperty("/entityType");if(!L){q.sap.log.error(e.CARD_ANNO_ERROR+"in "+e.CARD_ANNO);return;}var h1=s(f1,g1);M=K.getProperty("/chartAnnotationPath");if(!M||!(P=L[M])){q.sap.log.error(e.CARD_ANNO_ERROR+"in "+e.CARD_ANNO);return;}if(!(T=P.DimensionAttributes)||!T.length){q.sap.log.error(e.CHART_ANNO_ERROR+"in "+e.CHART_ANNO+" "+e.DIMENSIONS_MANDATORY);return;}var i1;if(!(W=P.MeasureAttributes)||!W.length){q.sap.log.error(e.CHART_ANNO_ERROR+"in "+e.CHART_ANNO+" "+e.MEASURES_MANDATORY);return;}else{var j1=W[0].DataPoint?L[W[0].DataPoint.AnnotationPath.substring(1)]:null;var k1=j1&&j1.ValueFormat&&j1.ValueFormat.NumberOfFractionalDigits&&j1.ValueFormat.NumberOfFractionalDigits.Int;i1=k1?k1:0;}Y=T.slice();X=W.slice();var l1,m1;for(var i=0;i<Y.length;i++){var n1=Y[i];if(n1&&n1.Dimension&&n1.Dimension.PropertyPath){l1=n1.Dimension.PropertyPath;if(h1&&h1[l1]){if(h1[l1][d.LABEL_KEY_V4]){m1=h1[l1][d.LABEL_KEY_V4].String?h1[l1][d.LABEL_KEY_V4].String:h1[l1][d.LABEL_KEY_V4].Path;}else if(h1[l1][d.LABEL_KEY]){m1=h1[l1][d.LABEL_KEY];}else if(l1){m1=l1;}b1.push(m1);}}}for(var j=0;j<X.length;j++){var o1=X[j];if(o1&&o1.Measure&&o1.Measure.PropertyPath){l1=o1.Measure.PropertyPath;if(h1&&h1[l1]){if(h1[l1][d.LABEL_KEY_V4]){m1=h1[l1][d.LABEL_KEY_V4].String?h1[l1][d.LABEL_KEY_V4].String:h1[l1][d.LABEL_KEY_V4].Path;}else if(h1[l1][d.LABEL_KEY]){m1=h1[l1][d.LABEL_KEY];}else if(l1){m1=l1;}a1.push(m1);}}}Z=m(T,S,f1,g1);if(Z){S=S.time;}else{S=S.default;}var p1=false;var q1=i1>0?"tooltipNoScaleFormatter/"+i1.toString()+"/":'tooltipNoScaleFormatter/-1/';var r1=new c({formatString:q1});r1.connect(c1.getVizUid());if(c1){var s1=c1.getVizProperties();var t1=true;if(S.properties&&S.properties.hasOwnProperty("hideLabel")&&!S.properties["hideLabel"]){t1=false;}var u1=false;if(Q=='donut'){u1=true;}if(s1&&s1.plotArea&&s1.plotArea.dataLabel&&s1.plotArea.dataLabel.visible){s1.plotArea.dataLabel.visible=u1;}s1.title.visible=t1?false:true;_={legend:{isScrollable:false},valueAxis:{title:{visible:t1?false:true},label:{formatString:s1.valueAxis.label.formatString+(i1?"/"+i1+"/":"")}},categoryAxis:{title:{visible:t1?false:true}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:u1,type:'value'}},interaction:{selectability:{legendSelection:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}}};var v1=K.getProperty("/colorPalette");var w1;if(P.ChartType.EnumMember===V.constants.COLUMNSTACKED_CHARTTYPE&&v1&&v1.length===4){q.each(T,function(i,O1){if(O1&&O1.Role&&O1.Role.EnumMember=="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){w1=O1.Dimension&&O1.Dimension.PropertyPath;return;}});var x1;if(w1){var y1=k.getChart();if(w1&&!x.bSorterSetForCustomCharts){var z1=y1.getBinding("data");if(z1){z1.sort([new sap.ui.model.Sorter(w1,true)]);x.bSorterSetForCustomCharts=true;}}if(h1&&h1[w1]){if(h1[w1][d.LABEL_KEY_V4]){x1=h1[w1][d.LABEL_KEY_V4].String?h1[w1][d.LABEL_KEY_V4].String:h1[w1][d.LABEL_KEY_V4].Path;}else if(h1[w1][d.LABEL_KEY]){x1=h1[w1][d.LABEL_KEY];}else if(w1){x1=w1;}}var A1=v1.map(function(O1){return O1.color;});var B1=v1.map(function(O1){return O1.legendText;});var C1=B1[0]!=undefined?B1[0]:O.getText("OTHERS");var D1=B1[1]!=undefined?B1[1]:O.getText("BAD");var E1=B1[2]!=undefined?B1[2]:O.getText("CRITICAL");var F1=B1[3]!=undefined?B1[3]:O.getText("GOOD");_.plotArea.dataPointStyle={rules:[{callback:function(x){if((x&&(x[x1]==="3"||x[x1]===3))||(x&&(x[w1]==="3"||x[w1]===3))){return true;}},properties:{color:A1[3]},"displayName":F1},{callback:function(x){if((x&&(x[x1]==="2"||x[x1]===2))||(x&&(x[w1]==="2"||x[w1]===2))){return true;}},properties:{color:A1[2]},"displayName":E1},{callback:function(x){if((x&&(x[x1]==="1"||x[x1]===1))||(x&&(x[w1]==="1"||x[w1]===1))){return true;}},properties:{color:A1[1]},"displayName":D1},{callback:function(x){if((x&&(x[x1]==="0"||x[x1]===0))||(x&&(x[w1]==="0"||x[w1]===0))){return true;}},properties:{color:A1[0]},"displayName":C1}]};}}if(P.ChartType.EnumMember===d.SCATTER_CHARTTYPE||P.ChartType.EnumMember===d.BUBBLE_CHARTTYPE||P.ChartType.EnumMember===d.LINE_CHARTTYPE){if(P&&P.AxisScaling&&P.AxisScaling.EnumMember){var G1=P.AxisScaling.EnumMember.substring(P.AxisScaling.EnumMember.lastIndexOf('/')+1,P.AxisScaling.EnumMember.length);switch(G1){case"AdjustToDataIncluding0":_.plotArea.adjustScale=false;break;case"AdjustToData":_.plotArea.adjustScale=true;break;case"MinMaxValues":var H1=[];if(P["MeasureAttributes"][0]&&P["MeasureAttributes"][0].DataPoint&&P["MeasureAttributes"][0].DataPoint.AnnotationPath){var I1=P["MeasureAttributes"][0].DataPoint.AnnotationPath;var J1=I1.substring(I1.lastIndexOf('@')+1,I1.length);if(L&&L[J1]){var K1=L[J1];if(K1&&K1.MaximumValue&&K1.MaximumValue.Decimal&&K1.MinimumValue&&K1.MinimumValue.Decimal){H1.push({feed:"valueAxis",max:K1.MaximumValue.Decimal,min:K1.MinimumValue.Decimal});}else{q.sap.log.error(e.ERROR_MISSING_AXISSCALES);}}}if(P.ChartType.EnumMember!==d.LINE_CHARTTYPE&&P["MeasureAttributes"][1]&&P["MeasureAttributes"][1].DataPoint&&P["MeasureAttributes"][1].DataPoint.AnnotationPath){var I1=P["MeasureAttributes"][1].DataPoint.AnnotationPath;var J1=I1.substring(I1.lastIndexOf('@')+1,I1.length);if(L&&L[J1]){var K1=L[J1];if(K1&&K1.MaximumValue&&K1.MaximumValue.Decimal&&K1.MinimumValue&&K1.MinimumValue.Decimal){H1.push({feed:"valueAxis2",max:K1.MaximumValue.Decimal,min:K1.MinimumValue.Decimal});}else{q.sap.log.error(e.ERROR_MISSING_AXISSCALES);}}}c1.setVizScales(H1);break;default:break;}}}var L1=K.getProperty('/ChartProperties');if(S.hasOwnProperty('vizProperties')){var M1=S.vizProperties;for(var i=0;i<M1.length;i++){if(L1&&M1[i].hasOwnProperty('path')){var N1=J(L1,M1[i].path);if(undefined!==N1){J(_,M1[i].path,N1);}}}}c1.setVizProperties(_);}[S.dimensions,S.measures].forEach(function(O1,i){var P1=i?W:T;var Q1=i?"measure(s)":"dimension(s)";if(O1.min&&P1.length<O1.min){q.sap.log.error(e.CARD_ERROR+"in "+Q+" "+e.CARD_LEAST+O1.min+" "+Q1);p1=true;}if(O1.max&&P1.length>O1.max){q.sap.log.error(e.CARD_ERROR+"in "+Q+e.CARD_MOST+O1.max+" "+Q1);p1=true;}});if(p1){return;}E(a1,b1,v);if(k){if(k._headerText){k._headerText.setTooltip(k.getHeader());k._headerText.addStyleClass("ovpChartTitle");}}}function E(j,k,v){var x="",J="",K="";if(v){x=v.getText();}if(j&&(j.length>1)){for(var i=0;i<j.length-1;i++){if(J!=""){J+=", ";}J+=j[i];}J=O.getText("MEAS_DIM_TITLE",[J,j[i]]);}else if(j){J=j[0];}if(k&&(k.length>1)){for(var i=0;i<k.length-1;i++){if(K!=""){K+=", ";}K+=k[i];}K=O.getText("MEAS_DIM_TITLE",[K,k[i]]);}else if(k){K=k[0];}if(v&&(x=="")){x=O.getText("NO_CHART_TITLE",[J,K]);v.setText(x);v.data("aria-label",x,true);}}function F(M,j){var k;q.each(j,function(i,v){if(v.name==M){if(v["com.sap.vocabularies.Common.v1.Label"]){k=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){k=v["sap:label"];}return false;}});return k;}function G(M,P,v){var i=d.TYPE_KEY;if(!M||!M[P]||!M[P][i]){return v;}var j=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var k=M[P][i];if(q.inArray(k,j)!==-1){return Number(v);}return v;}function H(S){var i=S.getModel('ovpCardProperties'),j=i.getProperty("/entityType"),k=i.getProperty("/presentationAnnotationPath"),v=j.hasOwnProperty(k)&&j[k],x=v&&v.MaxItems;if(x){return{itemsLength:+(x.Int32?x.Int32:x.Int),dataStep:+i.getProperty("/dataStep")};}}function I(S,j){S.attachDataReceived(function(k){var x=j.getView().byId("ovpCT1");var J=S._getVizFrame();var K=j.getView().byId("bubbleText");var L=O.getText("BUBBLESIZE");if(J){if(K!=undefined){var M=J.getFeeds();q.each(M,function(i,v){if(M[i].getUid()=="bubbleWidth"){var P=j.getEntitySet()&&j.getEntitySet().name;var Q=J.getModel();var R=s(Q,P);var T=M[i].getValues()&&M[i].getValues()[0]&&M[i].getValues()[0].getName();var W=F(T,R);K.setText(L+" "+W);}});}}if(!j.isVizPropSet){B(S,x,j);j.isVizPropSet=true;}});}return{getSapLabel:F,buildSmartAttributes:B,errorMessages:e,formatChartAxes:f,checkExists:g,validateCardConfiguration:h,getConfig:l,hasTimeSemantics:m,getChartType:n,getPrimitiveValue:o,getMetadata:s,getSelectedDataPoint:t,checkBubbleChart:u,dimensionAttrCheck:w,measureAttrCheck:y,getEntitySet:z,getAnnotationQualifier:A,formatByType:G,getMaxItems:H,attachDataReceived:I};},true);
