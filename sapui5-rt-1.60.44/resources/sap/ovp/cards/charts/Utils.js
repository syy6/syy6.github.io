sap.ui.define(["jquery.sap.global"],function(q){"use strict";var u={};var c={CHART_QUALIFIER_KEY:"chartAnnotationPath",SELVAR_QUALIFIER_KEY:"selectionAnnotationPath",PREVAR_QUALIFIER_KEY:"presentationAnnotationPath",ERROR_NO_CHART:"Analytic cards require valid \"chartAnnotationPath\" "+"configured in manifest.json",LABEL_KEY:"sap:label",TEXT_KEY:"sap:text",TYPE_KEY:"type"};var e={CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",CACHING_ERROR:"no model defined while caching OdataMetaData"};function g(C,d){if(!d){return"";}var s=C.getSetting('ovpCardProperties');if(!s){return"";}var S=s.oData;if(!S){return"";}var i=S&&S[d]?S[d]:"";return i===""?"":i.split("#")[1];}u.getAllColumnTexts=function(d){return a("sap:text",d);};u.formDimensionPath=function(d){var r="{"+d+"}";var i=this.getModel('ovpCardProperties').getProperty("/entityType");if(!i){return r;}var j=f(i);if(!j||!j[d]){return r;}var t=j[d];if(t=="Edm.DateTime"){return"{path:'"+d+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}var k=u.getAllColumnTexts(i);if(!k){return r;}r="{"+(k[d]||d)+"}";return r;};function a(p,d){var j={};var k=d.property;for(var i=0,l=k.length;i<l;i++){if(k[i].hasOwnProperty(p)&&p=="com.sap.vocabularies.Common.v1.Label"){j[k[i].name]=k[i][p].String;}else if(k[i].hasOwnProperty(p)){j[k[i].name]=k[i][p];}else{j[k[i].name]=k[i].name;}}return j;}function b(d){return a("com.sap.vocabularies.Common.v1.Label",d);}function f(d){return a("type",d);}var h={};u.LineChart=(function(){function j(C,o,p){var r=k(C,p).split(",");var s=l(C,o).split(",");var v=[];q.each(r,function(i,m){v.push(m);});var w=[];q.each(s,function(i,d){w.push(d);});var D=true;var N=C.getSetting("ovpCardProperties").getProperty("/navigation");if(N=="chartNav"){D=false;}var D=D?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{   visible:false,   text: '"+v.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, categoryAxis:{  title:{   visible:false,   text: '"+w.join(",")+"'  },  label:{   formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, general: { groupData: false }, interaction:{  noninteractiveMode: "+D+",  selectability: {   legendSelection: false,   axisLabelSelection: false,   mode: 'EXCLUSIVE',   plotLassoSelection: false,   plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }";}j.requiresIContext=true;function k(C,d){var o=C.getSetting('ovpCardProperties').getProperty("/entityType");if(!o){return"";}var p=b(o);var r=[];q.each(d,function(i,m){r.push(p[m.Measure.PropertyPath]||m.Measure.PropertyPath);});return r.join(",");}k.requiresIContext=true;function l(C,m){var o=C.getSetting('ovpCardProperties').getProperty("/entityType");if(!o){return"";}var p=b(o);var r=[];var s;var v;q.each(m,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Category"){v=p[d.Dimension.PropertyPath];r.push(v?v:d.Dimension.PropertyPath);}});if(r.length<1){v=p[m[0].Dimension.PropertyPath];r.push(v?v:m[0].Dimension.PropertyPath);}s=g(C,c.CHART_QUALIFIER_KEY);h[s]=r;return r.join(",");}l.requiresIContext=true;function n(C,m){var r=[];var o;var p=C.getSetting('ovpCardProperties').getProperty("/entityType");if(!p){return"";}var s=b(p);var v;q.each(m,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Series"){v=s[d.Dimension.PropertyPath];r.push(v?v:d.Dimension.PropertyPath);}});o=g(C,c.CHART_QUALIFIER_KEY);r=q.grep(r,function(d){if(!h[o]){return true;}return d!==h[o][0];});return r.join(",");}n.requiresIContext=true;function t(C,d){return n(C,d)!=="";}t.requiresIContext=true;return{getVizProperties:j,getValueAxisFeed:k,getCategoryAxisFeed:l,getColorFeed:n,testColorFeed:t};})();u.BubbleChart=(function(){function j(C,d,v){var w=l(C,v).split(",");var x=n(C,v).split(",");var y=[];q.each(w,function(i,m){y.push(m);});var z=[];q.each(x,function(i,m){z.push(m);});var D=true;var N=C.getSetting("ovpCardProperties").getProperty("/navigation");if(N=="chartNav"){D=false;}var D=D?false:true;return"{ valueAxis:{  layout: { maxWidth : 0.4 }, title:{ visible:true, text: '"+y.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, valueAxis2:{  title:{ visible:true, text: '"+z.join(",")+"'  },  label:{ formatString:'axisFormatter'  } }, categoryAxis:{  title:{ visible:true  },  label:{ formatString:'axisFormatter'  } }, legend: {  isScrollable: false }, title: {  visible: false }, interaction:{  noninteractiveMode: "+D+",  selectability: { legendSelection: false, axisLabelSelection: false, mode: 'EXCLUSIVE', plotLassoSelection: false, plotStdSelection: true  }, zoom:{   enablement: 'disabled'} } }";}j.requiresIContext=true;function k(C,d){var v;if(!C||!C.getSetting||!(v=C.getSetting('ovpCardProperties'))){return[""];}var w=v.getProperty("/entityType");if(!w){return[""];}var x=b(w);var y=[null,null,null];q.each(d,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis1"){if(y[0]===null){y[0]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[1]===null){y[1]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[2]==null){y[2]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});q.each(d,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis2"){if(y[0]===null){y[0]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[1]===null){y[1]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[2]==null){y[2]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});q.each(d,function(i,m){if(m.Role.EnumMember.split("/")[1]==="Axis3"){if(y[0]===null){y[0]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[1]===null){y[1]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}else if(y[2]==null){y[2]=x[m.Measure.PropertyPath]||m.Measure.PropertyPath;}}});return y;}k.requiresIContext=true;function l(C,m){return k(C,m)[0];}l.requiresIContext=true;function n(C,m){return k(C,m)[1];}n.requiresIContext=true;function o(C,m){return k(C,m)[2];}o.requiresIContext=true;function p(C,m){var v=C.getSetting('ovpCardProperties').getProperty("/entityType");if(!v){return"";}var w=b(v);var x=[];var y;q.each(m,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Series"){y=w[d.Dimension.PropertyPath];x.push(y?y:d.Dimension.PropertyPath);}});return x.join(",");}p.requiresIContext=true;function r(C,m){var v=C.getSetting('ovpCardProperties').getProperty("/entityType");if(!v){return"";}var w=b(v);var x=[];var y;q.each(m,function(i,d){if(d.Role.EnumMember.split("/")[1]==="Category"){y=w[d.Dimension.PropertyPath];x.push(y?y:d.Dimension.PropertyPath);}});return x.join(",");}r.requiresIContext=true;function t(C,d){return p(C,d)!=="";}t.requiresIContext=true;function s(C,d){return r(C,d)!=="";}s.requiresIContext=true;return{getVizProperties:j,getMeasurePriorityList:k,getValueAxisFeed:l,getValueAxis2Feed:n,getBubbleWidthFeed:o,getColorFeed:p,getShapeFeed:r,testColorFeed:t,testShapeFeed:s};})();u.validateMeasuresDimensions=function(v,t){var m=null;var d=null;if(!v.getDataset()){q.sap.log.error("OVP-AC: "+t+" Card Error: No Dataset defined for chart.");return false;}m=v.getDataset().getMeasures();d=v.getDataset().getDimensions();switch(t){case"Bubble":if(m.length!==3||d.length<1||!m[0].getName()||!m[1].getName()||!m[2].getName()||!d[0].getName()){q.sap.log.error("OVP-AC: Bubble Card Error: Enter exactly 3 measures and at least 1 dimension.");return false;}break;case"Donut":if(m.length!==1||d.length!==1||!m[0].getName()||!d[0].getName()){q.sap.log.error("OVP-AC: Donut Card Error: Enter exactly 1 measure and 1 dimension.");return false;}break;case"Line":if(m.length<1||d.length<1||!m[0].getName()||!d[0].getName()){q.sap.log.error("OVP-AC: Line Card Error: Configure at least 1 dimensions and 1 measure.");return false;}break;}return true;};u.getSortAnnotationCollection=function(d,p,i){if(p&&p.SortOrder&&p.SortOrder.Path&&p.SortOrder.Path.indexOf('@')>=0){var s=p.SortOrder.Path.split('@')[1];var A=d.getServiceAnnotations()[i.entityType];return A[s];}return p.SortOrder;};u.oFullConfig=null;u.getConfig=function(C){if(!this.oFullConfig){try{this.oFullConfig=q.sap.loadResource({url:q.sap.getModulePath("sap.ovp.cards.charts")+"/config.json",dataType:"json",async:false});}catch(d){q.sap.log.error(e.CONFIG_LOAD_ERROR+d);}}if(!C){return this.oFullConfig;}var s;try{s=C.EnumMember.split("/")[1];}catch(d){q.sap.log.error(e.CARD_ERROR+e.INVALID_CHARTTYPE+e.ANNO_REF);return{};}if(!this.oFullConfig[s]){q.sap.log.error(e.INVALID_CONFIG+s+" "+e.CONFIG_JSON);return{};}var r;if((r=this.oFullConfig[s].reference)&&this.oFullConfig[r]){var v=q.extend(true,{},this.oFullConfig[r]);this.oFullConfig[s]=v;}return this.oFullConfig[s];};u.oCachedMetaModel={};u.cacheODataMetadata=function(m){if(!m){q.sap.log.error(e.CARD_ERROR+e.CACHING_ERROR);return;}var E=this.oCachedMetaModel[m.getId()];if(!E){E={};var M=m.getMetaModel();var o=M&&M.getODataEntityContainer();var d,p;q.each(o.entitySet,function(n,i){d=M.getODataEntityType(i.entityType);p={};q.each(d.property,function(j,P){p[P.name]=P;});E[i.name]=p;});this.oCachedMetaModel[m.getId()]=E;}return E;};return u;},true);
