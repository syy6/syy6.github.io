sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/ovp/cards/OVPCardAsAPIUtils","sap/ovp/cards/SettingsUtils","sap/ovp/cards/PayLoadUtils","sap/m/Text","sap/ui/comp/valuehelpdialog/ValueHelpDialog","sap/ovp/cards/rta/SettingsDialogConstants","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/ChangeReason","sap/m/Label","sap/ui/core/Icon","sap/m/Image","sap/m/Column","sap/m/ColumnListItem","sap/m/Table","sap/m/ListMode","sap/m/ToolbarSpacer","sap/m/SearchField","sap/ovp/cards/linklist/AnnotationHelper","sap/ovp/cards/AnnotationHelper","sap/m/Toolbar","sap/ui/core/IconPool","sap/m/IconTabBar","sap/m/IconTabFilter","sap/ui/core/mvc/ViewType","sap/m/Dialog","sap/m/Button","sap/ovp/cards/CommonUtils","sap/ui/Device","sap/ovp/app/resources"],function(q,C,J,O,s,P,T,V,S,M,F,a,b,L,I,c,d,e,f,g,h,k,l,m,n,o,p,r,t,D,B,u,v,w){"use strict";return C.extend("sap.ovp.cards.rta.SettingsDialog",{_oCardManifestSettings:{},_aRefreshNotRequired:S._aRefreshNotRequired,_aRefreshRequired:S._aRefreshRequired,oOvpResourceBundle:w,onInit:function(){s.oSaveButton.attachPress(this.onSaveButtonPress,this);s.oResetButton.attachPress(this.onResetButton,this);s.oMessagePopOverButton.attachPress(this.handleMessagePopoverPress,this);},onAfterRendering:function(){s.dialogBox.addStyleClass("sapOvpSettingsDialogBox");this.setEnablePropertyForResetAndSaveButton(false);this._oCardManifestSettings=this.getView().getModel().getData();this._oOriginalCardManifestSettings=q.extend(true,{},this._oCardManifestSettings);var i=this.getView(),j=i.getModel(),x=i.byId("dialogCard");if(!x.getVisible()){x=i.byId("dialogCardNoPreview");}x.getDomRef().style.minHeight=this._oCardManifestSettings.dialogBoxHeight+"px";i.byId("dialogCardOverlay").getDomRef().style.minHeight=this._oCardManifestSettings.dialogBoxHeight+"px";s.settingFormWidth(i,"calc(100% - "+(this._oCardManifestSettings.dialogBoxWidth+1)+"rem)");setTimeout(function(){var x=this.getView().byId("dialogCard");if(x.getVisible()){x.setBusy(false);}}.bind(this),2000);if(this._oCardManifestSettings.staticContent){this.handleErrorHandling(j,"title","/staticContent");this.handleErrorHandling(j,"targetUri","/staticContent");}if(s.bNewKPICardFlag){var y=i.getModel();var z=i.byId("sapOvpKPITable").getBinding("items").getLength();y.setProperty("/NoOfKPIItem",z);y.setProperty("/NoKPI",z);}},validateInputField:function(E){var i=E.getSource();var j=i.getValue().trim().length;if(!j){i.setValue(i.getValue().trim());}this.updateCard(E);},addView:function(E){this.setEnablePropertyForResetAndSaveButton(true);var i,j=this._oCardManifestSettings,x=this.getView().getModel();if(j.dataPointAnnotationPath&&j.dataPoint&&j.dataPoint.length){i=j.dataPoint[0].value;}if(j.tabs&&j.tabs.length){j.newViewCounter++;if(j.template==="sap.ovp.cards.charts.analytical"||j.template==="sap.ovp.cards.charts.smart.chart"){j.tabs.push({chartAnnotationPath:j.chart[0].value,dataPointAnnotationPath:i,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+j.newViewCounter)});}else{j.tabs.push({annotationPath:j.lineItem[0].value,dataPointAnnotationPath:i,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+j.newViewCounter)});}var y=j.tabs.length;j.aViews.push({text:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+j.newViewCounter),key:y,isLaterAddedView:true,isViewResetEnabled:false});var z=j.defaultViewSelected;if(j.tabs[z-1].entitySet){j.tabs[y-1].entitySet=j.allEntitySet[0].value;}this.selectViewSwitch(E,y);}else{j.tabs=[{}];S.tabFields.forEach(function(A){if(A!=='entitySet'){j.tabs[0][A]=j[A];}});j.tabs[0].value=this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" 1");if(j.template==="sap.ovp.cards.charts.analytical"||j.template==="sap.ovp.cards.charts.smart.chart"){j.tabs.push({chartAnnotationPath:j.chart[0].value,dataPointAnnotationPath:i,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" 2")});}else{j.tabs.push({annotationPath:j.lineItem[0].value,dataPointAnnotationPath:i,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" 2")});}j.selectedKey=1;j.defaultViewSelected=1;j.aViews=[{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_MAIN_VIEW"),key:0,isLaterAddedView:false,isViewResetEnabled:false},{text:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" 1 ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")"),key:1,initialSelectedKey:1,isLaterAddedView:false,isViewResetEnabled:false},{text:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" 2"),key:2,isLaterAddedView:true,isViewResetEnabled:false}];j.newViewCounter=2;this.selectViewSwitch(E,1);}this.handleErrorHandling(x,"value","/tabs");},deleteView:function(E){this.setEnablePropertyForResetAndSaveButton(true);var i=this._oCardManifestSettings,j=parseInt(i.selectedKey,10),x=this.getView().getModel();i.tabs.splice(j-1,1);i.aViews.splice(j,1);if(j===i.defaultViewSelected){i.defaultViewSelected=1;i.aViews[j].text=i.aViews[j].text+" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}i.aViews.forEach(function(y,z){if(z>=j){y.key--;}});this.handleErrorHandling(x,"value","/tabs");if(i.tabs.length==1){S.tabFields.forEach(function(y){var z=i.tabs[0][y];if(y!=='entitySet'||(y==='entitySet'&&z)){i[y]=z;}});delete i.selectedKey;delete i.defaultViewSelected;delete i.tabs;delete i.aViews;i.aViews=[{text:this.oOvpResourceBundle.getText("OVP_KEYUSER_SHOWS_DIFFERENT_VIEWS"),key:0,initialSelectedKey:0,isLaterAddedView:false,isViewResetEnabled:false}];s.addManifestSettings(i);s.setVisibilityForFormElements(i);this.getView().getModel("visibility").refresh();this.getView().getModel().refresh();this._fCardWithRefresh();}else{i.selectedKey=1;this.selectViewSwitch(E,i.selectedKey);}},resetView:function(){var i=this._oCardManifestSettings,j=this.getView().getModel(),x=parseInt(i.selectedKey,10),y=i.aViews[x],z=i.defaultViewSelected;if(!y.isLaterAddedView){var A=i.dataPointAnnotationPath?true:false,E=this._oOriginalCardManifestSettings.dataPointAnnotationPath?true:false;if(x){var G=i.aViews[x].initialSelectedKey;S.tabFields.forEach(function(K){if(K!=="dataPointAnnotationPath"||A){if(this._oOriginalCardManifestSettings.tabs&&this._oOriginalCardManifestSettings.tabs.length){var N=this._oOriginalCardManifestSettings.tabs[G-1][K];if(K!=='entitySet'||(K==='entitySet'&&N)){i[K]=N;i.tabs[x-1][K]=i[K];}}else{if(K!=='entitySet'){i[K]=this._oOriginalCardManifestSettings[K];i.tabs[x-1][K]=i[K];}}}}.bind(this));if(!this._oOriginalCardManifestSettings.tabs||!this._oOriginalCardManifestSettings.tabs.length){i.newViewCounter++;i.tabs[x-1].value=this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+i.newViewCounter);}if(x===i.defaultViewSelected){i.aViews[x].text=i.tabs[x-1].value+" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}else{i.aViews[x].text=i.tabs[x-1].value;}}else{S.mainFields.forEach(function(K){i[K]=this._oOriginalCardManifestSettings[K];}.bind(this));if(A!==E){if(E){i.tabs.forEach(function(K){if(K.prevDataPointAnnotationPath){K.dataPointAnnotationPath=K.prevDataPointAnnotationPath;}else{K.dataPointAnnotationPath=i.dataPoint[0].value;}});i.dataPointAnnotationPath=i.tabs[z].dataPointAnnotationPath;}else{i.tabs.forEach(function(K){K.prevDataPointAnnotationPath=K.dataPointAnnotationPath;K.dataPointAnnotationPath=undefined;});}}}}else{var H;if(i.dataPointAnnotationPath){H=i.dataPoint[0].value;}i.newViewCounter++;if(i.template==="sap.ovp.cards.charts.analytical"||i.template==="sap.ovp.cards.charts.smart.chart"){i.tabs[x-1]={chartAnnotationPath:i.chart[0].value,dataPointAnnotationPath:H,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+i.newViewCounter)};}else{i.tabs[x-1]={annotationPath:i.lineItem[0].value,dataPointAnnotationPath:H,value:this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+i.newViewCounter)};}if(x===i.defaultViewSelected){i.aViews[x].text=this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+i.newViewCounter+" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")");}else{i.aViews[x].text=this.oOvpResourceBundle&&(this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_VIEW_NAME")+" "+i.newViewCounter);}S.tabFields.forEach(function(K){var N=i.tabs[x-1][K];if(K!=='entitySet'||(K==='entitySet'&&N)){i[K]=N;}});}this.handleErrorHandling(j,"value","/tabs");i.isViewResetEnabled=false;i.aViews[x].isViewResetEnabled=false;s.addManifestSettings(i);s.setVisibilityForFormElements(i);this.getView().getModel("visibility").refresh();this.getView().getModel().refresh();this._fCardWithRefresh();},selectViewSwitch:function(E,i){var j=this._oCardManifestSettings,x=this.getView().getModel();if(!i){i=E.getSource().getSelectedIndex();}if(this.defaultViewSwitch){this.defaultViewSwitch.setEnabled(true);}this.setEnablePropertyForResetAndSaveButton(true);var y=j.metaModel,z,A=j.defaultViewSelected;if(!i){j.selectedKey=i;j.mainViewSelected=true;j.isViewResetEnabled=j.aViews[i].isViewResetEnabled;S.tabFields.forEach(function(K){var N=j.tabs[A-1][K];if(K!=='entitySet'||(K==='entitySet'&&N)){j[K]=N;}});this.handleErrorHandling(x,"value","/tabs");if(j.tabs[A-1].entitySet){z=y.getODataEntitySet(j.tabs[A-1].entitySet);j.entityType=y.getODataEntityType(z.entityType);this.resetSupportingObjectsOnEntitySetChange(j,A);}s.addManifestSettings(j);s.setVisibilityForFormElements(j);this.getView().getModel("visibility").refresh();this.getView().getModel().refresh();this._fCardWithRefresh();}else{j.mainViewSelected=false;j.isViewResetEnabled=j.aViews[i].isViewResetEnabled;var G=this.getView().byId("dialogCard");if(G.getVisible()){var R=G.getComponentInstance().getRootControl();var H=R.getController();H.changeSelection(i,true,j);this.handleErrorHandling(x,"value","/tabs");if(j.tabs[i-1].entitySet){z=y.getODataEntitySet(j.tabs[i-1].entitySet);j.entityType=y.getODataEntityType(z.entityType);this.resetSupportingObjectsOnEntitySetChange(j,A);}s.addManifestSettings(j);s.setVisibilityForFormElements(j);S.tabFields.forEach(function(K){var N=j.tabs[i-1][K];if(K!=='entitySet'||(K==='entitySet'&&N)){j[K]=N;}});if(!!j.kpiAnnotationPath){this.setAnnotationPathInModel(j,"sapOvpSettingsKPIAnnotation",j.kpiAnnotationPath);}if(!!j.selectionPresentationAnnotationPath){this.setAnnotationPathInModel(j,"sapOvpSettingsFilterAndPresentedBy",j.selectionPresentationAnnotationPath);}this.getView().getModel("visibility").refresh();this.getView().getModel().refresh();}}},resetSupportingObjectsOnEntitySetChange:function(i,j){i=s.addSupportingObjects(i);var x=i.defaultViewSelected;if(x){i.aViews[x].text=i.tabs[x-1].value;}i.aViews[j].text+=" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";i.defaultViewSelected=j;},setAnnotationPathInModel:function(i,j,x){if(i.entityType[x]){this.setVariant(i,x);}if(j==="sapOvpSettingsKPIAnnotation"){s.addKPINavApplicationName(i);}},setCurrentActivePageForCarouselCard:function(i){var j=this.getView().byId("dialogCard");if(j.getVisible()){var x=j.getComponentInstance(),R=x.getRootControl(),y=R.byId("pictureCarousel");if(y){var z=y.getPages(),A=z[i];y.setActivePage(A);}}},onSelectionChange:function(E){var j=E.getSource(),x=j.getModel(),y=x.getData().staticContent,z=j.getSelectedItem(),A=z.getBindingContext().getObject(),G=j.getModel("visibility");for(var i=0;i<y.length;i++){if(y[i].id===A.id){G.setProperty("/moveToTheTop",!(y.length===1||i===0));G.setProperty("/moveUp",!(y.length===1||i===0));G.setProperty("/moveDown",!(y.length===1||i===(y.length-1)));G.setProperty("/moveToTheBottom",!(y.length===1||i===(y.length-1)));G.setProperty("/delete",true);x.setProperty("/selectedItemIndex",i);G.refresh(true);if(E.getParameter("listItem")){this.setCurrentActivePageForCarouselCard(i);}break;}}},handleErrorForProperty:function(i,j,x){i.firePropertyChange({context:i.getContext(x?x:"/"),path:j,value:i.getProperty(x?(x+"/"+j):j),reason:b.Change});},handleErrorHandling:function(j,x,y){var z=j.getProperty(y);j.firePropertyChange({context:j.getContext(y),path:y+","+x,value:j.getProperty(y),reason:b.Change});for(var i=0;i<z.length;i++){var A=y+"/"+i;j.firePropertyChange({context:j.getContext(A),path:x,value:j.getProperty(A+"/"+x),reason:b.Change});}},setEnablePropertyForResetAndSaveButton:function(E){s.enableResetButton(E);s.enableSaveButton(E);},getValueInRemString:function(i){return i+"rem";},_getSelectedItemIndex:function(i){return i.getProperty("/selectedItemIndex");},_getLastItemIndex:function(i){return this._getStaticContentArray(i).length-1;},_getStaticContentArray:function(i){return i.getProperty("/staticContent");},_setStaticContentArray:function(i,j){i.setProperty("/staticContent",j);},_setSelectedItemAndScrollToElement:function(i,H){var j=this.getView(),x=j.byId("sapOvpStaticLinkListLineItem"),y=j.byId("scrollContainer"),z=j.getModel();this.handleErrorHandling(z,"title","/staticContent");this.handleErrorHandling(z,"targetUri","/staticContent");var A=x.getItems()[i];if(H){this._oList=x;this._oItem=A;this._oScrollContainer=y;var E={onAfterRendering:function(G){this._oList.removeEventDelegate(this._oDelegateOnAfter);this._oScrollContainer.scrollToElement(this._oItem);delete this._oDelegateOnAfter;delete this._oList;delete this._oScrollContainer;delete this._oItem;}};this._oDelegateOnAfter=E;x.addEventDelegate(E,this);}else{y.scrollToElement(A);}x.setSelectedItem(A);x.fireSelectionChange();},_arrangeStaticContent:function(i,j,x){var y=this._getStaticContentArray(i);y.splice(x,0,y.splice(j,1)[0]);this._setStaticContentArray(i,y);this._setSelectedItemAndScrollToElement(x);},getIndexFromIdForStaticLinkList:function(i){var j=i.split("-");return j[j.length-1];},_getImageData:function(){var i=[];i.push({"Name":"AW.png","Image":l.formUrl(this.getView().getModel().getProperty("/baseUrl"),"img/AW.png")});return i;},_getIconData:function(j){var x=o.getIconNames(),y=[];if(j){var N=j.split("://")[1],z=x.indexOf(N);x.splice(z,1);y.push({"Name":N,"Icon":o.getIconURI(N)});}for(var i=0;i<x.length;i++){y.push({"Name":x[i],"Icon":o.getIconURI(x[i])});}return y;},_getLinkListItemId:function(i,j){return i.getProperty("/staticContent/"+j+"/index");},_makeLinkListItemId:function(i){return"linkListItem--"+i;},_makeLinkListItemIndex:function(i){return"Index--"+i;},getIconAndImageDataModel:function(i){var j=this._getIconData(i),x=this._getImageData();return new J({"Icons":j,"Images":x,"NoOfIcons":j.length,"NoOfImages":x.length});},destroyTemplatesAndObjects:function(){var i=this.getView();var j=i.byId("tableFilterImage");if(j){j.destroy();}var x=i.byId("tableFilter");if(x){x.destroy();}var y=i.byId("tableFilterLinks");if(y){y.destroy();}delete this._oEvent;delete this._iCurrentRow;delete this._oModel;delete this._oVisibilityModel;delete this._oIconsDialogContentView;delete this._oLinksDialogContentView;delete this._oLineItemDialogContentView;delete this._oKPIItemDialogContentView;},onExternalUrlChange:function(E){this.setEnablePropertyForResetAndSaveButton(true);},onLinkSourceChange:function(E){var i=E.getSource(),j=i.getModel(),x=i.getModel("visibility"),y=this.getIndexFromIdForStaticLinkList(i.getId()),z=E.getParameter("selectedIndex"),A=x.getProperty("/staticLink"),G=x.getProperty("/links"),H=this._getLinkListItemId(j,parseInt(y,10));if(z===0){A[H]=false;G[H]=true;j.setProperty("/staticContent/"+y+"/targetUri",undefined);}else{A[H]=true;G[H]=false;j.setProperty("/staticContent/"+y+"/semanticObject",undefined);j.setProperty("/staticContent/"+y+"/action",undefined);j.setProperty("/staticContent/"+y+"/targetUri","");}x.setProperty("/staticLink",A);x.setProperty("/links",G);x.refresh(true);j.refresh(true);this.handleErrorForProperty(j,"targetUri","/staticContent/"+y);this.setEnablePropertyForResetAndSaveButton(true);},onRemoveVisualPress:function(E){var i=E.getSource(),j=i.getModel(),x=i.getModel("visibility"),y=this.getIndexFromIdForStaticLinkList(i.getId()),z=this._getLinkListItemId(j,parseInt(y,10)),R=x.getProperty("/removeVisual");R[z]=false;x.setProperty("/removeVisual",R);x.refresh(true);j.setProperty("/staticContent/"+y+"/imageUri",undefined);j.refresh(true);this.updateCard(E,"sapOvpSettingsStaticLinkListRemoveVisual");},createValueHelpDialogForInternalUrl:function(E){var i=E.getSource(),j=i.getModel(),x=i.getModel("staticCardProperties"),y=i.getModel("visibility"),z=this.getIndexFromIdForStaticLinkList(i.getId());this.attachBrowserHeightChangeHandler();this._oEvent=q.extend({},E);this._iCurrentRow=z;this._oModel=j;this._oVisibilityModel=y;var A=new B("linksCancelBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("cancelBtn")});this.linksDialog=new D({title:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_SELECT_APPLICATION_DIALOG"),buttons:[A]}).addStyleClass("sapOvpSettingsDialogBox");x.setProperty("/densityStyle",this.getDensityStyle());x.setProperty("/NoOfLinks",x.getProperty("/links").length);var G=new sap.ui.view("linksDialogContent",{viewName:"sap.ovp.cards.rta.SelectLinks",type:t.XML,preprocessors:{xml:{bindingContexts:{tableRows:x.createBindingContext("/")},models:{tableRows:x}}}});G.setModel(x);G.setModel(this.getView().getModel("ovpResourceModel"),"ovpResourceModel");this.linksDialog.addContent(G);G.loaded().then(function(H){this._oLinksDialogContentView=H;H.getController().updateLinkPath=function(K){var N=K.slice(1).split("-"),Q=N[0],R=N[1];this._oModel.setProperty("/staticContent/"+this._iCurrentRow+"/semanticObject",Q);this._oModel.setProperty("/staticContent/"+this._iCurrentRow+"/action",R);this._oModel.refresh(true);this.setEnablePropertyForResetAndSaveButton(true);this.cleanAndCloseDialog(A);}.bind(this);A.attachPress(function(){this.cleanAndCloseDialog(A);}.bind(this));this.linksDialog.open();setTimeout(function(){this.browserHeightChange();}.bind(this),0);}.bind(this));},onChangeVisualPress:function(E){var i=E.getSource(),j=i.getModel(),x=i.getModel("visibility"),y=this.getIndexFromIdForStaticLinkList(i.getId()),z=j.getProperty("/staticContent/"+y+"/imageUri"),N=l.isImageUrlStaticData(z);this.attachBrowserHeightChangeHandler();this._oEvent=q.extend({},E);this._iCurrentRow=y;this._oModel=j;this._oVisibilityModel=x;var A=new B("iconsCancelBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("cancelBtn")});this.iconsDialog=new D({title:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_SELECT_VISUAL_DIALOG"),buttons:[A]}).addStyleClass("sapOvpSettingsDialogBox");var R=(N)?this.getIconAndImageDataModel():this.getIconAndImageDataModel(z);R.setProperty("/densityStyle",this.getDensityStyle());var G=new sap.ui.view("iconsDialogContent",{viewName:"sap.ovp.cards.rta.SelectIcons",type:t.XML,preprocessors:{xml:{bindingContexts:{tableRows:R.createBindingContext("/")},models:{tableRows:R}}}});R.setProperty("/tableName","IconTable");G.setModel(R);G.setModel(this.getView().getModel("ovpResourceModel"),"ovpResourceModel");this.iconsDialog.addContent(G);G.loaded().then(function(H){this._oIconsDialogContentView=H;H.getController().updateIconPath=function(U){var K=this._getLinkListItemId(this._oModel,parseInt(this._iCurrentRow,10)),Q=this._oVisibilityModel.getProperty("/removeVisual");Q[K]=true;this._oVisibilityModel.setProperty("/removeVisual",Q);this._oVisibilityModel.refresh(true);this._oModel.setProperty("/staticContent/"+this._iCurrentRow+"/imageUri",U);this._oModel.refresh(true);this.updateCard(this._oEvent,"sapOvpSettingsStaticLinkListChangeVisual");this.cleanAndCloseDialog(A);}.bind(this);A.attachPress(function(){this.cleanAndCloseDialog(A);}.bind(this));this.iconsDialog.open();setTimeout(function(){this.browserHeightChange();}.bind(this),0);}.bind(this));},getDensityStyle:function(){if(!v.support.touch){return"compact";}else{return"cozy";}},cleanAndCloseDialog:function(i){if(this._oIconsDialogContentView){this._oIconsDialogContentView.destroy();}if(this._oLinksDialogContentView){this._oLinksDialogContentView.destroy();}if(this._oLineItemDialogContentView){this._oLineItemDialogContentView.destroy();}if(this._oKPIItemDialogContentView){this._oKPIItemDialogContentView.destroy();}this.destroyTemplatesAndObjects();if(this.iconsDialog){this.iconsDialog.close();}if(this.linksDialog){this.linksDialog.close();}if(this.lineItemDialog){this.lineItemDialog.close();}if(this.KPIItemDialog){this.KPIItemDialog.close();}i.destroy();this.detachBrowserHeightChangeHandler();},attachBrowserHeightChangeHandler:function(){v.resize.attachHandler(this.browserHeightChange,this);},detachBrowserHeightChangeHandler:function(){v.resize.detachHandler(this.browserHeightChange,this);},browserHeightChange:function(i){var j,x,y;if(this.iconsDialog&&this._oIconsDialogContentView){j=this.iconsDialog;x=this._oIconsDialogContentView;y="iconsScrollContainer";}else if(this.linksDialog&&this._oLinksDialogContentView){j=this.linksDialog;x=this._oLinksDialogContentView;y="linksScrollContainer";}else if(this.lineItemDialog&&this._oLineItemDialogContentView){j=this.lineItemDialog;x=this._oLineItemDialogContentView;y="lineItemScrollContainer";}else if(this.KPIItemDialog&&this._oKPIItemDialogContentView){j=this.KPIItemDialog;x=this._oKPIItemDialogContentView;y="KPIItemScrollContainer";}if(j&&x&&y){var z=j.getDomRef(),A=(i?(i.height*93)/100:s.dialogBox.getDomRef().getBoundingClientRect().height),E=z.getBoundingClientRect().height,H=Math.max(A,E)-(u.getPixelPerRem()*9),G=x.byId(y);G.setHeight(H+"px");}},handleMessagePopoverPress:function(E){s.oMessagePopOver.openBy(E.getSource());},onShowMorePress:function(E){var i=E.getSource(),j=i.getModel(),x=i.getModel("visibility"),y=this.getIndexFromIdForStaticLinkList(i.getId()),z=this._getLinkListItemId(j,parseInt(y,10)),A=x.getProperty("/showMore/"+z);if(A){x.setProperty("/showMore/"+z,false);}else{x.setProperty("/showMore/"+z,true);}x.refresh(true);},onPressDelete:function(E){this._oEvent=q.extend({},E);M.confirm(this.oOvpResourceBundle.getText("OVP_KEYUSER_MESSAGE_BOX_INFORMATION_MESSAGE_INFO"),{actions:[M.Action.OK,M.Action.CANCEL],icon:M.Icon.INFORMATION,title:this.oOvpResourceBundle.getText("OVP_KEYUSER_MESSAGE_BOX_TITLE_INFO"),initialFocus:M.Action.CANCEL,onClose:function(A){if(A==="OK"){var i=this._oEvent.getSource(),j=i.getModel("visibility"),x=i.getModel(),y=this._getStaticContentArray(x),z=this._getSelectedItemIndex(x),G=this._getLinkListItemId(x,z),H=j.getProperty("/staticLink"),K=j.getProperty("/links"),R=j.getProperty("/removeVisual"),N=j.getProperty("/showMore");delete H[G];delete K[G];delete R[G];delete N[G];j.setProperty("/staticLink",H);j.setProperty("/links",K);j.setProperty("/removeVisual",R);j.setProperty("/showMore",N);y.splice(z,1);this._setStaticContentArray(x,y);x.refresh(true);if(y.length>0){this._setSelectedItemAndScrollToElement(Math.min(parseInt(z,10),y.length-1),true);}if(y.length<=1){j.setProperty("/delete",false);}j.refresh(true);this.updateCard(this._oEvent,"sapOvpSettingsStaticLinkListDelete");}delete this._oEvent;}.bind(this)});},onPressAdd:function(E){var i=E.getSource(),j=i.getModel("visibility"),x=i.getModel(),y=this._getStaticContentArray(x),z=x.getProperty("/lineItemIdCounter"),A=this._makeLinkListItemId(z+1),G=this._makeLinkListItemIndex(z+1),H=j.getProperty("/staticLink"),K=j.getProperty("/links"),R=j.getProperty("/removeVisual"),N=j.getProperty("/showMore");x.setProperty("/lineItemIdCounter",z+1);y.unshift({"id":A,"index":G,"title":"Default Title","subTitle":"Default SubTitle","imageUri":"","imageAltText":"","targetUri":"","openInNewWindow":""});H[G]=true;K[G]=false;R[G]=false;N[G]=false;j.setProperty("/staticLink",H);j.setProperty("/links",K);j.setProperty("/removeVisual",R);j.setProperty("/showMore",N);j.refresh(true);this._setStaticContentArray(x,y);x.refresh(true);this._setSelectedItemAndScrollToElement(0);this.updateCard(E,"sapOvpSettingsStaticLinkListAdd");},onPressMoveToTheTop:function(E){var i=E.getSource().getModel();this._arrangeStaticContent(i,this._getSelectedItemIndex(i),0);this.updateCard(E,"sapOvpSettingsStaticLinkListSort");},onPressMoveUp:function(E){var i=E.getSource().getModel(),j=this._getSelectedItemIndex(i);this._arrangeStaticContent(i,j,j-1);this.updateCard(E,"sapOvpSettingsStaticLinkListSort");},onPressMoveDown:function(E){var i=E.getSource().getModel(),j=this._getSelectedItemIndex(i);this._arrangeStaticContent(i,j,j+1);this.updateCard(E,"sapOvpSettingsStaticLinkListSort");},onPressMoveToTheBottom:function(E){var i=E.getSource().getModel(),j=this._getSelectedItemIndex(i),x=this._getLastItemIndex(i);this._arrangeStaticContent(i,j,x);this.updateCard(E,"sapOvpSettingsStaticLinkListSort");},onResetButton:function(){this._oCardManifestSettings=q.extend(true,{},this._oOriginalCardManifestSettings);var i=this.getView().getModel();i.setProperty("/",this._oCardManifestSettings);s.setVisibilityForFormElements(this._oCardManifestSettings);this.getView().getModel("visibility").refresh();if(this._oCardManifestSettings.layoutDetail==="resizable"){if(this._oCardManifestSettings.stopResizing){this.getView().byId("sapOvpSettingsStopResize").setState(false);}else if(!this._oCardManifestSettings.stopResizing){this.getView().byId("sapOvpSettingsStopResize").setState(true);}}s.resetErrorHandling();this.setEnablePropertyForResetAndSaveButton(false);this._fCardWithRefresh();},onSaveButtonPress:function(){if(s.bError){s.oMessagePopOverButton.firePress();}else{this.createAndSubmitChange.bind(this)();}},onResizingChange:function(E){var i=E.getParameter("state");this._oCardManifestSettings.stopResizing=!i;this.updateCard(E);},onNumberOfRowsChanged:function(E){var R=+this._oCardManifestSettings.defaultSpan.rows;this._oCardManifestSettings.defaultSpan.rows=R;this._oCardManifestSettings.defaultSpan.showOnlyHeader=(R===0);this._oCardManifestSettings.cardLayout.showOnlyHeader=(R===0);var i=["sap.ovp.cards.list","sap.ovp.cards.table"];if(i.indexOf(this._oCardManifestSettings.template)!==-1){this._oCardManifestSettings.cardLayout.noOfItems=R;}else{this._oCardManifestSettings.cardLayout.rowSpan=R;}this.updateCard(E);},onNumberOfColumnsChanged:function(E){this._oCardManifestSettings.defaultSpan.cols=+this._oCardManifestSettings.defaultSpan.cols;this.updateCard(E);},setBusy:function(i){if(i){this.getView().addStyleClass("dialogContainerOverlay");var j=this.getView().byId("dialogCard");if(j.getVisible()&&j.getComponentInstance()){j.getComponentInstance().getRootControl().setBusy(i);}}else{this.getView().removeStyleClass("dialogContainerOverlay");setTimeout(function(){var j=this.getView().byId("dialogCard");if(j.getVisible()&&j.getComponentInstance()){j.getComponentInstance().getRootControl().setBusy(i);}}.bind(this),2000);}},_fCardWithoutRefresh:function(E,i){var j=this.getView(),x=this._oCardManifestSettings,y=j.byId("dialogCard").getComponentInstance(),R=y.getRootControl(),z=R.getController(),A=z.getCardPropertiesModel(),G,H,K=false,N;if(x.tabs&&x.tabs.length){K=true;N=parseInt(x.selectedKey,10);}if(i.formElementId==="sapOvpSettingsLineItemTitle"||i.formElementId==="sapOvpSettingsLineItemSubTitle"){G=R.byId(i.cardElementId+"--"+j.getModel().getProperty("/lineItemId"));}else{G=R.byId(i.cardElementId);if(!G){this._fCardWithRefresh(E,i.cardElementId);}}switch(i.formElementId){case"sapOvpSettingsLineItemTitle":case"sapOvpSettingsLineItemSubTitle":case"sapOvpSettingsTitle":case"sapOvpSettingsValueSelectionInfo":if(G){G.setText(E.getSource().getValue());}break;case"sapOvpSettingsSubTitle":A.setProperty("/subTitle",E.getSource().getValue());z._setSubTitleWithUnitOfMeasure();break;case"sapOvpSettingsViewName":var Q=x.viewName;H=j.getModel();G.getItems()[N-1].setText(Q);x.tabs[N-1].value=Q;if(x.defaultViewSelected===N){Q=Q+" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";}x.aViews[N].text=Q;H.refresh();break;case"sapOvpDefaultViewSwitch":if(E.getSource().getState()){var U=x.defaultViewSelected;H=j.getModel();x.defaultViewSelected=N;x.aViews[U].text=x.tabs[U-1].value;x.aViews[N].text+=" ("+this.oOvpResourceBundle.getText("OVP_KEYUSER_LABEL_DEFAULT_VIEW")+")";H.refresh();this.defaultViewSwitch=E.getSource();this.defaultViewSwitch.setEnabled(false);}break;case"sapOvpSettingsIdentification":if(K){x.tabs[N-1][i.updateProperty]=x[i.updateProperty];}break;case"sapOvpSettingsKPIHeaderSwitch":var W=j.getModel("visibility"),X=W.getData();X.dataPoint=false;X.valueSelectionInfo=false;if(K){x.tabs.forEach(function(Z){Z.prevDataPointAnnotationPath=Z.dataPointAnnotationPath;Z.dataPointAnnotationPath=undefined;});}else{var Y=x.dataPointAnnotationPath;if(Y){x.prevDataPointAnnotationPath=Y;}x.dataPointAnnotationPath=undefined;}W.refresh(true);G.destroy();break;default:break;}},_fCardWithRefresh:function(E,i){var j,x,y,z,A,G=this._oCardManifestSettings,H=this.getView(),K=H.byId("dialogCard"),N=(!K.getComponentInstance())?undefined:K.getComponentInstance().getComponentData(),Q=(!N)?"Dialog":N.cardId,R=(!N)?undefined:N.manifest.cards[Q].model,U={cards:{}},W=false,X;if(G.tabs&&G.tabs.length){W=true;X=parseInt(G.selectedKey,10);}switch(i){case"subTitleSwitch":y=this.getView();z=y.getModel("visibility");if(E.getSource().getState()){if(W){x=G.defaultViewSelected;G.tabs.forEach(function(d1){j=d1.prevDynamicSubtitleAnnotationPath;if(j){d1.dynamicSubtitleAnnotationPath=j;}else{d1.dynamicSubtitleAnnotationPath=G.dynamicSubTitle[0].value;}});G.dynamicSubtitleAnnotationPath=G.tabs[x-1].dynamicSubtitleAnnotationPath;}else{j=G.prevDynamicSubtitleAnnotationPath;if(j){G.dynamicSubtitleAnnotationPath=j;}else{G.dynamicSubtitleAnnotationPath=G.dynamicSubTitle[0].value;}}H.byId("sapOvpSettingsDynamicSubTitle").setSelectedKey(G.dynamicSubtitleAnnotationPath);}else{if(W){G.tabs.forEach(function(d1){d1.prevDynamicSubtitleAnnotationPath=d1.dynamicSubtitleAnnotationPath;d1.dynamicSubtitleAnnotationPath=undefined;});G.dynamicSubtitleAnnotationPath=undefined;}else{var Y=G.dynamicSubtitleAnnotationPath;if(Y){G.prevDynamicSubtitleAnnotationPath=Y;}G.dynamicSubtitleAnnotationPath=undefined;}}z.setProperty("/subTitle",s.getVisibilityOfElement(G,"subTitle",W));z.setProperty("/dynamicSubTitle",s.getVisibilityOfElement(G,"dynamicSubTitle",W)&&!!G["dynamicSubTitle"]&&!!G["dynamicSubTitle"].length);z.refresh(true);break;case"kpiHeader":y=this.getView();z=y.getModel("visibility");A=z.getData();A.valueSelectionInfo=true;A.dataPoint=true;if(G.tabs&&G.tabs.length){A.dataPoint=s.getVisibilityOfElement(G,"dataPoint",true);}if(!G.valueSelectionInfo){G.valueSelectionInfo=" ";}if(W){x=G.defaultViewSelected;G.tabs.forEach(function(d1){j=d1.prevDataPointAnnotationPath;if(j){d1.dataPointAnnotationPath=j;}else{d1.dataPointAnnotationPath=G.dataPoint[0].value;}});G.dataPointAnnotationPath=G.tabs[x-1].dataPointAnnotationPath;}else{j=G.prevDataPointAnnotationPath;if(j){G.dataPointAnnotationPath=j;}else{G.dataPointAnnotationPath=G.dataPoint[0].value;}}z.refresh(true);break;case"listType":G[i]=(E.getSource().getState())?"extended":"condensed";break;case"listFlavor":G[i]=(E.getSource().getState())?"bar":"";break;case"entitySet":if(W){G.tabs[X-1][i]=G[i];S.resetTabFields.forEach(function(d1){delete G.tabs[X-1][d1];delete G[d1];});var Z=G.metaModel,$=Z.getODataEntitySet(G.tabs[X-1].entitySet),_=G.defaultViewSelected;G.entityType=Z.getODataEntityType($.entityType);this.resetSupportingObjectsOnEntitySetChange(G,_);}break;case"kpiAnnotationPath":if(W){G.tabs[X-1][i]=G[i];}var a1=H.byId("sapOvpSettingsKPIAnnotation").getSelectedKey();if(G.entityType[a1]){this.setVariant(G,a1);}s.addKPINavApplicationName(G);break;case"selectionPresentationAnnotationPath":if(W){G.tabs[X-1][i]=G[i];}var a1=H.byId("sapOvpSettingsFilterAndPresentedBy").getSelectedKey();if(G.entityType[a1]){this.setVariant(G,a1);}break;case"listFlavorForLinkList":case"annotationPath":case"chartAnnotationPath":case"presentationAnnotationPath":case"selectionAnnotationPath":case"dynamicSubtitleAnnotationPath":case"dataPointAnnotationPath":if(W){G.tabs[X-1][i]=G[i];}break;case"noOfRows":case"ovpHeaderTitle":case"add":case"removeVisual":case"changeVisual":case"sort":case"delete":break;default:break;}U.cards[Q]={settings:G};if(s.bNewKPICardFlag){U.cards[Q].template=G.template;}else{U.cards[Q].template=N.template;}if(s.bNewKPICardFlag){if(R&&H.getModel(R)){H.getModel(R).destroy();H.setModel(null,R);}var b1=this._oCardManifestSettings.selectedKPI,c1=new sap.ui.model.odata.v2.ODataModel(b1.ODataURI,{'annotationURI':b1.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None});R="customer.kpi_card_model_"+s.getTrimmedDataURIName(b1.ODataURI);H.setModel(c1,R);}if(!!R){U.cards[Q].model=R;}if(s.bNewKPICardFlag){c1.getMetaModel().loaded().then(function(){var d1=O.createCardComponent(H,U,"dialogCard");d1.then(function(){H.setBusy(false);this.setBusy(false);}.bind(this)).catch(function(){s.setErrorMessage(U.cards[Q].settings,"OVP_KEYUSER_ANNOTATION_FAILURE");s.createErrorCard(H,U,Q);});}.bind(this),function(d1){q.sap.log.error(d1);this.setBusy(false);H.setBusy(false);}.bind(this));c1.attachMetadataFailed(function(){s.setErrorMessage(U.cards[Q].settings,"OVP_KEYUSER_METADATA_FAILURE");s.createErrorCard(H,U,Q);});}else{this.createCard(H,U);}},setVariant:function(i,j){var x=i.entityType[j];var y=x.SelectionVariant&&x.SelectionVariant.Path;if(/^@/.test(y)){y=y.slice(1);}i.selectionAnnotationPath=y;var z;if(j.indexOf(".KPI")!==-1){z=x.Detail&&x.Detail.DefaultPresentationVariant&&x.Detail.DefaultPresentationVariant.Path;}else if(j.indexOf(".SelectionPresentationVariant")!==-1){z=x.PresentationVariant&&x.PresentationVariant.Path;}if(/^@/.test(z)){z=z.slice(1);}i.presentationAnnotationPath=z;var A=i.entityType[i.presentationAnnotationPath]&&i.entityType[i.presentationAnnotationPath].Visualizations;for(var E=0;E<A.length;E++){var G=A[E].AnnotationPath;if(G){if(/^@/.test(G)){G=G.slice(1);}if(/.Chart/.test(G)){i.chartAnnotationPath=G;break;}}}},createCard:function(i,j){this.setBusy(true);var x=O.createCardComponent(i,j,"dialogCard");x.then(function(){this.setBusy(false);var y=this.getView().byId("sapOvpStaticLinkListLineItem");if(y){var z=y.getSelectedItem();if(z){var A=z.getId(),E=this.getIndexFromIdForStaticLinkList(A);this.setCurrentActivePageForCarouselCard(E);}}}.bind(this));x.catch(function(){this.setBusy(false);}.bind(this));},updateCard:function(E,x){var y=this._oCardManifestSettings,z=this.getView().byId("dialogCard");this.setEnablePropertyForResetAndSaveButton(true);if(z.getVisible()){if(y.tabs&&y.tabs.length){var A=parseInt(y.selectedKey,10);y.isViewResetEnabled=true;y.aViews[A].isViewResetEnabled=true;}var G=E.getSource(),H=(x)?x:G.getId(),K=false;if(H.indexOf("sapOvpStaticLinkListLineItem")!==-1){var N=G.getModel(),Q=N.getData().staticContent,R=this.getIndexFromIdForStaticLinkList(H);this.setCurrentActivePageForCarouselCard(R);N.setProperty("/lineItemId",Q[R].id);if(H.indexOf("sapOvpSettingsLineItemTitle")!==-1){H="sapOvpSettingsLineItemTitle";}else if(H.indexOf("sapOvpSettingsLineItemSubTitle")!==-1){H="sapOvpSettingsLineItemSubTitle";}}for(var i=0;i<this._aRefreshNotRequired.length;i++){if(H.indexOf(this._aRefreshNotRequired[i].formElementId)>-1){if(this._aRefreshNotRequired[i].isKpiSwitch&&E.getSource().getState()){break;}this._fCardWithoutRefresh(E,this._aRefreshNotRequired[i]);K=true;break;}}if(!K){for(var j=0;j<this._aRefreshRequired.length;j++){if(H.indexOf(this._aRefreshRequired[j].formElementId)>-1){this.setBusy(true);this._fCardWithRefresh(E,this._aRefreshRequired[j].updateProperty);break;}}}}},onExit:function(){s.oSaveButton.detachPress(this.onSaveButtonPress,this);s.oResetButton.detachPress(this.onResetButton,this);s.oMessagePopOverButton.detachPress(this.handleMessagePopoverPress,this);},getListItems:function(){var i=[],j=this._oCardManifestSettings,x=this.getView(),y=x.byId("dialogCard"),z=y.getComponentInstance().getComponentData(),A=j.entityType.$path+"/"+j.annotationPath,E=z.model.getMetaModel(),G=E.getContext(E.resolve(A,this.oView.getBindingContext()));var H=2,K=1,N=0;if(j.listFlavor==="bar"){H=1;K=2;}if(j.listType&&j.listType.toLowerCase()==="extended"){H=6;K=3;N=3;if(j.listFlavor==="bar"){H=5;}}else if(j.contentFragment==="sap.ovp.cards.table.Table"){H=3;K=1;N=1;}j.lineItem.forEach(function(Q){var R=m.getSortedDataPoints(G,Q.fields),U=m.getSortedDataFields(G,Q.fields),W=[],X=[];R.forEach(function(_){if(_.Title){X.push(_.Title.String);}});U.forEach(function(_){if(_.Label){W.push(_.Label.String);}});var Y=Math.min(X.length,K),Z=Math.min(N,Y),$=W.slice(0,H-Z).concat(X.slice(0,Y));$.map(function(_){return _.charAt(0).toUpperCase()+_.substr(1);});i.push({Value:Q.value,Label:Q.name,VisibleFields:$.toString()});});return i;},onSearch:function(E){var i=this.getView(),j=i.getModel(),x;this._filterTable(E,["GroupTitle","KPITitle","GroupID","KPIID","KPIQualifier"],"sapOvpKPITable");x=i.byId("sapOvpKPITable").getBinding("items").getLength();j.setProperty("/NoOfKPIItem",x);j.refresh(true);},_filterTable:function(E,j,x){var Q=E.getParameter("query"),G=null,y=[];for(var i=0;i<j.length;i++){y.push(new F(j[i],a.Contains,Q));}if(Q){G=new F(y,false);}this.getView().byId(x).getBinding("items").filter(G,"Application");},onItemPress:function(E){this.getView().setBusy(true);this.getView().setBusyIndicatorDelay(0);var i=E.getSource(),j=i.getBindingContext(),K=j.getObject();this.getView().byId("sapOvpSettingsTitle").setValue(K.GroupTitle);this.getView().byId("sapOvpSettingsSubTitle").setValue(K.KPITitle);this.onKPIUpdate(K);this.updateCard(E,"sapOvpSettingsNewKPICard");},onKPIUpdate:function(K){this._oCardManifestSettings.entitySet=K.ODataEntityset;this._oCardManifestSettings.kpiAnnotationPath="com.sap.vocabularies.UI.v1.KPI#"+K.KPIQualifier;this._oCardManifestSettings.title=K.GroupTitle;this._oCardManifestSettings.subTitle=K.KPITitle;this._oCardManifestSettings.template="sap.ovp.cards.charts.analytical";this._oCardManifestSettings.selectedKPI=K;},onSeePress:function(){this.attachBrowserHeightChangeHandler();var i=new B("KPIItemCancelBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("cancelBtn")});this.KPIItemDialog=new D({title:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_KPI_DIALOG_TITLE"),buttons:[i]}).addStyleClass("sapOvpSettingsDialogBox");var R=new J({"KPIItem":this._oCardManifestSettings.KPIData});R.setProperty("/densityStyle",this.getDensityStyle());R.setProperty("/NoOfKPIItem",R.getProperty("/KPIItem").length);var K=new sap.ui.view("KPIItemDialogContent",{viewName:"sap.ovp.cards.rta.SelectKPI",type:t.XML,preprocessors:{xml:{bindingContexts:{tableRows:R.createBindingContext("/")},models:{tableRows:R}}}});K.setModel(R);K.setModel(this.getView().getModel("ovpResourceModel"),"ovpResourceModel");this.KPIItemDialog.addContent(K);K.loaded().then(function(j){this._oKPIItemDialogContentView=j;j.getController().updateKPIItemPath=function(x,E){this.getView().setBusy(true);this.getView().setBusyIndicatorDelay(0);this.getView().byId("sapOvpSettingsTitle").setValue(x.GroupTitle);this.getView().byId("sapOvpSettingsSubTitle").setValue(x.KPITitle);this.onKPIUpdate(x);this.updateCard(E,"sapOvpSettingsNewKPICard");this.cleanAndCloseDialog(i);}.bind(this);i.attachPress(function(){this.cleanAndCloseDialog(i);}.bind(this));this.KPIItemDialog.open();setTimeout(function(){this.browserHeightChange();}.bind(this),0);}.bind(this));},openLineItemValueHelpDialog:function(E){this.attachBrowserHeightChangeHandler();this._oEvent=q.extend({},E);var i=new B("lineItemCancelBtn",{text:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("cancelBtn")});this.lineItemDialog=new D({title:this.oOvpResourceBundle&&this.oOvpResourceBundle.getText("OVP_KEYUSER_LINEITEM_ANNO"),buttons:[i]}).addStyleClass("sapOvpSettingsDialogBox");var R=new J({"lineItem":this.getListItems()});R.setProperty("/densityStyle",this.getDensityStyle());R.setProperty("/NoOfLineItem",R.getProperty("/lineItem").length);var j=new sap.ui.view("lineItemDialogContent",{viewName:"sap.ovp.cards.rta.SelectLineItem",type:t.XML,preprocessors:{xml:{bindingContexts:{tableRows:R.createBindingContext("/")},models:{tableRows:R}}}});j.setModel(R);j.setModel(this.getView().getModel("ovpResourceModel"),"ovpResourceModel");this.lineItemDialog.addContent(j);j.loaded().then(function(x){this._oLineItemDialogContentView=x;x.getController().updateLineItemPath=function(y){var z=y.Value,A=this._oCardManifestSettings,G;if(A.tabs&&A.tabs.length){G=parseInt(A.selectedKey,10);}A.lineItemQualifier=s.getQualifier(z);A.annotationPath=z;if(A.tabs&&A.tabs.length){A.tabs[G-1].annotationPath=A.annotationPath;}this.getView().byId("sapOvpSettingsLineItem").setValue(y.Label);this._fCardWithRefresh(this._oEvent,"annotationPath");this.setEnablePropertyForResetAndSaveButton(true);if(A.tabs&&A.tabs.length){A.isViewResetEnabled=true;A.aViews[G].isViewResetEnabled=true;}this.cleanAndCloseDialog(i);}.bind(this);i.attachPress(function(){this.cleanAndCloseDialog(i);}.bind(this));this.lineItemDialog.open();setTimeout(function(){this.browserHeightChange();}.bind(this),0);}.bind(this));},createAndSubmitChange:function(){var i;if(s.bNewStaticLinkListCardFlag){i=P.getPayLoadForNewStaticLinkListCard.bind(this)(s);}else if(s.bNewKPICardFlag){i=P.getPayLoadForNewKPICard.bind(this)(s);}else{i=P.getPayLoadForEditCard.bind(this)(s);}this.settingsResolve(i);s.dialogBox.close();}});});
