sap.ui.define(["jquery.sap.global","sap/suite/ui/commons/library","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","./TAccountGroup","sap/ui/core/IconPool","sap/ui/core/Icon","sap/base/security/encodeXML","./TAccountUtils","sap/ui/thirdparty/jqueryui/jquery-ui-core","sap/ui/thirdparty/jqueryui/jquery-ui-widget","sap/ui/thirdparty/jqueryui/jquery-ui-mouse","sap/ui/thirdparty/jqueryui/jquery-ui-draggable","sap/ui/thirdparty/jqueryui/jquery-ui-droppable","sap/ui/thirdparty/jqueryui/jquery-ui-selectable"],function(q,l,C,I,T,a,b,e,c){"use strict";var r=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");var D=Object.freeze({UP:"UP",DOWN:"DOWN",PREVIOUS:"PREVIOUS",NEXT:"NEXT"});var d=C.extend("sap.suite.ui.commons.taccount.TAccount",{metadata:{library:"sap.suite.ui.commons",properties:{measureOfUnit:{type:"string",group:"Misc",defaultValue:""},collapsed:{type:"boolean",group:"Misc",defaultValue:false},title:{type:"string",group:"Misc",defaultValue:null},subtitle:{type:"string",group:"Misc",defaultValue:null}},aggregations:{debit:{type:"sap.suite.ui.commons.taccount.TAccountItem",multiple:true,singularName:"debit"},credit:{type:"sap.suite.ui.commons.taccount.TAccountItem",multiple:true,singularName:"credit"}}},renderer:function(R,A){var w=function(i,f){i.forEach(function(o){o._bIsDebit=f;R.renderControl(o);});};R.write("<div");if(A.getCollapsed()){R.addClass("sapSuiteUiCommonsAccountCollapsed");}R.addClass("sapSuiteUiCommonsAccount");R.writeClasses(A);R.writeControlData(A);R.writeAttributeEscaped("aria-label",A._getAriaLabelText());R.writeAttribute("tabindex","0");R.write(">");R.write("<div class=\"sapSuiteUiCommonsTAccountInfoIconWrapper sapSuiteUiCommonsTAccountBaseInfoIconWrapper\" title=\""+r.getText("TACCOUNT_SELECTED")+"\">");R.write("<div class=\"sapSuiteUiCommonsInfoIcon\">");R.write("!");R.write("</div>");R.write("</div>");R.write("<div class=\"sapSuiteUiCommonsAccountHeader\">");R.write("<div class=\"sapSuiteUiCommonsAccountHeaderFirst\">");R.write("<div");R.addClass("sapSuiteUiCommonsAccountHeaderExpandWrapper");if(A.getSubtitle()){R.addClass("sapSuiteUiCommonsAccountHeaderExpandWrapperTopAlign");}R.writeClasses();R.write(">");R.renderControl(A._getDownArrow());R.write("</div>");var t=e(A.getTitle()).replace(/&#xa;|\n/g,"<br>");if(A.getSubtitle()){var s=e(A.getSubtitle()).replace(/&#xa;|\n/g,"<br>");R.write("<div class=\"sapSuiteUiCommonsAccountHeaderTitleWrapper\">");R.write("<div class=\"sapSuiteUiCommonsAccountHeaderTitleWithSubtitle\">"+t+"</div>");R.write("<div class=\"sapSuiteUiCommonsAccountHeaderSubtitle\">"+s+"</div>");R.write("</div>");}else{R.write("<span class=\"sapSuiteUiCommonsAccountHeaderTitle\">"+t+"</span>");}R.write("</div>");R.write("<div class=\"sapSuiteUiCommonsAccountHeaderSecond\">");R.write("<span id=\""+A.getId()+"-sum\" class=\"sapSuiteUiCommonsAccountHeaderSUM\">"+A._getSumText()+"</span>");R.write("</div>");R.write("</div>");R.write("<div id=\""+A.getId()+"-content"+"\" class=\"sapSuiteUiCommonsAccountTWrapper\"");if(A.getCollapsed()){R.write("style=\"display:none\"");}R.write(">");R.write("<div class=\"sapSuiteUiCommonsAccountTHeader\">");R.write("<span class=\"sapSuiteUiCommonsAccountTHeaderTitle\">"+r.getText("TACCOUNT_DEBIT")+"</span>");R.write("<span class=\"sapSuiteUiCommonsAccountTHeaderTitle\">"+r.getText("TACCOUNT_CREDIT")+"</span>");R.write("</div>");R.write("<div class=\"sapSuiteUiCommonsAccountTBody\"");R.writeAttribute("role","listbox");R.write(">");R.write("<div class=\"sapSuiteUiCommonsAccountDebit\">");w(A.getDebit(),true);R.write("</div>");R.write("<div class=\"sapSuiteUiCommonsAccountCredit\">");w(A.getCredit(),false);R.write("</div>");R.write("</div>");R.write("</div>");R.write("</div>");}});d.prototype.onBeforeRendering=function(){this._bRendered=false;};d.prototype.onAfterRendering=function(){this._bRendered=true;this._setupDraggable();this._setupKeyboard();};d.prototype.onsapdownmodifiers=function(E){if(E.ctrlKey){this._handleArrowMoveEvent(E,D.DOWN);}};d.prototype.onsapupmodifiers=function(E){if(E.ctrlKey){this._handleArrowMoveEvent(E,D.UP);}};d.prototype.onsappreviousmodifiers=function(E){if(E.ctrlKey){this._handleArrowMoveEvent(E,D.PREVIOUS);}};d.prototype.onsapnextmodifiers=function(E){if(E.ctrlKey){this._handleArrowMoveEvent(E,D.NEXT);}};d.prototype._setupKeyboard=function(){if(!this._oItemNavigation){this._oItemNavigation=new I();this.addDelegate(this._oItemNavigation);}this._oItemNavigation.setRootDomRef(this.$().find(".sapSuiteUiCommonsAccountTBody")[0]);this._oItemNavigation.setItemDomRefs(this.$().find(".sapSuiteUiCommonsAccountItem"));this._oItemNavigation.setCycling(true);};d.prototype._isInGroup=function(){return this.getParent()instanceof T;};d.prototype._setupDraggable=function(){if(this._isInGroup()){var $=this.$(),p=this.getParent();$.draggable({revert:"invalid",delay:100,helper:function(){return $.clone().width($.width()).css("z-index",500);},opacity:0.6,scope:p.getId()+"-content",handle:".sapSuiteUiCommonsAccountHeader",start:function(){$.addClass("sapSuiteUiCommonsAccountItemDragging");p.$().find(".sapSuiteUiCommonsAccountGroupDroppingArea").addClass("sapSuiteUiCommonsAccountGroupDroppingAreaHighlight");},stop:function(){$.removeClass("sapSuiteUiCommonsAccountItemDragging");p.$().find(".sapSuiteUiCommonsAccountGroupDroppingArea").removeClass("sapSuiteUiCommonsAccountGroupDroppingAreaHighlight");}});}};d.prototype._getDownArrow=function(){if(!this._oArrowDown){this._oArrowDown=new b({src:"sap-icon://navigation-down-arrow",press:function(){this.setCollapsed(!this.getCollapsed());}.bind(this)}).addStyleClass("sapSuiteUiCommonsAccountGroupCollapseIcon");}return this._oArrowDown;};d.prototype._getSum=function(){if(!this._iSum){var s=0;this.getCredit().forEach(function(i){s+=i.getValue();});this.getDebit().forEach(function(i){s-=i.getValue();});this._iSum=s;}return this._iSum;};d.prototype._getAriaLabelText=function(){return"T account "+this.getTitle()+" "+this._getSumText();};d.prototype._getSumText=function(){var s=this.getMeasureOfUnit(),v=c.formatCurrency(Math.abs(this._getSum()),s);return(this._getSum()>0?r.getText("TACCOUNT_CREDIT"):r.getText("TACCOUNT_DEBIT"))+": "+v+" "+e(s);};d.prototype._valueChanged=function(i){if(this._bRendered){this._iSum=this._getSum()+i;this.$("sum").text(this._getSumText());var p=this.getParent();if(this._hasGroupParent(p)){p._valueChanged(i);}}};d.prototype._hasGroupParent=function(p){return(p||this.getParent())instanceof T;};d.prototype._handleArrowMoveEvent=function(E,o){this._moveTAccount(o);E.preventDefault();E.stopImmediatePropagation();};d.prototype._moveTAccount=function(o){var $,f,g,m,i=o===D.UP,s=true,h=this.$();var M=function(A){if(g.length===0){s=false;return;}h.detach();$.detach();g[A](h);g[A]($);};if(i||o===D.DOWN){m=i?["next","prev","insertBefore","append"]:["prev","next","insertAfter","prepend"];$=h[m[0]](".sapSuiteUiCommonsAccountGroupDroppingArea");f=h[m[1]]()[m[1]](".sapSuiteUiCommonsAccount");if(f.length!==0){h.detach()[m[2]](f);$.detach()[m[2]](f);}else{g=h.parent()[m[1]](".sapSuiteUiCommonsAccountGroupColumn");M(m[3]);}}else{$=h.prev(".sapSuiteUiCommonsAccountGroupDroppingArea");g=h.parent()[o===D.NEXT?"next":"prev"](".sapSuiteUiCommonsAccountGroupColumn");M("append");}if(s){this.getParent()._setupKeyboard();h.focus();}};d.prototype.setCollapsed=function(v){this.setProperty("collapsed",v,true);this._getDownArrow().setSrc(!v?"sap-icon://navigation-down-arrow":"sap-icon://navigation-right-arrow");this.$()[v?"addClass":"removeClass"]("sapSuiteUiCommonsAccountCollapsed");if(this.getDomRef()){this.$("content")[v?"hide":"show"]("medium");}};return d;},true);
