/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

(c) Copyright 2009-2018 SAP SE. All rights reserved
 */
sap.ui.define(["sap/ui/thirdparty/jquery","./library","sap/ui/core/Control","sap/suite/ui/microchart/RadialMicroChartRenderer","sap/ui/Device","sap/m/ValueColor","sap/base/Log","sap/ui/events/KeyCodes","sap/suite/ui/microchart/MicroChartUtils","sap/m/ValueCSSColor"],function(q,l,C,R,D,V,L,K,M,a){"use strict";var b=C.extend("sap.suite.ui.microchart.RadialMicroChart",{constructor:function(i,s){var p;if(s&&typeof s.percentage==="number"){p=true;}else if(i&&typeof i.percentage==="number"){p=true;}else{p=false;}try{C.apply(this,arguments);this._bPercentageMode=p;}catch(e){this.destroy();throw e;}},metadata:{library:"sap.suite.ui.microchart",properties:{total:{group:"Data",type:"float",defaultValue:null},fraction:{group:"Data",type:"float",defaultValue:null},percentage:{group:"Data",type:"float",defaultValue:null},valueColor:{group:"Appearance",type:"sap.m.ValueCSSColor",defaultValue:"Neutral"},size:{group:"Misc",type:"sap.m.Size",defaultValue:"Responsive"}},associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}},events:{press:{}}}});b.prototype.init=function(){this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.microchart");this._bThemeApplied=true;if(!sap.ui.getCore().isInitialized()){this._bThemeApplied=false;sap.ui.getCore().attachInit(this._handleCoreInitialized.bind(this));}else{this._handleCoreInitialized();}};b.prototype._handleCoreInitialized=function(){this._bThemeApplied=sap.ui.getCore().isThemeApplied();if(!this._bThemeApplied){sap.ui.getCore().attachThemeChanged(this._handleThemeApplied,this);}};b.prototype._handleThemeApplied=function(){this._bThemeApplied=true;this.invalidate();sap.ui.getCore().detachThemeChanged(this._handleThemeApplied,this);};b.prototype.onBeforeRendering=function(){if(l._isInGenericTile(this)){l._removeStandardMargins(this);}if(!this._getPercentageMode()){if(this.getTotal()===0){L.info("Total cannot be 0. Please add a valid total value.");}else{this.setProperty("percentage",Math.round((this.getFraction()*100/this.getTotal())*10)/10,true);}}this._unbindMouseEnterLeaveHandler();};b.prototype.onAfterRendering=function(){R._handleOnAfterRendering(this);this._bindMouseEnterLeaveHandler();};b.prototype.ontouchstart=function(e){if(this.hasListeners("press")===true){e.setMarked();}};b.prototype.ontap=function(e){if(D.browser.msie){this.$().focus();}if(this.hasListeners("press")===true){e.setMarked();}this.firePress();};b.prototype.onkeydown=function(e){if(e.which===K.SPACE){if(this.hasListeners("press")===true){e.setMarked();}e.preventDefault();}};b.prototype.onkeyup=function(e){if(e.which===K.ENTER||e.which===K.SPACE){if(this.hasListeners("press")===true){e.setMarked();}this.firePress();e.preventDefault();}};b.prototype.attachEvent=function(e,d,f,c){C.prototype.attachEvent.call(this,e,d,f,c);if(e==="press"){this.rerender();}return this;};b.prototype.detachEvent=function(e,f,c){C.prototype.detachEvent.call(this,e,f,c);if(e==="press"){this.rerender();}return this;};b.prototype._getPercentageMode=function(){return this._bPercentageMode;};b.prototype.setPercentage=function(p){if(q.type(p)==="number"){this._bPercentageMode=true;if(p!==this.getPercentage()){this.setProperty("percentage",p);}}else{this._bPercentageMode=false;this.setProperty("percentage",null);}return this;};b.prototype.getTooltip_AsString=function(){return this._getTooltipText();};b.prototype._getAccessibilityControlType=function(){return this._oRb.getText("ACC_CTR_TYPE_RADIALMICROCHART");};b.prototype._isValueColorValid=function(){return V.hasOwnProperty(this.getValueColor());};b.prototype._getTooltipText=function(i){var t=this.getTooltip_Text();if(!t){t=this._getAriaAndTooltipText(i);}else if(this._isTooltipSuppressed()){t=null;}return t;};b.prototype._getAriaText=function(i){var A=this.getTooltip_Text();if(!A||this._isTooltipSuppressed()){A=this._getAriaAndTooltipText(i);}return A;};b.prototype._isTooltipSuppressed=function(){var t=this.getTooltip_Text();if(t&&q.trim(t).length===0){return true;}else{return false;}};b.prototype._getAriaAndTooltipText=function(i){var t=this._oRb.getText("RADIALMICROCHART");if(i){t+=" "+this._oRb.getText("IS_ACTIVE");}t+="\n";if(!this._hasData()){t+=this._oRb.getText("NO_DATA");return t;}var p=this.getPercentage();if(p>100){p=100;}else if(p<0){p=0;}if(this._isValueColorValid()){t+=this._oRb.getText("RADIALMICROCHART_ARIA_LABEL",[this.getPercentage(),this._getStatusText()]);}else{t+=this._oRb.getText("RADIALMICROCHART_PERCENTAGE_TEXT",p);}return t;};b.prototype._getStatusText=function(){var v=this.getValueColor();switch(v){case V.Error:return this._oRb.getText("SEMANTIC_COLOR_ERROR");case V.Critical:return this._oRb.getText("SEMANTIC_COLOR_CRITICAL");case V.Good:return this._oRb.getText("SEMANTIC_COLOR_GOOD");case V.Neutral:return this._oRb.getText("SEMANTIC_COLOR_NEUTRAL");default:return"";}};b.prototype._addTitleAttribute=function(){if(!this.$().attr("title")&&this._hasData()){this.$().attr("title",this.getTooltip_AsString());}};b.prototype._removeTitleAttribute=function(){if(this.$().attr("title")){this.$().removeAttr("title");}};b.prototype._bindMouseEnterLeaveHandler=function(){this.$().bind("mouseenter.tooltip",this._addTitleAttribute.bind(this));this.$().bind("mouseleave.tooltip",this._removeTitleAttribute.bind(this));};b.prototype._unbindMouseEnterLeaveHandler=function(){this.$().unbind("mouseenter.tooltip");this.$().unbind("mouseleave.tooltip");};b.prototype._hasData=function(){return this._getPercentageMode()||(this.getTotal()!==0);};b.prototype.firePress=function(){if(this._hasData()){C.prototype.fireEvent.call(this,"press",arguments);}};M.extendMicroChart(b);return b;});
