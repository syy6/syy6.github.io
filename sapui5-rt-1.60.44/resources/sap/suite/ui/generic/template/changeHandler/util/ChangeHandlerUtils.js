sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/js/AnnotationHelper"],function(q,A){"use strict";var L="com.sap.vocabularies.UI.v1.LineItem";var D="com.sap.vocabularies.UI.v1.DataFieldForAnnotation";var a="com.sap.vocabularies.UI.v1.DataFieldForAction";var I="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation";var F="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation";var b="com.sap.vocabularies.UI.v1.FieldGroup";var c="com.sap.vocabularies.UI.v1.Identification";var S="com.sap.vocabularies.UI.v1.SelectionFields";var C={};var m;C.isReveal=false;C.isRevert=false;C.getMetaModel=function(s,p){if(m){return m;}m={};var i=(s.source&&s.source.id)||s.parentId||(s.removedElement&&s.removedElement.id)||(s.selector&&s.selector.id);q.extend(true,m,p.modifier.bySelector(i,p.appComponent).getModel().getMetaModel());return m;};C.getComponent=function(M){var o;while(M){if(M instanceof sap.ui.core.mvc.View){o=M.getController().getOwnerComponent();break;}else if(M instanceof sap.ui.core.UIComponent){o=M;break;}if(M.getParent){M=M.getParent();}else{break;}}return o;};C.getODataEntitySet=function(o){var M=o.getModel();var e=M&&o.getEntitySet&&o.getEntitySet();var m=M&&M.getMetaModel();return e&&m.getODataEntitySet(e);};C.getEntityType=function(e){var E;if(e){if(e.getEntityType){E=e.getEntityType();}else{var o=C.getComponent(e);var s=o&&o.getEntitySet();var m=e.getModel().getMetaModel();var d=s&&m&&m.getODataEntitySet(s);E=d&&d.entityType;}}return E;};C.getODataEntityType=function(M){var d;if(M){var o=C.getComponent(M);var e=o&&o.getEntitySet();var f=M.getModel();var g=f&&f.getMetaModel();if(g){var E=g.getODataEntitySet(e);var s=E&&E.entityType;d=g.getODataEntityType(s);}}return d;};C.getSmartFormGroupInfo=function(g,f){var o,d,s;for(var i=0;i<f.length;i++){o=f[i];if(o&&o.Facets){d=C.getSmartFormGroupInfo(g,o.Facets);if(d){return d;}}else if(o&&o.Target&&o.Target.AnnotationPath&&(o.Target.AnnotationPath.indexOf(b)>=0)||(o.Target.AnnotationPath.indexOf(c)>=0)){s=(o.ID&&o.ID.String)||o.Target.AnnotationPath;if(s===g){return{aForm:f,oGroup:o};}}}};C.getCollectionFacet=function(s,f){var o;for(var i=0;i<f.length;i++){o=f[i];if(o&&o.ID&&o.ID.String===s){return o;}else if(o&&o.Facets){var d=C.getCollectionFacet(s,o.Facets);if(d){return d;}}}};C.createFieldGroupTerm=function(e){var f="com.sap.vocabularies.UI.v1.FieldGroup#RTAGroup";var M=-1;for(var i in e){if(i.indexOf(f)>-1&&i.indexOf("RTAGroup")>-1){var s=i.substring(f.length);var d=parseInt(s,10);M=Math.max(d,M);}}M++;return f+M;};C.getSmartFilterBarControlConfiguration=function(v){var i=v.getContent()[0].getId();var f=i.substring(i.lastIndexOf("-")+1);var s=C.findSmartFilterBar(v);var o=s.getControlConfiguration().filter(function(d){return d.getKey()===f;})[0];return o;};C.findSmartFilterBar=function(e){if(!e){return;}if(e.getMetadata().getName()==="sap.ui.comp.smartfilterbar.SmartFilterBar"){return e;}else{return C.findSmartFilterBar(e.getParent());}};C.getIndexFromInstanceMetadataPath=function(o){var r=-1;var t=C.getTemplatingInfo(o);if(t&&t.path){r=parseInt(t.path.substring(t.path.lastIndexOf("/")+1),10);}return r;};C.getCustomDataObject=function(e){var d=e.getCustomData(),o={};if(!d){return;}for(var i=0;i<d.length;i++){o[d[i].getKey()]=d[i].getValue();}return o;};C.getLineItems=function(e){var o=C.getComponent(e);var E=o&&C.getODataEntityType(o);return E&&E[L];};C.getLineItemRecordIndex=function(o,l){if(!o){return;}if(!l){l=C.getLineItems(o);}if(!l){return;}var r=-1,i,p=o.data("p13nData");if(!p||!l||l.length===0){return r;}if(!p.columnKey||p.columnKey.search("template::")===-1){for(i=0;i<l.length;i++){if(l[i].Value&&l[i].Value.Path===p.leadingProperty){return i;}}return r;}var t=p.columnKey.split("::");switch(t[1]){case"DataFieldForAction":for(i=0;i<l.length;i++){if(l[i].RecordType===a&&l[i].Action.String===t[2]){return i;}}break;case"DataFieldForAnnotation":for(i=0;i<l.length;i++){if(l[i].RecordType===D&&l[i].Target&&l[i].Target.AnnotationPath&&l[i].Target.AnnotationPath.replace("@","")===t[2]){return i;}}break;case"DataFieldWithIntentBasedNavigation":for(i=0;i<l.length;i++){if(l[i].RecordType===I&&l[i].SemanticObject.String===t[2]&&l[i].Action.String===t[3]){return i;}}break;default:for(i=0;i<l.length;i++){if(l[i].Value&&l[i].Value.Path===p.leadingProperty){return i;}}break;}return r;};C.getLineItemRecordIndexForButton=function(B,l){if(!l){l=C.getLineItems(B);}if(!l){return;}var o=C.getCustomDataObject(B),d=-1,e;for(var i=0;i<l.length;++i){e=l[i];if(e.RecordType===a&&e.Action&&e.Action.String===o.Action||e.RecordType===F&&e.Action&&e.Action.String===o.Action&&e.SemanticObject&&e.SemanticObject.String===o.SemanticObject){d=i;break;}}return d;};C.getRecordIndexForSelectionField=function(v){var t=-1,e=v.getParent().getParent().getEntityType(),m=v.getModel().getMetaModel(),E=m.getODataEntityType(e),s=E&&E[S];var T=C.getTemplatingInfo(C.getSmartFilterBarControlConfiguration(v));if(T&&T.annotation===S){s.some(function(o,i){if(o.PropertyPath===T.value){t=i;return true;}});}return t;};C.getLineItemRecordForButton=function(B){var l=C.getLineItems(B);if(!l){return;}var i=C.getLineItemRecordIndexForButton(B,l);return l[i];};C.getLineItemRecordForColumn=function(o){var l=C.getLineItems(o);if(!l){return;}var i=C.getLineItemRecordIndex(o,l);return l[i];};C.getTemplatingInfo=function(e){var t;if(e){var T=e.data("sap-ui-custom-settings")&&e.data("sap-ui-custom-settings")["sap.ui.dt"]&&e.data("sap-ui-custom-settings")["sap.ui.dt"].annotation;if(T){t=JSON.parse(T);}}return t;};C.getPropertyOfColumn=function(o){var p=o.data("p13nData"),P=p&&p.leadingProperty;return P;};C.getODataPath=function(o,d){var O,t=-1,e,E=o.getElement(),m=E.getModel().getMetaModel(),f=o.getDesignTimeMetadata()&&o.getDesignTimeMetadata().getData();if(f&&q.isFunction(f.getCommonInstanceData)){e=f.getCommonInstanceData(E);}if(!e){if(!d||!d.target){return;}for(var i=0;i<d.target.length;i++){if(d.target[i]==="EntityType"){t=i;break;}else if(d.target[i]==="EntitySet"){t=i;}}if(t>-1){var s=C.getEntityType(E);if(!m.getODataEntityType){return;}var g=m.getODataEntityType(s);switch(d.target[t]){case"EntityType":O=g&&g.namespace+"."+g.name;break;case"EntitySet":var h=C.getComponent(E);var j=C.getODataEntitySet(h);var k=j&&j.name;O=g&&g.namespace+"."+k;break;default:return;}}}else{O=e.target;}if(O&&d&&d.target){O+="/"+d.namespace+"."+d.annotation;}return O;};C.getEntityTypeFromAnnotationPath=function(e,s){var E,d,o;if(!e||!s){return E;}var m=e.getModel()&&e.getModel().getMetaModel();if(!m){return E;}if(s.search("/")===-1){E=C.getODataEntityType(e);}else{o=C.getODataEntitySet(C.getComponent(e));d=A.getTargetEntitySet(m,o,s).entityType;E=m.getODataEntityType(d);}return E;};return C;});
