sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ControllerExtension","sap/ui/core/format/DateFormat","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/generic/app/navigation/service/SelectionVariant","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/detailTemplates/detailUtils","sap/suite/ui/generic/template/ObjectPage/extensionAPI/ExtensionAPI","sap/ui/model/json/JSONModel","sap/suite/ui/generic/template/js/AnnotationHelper","sap/ui/core/mvc/ViewType","sap/m/Table","sap/ui/layout/DynamicSideContent","sap/suite/ui/generic/template/lib/ShareUtils"],function(q,C,D,M,a,F,S,b,t,d,E,J,A,V,R,c,f){"use strict";function s(O){O.setSelectedSection(null);}function I(e){return e.data("inlineCreate")==="true";}function g(B,e){if(B.getBindings){var h=B.getBindings();for(var i=0;i<h.length;i++){g(h[i],e);}}else{var T=B.getType();B.setType(T,e);}}var r=/[A-Za-z].*[A-Za-z]/;var m=720;var o={getMethods:function(v,T,h){var B=d.getControllerBase(v,T,h);B.state.aUnsavedDataCheckFunctions=[];v.oController=h;var l;var O;var n;function p(e){var i=e.getParameter("bindingParams");i.parameters=i.parameters||{};i.parameters.usePreliminaryContext=true;i.parameters.batchGroupId="facets";return i;}function u(){q.sap.log.info("Activate object");var e=T.oServices.oCRUDManager.activateDraftEntity();e.then(function(i){T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(i&&i.context){var j=h.getOwnerComponent();T.oServices.oViewDependencyHelper.setAllPagesDirty([j.getId()]);T.oServices.oViewDependencyHelper.unbindChildren(j);var k=h.getOwnerComponent().getNavToListOnSave();T.oServices.oApplication.invalidatePaginatorInfo();if(k){T.oServices.oNavigationController.navigateToRoot(true);}else{T.oServices.oNavigationController.navigateToContext(i.context,undefined,true,undefined,true);}}var x={activationPromise:e};T.oComponentUtils.fire(h,"AfterActivate",x);},q.noop);}function w(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,u);}function y(){var e=h.getView().getBindingContext();var i=h.getView().getModel().getPendingChanges();i=i&&i[e.getPath().replace("/","")]||{};var j=Object.keys(i)||[];var k=T.oComponentUtils.isNonDraftCreate();var x=j.indexOf("__metadata");if(x>-1){j.splice(x,1);}var z1=T.oServices.oCRUDManager.saveEntity();z1.then(function(B1){var C1=T.oComponentUtils.getTemplatePrivateModel();C1.setProperty("/objectPage/displayMode",1);v.setEditable(false);T.oServices.oViewDependencyHelper.setRootPageToDirty();T.oServices.oViewDependencyHelper.unbindChildren(h.getOwnerComponent());T.oServices.oApplication.invalidatePaginatorInfo();if(k){if(B1&&B1.getPath()!=="/undefined"){T.oServices.oNavigationController.navigateToContext(B1,undefined,true);}else{T.oServices.oNavigationController.navigateBack();}T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_CREATED"));}else{T.oServices.oApplication.showMessageToast(T.oCommonUtils.getText("OBJECT_SAVED"));if(!T.oComponentUtils.isDraftEnabled()&&!l){T.oServices.oNavigationController.navigateBack();}}if(j.length>0){T.oServices.oApplicationController.executeSideEffects(e,j);}});var A1={saveEntityPromise:z1};T.oComponentUtils.fire(h,"AfterSave",A1);}function z(){B.state.beforeSaveHelper.prepareAndRunSaveOperation(true,y);}function G(e){if(I(e.getSource())){var i=e.getParameter("bindingParams");if(i.filters&&i.filters.length){var j=new F(i.filters);i.filters=new F({filters:[new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:true}),j],and:true}),new F({filters:[new F({path:"IsActiveEntity",operator:"EQ",value1:false}),new F({filters:[j,new F({path:"HasActiveEntity",operator:"EQ",value1:false})],and:false})],and:true})],and:false});}var k=i.sorter[0]&&i.sorter[0].getGroupFunction();var x=k&&function(z1){var A1=z1.getObject();if(A1.IsActiveEntity||A1.HasActiveEntity){var B1=q.extend({},k(z1));B1.key=B1.key.charAt(0)==="ยง"?"ยง"+B1.key:B1.key;return B1;}return{key:"ยง",text:T.oCommonUtils.getText("NEW_ENTRY_GROUP")};};i.sorter.unshift(new S("HasActiveEntity",false,x));}}function H(){return O.getHeaderTitle();}function K(e){var i=T.oComponentUtils.getTemplatePrivateModel();var j={shareEmailPressed:function(){var k=i.getProperty("/objectPage/headerInfo/objectTitle");var x=i.getProperty("/objectPage/headerInfo/objectSubtitle");if(x){k=k+" - "+x;}var z1=document.URL.replace(/\(/g,'%28').replace(/\)/g,'%29');sap.m.URLHelper.triggerEmail(null,k,z1);},shareJamPressed:function(){f.openJamShareDialog(i.getProperty("/objectPage/headerInfo/objectTitle")+" "+i.getProperty("/objectPage/headerInfo/objectSubtitle"));},getModelData:function(){return{title:i.getProperty("/objectPage/headerInfo/objectTitle"),subtitle:i.getProperty("/objectPage/headerInfo/objectSubtitle"),customUrl:document.URL};}};f.openSharePopup(T.oCommonUtils,e.getSource(),j);}function L(){var e=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.RelatedAppsSheet",{buttonPressed:function(i){var j=i.getSource();var k=j.getBindingContext("buttons");var x=k.getProperty("link");var z1=k.getProperty("param");var A1=x.intent;var B1=A1.split("#")[1].split("-")[0];var C1=A1.split("-")[1].split("?")[0].split("~")[0];var D1={target:{semanticObject:B1,action:C1},params:z1};sap.ushell.Container.getService("CrossApplicationNavigation").toExternal(D1);}},"buttons");return e;}function N(){var e=T.oServices.oApplication.getBusyHelper();if(e.isBusy()){return;}var i=h.getOwnerComponent();var j=T.oCommonUtils;var k=T.oComponentUtils.getTemplatePrivateModel();var x=(k.getProperty("/objectPage/headerInfo/objectTitle")||"").trim();var z1=k.getProperty("/objectPage/headerInfo/objectSubtitle");var A1;var B1={title:j.getText("DELETE")};if(x){if(z1){A1=[" ",x,z1];B1.text=j.getText("DELETE_WITH_OBJECTINFO",A1);}else{A1=[x];B1.text=j.getText("DELETE_WITH_OBJECTTITLE",A1);}}else{B1.text=j.getText("ST_GENERIC_DELETE_SELECTED");}var C1=Promise.resolve(h.beforeDeleteExtension());C1.then(function(D1){q.extend(B1,D1);M.show(B1.text,{icon:M.Icon.WARNING,styleClass:T.oCommonUtils.getContentDensityClass(),title:B1.title,actions:[M.Action.DELETE,M.Action.CANCEL],onClose:function(E1){if(E1===M.Action.DELETE){var F1=i.getModel("_templPrivGlobal");var G1={objectPage:{currentEntitySet:i.getProperty("entitySet")}};F1.setProperty("/generic/multipleViews",G1);var H1=T.oServices.oCRUDManager.deleteEntity();var I1=i.getBindingContext().getPath();var J1=Object.create(null);J1[I1]=H1;T.oServices.oApplication.prepareDeletion(J1);var K1={deleteEntityPromise:H1};e.setBusy(H1);T.oComponentUtils.fire(h,"AfterDelete",K1);}}});},q.noop);}function P(e){T.oServices.oApplication.performAfterSideEffectExecution(N);}function Q(e){var i,j;if(e){j=e.context||e;if(T.oServices.oDraftController.getDraftContext().hasDraft(j)){T.oServices.oViewDependencyHelper.setRootPageToDirty();i=e.context&&e.context.context||e.context||e;}}if(i){T.oServices.oApplication.invalidatePaginatorInfo();if(B.fclInfo.navigateToDraft){B.fclInfo.navigateToDraft(i);}else{T.oServices.oNavigationController.navigateToContext(i,undefined,true,2,true);}}else{var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",2);}v.setEditable(true);}var U;function W(e){T.oServices.oCRUDManager.editEntity(e).then(function(i){if(i.draftAdministrativeData){U(i.draftAdministrativeData.CreatedByUserDescription||i.draftAdministrativeData.CreatedByUser);}else{Q(i.context);}});}U=function(e){var i=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.UnsavedChangesDialog",{onEdit:function(){i.close();W(true);},onCancel:function(){i.close();}},"Dialog");var j=i.getModel("Dialog");var k=T.oCommonUtils.getText("DRAFT_LOCK_EXPIRED",[e]);j.setProperty("/unsavedChangesQuestion",k);i.open();};function X(){var j="{\"SelectionVariantID\":\"\"}";var k=h.getOwnerComponent();var z1=k.getEntitySet();var A1=k.getModel();var B1=A1.getMetaModel();var C1=B1.getODataEntitySet(z1);var D1=B1.getODataEntityType(C1.entityType);var E1=D1.property;var F1=[];for(var x in E1){var G1=E1[x]["com.sap.vocabularies.Common.v1.FieldControl"]&&E1[x]["com.sap.vocabularies.Common.v1.FieldControl"].Path;if(G1&&F1.indexOf(G1)<0){F1.push(G1);}}var H1=h.getView().getBindingContext();var I1=H1.getObject();var J1=new b();for(var i in E1){var K1=E1[i].type;var L1=E1[i].name;var M1=I1[E1[i].name];if(F1.indexOf(L1)>-1){continue;}if(L1&&(M1||K1==="Edm.Boolean")){if(K1==="Edm.Time"&&M1.ms!==undefined){M1=M1.ms;}if(typeof M1!=="string"){try{M1=M1.toString();}catch(e){M1=M1+"";}}J1.addParameter(L1,M1);}}j=J1.toJSONString();return j;}function Y(e,$){var i=true;var j=$.getModel();$=$ instanceof R?$.getParent():$;var k=T.oCommonUtils.getDeleteRestrictions($);var x=k&&k.Deletable&&k.Deletable.Path;if(x){i=j.getProperty(x,e);}return i;}var Z;var $;function _(e,j){Z=e;$=j instanceof R?j.getParent():j;var k=[];return T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.TableDeleteConfirmation",{onCancel:function(i){var x=i.getSource().getParent();x.close();},onDelete:function(x){var z1=T.oServices.oApplication.getBusyHelper();var A1=x.getSource().getParent();var B1=T.oCommonUtils.getSelectedContexts($);k=[];var C1;var D1;var E1=h.getView().getModel().getObject(B1[0].getPath());for(var i=0;i<B1.length;i++){if(Y(B1[i],$)){k.push(B1[i].getPath());}}var F1=T.oServices.oCRUDManager.deleteEntities(k);z1.setBusy(F1);T.oServices.oApplicationController.executeSideEffects($.getBindingContext(),[],[$.getTableBindingPath()]);var G1=Z.getParent().getParent().getId();F1.then(function(I1){var J1=$.getId().substring($.getId().indexOf(h.getOwnerComponent().getEntitySet()),$.getId().lastIndexOf("::"));J1=J1.replace(/--/g,"|").replace(/::/g,"|");T.oServices.oViewDependencyHelper.unbindChildren(h.getOwnerComponent());T.oCommonUtils.refreshSmartTable($);if(E1.IsActiveEntity===false){D1=0;}else{D1=I1.length;}C1=k.length-D1;var K1="";var L1="";var M1="";if(D1>0){var N1="";if(C1>0){M1=(T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT|"+J1)==="DELETE_SUCCESS_PLURAL_WITH_COUNT|"+J1)?T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT",[C1]):T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL_WITH_COUNT|"+J1,[C1]);L1=(T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT|"+J1)==="DELETE_SUCCESS_WITH_COUNT|"+J1)?T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT",[C1]):T.oCommonUtils.getText("DELETE_SUCCESS_WITH_COUNT|"+J1,[C1]);N1+=(C1>1)?M1:L1;N1+="\n";M1=(T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT|"+J1)==="DELETE_ERROR_PLURAL_WITH_COUNT|"+J1)?T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT",[D1]):T.oCommonUtils.getText("DELETE_ERROR_PLURAL_WITH_COUNT|"+J1,[D1]);L1=(T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT|"+J1)==="DELETE_ERROR_WITH_COUNT|"+J1)?T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT",[D1]):T.oCommonUtils.getText("DELETE_ERROR_WITH_COUNT|"+J1,[D1]);N1+=(D1>1)?M1:L1;}else{M1=(T.oCommonUtils.getText("DELETE_ERROR_PLURAL|"+J1)==="DELETE_ERROR_PLURAL|"+J1)?T.oCommonUtils.getText("DELETE_ERROR_PLURAL"):T.oCommonUtils.getText("DELETE_ERROR_PLURAL|"+J1);L1=(T.oCommonUtils.getText("DELETE_ERROR|"+J1)==="DELETE_ERROR|"+J1)?T.oCommonUtils.getText("DELETE_ERROR"):T.oCommonUtils.getText("DELETE_ERROR|"+J1);N1=(D1>1)?M1:L1;}M.error(N1);}else{M1=(T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL|"+J1)==="DELETE_SUCCESS_PLURAL|"+J1)?T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL"):T.oCommonUtils.getText("DELETE_SUCCESS_PLURAL|"+J1);L1=(T.oCommonUtils.getText("ITEM_DELETED|"+J1)==="ITEM_DELETED|"+J1)?T.oCommonUtils.getText("ITEM_DELETED"):T.oCommonUtils.getText("ITEM_DELETED|"+J1);K1=(C1>1)?M1:L1;T.oServices.oApplication.showMessageToast(K1);}});var H1={deleteEntitiesPromise:F1,sUiElementId:G1,aContexts:B1};T.oComponentUtils.fire(h,"AfterLineItemDelete",H1);A1.close();}},"delete");}function a1(e){var j=T.oServices.oApplication.getBusyHelper();if(j.isBusy()){return;}var Z=e.getSource();var $=T.oCommonUtils.getOwnerControl(Z);if(!T.oCommonUtils.isSmartTable($)){$=$.getParent();}var k=T.oCommonUtils.getSelectedContexts($);if(k.length===0){M.error(T.oCommonUtils.getText("ST_GENERIC_NO_ITEM_SELECTED"),{styleClass:T.oCommonUtils.getContentDensityClass()});return;}var x=[];var z1=[];for(var i=0;i<k.length;i++){if(Y(k[i],$)){x.push(k[i].getPath());}else{z1.push(k[i]);}}var A1=$.getId().substring($.getId().indexOf(h.getOwnerComponent().getEntitySet()),$.getId().lastIndexOf("::"));A1=A1.replace(/--/g,"|").replace(/::/g,"|");var B1=function(){var F1=Array.apply(null,arguments);F1[0]=F1[0]+"|"+A1;var G1=T.oCommonUtils.getText.apply(null,F1);return(G1===F1[0]?T.oCommonUtils.getText.apply(null,arguments):G1);};var C1={title:(k.length>1?T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE_WITH_COUNT",[k.length]):T.oCommonUtils.getText("ST_GENERIC_DELETE_TITLE")),text:(k.length>1?B1("DELETE_SELECTED_ITEMS"):B1("DELETE_SELECTED_ITEM")),undeletableText:(z1.length>0?B1("DELETE_UNDELETABLE_ITEMS",[z1.length,k.length]):undefined)};var D1={sUiElementId:Z.getParent().getParent().getId(),aContexts:k};var E1=Promise.resolve(h.beforeLineItemDeleteExtension(D1));E1.then(function(F1){q.extend(C1,F1);var G1=_(Z,$);if(!z1.length){C1.undeletableText=undefined;}var H1=G1.getModel("delete");H1.setData(C1);G1.open();},q.noop);}function b1(){var i=h.byId("imageDialog")||T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.ImageDialog",{onImageDialogClose:function(){i.close();}},"headerImage");return i;}function c1(){var e=h.byId("template::ObjectPage::TitleImage");if(!e){return;}var i=h.getView().byId("template::ObjectPage::ObjectPageHeader");e.setVisible(false);i.attachStateChange(function(j){var k=j.getParameter("isExpanded");e.setVisible(!k);});}function d1(){var e;var j=T.oComponentUtils.getTemplatePrivateModel();var k=function(i){return function(x){var z1=x.getSource();var A1=z1.getExternalValue();j.setProperty("/objectPage/headerInfo/"+i,A1);if(!A1&&i==="objectTitle"){var B1=T.oComponentUtils.getHeaderDataAvailablePromise();B1.then(function(C1){A1=z1.getExternalValue();if(A1){return;}var D1=h.getView();var E1=C1.getObject();var F1=D1.getModel("ui");var G1=F1.getProperty("/createMode");if(G1&&E1&&(E1.IsActiveEntity===undefined||E1.IsActiveEntity===false||E1.HasActiveEntity===false)){e=e||T.oCommonUtils.getText("NEW_OBJECT");j.setProperty("/objectPage/headerInfo/objectTitle",e);}});}};};O.getCustomData().forEach(function(x){var z1=x.getKey();if(z1==="objectTitle"||z1==="objectSubtitle"){var A1=x.getBinding("value");var B1=!A1&&x.getBindingInfo("value");if(!A1&&!B1){j.setProperty("/objectPage/headerInfo/"+z1,x.getValue());return;}var C1=k(z1);if(A1){A1.attachChange(C1);g(A1,"string");}else{B1.events={change:C1};for(var i=0;i<B1.parts.length;i++){B1.parts[i].targetType="string";}}}});}function e1(e,i){q.sap.log.info("Set binding context to "+e,"Subsection: "+i.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");i.setBindingContext(e);}function f1(e,i,j,k){if(i){var x=e?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();x.then(function(){e1(undefined,j);var z1=j.getId();q.sap.log.info("Start refreshing of Subsection: "+z1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k.refresh(null,true);q.sap.log.info("End refreshing of Subsection: "+z1,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");});}else{e1(null,j);}}var g1={lazyLoading:f1.bind(null,false),lazyLoadingAfterHeader:f1.bind(null,true),reuseComponent:function(i,e){var j=e.getBlocks()[0];var k=i?T.oComponentUtils.getHeaderDataAvailablePromise():Promise.resolve();k.then(T.oComponentUtils.onVisibilityChangeOfReuseComponent.bind(null,i,j));}};function h1(e,i,j){if(j instanceof c){j=j.getMainContent()[0];}else if(!j.getContent){return;}j.getContent().forEach(function(k){if(T.oCommonUtils.isSmartTable(k)){if(i||e[k.getEntitySet()]){if(k.isInitialised()){T.oCommonUtils.refreshSmartTable(k);}else{k.attachInitialise(function(){T.oCommonUtils.refreshSmartTable(k);});}if(!i){T.oServices.oApplicationController.executeSideEffects(h.getOwnerComponent().getBindingContext(),[],[k.getTableBindingPath()]);}}}});}function i1(e,i,j){var k=j.getBlocks().concat(j.getMoreBlocks());e.refresh=function(A1,B1){var C1=h1.bind(null,A1,B1);k.forEach(C1);};var x=T.oCommonUtils.getElementCustomData(j).strategyForVisibilityChange;var z1=g1[x];e.strategyForVisibilityChange=z1||q.noop;if(z1){i.push("subSectionListeningToVisibilityChange");}}function j1(e){return T.oCommonUtils.getControlInformation(e,i1);}function k1(i,e,j){e=e||j1(j);if(e.isVisible===i){return;}e.isVisible=i;e.strategyForVisibilityChange(i,j,e);}function l1(i){T.oCommonUtils.executeForAllInformationObjects("subSectionListeningToVisibilityChange",k1.bind(null,i));}function m1(e){var i=e&&e.getParameter("section");n=i?i.getId():O.getSelectedSection();}function n1(e){m1(e);B.stateChanged();}function o1(e,i,j,k,x){var z1=A.createP13NColumnKey(x);var A1=A.getBindingForHiddenPath(x);if(A1==="{= !${} }"){e.push(z1);return false;}if(typeof(A1)==="string"){var B1=A1.match(r)&&A1.match(r)[0];if(B1&&B1.indexOf("/")>0&&k.navigationProperty){var C1=h.getOwnerComponent().getEntitySet();var D1=B1.split("/",1)[0];if(j.getODataAssociationSetEnd(k,D1).entitySet===C1){i[z1]=B1.split("/").slice(1).join("/");return true;}}}else if(!A1){e.push(z1);}return false;}function p1($,e,j,k,x,z1){var A1=[];var B1=Object.create(null);var C1=false;for(var i=0;i<z1.length;i++){var D1=z1[i];C1=o1(A1,B1,k,x,D1)||C1;}if(C1){e.dynamicHideInfos={staticHiddenColumns:A1,columnKeyToHiddenPath:B1};j.push("smartTableWithDynamicColumnHide");}if(A1.length){$.deactivateColumns(A1);}}function q1(e,j,$){j.push("smartTable");$=T.oCommonUtils.isMTable($)?$.getParent():$;var k=$.getModel().getMetaModel();var x=k.getODataEntitySet($.getEntitySet());var z1=k.getODataEntityType(x.entityType);var A1=z1["com.sap.vocabularies.UI.v1.LineItem"];var B1=$.getCustomData();for(var i=0;i<B1.length;i++){if(B1[i].getKey()==="lineItemQualifier"){A1=z1["com.sap.vocabularies.UI.v1.LineItem#"+B1[i].getValue()];break;}}p1($,e,j,k,z1,A1);}function r1($){return T.oCommonUtils.getControlInformation($,q1);}function s1(e,i,j){i.push("searchField");var k=T.oCommonUtils.isMTable(j.getParent().getParent())?j.getParent().getParent().getParent():j.getParent().getParent();e.table=k;var x=r1(k);x.searchField=j;}function t1(e){return T.oCommonUtils.getControlInformation(e,s1);}function u1(e){t1(e);}function v1(e){var i=t1(e);i.searchString=e.getSource().getValue();i.table.rebindTable();}function w1(e,i){i.setValue("");if(e.searchString){e.searchString="";e.table.rebindTable();}}function x1(){T.oCommonUtils.executeForAllInformationObjects("searchField",w1);}v.refreshFacets=function(e){var i=function(j){var k=j1(j);k.refresh(e,false);};O.getSections().forEach(function(j){j.getSubSections().forEach(i);});};v.getHeaderInfoTitleForNavigationMenue=function(){var e=T.oComponentUtils.getTemplatePrivateModel();var i=e.getProperty("/generic/viewLevel");var j=e.getProperty("/objectPage/headerInfo/objectTitle");T.oServices.oApplication.subTitleForViewLevelChanged(i,j);};v.onComponentActivate=B.onComponentActivate;v.draftResume=function(e,j,k){var x=e.getObject();if(!x||!x.hasOwnProperty("IsActiveEntity")||x.IsActiveEntity!==false){return;}var z1=h.getView().getModel();var A1=z1.getMetaModel();var B1=A1.getODataEntitySet(h.getOwnerComponent().getEntitySet());var C1=A1.getODataEntityType(B1.entityType);var D1="";var E1="";var F1=C1["com.sap.vocabularies.Common.v1.SemanticKey"];for(var i in F1){var G1=F1[i];if(E1===""){E1=j[G1.PropertyPath];}else{E1=E1+"-"+j[G1.PropertyPath];}}var H1="-";if(k&&k.LastChangeDateTime!==null){var I1=D.getDateTimeInstance({pattern:"MMMM d, yyyy HH:mm",style:"long"});H1=I1.format(k.LastChangeDateTime);}var J1=[D1,E1,H1];var K1=T.oCommonUtils.getText("DRAFT_FOUND_RESUME",J1);var L1;var M1=T.oCommonUtils.getDialogFragment("sap.suite.ui.generic.template.ObjectPage.view.fragments.DraftResumeDialog",{onDraftResume:function(){M1.close();T.oServices.oNavigationController.navigateToContext(L1.getProperty("/siblingContext"),null,true);},onDraftDiscard:function(){M1.close();h.getView().getModel("ui").setProperty("/enabled",true);T.oServices.oCRUDManager.deleteEntity(true);L1.getProperty("/activeEntity").HasDraftEntity=false;T.oServices.oViewDependencyHelper.setAllPagesDirty();},onResumeDialogClosed:function(){L1.setProperty("/siblingContext",null);L1.setProperty("/activeEntity",null);}},"Dialog");L1=M1.getModel("Dialog");L1.setProperty("/draftResumeText",K1);L1.setProperty("/siblingContext",e);L1.setProperty("/activeEntity",j);M1.open();};v.getCurrentState=function(){var e=Object.create(null);if(n){e.section={data:n,lifecycle:{permanent:true,pagination:true}};}var i=Object.create(null);h.provideCustomStateExtension(i);for(var j in i){e["$custom$"+j]=i[j];}var k=true;var x=function(z1,A1){if(!(z1 instanceof C)){throw new Error("State must always be set with respect to a ControllerExtension");}if(!k){throw new Error("State must always be provided synchronously");}var B1=z1.getMetadata().getNamespace();if(A1){for(var C1 in A1){e["$extension$"+B1+"$"+C1]=A1[C1];}}};h.templateBaseExtension.provideExtensionStateData(x);k=false;return e;};v.applyState=function(e,i){var j=Object.create(null);var k=Object.create(null);for(var x in e){if(x.indexOf("$custom$")===0){j[x.substring(8)]=e[x];}else if(x.indexOf("$extension$")===0){var z1=x.substring(11,x.indexOf("$",11));var A1=k[z1];if(!A1){A1=Object.create(null);k[z1]=A1;}var B1=x.substring(x.indexOf("$",11)+1,x.length);A1[B1]=e[x];}}h.applyCustomStateExtension(j,i);var C1=true;var D1=function(E1){if(!(E1 instanceof C)){throw new Error("State must always be retrieved with respect to a ControllerExtension");}if(!C1){throw new Error("State must always be restored synchronously");}var z1=E1.getMetadata().getNamespace();return k[z1];};h.templateBaseExtension.restoreExtensionStateData(D1,i);C1=false;if(i){if(n!==(e.section||"")){B.stateChanged();}return;}x1();if(e.section){O.setSelectedSection(e.section);m1();}else{Promise.all([T.oComponentUtils.getHeaderDataAvailablePromise(),T.oComponentUtils.getNavigationFinishedPromise()]).then(s.bind(null,O));n="";}};v.beforeRebind=function(){l1(false);};v.afterRebind=function(){q.sap.log.info("Call of _triggerVisibleSubSectionsEvents","","Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");O._triggerVisibleSubSectionsEvents();};v.applyHeaderContextToSmartTablesDynamicColumnHide=function(e){var i=function(j,$){var k=j.dynamicHideInfos.staticHiddenColumns.slice();for(var x in j.dynamicHideInfos.columnKeyToHiddenPath){var z1=j.dynamicHideInfos.columnKeyToHiddenPath[x];if(e.getProperty(z1)){k.push(x);}}$.deactivateColumns(k);};T.oCommonUtils.executeForAllInformationObjects("smartTableWithDynamicColumnHide",i);};var W=t.testable(W,"editEntity");var Y=t.testable(Y,"isEntryDeletable");var u=t.testable(u,"onActivateImpl");var y1={onInit:function(){O=h.byId("objectPage");var e=h.getOwnerComponent();var x=O.getSections();for(var k=1;k<x.length;k++){var z1=x[k];var A1=z1.getSubSections();A1.forEach(j1);}var B1=H();var C1=e.getAppComponent().getConfig();var D1=C1&&C1.settings&&C1.settings.objectPageDynamicHeaderTitleWithVM;v.aBreadCrumbs=B1&&(D1?B1.getBreadcrumbs().getLinks():B1.getBreadCrumbsLinks());if(D1){c1();}B.onInit(null,O.getScrollDelegate.bind(O),l1.bind(null,true));d1();T.oCommonUtils.executeGlobalSideEffect();O.attachEvent("subSectionEnteredViewPort",function(i){var j=i.getParameter("subSection");q.sap.log.info("Viewport entered ","Subsection: "+j.getId(),"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");k1(true,null,j);});sap.ui.Device.resize.attachHandler(function(E1){var F1;for(var i=1;i<x.length;i++){var G1=x[i].getSubSections();for(var j=0;j<G1.length;j++){var H1=G1[j];var I1=H1.getBlocks()[0];if(I1 instanceof c){var J1=H1.getActions();var K1=J1[J1.length-1];var L1=H1.getId();L1=L1.substring(L1.indexOf(e.getEntitySet()),L1.lastIndexOf("::"));L1=L1.replace(/--/g,"|").replace(/::/g,"|");if(I1.getShowSideContent()){F1=T.oCommonUtils.getContextText("HideSideContent",L1,"HIDE_SIDE_CONTENT");if(E1.width>m){I1.setShowMainContent(true);}}else{F1=T.oCommonUtils.getContextText("ShowSideContent",L1,"SHOW_SIDE_CONTENT");}K1.setText(F1);}}}},O);},handlers:{addEntry:function(e){var Z=e.getSource();var $=T.oCommonUtils.getOwnerControl(Z);$=T.oCommonUtils.isMTable($)?$.getParent():$;var i=I($);if(!Z.data("CrossNavigation")&&i){T.oCommonEventHandlers.addEntry(Z,true);return;}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){T.oCommonEventHandlers.addEntry(Z,false);},q.noop,B.state);},submitChangesForSmartMultiInput:function(){if(T.oComponentUtils.isDraftEnabled()){T.oCommonEventHandlers.submitChangesForSmartMultiInput();}},deleteEntries:a1,onSelectionChange:function(e){T.oCommonUtils.setEnabledToolbarButtons(e.getSource());},onCancel:function(e){var i="Proceed";var j;if(T.oComponentUtils.isNonDraftCreate()||!l){i="LeavePage";}T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var k=T.oComponentUtils.getTemplatePrivateModel();k.setProperty("/objectPage/displayMode",1);if(T.oComponentUtils.isNonDraftCreate()){v.setEditable(false);}else if(l){v.setEditable(false);}if(T.oComponentUtils.isNonDraftCreate()||!l){T.oServices.oNavigationController.navigateBack();}},q.noop,B.state,i,j,e);},onContactDetails:function(e){T.oCommonEventHandlers.onContactDetails(e);},onPressDraftInfo:function(e){var i=h.getView().getBindingContext();var j=sap.ui.getCore().byId(e.getSource().getId()+(e.getId()==="markChangesPress"?"-changes":"-lock"));T.oCommonUtils.showDraftPopover(i,j);},onPressDraftInfoObjectPageDynamicHeaderTitle:function(e){var i=h.getView().getBindingContext();var j=h.byId("template::ObjectPage::ObjectMarkerObjectPageDynamicHeaderTitle");T.oCommonUtils.showDraftPopover(i,j);},onShareObjectPageActionButtonPress:K,onRelatedApps:function(e){var x,z1,A1,B1,C1,D1,E1;var F1,G1,H1,I1,J1;x=e.getSource();H1=sap.ushell&&sap.ushell.Container;z1=H1&&H1.getService("URLParsing");A1=z1.parseShellHash(document.location.hash);I1=A1.semanticObject;J1=A1.action;B1=h.getView&&h.getView().getBindingContext();var K1=h.getOwnerComponent().getModel().getMetaModel();var L1=B1.getObject();var M1=L1.__metadata.type;var N1=K1.getODataEntityType(M1);var O1=N1["com.sap.vocabularies.Common.v1.SemanticKey"];var P1={};if(O1&&O1.length>0){for(var j=0;j<O1.length;j++){var Q1=O1[j].PropertyPath;if(!P1[Q1]){P1[Q1]=[];P1[Q1].push(L1[Q1]);}}}else{for(var k in N1.key.propertyRef){var R1=N1.key.propertyRef[k].name;if(!P1[R1]){P1[R1]=[];P1[R1].push(L1[R1]);}}}C1=h.getOwnerComponent().getAppComponent();D1=H1&&H1.getService("CrossApplicationNavigation");E1=D1.getLinks({semanticObject:I1,params:P1,ui5Component:C1});F1=L();G1=F1.getModel("buttons");G1.setProperty("/buttons",[]);F1.openBy(x);E1.done(function(S1){var T1=[];S1.sort(function(X1,Y1){if(X1.text<Y1.text){return-1;}if(X1.text>Y1.text){return 1;}return 0;});for(var i=0;i<S1.length;i++){var U1=S1[i];var V1=U1.intent;var W1=V1.split("-")[1].split("?")[0];if(W1!==J1){T1.push({enabled:true,text:U1.text,link:U1,param:P1});}}if(T1.length===0){T1.push({enabled:false,text:T.oCommonUtils.getText("NO_RELATED_APPS")});}G1.setProperty("/buttons",T1);});},onSemanticObjectLinkPopoverLinkPressed:function(e){T.oCommonEventHandlers.onSemanticObjectLinkPopoverLinkPressed(e,B.state);},onEdit:function(e){var Z=e.getSource();if(Z.data("CrossNavigation")){T.oCommonEventHandlers.onEditNavigateIntent(Z);return;}l=true;W();},onSave:z,onActivate:w,onSmartFieldUrlPressed:function(e){T.oCommonEventHandlers.onSmartFieldUrlPressed(e,B.state);},onBreadCrumbUrlPressed:function(e){T.oCommonEventHandlers.onBreadCrumbUrlPressed(e,B.state);},onDiscardDraft:function(e){T.oCommonEventHandlers.onDiscardDraft(e,B.state.beforeSaveHelper);},onDelete:P,onCallActionFromToolBar:function(e){T.oCommonEventHandlers.onCallActionFromToolBar(e,B.state);},onCallAction:function(e){var i=h.getOwnerComponent();var j=i.getEntitySet();var k=T.oCommonUtils.getCustomData(e);var x=[];x.push(h.getView().getBindingContext());if(x[0]&&k.Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var z1={functionImportPath:k.Action,contexts:x,sourceControl:"",label:k.Label,operationGrouping:k.InvocationGrouping,navigationProperty:h.getOwnerComponent().getNavigationProperty()};T.oServices.oCRUDManager.callAction(z1).then(function(A1){var B1=A1&&A1[0];if(B1&&B1.response&&B1.response.context&&(!B1.actionContext||B1.actionContext&&B1.response.context.getPath()!==B1.actionContext.getPath())){T.oServices.oViewDependencyHelper.setParentToDirty(i,j,1);}});},q.noop,B.state,"Proceed");}else if(k.Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);}},onDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldForIntentBasedNavigation(e,B.state);},onDataFieldWithIntentBasedNavigation:function(e){T.oCommonEventHandlers.onDataFieldWithIntentBasedNavigation(e,B.state);},onDataFieldWithNavigationPath:function(e){T.oCommonEventHandlers.onDataFieldWithNavigationPath(e);},onChartInit:function(e){var i=e.getSource().getChart();var j=h._templateEventHandlers.onSelectionChange;i.attachSelectData(j).attachDeselectData(j);var k=i.getParent();T.oCommonUtils.checkToolbarIntentsSupported(k);},onDataRequested:function(i){q.sap.log.info("Data requested","SmartTable: "+i,"Class sap.suite.ui.generic.template.ObjectPage.controller.ControllerImplementation");},onDataReceived:function(e){T.oCommonEventHandlers.onDataReceived(e);},onBeforeRebindDetailTable:function(e){var $=e.getSource();var i=p(e);var j=r1($);var k=j.searchField;if(k){var x=T.oCommonUtils.getControlInformation(k);if(x.searchString){i.parameters.custom={search:x.searchString};}}T.oCommonEventHandlers.onBeforeRebindTable(e,{ensureExtensionFields:h.templateBaseExtension.ensureFieldsForSelect,addExtensionFilters:h.templateBaseExtension.addFilters});h.onBeforeRebindTableExtension(e);G(e);if(T.oCommonUtils.isAnalyticalTable($.getTable())){i.parameters.entitySet=$.getEntitySet();}},onShowDetails:function(e){T.oCommonEventHandlers.onShowDetails(e.getSource(),B.state);},onListNavigate:function(e){if(!h.onListNavigationExtension(e)){T.oCommonEventHandlers.onListNavigate(e.getSource(),B.state);}},onBeforeSemanticObjectLinkPopoverOpens:function(e){var i=e.getParameters();T.oCommonUtils.processDataLossConfirmationIfNonDraft(function(){var j=X();T.oCommonUtils.semanticObjectLinkNavigation(i,j,h);},q.noop,B.state,q.noop);},onSemanticObjectLinkNavigationPressed:function(e){var i=e.getParameters();var Z=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationPressed(Z,i);},onSemanticObjectLinkNavigationTargetObtained:function(e){var i=e.getParameters();var Z=e.getSource();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(Z,i,B.state);},onSemanticObjectLinkNavigationTargetObtainedSmartLink:function(e){var i,Z;i=e.getParameters();Z=e.getSource();Z=Z.getParent().getParent().getParent().getParent();T.oCommonEventHandlers.onSemanticObjectLinkNavigationTargetObtained(Z,i,B.state);},onHeaderImagePress:function(e){var i=b1();var j=e.getSource().getId();i.addAriaLabelledBy(j);var k=i.getModel("headerImage");k.setProperty("/src",e.getSource().getSrc());if(sap.ui.Device.system.phone){i.setProperty("stretch",true);}i.open();},sectionNavigate:n1,onInlineDataFieldForAction:function(e){T.oCommonEventHandlers.onInlineDataFieldForAction(e,B.state);},onInlineDataFieldForIntentBasedNavigation:function(e){T.oCommonEventHandlers.onInlineDataFieldForIntentBasedNavigation(e.getSource(),B.state);},onDeterminingDataFieldForAction:function(e){T.oCommonEventHandlers.onDeterminingDataFieldForAction(e);},onBeforeRebindChart:function(e){p(e);var i=e.getSource();i.oModels=i.getChart().oPropagatedProperties.oModels;var j={ensureExtensionFields:q.noop,addExtensionFilters:h.templateBaseExtension.addFilters};T.oCommonUtils.onBeforeRebindTableOrChart(e,j);},onToggleDynamicSideContent:function(e){var i,Z;Z=e.getSource();var j=Z.getParent();var k=h.getOwnerComponent();var x=j.getId();x=x.substring(x.indexOf(k.getEntitySet()),x.lastIndexOf("::"));x=x.replace(/--/g,"|").replace(/::/g,"|");var z1=j.getBlocks()[0];if(z1.getShowSideContent()){i=T.oCommonUtils.getContextText("ShowSideContent",x,"SHOW_SIDE_CONTENT");z1.setShowSideContent(false);if(sap.ui.Device.resize.width<=m){z1.setShowMainContent(true);}}else{i=T.oCommonUtils.getContextText("HideSideContent",x,"HIDE_SIDE_CONTENT");z1.setShowSideContent(true);if(sap.ui.Device.resize.width<=m){z1.setShowMainContent(false);}}Z.setText(i);},onTableInit:function(e){var $=e.getSource();var i=$.getTable();r1($);T.oCommonUtils.checkToolbarIntentsSupported($);if(I($)&&!$.data("CrossNavigation")){i.addEventDelegate({onkeyup:function(e){if(e.ctrlKey&&e.keyCode===q.sap.KeyCodes.ENTER&&$.getEditable()){T.oCommonEventHandlers.addEntry($,true);e.preventDefault();e.setMarked();}}});}},onSearchObjectPage:v1,onSearchLiveChange:u1},formatters:{setNoDataTextForSmartTable:function(){var e=h.getOwnerComponent()&&h.getOwnerComponent().getModel("i18n")&&h.getOwnerComponent().getModel("i18n").getResourceBundle();if(e&&e.getText("NOITEMS_SMARTTABLE")!=="NOITEMS_SMARTTABLE"){return e.getText("NOITEMS_SMARTTABLE");}else{var i=h.getOwnerComponent().getAppComponent();e=i&&i.getModel("i18n")&&i.getModel("i18n").getResourceBundle();if(e&&e.hasText("NOITEMS_SMARTTABLE")){return e.getText("NOITEMS_SMARTTABLE");}else{return"";}}},setVMVisibilityForVendor:function(){var e=q.sap.getUriParameters();if(e.mParams["sap-ui-layer"]){var j=e.mParams["sap-ui-layer"];for(var i=0;i<j.length;i++){if(j[i].toUpperCase()==="VENDOR"){return true;}}}return false;}},extensionAPI:new E(T,h,B)};y1.handlers=q.extend(B.handlers,y1.handlers);return y1;}};return o;});
