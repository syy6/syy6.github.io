sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/ui/core/mvc/View","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/suite/ui/generic/template/lib/TemplateViewController","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/Application","sap/suite/ui/generic/template/lib/CRUDManager","sap/suite/ui/generic/template/lib/CommonUtils","sap/suite/ui/generic/template/lib/ComponentUtils","sap/suite/ui/generic/template/lib/CommonEventHandlers","sap/suite/ui/generic/template/lib/ViewDependencyHelper","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/testableHelper","sap/suite/ui/generic/template/support/lib/CommonMethods"],function(q,C,O,V,J,R,T,a,A,b,c,d,e,f,r,t,g){"use strict";var m=Object.create(null);var h=function(o){var s=o.appComponent.getId();m[s]=o;return function(){delete m[s];};};function i(o){var s=o.getId();var n=m[s];return n;}function j(o){return i(o.getAppComponent()).oTemplateContract.componentRegistry[o.getId()];}function F(o){while(o&&!(o instanceof V)){o=o.getParent();}return o;}function G(o){while(o){var v=F(o);var n=v&&v.getController();var p=n&&n.getOwnerComponent();if(p instanceof a){var s=j(p);return s;}else{o=p&&p.oContainer;}}}function k(n,o,p,s,u,v){var w=o.oComponent.getTemplateName();p=q.extend(true,{},p);s=q.extend(true,{},s);var x,y;var E;p.constructor=function(){T.prototype.constructor.apply(this,arguments);o.oController=this;var M=n(u,this);o.oControllerUtils=u;this._templateEventHandlers=Object.freeze(M.handlers||{});this._templateFormatters=Object.freeze(M.formatters||{});E=Object.freeze(M.extensionAPI||{});this.extensionAPI=E;var D;x=function(){var H=this.getView();D=H.getId();q.sap.log.info("Init view "+D+" of template "+w);u.oServices.oApplicationController.registerView(H);u.oCommonUtils=new c(this,u.oServices,u.oComponentUtils);u.oServices.oCRUDManager=new b(this,u.oComponentUtils,u.oServices,u.oCommonUtils,v.oTemplateContract.oBusyHelper);u.oCommonEventHandlers=new e(this,u.oComponentUtils,u.oServices,u.oCommonUtils);(M.onInit||q.noop)();}.bind(this);y=function(){v.oTemplateContract.oApplicationProxy.destroyView(D);(M.onExit||q.noop)();q.sap.log.info("View "+D+" of template "+w+" exited");};};p.onInit=function(){x();};p.onExit=function(){y();};s.metadata=s.metadata||{};s.metadata.methods=s.metadata.methods||{};for(var z in s){if(typeof s[z]==="function"){var B=s.metadata.methods[z];if(!B){B={};s.metadata.methods[z]=B;}B.public=(B.public!==false);B.final=B.final||false;B.overrideExecution=B.overrideExecution||O.After;}}s.metadata.methods.getExtensionAPI={"public":true,"final":true};s.getExtensionAPI=function(){return E;};p.templateBaseExtension=C.extend(w+"BaseExtension",s);return T.extend(w,p);}function l(o){var n=o.methods.oControllerSpecification;return n&&function(){var p=o.oComponent.getAppComponent();var s=i(p);var u=p.getTransactionController();var N=p.getNavigationController();var v={oComponentUtils:o.utils,oServices:{oTemplateCapabilities:{},oApplicationController:p.getApplicationController(),oTransactionController:u,oNavigationController:N,oDraftController:u.getDraftController(),oApplication:s.application,oViewDependencyHelper:s.oViewDependencyHelper}};o.viewRegistered.catch(function(E){N.navigateToMessagePage({viewLevel:o.viewLevel,title:o.oTemplateContract.getText("ST_ERROR"),text:o.oTemplateContract.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:E.message});});return k(n.getMethods,o,n.oControllerDefinition,n.oControllerExtensionDefinition,v,s);};}h=t.testableStatic(h,"TemplateComponent_RegisterAppComponent");return{getTemplateComponent:function(n,s,o){var p=s+".Component";o=o||{};o.init=function(){var u=this.getComponentData();var v=u.registryEntry;v.viewRegistered=new Promise(function(y,z){v.fnViewRegisteredResolve=function(E){if(E){v.fnViewRegisteredResolve=q.noop;z(E);}else{delete v.fnViewRegisteredResolve;y();}};});v.oViewRenderedPromise=new Promise(function(y){v.fnViewRenderdResolve=y;});v.oViewRenderedPromise.then(function(){g.setApplicationStatus(g.mApplicationStatus.RENDERED);g.publishEvent("elements","ViewRendered",{});});v.reuseComponentProxies=Object.create(null);v.componentName=p;v.oComponent=this;v.activationTakt=0;var w=i(v.oAppComponent);v.oTemplateContract=w.oTemplateContract;(a.prototype.init||q.noop).apply(this,arguments);v.utils=new d(this,v);v.methods=n(this,v.utils)||{};v.oGenericData={};v.mRefreshInfos=Object.create(null);var x=this.getId();v.oTemplateContract.componentRegistry[x]=v;v.oTemplateContract.oBusyHelper.setBusy(v.viewRegistered,true);v.oApplication=w.application;v.createViewController=l(v);v.componentCreateResolve(this);delete v.componentCreateResolve;delete u.registryEntry;(v.methods.init||q.noop)();};o.exit=function(){var u=this.getId();var v=j(this);var w=i(this.getAppComponent());var M=v.methods;(M.exit||q.noop)();delete w.oTemplateContract.componentRegistry[u];(a.prototype.exit||q.noop).apply(this,arguments);};o.onBeforeRendering=function(){var u=j(this);(a.prototype.onBeforeRendering||q.noop).bind(this,u).apply(this,arguments);var M=u.methods;(M.onBeforeRendering||q.noop)();};o.onAfterRendering=function(){var u=j(this);if(u.fnViewRenderdResolve&&!u.fnViewRegisteredResolve){u.fnViewRenderdResolve();delete u.fnViewRenderdResolve;}(a.prototype.onAfterRendering||q.noop).bind(this,u).apply(this,arguments);var M=u.methods;(M.onAftereRendering||q.noop)();};o.onActivate=function(B,I){var u=j(this);u.sCurrentBindingPath=B;var v=function(){u.utils.bindComponent(u.sCurrentBindingPath,I);u.utils.refreshBinding();return(u.methods.onActivate||q.noop)(B,I);};return u.fnViewRegisteredResolve?u.viewRegistered.then(v):(v()||Promise.resolve());};o.setIsRefreshRequired=function(I){if(I){var u=j(this);if(u.utils.isComponentActive()){u.viewRegistered.then(u.utils.refreshBinding.bind(null,true,{}));I=false;}}this.setProperty("isRefreshRequired",I);};o.onDeactivate=q.noop;return a.extend(p,o);},getRegisterAppComponent:function(){var n=h;h=null;return n;},getExtensionAPIPromise:function(o){var n=G(o);if(!n){return Promise.reject();}return n.viewRegistered.then(function(){return n.oController.extensionAPI;});},getExtensionAPI:function(o){var n=G(o);return n&&n.oController&&n.oController.extensionAPI;}};});
