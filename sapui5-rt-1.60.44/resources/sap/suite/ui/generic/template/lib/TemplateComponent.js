sap.ui.define(["jquery.sap.global","sap/ui/core/CustomizingConfiguration","sap/ui/core/mvc/ViewType","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper","sap/ui/core/CustomData","sap/suite/ui/generic/template/lib/StableIdDefinition","sap/suite/ui/generic/template/js/StableIdHelper"],function(q,C,V,a,U,J,R,D,r,b,S,c){"use strict";function g(O){var s=O&&typeof O==="string"?O:(O&&a.getOwnerIdFor(O));var i=s&&sap.ui.component(s);if(i instanceof T){i=i.getAppComponent();}return i;}var G=C.getViewExtension;C.getViewExtension=function(v,s,O){var i=g(O),t=i&&i.getId(),u=G.call(C,v,s,t);return u;};var f=C.getControllerExtension;C.getControllerExtension=function(s,O){var i=g(O),t=i&&i.getId(),u=f.call(C,s,t);return u;};function e(s){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var t=[];var M=s.getAppComponent().getModel("i18n|"+s.getMetadata().getComponentName()+"|"+s.getEntitySet());if(M){t.push(M);}var u=s.getModel("i18n");if(u){t.push(u);}var P=true;for(var v="i18n";P;){v=v+"||Parent";P=s.getModel(v);if(P){t.push(P);}}for(var i=t.length-1;i>=0;i--){I.enhance(t[i].getResourceBundle());}s.setModel(I,"i18n");}function E(i,M){var s=i.getAppComponent().getManifestEntry("sap.ui5");var t=s.extends&&s.extends.extensions&&s.extends.extensions["sap.ui.controllerExtensions"];var u=i.getTemplateName();var v=t&&t[u]&&t[u]["sap.ui.generic.app"];var w=i.getEntitySet();var B=v&&v[w]&&v[w].Actions;var x={};var y=d(i);if(B){if(y){A(x,B,y);}else{h(x,B);}}else{var z=v&&v[w]&&v[w]["Sections"];for(var F in z){B=z[F]["Actions"];if(B){h(x,B);}}}i.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",x);}function d(i){var s;var t=i.getAppComponent().getConfig();var u=t&&t.pages[0]&&t.pages[0].component&&t.pages[0].component.settings;if(u&&u.quickVariantSelectionX){s=u.quickVariantSelectionX.variants;}return s;}function A(B,s,t){var u;for(var v in s){u=true;if(s[v].requiresSelection){u=false;}for(var i in t){var w=s[v].id;var x=t[i];var y=sap.suite.ui.generic.template.js.AnnotationHelper.getSuffixFromIconTabFilterKey(x);if(y){w=w.concat(y);}B[w]={enabled:u};}}}function h(B,i){var s;for(var t in i){s=true;if(i[t].requiresSelection){s=false;}B[i[t].id]={enabled:s};}}function j(i){if(i.getAppComponent().getMetadata().getComponentName()===""||i.getTemplateName()===""||i.getEntitySet()===""){}return i.getAppComponent().getMetadata().getComponentName()+"::"+i.getTemplateName()+"::"+i.getEntitySet();}function k(s,i,M,t){var u=i.oComponent;var v=u.getAppComponent();var w=u.getEntitySet();var x=i.utils.isDraftEnabled();var y=null;var z=u.getComponentContainer().getSettings();y=q.extend({},z);delete y.appComponent;delete y.entitySet;delete y.navigationProperty;y.subPages=i.routeConfig.pages;y.routeConfig=i.routeConfig;return new J({entitySet:w,entityType:s,constants:{annotations:{selectionFields:"com.sap.vocabularies.UI.v1.SelectionFields",facets:"com.sap.vocabularies.UI.v1.Facets",identification:"com.sap.vocabularies.UI.v1.Identification"}},routingSpec:i.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:x,settings:y,manifest:v.getInternalManifest(),metaModel:M,templateSpecific:t&&t(),appComponentName:u.getAppComponent().getMetadata().getComponentName(),helper:{bool:{"true":true,"false":false}},stableId:{definition:S,aParameter:[],getStableId:c.getStableId}});}function l(i,s){var t=i.oComponent,u=i.createViewController,v=i.methods&&i.methods.getTemplateSpecificParameters,M=t.getModel(),w,x,y,z,B,N=i.routingSpec&&i.routingSpec.noOData;if(N){w=new J({entitySet:{},entityType:{}});z=w.createBindingContext("/entitySet");B=w.createBindingContext("/entityType");}else{w=M&&M.getMetaModel();x=M&&t.getEntitySet();var F=x&&w.getODataEntitySet(x);y=F&&F.entityType;if(!y){return{loaded:function(){return Promise.reject(new Error("Unknown entityset "+x));}};}z=w.createBindingContext(w.getODataEntitySet(x,true));B=w.createBindingContext(w.getODataEntityType(y,true));}e(t);E(t,M);q.sap.require("sap.ui.model.odata.AnnotationHelper");var H=j(t);var I=sap.ui.getCore().byId(H);if(I){q.sap.log.warning("View with ID: "+H+" already exists - old view is getting destroyed now!");try{I.destroy();}catch(K){q.sap.log.warning("Error destroying view: "+K);}I=null;}var L=new J(D);L.setDefaultBindingMode("OneWay");i.oParameterModel=k(y,i,w,v);t.runAsOwner(function(){var P=i.preprocessorsData;var O={async:true,preprocessors:{xml:{bindingContexts:{entitySet:z,entityType:B},models:{device:L,entitySet:w,entityType:w,parameter:i.oParameterModel},preprocessorsData:P}},id:H,type:V.XML,viewName:t.getTemplateName(),height:"100%",cache:{keys:s,additionalData:[P]}};if(t.getDesigntimePath&&t.getFlexibilityPath){O.customData=[new b({key:"sap-ui-custom-settings",value:{"sap.ui.dt":{"designtime":t.getDesigntimePath()},"sap.ui.fl":{"flexibility":t.getFlexibilityPath()}}})];}if(u){var Q=u();O.controller=new Q();}I=sap.ui.view(O);});return I;}function m(i,s,t){var u=i.oController.extensionAPI;var v=q.extend({},u);if(u.getNavigationController){var N=q.extend({},u.getNavigationController());var w=N.navigateInternal;N.navigateInternal=function(x,y){var z=y&&y.routeName;if(z){i.utils.navigateRoute(z,x,s,y&&y.replaceInHistory);}else{w(x,y);}};v.getNavigationController=function(){return N;};}v.getCommunicationObject=function(L){return L===1?t.communicationObject:i.utils.getCommunicationObject(L);};(i.methods.enhanceExtensionAPI4Reuse||q.noop)(v,t);return v;}function p(i,s,t,u,v){u.extensionAPI=m(i,t,u);r.transferEmbeddedComponentProxy(i,s,t,u,v);var w=i.oController.byId(u.containerId);v.applySettings(w.getSettings());w.setComponent(v);}function n(i,s,t){return t.componentUsage?i.createComponent({usage:t.componentUsage,id:s}):i.runAsOwner(function(){return a.create({name:t.componentName,id:s});});}function o(i){i.reuseComponentsReady=new Promise(function(s,t){var u=Object.create(null);var v=s.bind(null,u);if(i.viewLevel>0){var w=i.oTemplateContract.mEntityTree[i.routeConfig.entitySet];if(w){var L=function(x,y){q.sap.log.error("Failed to load reuse component for key "+x,y instanceof Error?y.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};i.viewRegistered.then(function(){var x=[];for(var y in w.embeddedComponents){var z=w.embeddedComponents[y];var B=z.sectionId&&i.oController.byId(z.sectionId);if(B&&B.getStashed()){delete w.embeddedComponents[y];}else{var F=i.oController.createId(z.containerId+"Content");var H=n(i.oAppComponent,F,z);x.push(H);H.catch(L.bind(null,y));H.then(p.bind(null,i,u,y,z));i.oTemplateContract.oBusyHelper.setBusy(H);}}Promise.all(x).then(v,function(I){var N=i.oAppComponent.getNavigationController();N.navigateToMessagePage({text:i.oTemplateContract.getText("ST_ERROR"),description:I instanceof Error?I.message:""});t();});});return;}}v();});}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this);var u=new J({editable:false,enabled:false});this.setModel(u,"ui");var i=this.getComponentData().registryEntry;var s=Object.create(null);var t=(i.routeConfig&&i.routeConfig.embeddedComponents)||{};for(var K in t){var v=t[K];var w={hidden:!!v.hiddenByDefault};s[K]=w;}var x=new J({generic:{isActive:false,listCommons:{},viewLevel:i.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:s}});x.setDefaultBindingMode("TwoWay");this.setModel(x,"_templPriv");o(i);},getManifestEntry:function(K){var v=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){v=q.extend(true,{},v,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return v;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(s){if(s){var t=s.oComponent.getComponentContainer();var M=!s.createViewStarted&&t&&t.getModel();if(M){M.getMetaModel().loaded().then(function(){if(!s.createViewStarted){var u=[];var v=M.metadataLoaded().then(function(P){var i;if(P&&P.lastModified){i=new Date(P.lastModified).getTime()+"";}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");i=new Date().getTime()+"";}return i;});u.push(v);var w=M.annotationsLoaded().then(function(P){var x=0;if(P){for(var i=0;i<P.length;i++){if(P[i].lastModified){var L=new Date(P[i].lastModified).getTime();if(L>x){x=L;}}else{q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");x=new Date().getTime()+"";}}}if(x===0){q.sap.log.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");x=new Date().getTime();}return x+"";});u.push(w);s.createViewStarted=true;l(s,u).loaded().then(function(i){s.oComponent.setAggregation("rootControl",i);s.fnViewRegisteredResolve();t.invalidate();},function(i){s.fnViewRegisteredResolve(i||{});});}});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
