sap.ui.define(["sap/m/HeaderContainer","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/comp/odata/ODataModelUtil","sap/ui/comp/smartfilterbar/FilterProvider","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/VisualFilterProvider","sap/ui/comp/smartvariants/PersonalizableInfo","sap/ui/comp/smartvariants/SmartVariantManagement","sap/ui/model/Filter","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/ui/comp/odata/MetadataAnalyser","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/m/VBox","sap/m/Button","sap/m/Title","sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/suite/ui/generic/template/AnalyticalListPage/controller/DatePickerController","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroBar","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroLine","sap/suite/ui/generic/template/AnalyticalListPage/control/visualfilterbar/FilterItemMicroDonut","sap/ui/model/json/JSONModel","sap/ui/core/CustomData","sap/m/Text","sap/m/OverflowToolbarLayoutData","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/model/SimpleType","sap/ui/core/library","sap/m/library","sap/m/DatePicker"],function(H,V,O,F,a,P,S,b,c,T,M,d,f,g,B,h,D,k,l,m,n,J,C,o,p,q,r,s,t,u,v){"use strict";var w="Donut";var x="Line";var y="Bar";var z=s.extend("sap.ui.model.DimensionFilterType",{formatValue:function(e){return e;},parseValue:function(e){return e;},validateValue:function(e){}});var A=H.extend("sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",{metadata:{designTime:true,properties:{entitySet:{type:"string",group:"Misc",defaultValue:null},config:{type:"object",group:"Misc",defaultValue:null},persistencyKey:{type:"string",group:"Misc",defaultValue:null},lazyLoadVisualFilter:{type:"boolean",group:"Misc",defaultValue:false},displayCurrency:{type:"string",group:"Misc",defaultValue:null},smartFilterId:{type:"string",group:"Misc",defaultValue:null}},associations:{smartVariant:{type:"sap.ui.core.Control",multiple:false}},events:{filterChange:{},Initialized:{}}},renderer:{}});A.prototype.init=function(){if(H.prototype.init){H.prototype.init.apply(this,arguments);}var i=jQuery(document.body).hasClass("sapUiSizeCozy");this._cellItemHeightNorth="2.5rem";this._cellItemHeightSouth=i?"9.9rem":"7.9rem";this._cellHeight=i?"12rem":"10.9rem";this._cellWidth="20rem";this.labelHeight=2.0;this.compHeight=i?9.9:7.9;this.cellHeightPadding=1;this.cellHeight=(this.labelHeight+this.compHeight+this.cellHeightPadding)+"rem";this.cellWidth=320;this._dialogFilters={};this._compactFilters={};this._oVariantConfig={};this._smartFilterContext;this._oMetadataAnalyser;this.setModel(new J(),'_visualFilterConfigModel');if(i){if(r.system.phone){this.setOrientation("Vertical");this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozyPhone");}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBarCozy");}}else{this.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterBar");}};A.prototype.propagateProperties=function(){H.prototype.propagateProperties.apply(this,arguments);this._initMetadata();};A.prototype._initMetadata=function(){if(!this.bIsInitialised){O.handleModelInit(this,this._onMetadataInit);}};A.prototype._onMetadataInit=function(){if(this._smartFilterContext.isInitialised()){this._initiateVisualFilterLoad();}else{this._smartFilterContext.attachInitialized(this._initiateVisualFilterLoad,this);}};A.prototype._initiateVisualFilterLoad=function(){if(this.bIsInitialised){return;}this._annoProvider=this._createVisualFilterProvider();if(!this._annoProvider){return;}this._oMetadataAnalyser=this._annoProvider.getMetadataAnalyser();this.bIsInitialised=true;this._updateFilterBar();};A.prototype._createVisualFilterProvider=function(){var e=this.getModel();var i=this.getEntitySet();if(!e||!i){return null;}return new a(this);};A.prototype._getBasicGroupTitle=function(){return this.getModel("i18n").getResourceBundle().getText("VIS_FILTER_GRP_BASIC_TITLE");};A.prototype._getFieldGroupForProperty=function(e,i){return this._annoProvider?this._annoProvider._getFieldGroupForProperty(e,i):undefined;};A.prototype._getGroupList=function(){return this._annoProvider?this._annoProvider.getGroupList():[];};A.prototype._getGroupMap=function(){return this._annoProvider?this._annoProvider.getGroupMap():{};};A.prototype._getMeasureMap=function(){return this._annoProvider?this._annoProvider.getMeasureMap():{};};A.prototype._getDimensionMap=function(){return this._annoProvider?this._annoProvider.getDimensionMap():{};};A.prototype.setSmartFilterContext=function(e){this._smartFilterContext=e;};A.prototype._updateFilterBar=function(){var e=this._getAnnotationSettings();if(e&&e.filterList){var i=this._convertSettingsToConfig(e);}else{i={filterCompList:[]};this.getModel('_visualFilterConfigModel').setData(i);return;}var j=this._getVariantConfig();if(j&&j.config){i.filterCompList.forEach(function(E){if(j.config[E.component.properties.parentProperty]){jQuery.extend(true,E,j.config[E.component.properties.parentProperty]);}});this._oVariantConfig=i;}this.unbindAggregation('content',true);this.getModel('_visualFilterConfigModel').setData(i);this.bindAggregation('content',{path:"_visualFilterConfigModel>/filterCompList",factory:function(I,E){var G=E.getProperty('component'),K=G?G.properties:undefined,L=this._resolveChartType(G?G.type:undefined);return this._createHeaderItems(E.sPath,L,K);}.bind(this),filters:new b("shownInFilterBar",q.EQ,true)});this.fireInitialized();};A.prototype._createHeaderItems=function(i,j,E){var G=this._createFilterItemOfType(j,E),I=E.selectFilters&&E.selectFilters.SelectOptions,K=G.getInParameters(),L=[],N=this;if(K&&K.length>0){K.forEach(function(e){L.push({path:'_filter>/'+e.localDataProperty});});}G.addCustomData(new C({key:'sPath',value:i}));if(E.stringdate){G.addCustomData(new C({key:'stringdate',value:E.stringdate}));}if(N.getEntitySet()===G.getEntitySet()){var Q=N._smartFilterContext.determineMandatoryFilterItems();if(Q&&Q.length>0){Q.forEach(function(e){if(!e.data("isCustomField")){L.push({path:'_filter>/'+e.getName()});}});}}G.bindProperty('dimensionFilter',{path:'_filter>/'+G.getParentProperty(),type:new z()});G.bindProperty('measureField',{path:'_visualFilterConfigModel>'+i+'/component/properties/measureField'});G.bindProperty('sortOrder',{path:'_visualFilterConfigModel>'+i+'/component/properties/sortOrder'});G.bindProperty('unitField',{path:'_visualFilterConfigModel>'+i+'/component/properties/measureField',formatter:function(){var e=N._getMeasureMap();var Z=e[this.getEntitySet()][this.getMeasureField()];return Z?Z.fieldInfo.unit:"";}});if(L&&L.length>0){G.bindProperty('dimensionFilterExternal',{parts:L,formatter:function(){var K=this.getInParameters(),Z=this.getParentProperty();var $,_;if(N.getEntitySet()===this.getEntitySet()){var Q=N._smartFilterContext.determineMandatoryFilterItems();Q.forEach(function(o1){var p1=o1.getName();var q1=K&&K.some(function(e){return e.localDataProperty===p1;});if(p1.indexOf("$Parameter")===-1&&!q1){K.push({localDataProperty:p1,valueListProperty:p1});}});}if(!(N.getEntitySet()===this.getEntitySet()&&N._smartFilterContext.getAnalyticBindingPath()!=="")&&(N._smartFilterContext.getAnalyticBindingPath()===""||N._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var a1=this.getMeasureField();var b1=N.getModel();var c1=b1.getMetaModel();var d1=c1.getODataEntityType(N._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var e1=c1.getODataEntitySet(this.getEntitySet());var f1=c1.getODataProperty(d1,a1);var g1=N.getProperty("displayCurrency");var h1=f1&&f1[f.ISOCurrency];if(g1&&h1){var i1=h1.Path;for(var j1=(K.length-1);j1>-1;j1--){var k1=K[j1].valueListProperty;var l1=K[j1].localDataProperty;if(k1===i1){var m1=N._smartFilterContext.getFilterData();if(!m1[l1]){_=c1.getODataProperty(d1,i1);var n1=_&&d.isPropertyNonFilterable(e1,_.name);if(!n1){$=new b({aFilters:[new b({path:i1,operator:"EQ",value1:g1,value2:undefined})],and:false});}}break;}}}}if(this.getId().indexOf("donut")!==-1){this._inParameterFilterList=new b({aFilters:[],bAnd:true});}return N._getFiltersForFilterItem(K,Z,$,i1,I,this._inParameterFilterList);}});}if(G.attachFilterChange){G.attachFilterChange(this._onFilterChange,this);}if(G.attachTitleChange){G.attachTitleChange(this._onTitleChange,this);}var R=this._createTitleToolbar(E,G),U=new g({height:this._cellItemHeightNorth,items:[R]});var W=new g({width:"100%",height:this._cellItemHeightSouth,items:[new o({width:this.cellWidth+"px",textAlign:t.TextAlign.Center,text:{path:'_visualFilterConfigModel>'+i+'/overlayMessage',formatter:function(e){return e&&this.getModel("i18n").getResourceBundle().getText(e);}}})],visible:{path:'_visualFilterConfigModel>'+i+'/showChartOverlay',formatter:function(e){return e;}}});W.addStyleClass("sapUiOverlay");W.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");W.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflowCozy");var X=new g({height:this._cellItemHeightSouth,items:[G],visible:{path:"_visualFilterConfigModel>"+i+"/showChartOverlay",formatter:function(e){return!e;}}});var Y=new g({fieldGroupIds:["headerBar"],height:this._cellHeight,width:this.cellWidth+"px",items:[U,W,X]});return Y;};A.prototype._getAnnotationSettings=function(){return this._annoProvider?this._annoProvider.getVisualFilterConfig():null;};A.prototype._convertSettingsToConfig=function(e,I){var E={filterCompList:[]};var G=this._getGroupList();var K={};for(var i=0;i<G.length;i++){var L=G[i];for(var j=0;j<L.fieldList.length;j++){var N=L.fieldList[j];K[N.name]={name:L.name,label:L.label};}}var Q=this._getGroupMap();var R=Q["_BASIC"];var U=[];if(R&&R.fieldList){for(var i=0;i<R.fieldList.length;i++){U.push(R.fieldList[i].name);}}var W=this._getMeasureMap(),X=e.filterList,Y={};for(var i=0;i<X.length;i++){var Z=X[i];var $=Z.dimension.field;var _=W[Z.collectionPath][Z.measure.field];var a1=false;if(_.fieldInfo[f.ISOCurrency]){a1=true;}var b1={shownInFilterBar:Z.selected,component:{type:Z.type,properties:{sortOrder:Z.sortOrder,measureField:Z.measure.field,parentProperty:Z.parentProperty?Z.parentProperty:undefined,stringdate:Z.stringdate}}};if(!I){var c1={shownInFilterDialog:Z.selected||U.indexOf($)!=-1,group:K[Z.parentProperty],component:{properties:{selectFilters:Z.selectionVariant?Z.selectionVariant:undefined,scaleFactor:Z.scaleFactor,numberOfFractionalDigits:Z.numberOfFractionalDigits,filterRestriction:Z.filterRestriction,lazyLoadVisualFilter:this.getLazyLoadVisualFilter(),width:this.cellWidth+"px",height:this.compHeight+"rem",entitySet:Z.collectionPath?Z.collectionPath:this.getEntitySet(),dimensionField:$,dimensionFieldDisplay:Z.dimension.fieldDisplay,dimensionFilter:Z.dimensionFilter,unitField:_?_.fieldInfo.unit:"",isCurrency:a1,isDropDown:Z.isDropDown,isMandatory:Z.isMandatory,outParameter:Z.outParameter?Z.outParameter:undefined,inParameters:Z.inParameters?Z.inParameters:undefined,textArrangement:Z.displayBehaviour,chartQualifier:Z.chartQualifier?Z.chartQualifier:undefined,dimensionFieldIsDateTime:Z.dimensionFieldIsDateTime}}};jQuery.extend(true,b1,c1);E.filterCompList.push(b1);}else{Y[Z.parentProperty]=b1;}}return I?Y:E;};A.prototype._setVariantModified=function(){if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(true);}};A.prototype._checkMandatoryFilters=function(){var e=this._smartFilterContext.getFilterData();var j=this._smartFilterContext.determineMandatoryFilterItems();var E=false;for(var i=0;i<j.length;i++){if(e[j[i].getName()]===undefined){E=true;break;}}if(E){this._smartFilterContext.showFilterDialog();}};A.prototype._onFilterChange=function(e){this._setVariantModified();this.fireFilterChange();this._checkMandatoryFilters();};A.prototype._getFiltersForFilterItem=function(e,j,E,G,I,K){var L=this;var N={},Q=[],R=[],U=new b({aFilters:[],bAnd:true});var W=function(_,d1){var e1=new b({aFilters:[],bAnd:false});_.Ranges.forEach(function(f1){var g1=f1.Low&&f1.Low.String,h1=f1.Sign&&f1.Sign.EnumMember&&f1.Sign.EnumMember.split("/")[1],i1=f1.Option&&f1.Option.EnumMember&&f1.Option.EnumMember.split("/")[1],j1=f1.High&&f1.High.String;var k1=L._getSelectOptionFilters(d1,g1,j1,i1,h1);e1.aFilters.push(k1);});U.aFilters.push(e1);};if(e&&e.length>0){var X=function(d1){d1.sPath=$;};for(var Y=(e.length-1);Y>-1;Y--){var Z=e[Y].localDataProperty,$=e[Y].valueListProperty;if(I){for(var i=0;i<I.length;i++){var _=I[i];var a1=_.PropertyName&&_.PropertyName.PropertyPath;if(R.indexOf(a1)===-1){if(a1===j){W(_,a1);R.push(a1);}else{var b1=this._smartFilterContext.determineFilterItemByName(a1);if(b1&&(b1.getVisibleInFilterBar()||b1.getPartOfCurrentVariant())){var c1=this._smartFilterContext.getFilters([a1]);if((c1&&c1.length)||(Q.indexOf(a1)!==-1)){continue;}else{W(_,a1);R.push(a1);}}else{W(_,a1);R.push(a1);}}}}}if(Z!==j&&Q.indexOf(Z)===-1){var b1=this._smartFilterContext.determineFilterItemByName(Z);if(b1&&(b1.getVisibleInFilterBar()||b1.getPartOfCurrentVariant())){N=this._smartFilterContext.getFilters([Z]);if(N&&N.length>0){if(N[0].aFilters){N[0].aFilters.forEach(X.bind(this));}else{X(N[0]);}Q.push(Z);U.aFilters.push(N[0]);if(K){K.aFilters.push(N[0]);}}}}}if(E){U.aFilters.push(E);}}else{if(I&&I.length){for(var i=0;i<I.length;i++){var _=I[i];var a1=_.PropertyName&&_.PropertyName.PropertyPath;W(_,a1);}}}return U;};A.prototype._getSelectOptionFilters=function(e,L,i,j,E){if(E==="E"){if(j!==q.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");return;}else{j=q.NE;E="I";}}if(j==="CP"){j=q.Contains;if(L.indexOf("*")!==-1){var G=L.indexOf('*');var I=L.lastIndexOf('*');if(G>-1){if((G===0)&&(I!==(L.length-1))){j=q.EndsWith;L=L.substring(1,L.length);}else if((G!==0)&&(I===(L.length-1))){j=q.StartsWith;L=L.substring(0,L.length-1);}else{L=L.substring(1,L.length-1);}}}}var K=new b({path:e,sign:E,operator:j,value1:L,value2:i});return K;};A.prototype._createTitleToolbar=function(e,i){var j=i.getTitle();var E=new h({text:j.titleMD,titleStyle:t.TitleLevel.H6});if(i.getProperty("isMandatory")){E.addStyleClass("sapMLabelRequired");}var G=new h({text:j.titleUnitCurr.length>1?"| "+j.titleUnitCurr:"",titleStyle:t.TitleLevel.H6,width:"4.15rem"});var I=this._smartFilterContext.getControlByKey(e.parentProperty);this._smartFilterContext.ensureLoadedValueHelp(e.parentProperty);if(I){var K=d.getPropertyNameDisplay(this.getModel(),i.getEntitySet(),i.getDimensionField()),L=this.getModel("i18n").getResourceBundle(),N=I.getShowValueHelp&&I.getShowValueHelp(),Q=I instanceof v,R=Q?"sap-icon://appointment-2":"",U=(e.isDropDown)?"sap-icon://slim-arrow-down":"",W=N?"sap-icon://value-help":R||U,X,Y=new B({text:{path:"_filter>/"+i.getParentProperty(),formatter:function($){var _=i.getFilterRestriction();X=0;if($){if(_==='single'){X=1;}else{if(typeof $==="object"){if($.value){X++;}if($.items&&$.items.length){X+=$.items.length;}if($.ranges&&$.ranges.length){X+=$.ranges.length;}}else{X++;}}}return X?"("+X+")":"";}},icon:(N||e.isDropDown||Q)?W:"",visible:{path:"_filter>/"+i.getParentProperty(),formatter:function($){if(N||e.isDropDown||Q){return true;}else{if(!$){return false;}if(typeof $==="object"){return($.value||($.items&&$.items.length)||($.ranges&&$.ranges.length))?true:false;}return true;}}},press:function($){if(N){I.fireValueHelpRequest.call(I);}else if(e.isDropDown){var _=this._isDimensionFieldFilterable(this.getModel(),e.entitySet,e.dimensionField),a1=this.getModel("visualFilter")||this.getModel();D.createDropdown($.getSource(),i,a1,K,e,_);}else if(Q){k._createDatePicker($.getSource(),i);}else{V.launchAllFiltersPopup(Y,i,$.getSource().getModel('i18n'));}}.bind(this),layoutData:new p({priority:u.OverflowToolbarPriority.NeverOverflow}),tooltip:{path:"_filter>/"+i.getParentProperty(),formatter:function(){return d.getTooltipForValueHelp(N,K,L,X,Q);}}});}var Z=new c({design:u.ToolbarDesign.Transparent,width:this.cellWidth+"px",content:[E,G,new T(),Y]});Z.addStyleClass("sapSmartTemplatesAnalyticalListPageVisualFilterTitleToolbar");return Z;};A.prototype._isDimensionFieldFilterable=function(e,E,i){var j=e.getMetaModel(),G=j.getODataEntitySet(E),I=j.getODataEntityType(G.entityType),K=j.getODataProperty(I,i);return(K["sap:filterable"]===undefined)?true:K["sap:filterable"];};A.prototype.getTitleByFilterItemConfig=function(e,i,j){var E=e.component.properties;var G=E.entitySet;var I=this.getModel();if(!I){return"";}var K=d.getPropertyNameDisplay(I,G,E.measureField);var L=d.getPropertyNameDisplay(I,G,E.dimensionField);if(!i){i="";}if(!j){j="";}var N=this.getModel("i18n").getResourceBundle();var Q=N.getText("VIS_FILTER_TITLE_MD",[K,L]);var R=j+" "+i;R=R.trim();var U={titleMD:Q,titleUnitCurr:R};return U;};A.prototype._onTitleChange=function(e){var i=e.getSource().getParent().getParent();var L=i.getItems()[0].getItems()[0].getContent()[0];var j=i.getItems()[0].getItems()[0].getContent()[1];var E=this.getModel("i18n");if(!E){return"";}var G=E.getResourceBundle();if(e.getSource().getProperty("isMandatory")){L.addStyleClass("sapMLabelRequired");}var I=e.getSource().getTitle();L.setText(I.titleMD);var K=I.titleUnitCurr==""?I.titleMD:G.getText("VIS_FILTER_TITLE_MD_WITH_UNIT_CURR",[I.titleMD,I.titleUnitCurr]);L.setTooltip(K);j.setText(I.titleUnitCurr.length>0?"| "+I.titleUnitCurr:"");j.setTooltip("");var N=I.titleUnitCurr.split(" ");if(I.titleUnitCurr==""){j.setVisible(false);}else{j.setVisible(true);var W=N.length>1?"4.15rem":"2.4rem";j.setWidth(W);}};A.prototype._getSupportedFilterItemList=function(){if(!this._supportedFilterItemList){this._supportedFilterItemList=[{type:"Bar",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroBar",iconLink:"sap-icon://horizontal-bar-chart",textKey:"VISUAL_FILTER_CHART_TYPE_BAR"},{type:"Donut",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroDonut",iconLink:"sap-icon://donut-chart",textKey:"VISUAL_FILTER_CHART_TYPE_Donut"},{type:"Line",className:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.FilterItemMicroLine",iconLink:"sap-icon://line-charts",textKey:"VISUAL_FILTER_CHART_TYPE_Line"}];}return this._supportedFilterItemList;};A.prototype._getSupportedFilterItemMap=function(){if(!this._supportedFilterItemMap){this._supportedFilterItemMap={};var e=this._getSupportedFilterItemList();for(var i=0;i<e.length;i++){var j=e[i];this._supportedFilterItemMap[j.type]=j;}}return this._supportedFilterItemMap;};A.prototype._resolveChartType=function(e){var i=this._getSupportedFilterItemMap();var j=i[e];if(!j){var E;for(E in i){j=i[E];break;}jQuery.sap.log.error("Could not resolve the filter component type: \""+e+"\", falling back to "+E);e=E;}return e;};A.prototype._createFilterItemOfType=function(e,i){var j;if(e===y){j=new l(i);}else if(e===x){j=new m(i);}else if(e===w){j=new n(i);}j.setSmartFilterId(this.getSmartFilterId());j.setModel(this.getModel('i18n'),'i18n');j.setModel(this.getModel("_templPriv"),"_templPriv");if(!this._smartFilterContext.isDialogOpen()){j.setModel(this.getModel('_filter'),'_filter');j.setModel(this.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");}j.setModel(this.getModel());var E=this.getModel("visualFilter");if(E){j.setModel(E,"visualFilter");}return j;};A.prototype.getConfig=function(I){var e=this.getModel('_visualFilterConfigModel').getData(),j={};if(!e){return{filterCompList:[]};}var E=0;var G=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<e.filterCompList.length;i++){var K=e.filterCompList[i];if(I){j[K.component.properties.parentProperty]={shownInFilterBar:K.shownInFilterBar,shownInFilterDialog:K.shownInFilterDialog,component:{type:K.component.type,properties:{measureField:K.component.properties.measureField,sortOrder:K.component.properties.sortOrder,parentProperty:K.component.properties.parentProperty}}};}else{if(!K.shownInFilterBar){continue;}var L=G[E];if(!L){jQuery.sap.log.error("The configured selected filter bar items do not correspond to the actual filter bar items.  Could be an error during initialization, e.g. a chart class not found");return{filterCompList:[]};}E++;if(L._chart){var N=L;K.component.properties=N.getP13NConfig();}}}return I?j:e;};A.prototype.setSmartVariant=function(e){this.setAssociation("smartVariant",e);if(e){var i=new P({type:"sap.suite.ui.generic.template.AnalyticalListPage.control.visualfilterbar.SmartVisualFilterBar",keyName:"persistencyKey"});i.setControl(this);}this._oVariantManagement=this._getVariantManagementControl(e);if(this._oVariantManagement){this._oVariantManagement.addPersonalizableControl(i);this._oVariantManagement.initialise(this._variantInitialised,this);this._oVariantManagement.attachSave(this._onVariantSave,this);}else if(e){if(typeof e==="string"){jQuery.sap.log.error("Variant with id="+e+" cannot be found");}else if(e instanceof sap.ui.core.Control){jQuery.sap.log.error("Variant with id="+e.getId()+" cannot be found");}}else{jQuery.sap.log.error("Missing SmartVariant");}};A.prototype._getVariantManagementControl=function(e){var i=null;if(e){i=typeof e=="string"?sap.ui.getCore().byId(e):e;if(i&&!(i instanceof S)){jQuery.sap.log.error("Control with the id="+e.getId?e.getId():e+" not of expected type");return null;}}return i;};A.prototype._variantInitialised=function(){if(!this._oCurrentVariant){this._oCurrentVariant="STANDARD";}};A.prototype._onVariantSave=function(){if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant={config:this.getConfig(true)};}};A.prototype.applyVariant=function(e,i){this._oCurrentVariant=e;if(this._oCurrentVariant=="STANDARD"){this._oCurrentVariant=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config&&this._oCurrentVariant.config.filterCompList){this._oCurrentVariant.config=null;}if(this._oCurrentVariant&&this._oCurrentVariant.config==null){var j=this._getAnnotationSettings();if(j&&j.filterList){this._oCurrentVariant.config=this._convertSettingsToConfig(j,true);}}this._updateFilterBar();if(this._oVariantManagement){this._oVariantManagement.currentVariantSetModified(false);}};A.prototype._getVariantConfig=function(){return this._oCurrentVariant;};A.prototype.fetchVariant=function(){if(!this._oCurrentVariant||this._oCurrentVariant=="STANDARD"){var e=this._getAnnotationSettings();if(e&&e.filterList){this._oCurrentVariant={config:this._convertSettingsToConfig(e,true)};return this._oCurrentVariant;}else{return{config:null};}}return{config:this.getConfig(true)};};A.prototype._getStandardVariantConfig=function(){var e=this._getAnnotationSettings();var i=this._convertSettingsToConfig(e);return i;};A.prototype.updateVisualFilterBindings=function(e,U){if(U){for(var i in this.filterChartList){var j=this.filterChartList[i];if(j._chart){j._updateBinding();j._bAllowBindingUpdateOnPropertyChange=e===true;}}}else{var E=sap.ui.getCore().byFieldGroupId("headerBar");for(var i=0;i<E.length;i++){if(E[i]._chart){E[i]._updateBinding();E[i]._bAllowBindingUpdateOnPropertyChange=e===true;}}}};A.prototype.addVisualFiltersToBasicArea=function(e){var j=jQuery.extend(true,{},this.getModel('_visualFilterConfigModel').getData()),E=(e&&e.constructor===Array&&e.length)?e.length:0,G=0;if(!j){jQuery.sap.log.error("Could not add filter to basic area. No config found!");return false;}else if(!E){jQuery.sap.log.error("Improper parameter passed. Pass an array of properties.");return false;}else{for(var i=0;i<j.filterCompList.length;i++){var I=j.filterCompList[i];if(e.indexOf(d.readProperty(I.component.properties.parentProperty))!==-1&&!I.shownInFilterBar){I.shownInFilterBar=true;I.shownInFilterDialog=true;G++;}}if(G){this.getModel('_visualFilterConfigModel').setData(j);return true;}else{jQuery.sap.log.info("Filters already present in visual filter basic area");return false;}}};return A;},true);
