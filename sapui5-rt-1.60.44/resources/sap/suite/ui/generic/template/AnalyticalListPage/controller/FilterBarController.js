sap.ui.define(["sap/m/SegmentedButtonItem","sap/m/Button","sap/m/ButtonType","sap/m/Text","sap/m/Dialog","sap/m/SegmentedButton","sap/suite/ui/generic/template/AnalyticalListPage/controller/VisualFilterDialogController","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/ui/Device","sap/suite/ui/generic/template/AnalyticalListPage/util/CommonUtil"],function(S,B,a,T,D,b,V,C,F,c,d){"use strict";var e="visual",f="sap.suite.ui.generic.template.customData",g="sap.suite.ui.generic.template.genericData",h="sap.suite.ui.generic.template.extensionData";var j=C.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.FilterBarController",{init:function(s){this.compactFilterData={};var m=this;m.oState=s;var i;if(c.system.phone){i=true;}else{i=m.oState.oController.getOwnerComponent().getShowGoButtonOnFilterBar()?true:false;}s.oSmartFilterbar.setShowGoOnFB(i);s.oSmartFilterbar.setLiveMode(!i);s.oSmartFilterbar.setShowMessages(i);if(s.oSmartTable){s.oSmartTable.setEnableAutoBinding(!i);}if(!i){m.oState.oSmartFilterbar._oFiltersButton.setVisible(false);}s.oHeader=s.oPage.getHeader();s.oTitle=s.oPage.getTitle();if(s.alr_visualFilterBar){s.alr_visualFilterBar.setSmartFilterContext(this.oState.oSmartFilterbar);s.alr_visualFilterBar.attachFilterChange(this._onVisualFilterChange.bind(this));}s.oSmartFilterbar.attachAfterVariantLoad(this._afterVariantLoad.bind(this));},_updateFilterLink:function(){var o=this.oState.oSmartFilterbar.retrieveFiltersWithValues(),t=this.oState.oController.getOwnerComponent().getModel("_templPriv");t.setProperty('/alp/filtersLink',o);},_afterVariantLoad:function(E){if(this.oState.alr_visualFilterBar){var i=this.oState.oSmartFilterbar.isDialogOpen();if(i){this.oState.alr_visualFilterBar.updateVisualFilterBindings.apply(this.oState.visualFilterDialogContainer,[true,true]);}else{this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}}if(this.oState.oSmartFilterbar.isLiveMode()&&E.mParameters.context!="INIT"){this.oState.oSmartFilterbar.search();}},_afterSFBVariantLoad:function(){var o=this.oState.oSmartFilterbar.getFilterData();if(o._CUSTOM!==undefined){this.oState.oIappStateHandler.fnRestoreFilterState(o._CUSTOM);}else{var i=this.oState.oIappStateHandler.getFilterState();d.nullify(i[f]);d.nullify(i[g]);d.nullify(i[h]);this.oState.oIappStateHandler.fnRestoreFilterState(i);}this.oState.oIappStateHandler.fnStoreCurrentAppStateAndAdjustURL();},_onVisualFilterChange:function(E){if(E.getParameter('propertyName')&&E.getParameter('bVisible')!==undefined){var o=this.oState.oSmartFilterbar.determineFilterItemByName(E.getParameter('propertyName'));if(E.getParameter('bVisible')){if(!o.getPartOfCurrentVariant()){o.setPartOfCurrentVariant(true);o.setVisibleInFilterBar(true);}}else{o.setPartOfCurrentVariant(false);o.setVisibleInFilterBar(false);}}var i=this.oState.oSmartFilterbar.isDialogOpen();if(i&&this.oState.visualFilterDialogContainer){var k=this.oState.visualFilterDialogContainer.oVerticalBox.getModel("_dialogFilter");var l=k.getData();this.oState.oSmartFilterbar.setFilterData(l,true);}else{var m=this.oState.oController.getOwnerComponent().getModel("_filter");var n=m.getData();this.oState.oSmartFilterbar.setFilterData(n,true);}if(this.oState.oSmartFilterbar.isLiveMode()&&!i){this.oState.oSmartFilterbar.search();}},onGoFilter:function(){this.oState.oSmartFilterbar.search();},setDefaultFilter:function(m){var t=this.oState.oController.getOwnerComponent().getModel("_templPriv");t.setProperty('/alp/filterMode',m);this.handleFilterSwitch(m);},handleFilterSwitch:function(m,A){var o=this.oState.oController.getOwnerComponent();var t=o.getModel("_templPriv");if(t.getProperty('/alp/filterMode')===e){if(o.getLazyLoadVisualFilter()&&!this.oState.oSmartFilterbar.isDialogOpen()){this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}this.fnCheckMandatory();}},fnCheckMandatory:function(){this.oState.oSmartFilterbar.checkSearchAllowed(this.oState);var t=this.oState.oController.getOwnerComponent().getModel("_templPriv");if(this.oState.alr_visualFilterBar&&this.oState.alr_visualFilterBar.bIsInitialised&&t.getProperty('/alp/searchable')===false){this.oState.oSmartFilterbar.showFilterDialog();}},showDialog:function(){this.oState.oSmartFilterbar.showFilterDialog();},clearFilters:function(){var o=this.oState.oSmartFilterbar.getFilterData();for(var p in o){if(o.hasOwnProperty(p)){delete o[p];}}this.oState.oSmartFilterbar.setFilterData(o,true);if(this.oState.chartController){this.oState.chartController._updateTable();}},changeVisibility:function(E){var o=E.getParameters().filterItem.filterItem,v=E.getParameters().added?true:false,k=this.oState.visualFilterDialogContainer;var l=k.oVerticalBox.getModel('_visualFilterDialogModel').getData().filterCompList;for(var i=0;i<l.length;i++){if(o&&o.getName()===l[i].component.properties.parentProperty){k.oConfig.filterCompList[i].shownInFilterDialog=v;k.oConfig.filterCompList[i].shownInFilterBar=v;k._updateVisualFilterConfigModel(i,'/shownInFilterDialog',v);k.selectCheckBox(i,v);break;}}k._reloadForm();}});return j;});
