sap.ui.define(["sap/ui/base/Object","sap/ui/model/Context","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms","sap/ui/core/Locale","sap/ui/core/format/NumberFormat","sap/ui/model/FilterOperator"],function(B,C,V,L,N,F){"use strict";var K=B.extend("sap.suite.ui.generic.template.AnalyticalListPage.util.KpiUtil");K.getNumberValue=function(v){if(v){var a=Object.keys(v)[0];return(v&&a&&["String","Int","Decimal","Double","Single"].indexOf(a)!==-1)?Number(v[a]):undefined;}};K.getBooleanValue=function(v,d){if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;};K.getPrimitiveValue=function(v){var a;if(v){if(v.String!==undefined){a=v.String;a=(a.indexOf(">")>0)?a.split("{")[1].split("}")[0]:a;}else if(v.Bool){a=K.getBooleanValue(v);}else if(v.EnumMember){a=v.EnumMember.split("/")[1];}else{a=K.getNumberValue(v);}}return a;};K.getPathOrPrimitiveValue=function(i){if(i){return(i.Path)?"{path:'"+i.Path+"'}":K.getPrimitiveValue(i);}else{return"";}};K.isBindingValue=function(v){return(typeof v==="string")&&v.charAt(0)==="{";};K.getNumberFormatter=function(s,a,m){var f=N.getIntegerInstance({style:"short",minFractionDigits:0,maxFractionDigits:m,showScale:s,shortRefNumber:a});return f;};K.determineThousandsRefNumber=function(s){var a=s;if(s>=1000){var t=0;while(a>=1000){a/=1000;t++;}return t==0?undefined:t*1000;}else{return undefined;}};K.formatNumberForPresentation=function(v,n,i){var a=Number(v);var c=sap.ui.getCore().getConfiguration().getLanguage();var o=new L(c);var b=N.getFloatInstance({style:i?undefined:"short",showScale:i?undefined:true,minFractionDigits:0,maxFractionDigits:1,decimals:n},o).format(a);return b;};K.getUnitofMeasure=function(m,e){return(e&&(e["Org.OData.Measures.V1.ISOCurrency"]||e["Org.OData.Measures.V1.Unit"]))?e["Org.OData.Measures.V1.ISOCurrency"]||e["Org.OData.Measures.V1.Unit"]:"";};K.isRelative=function(d){var t=d.TrendCalculation;var r=false;if(t){var a=t.IsRelativeDifference.DefaultValue;r=K.getBooleanValue(t.IsRelativeDifference,a?({"true":true,"false":false})[a.toLowerCase()]:false);}return r;};K.getFilter=function(r,s,p){var f;if(!p){f={path:s.PropertyName.PropertyPath,operator:r.Option.EnumMember.split("/")[1],value1:r.Low.String,value2:r.High?r.High.String:"",sign:r.Sign.EnumMember===V.SelectionRangeSignType+"/I"?"I":"E"};}else{f={path:p,operator:r.Option,value1:r.Low,value2:r.High,sign:r.Sign};}if(f.sign==="E"&&f.operator!==F.EQ){jQuery.sap.log.error("Exclude sign is supported only with EQ operator");return;}else{if(f.sign==="E"&&f.operator===F.EQ){f.operator=F.NE;f.sign="I";}}if(f.operator==="CP"&&!s){var i=F.Contains;var v=f.value1;if(v){var n=v.indexOf('*');var a=v.lastIndexOf('*');if(n>-1){if((n===0)&&(a!==(v.length-1))){i=F.EndsWith;v=v.substring(1,v.length);}else if((n!==0)&&(a===(v.length-1))){i=F.StartsWith;v=v.substring(0,v.length-1);}else{v=v.substring(1,v.length-1);}}}f.operator=i;f.value1=v;}return f;};K.updateKpiList=function(k,p){try{var l=this.getKpiList(k.getModelName(),k.getGroupId(),k.getId());l.bProcessed=p;}catch(e){jQuery.sap.log.error("KPI processing failed: "+k.getId()+" : "+e);}};K.addToKpiList=function(s,k){try{var g,m,a;m=s.modelName;g=s.groupId||k.getGroupId();a=s.id;this.oKpiList=this.oKpiList||{};var o=this.oKpiList[m]=this.oKpiList[m]||{};o[g]=o[g]||{};o[g][a]={bProcessed:false};}catch(e){jQuery.sap.log.error("KPI processing failed: "+a+" : "+e);}};K.getKpiList=function(m,g,k){var l=this.oKpiList;if(m||m===""){l=l[m];if(g){l=l[g];if(k){l=l[k];}}}return l;};return K;},true);
